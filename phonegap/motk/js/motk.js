var WTK_HOST_NAME="http://www.drawapp8.com";function wtkGetHostName(){return""}function wtkSetHostName(a){WTK_HOST_NAME=a;return}function wtkGetImageRoot(){return wtkGetHostName()+"/base/images/"}function wtkGetImageURL(a){return wtkGetHostName()+"/base/images/"+a}var browser={versions:function(){var a=navigator.userAgent,b=navigator.appVersion;return{ie9:a.indexOf("MSIE 9.0")>-1,ie10:a.indexOf("MSIE 10.0")>-1,ie:a.indexOf("MSIE")>-1,oldIE:a.indexOf("MSIE 8.0")>-1||a.indexOf("MSIE 7.0")>-1||a.indexOf("MSIE 6.0")>-1,android:a.indexOf("Android")>-1&&a.indexOf("Linux")>-1,iPhone:a.indexOf("iPhone")>-1,iPad:a.indexOf("iPad")>-1,blackberry:a.indexOf("BlackBerry")>-1,firefoxMobile:a.indexOf("Mobile")>-1&&a.indexOf("Firefox")>-1,windowPhone:a.indexOf("Windows Phone")>-1,webkit:a.indexOf("WebKit")>-1}}()};function isWebkit(){return browser.versions.webkit}if(browser.versions.oldIE||browser.versions.ie9){window.console={};window.console.log=function(a){}}var gForceMobile=false;function setForceMobile(a){gForceMobile=a;return}function isOldIE(){return browser.versions.oldIE}function isIE(){return browser.versions.ie}if(browser.versions.oldIE){console.log("oldIE "+browser.versions.oldIE)}function isMobile(){return gForceMobile||browser.versions.android||browser.versions.iPhone||browser.versions.blackberry||browser.versions.windowPhone||browser.versions.firefoxMobile}function isAndroid(){return browser.versions.android}function isIPhone(){return browser.versions.iPhone}function isIPad(){return browser.versions.ipad}function isWinPhone(){return browser.versions.windowPhone}function isBlackBerry(){return browser.versions.blackberry}function isFirefoxMobile(){return browser.versions.firefoxMobile}function isPhoneGap(){return(window.cordova||window.Cordova||window.PhoneGap||window.phonegap)&&/^file:\/{3}[^\/]/i.test(window.location.href)&&/ios|iphone|ipod|ipad|android/i.test(navigator.userAgent)}function isTizen(){return window.tizen}function getBrowserVersionNumber(){var d=navigator.userAgent;var e=["AppleWebKit/","AppleWebKit ","AppleWebKit","MSIE ","Firefox/","Safari/","Opera ","Opera/"];for(var c=0;c<e.length;c++){var b=e[c];var g=d.indexOf(b);if(g>=0){var f=d.substr(g+b.length);var a=parseFloat(f);return a}}return 1}browser.versions.number=getBrowserVersionNumber();function browserVersion(){return browser.versions.number}console.log(navigator.userAgent+" version number="+browserVersion());(function(t){var j=t.Base64;var e="2.1.2";var u;if(typeof module!=="undefined"&&module.exports){u=require("buffer").Buffer}var r="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";var c=function(G){var F={};for(var E=0,D=G.length;E<D;E++){F[G.charAt(E)]=E}return F}(r);var z=String.fromCharCode;var B=function(E){if(E.length<2){var D=E.charCodeAt(0);return D<128?E:D<2048?(z(192|(D>>>6))+z(128|(D&63))):(z(224|((D>>>12)&15))+z(128|((D>>>6)&63))+z(128|(D&63)))}else{var D=65536+(E.charCodeAt(0)-55296)*1024+(E.charCodeAt(1)-56320);return(z(240|((D>>>18)&7))+z(128|((D>>>12)&63))+z(128|((D>>>6)&63))+z(128|(D&63)))}};var l=/[\uD800-\uDBFF][\uDC00-\uDFFFF]|[^\x00-\x7F]/g;var g=function(D){return D.replace(l,B)};var s=function(G){var F=[0,2,1][G.length%3],D=G.charCodeAt(0)<<16|((G.length>1?G.charCodeAt(1):0)<<8)|((G.length>2?G.charCodeAt(2):0)),E=[r.charAt(D>>>18),r.charAt((D>>>12)&63),F>=2?"=":r.charAt((D>>>6)&63),F>=1?"=":r.charAt(D&63)];return E.join("")};var m=t.btoa?function(D){return t.btoa(D)}:function(D){return D.replace(/[\s\S]{1,3}/g,s)};var q=u?function(D){return(new u(D)).toString("base64")}:function(D){return m(g(D))};var f=function(D,E){return !E?q(D):q(D).replace(/[+\/]/g,function(F){return F=="+"?"-":"_"}).replace(/=/g,"")};var w=function(D){return f(D,true)};var d=new RegExp(["[\xC0-\xDF][\x80-\xBF]","[\xE0-\xEF][\x80-\xBF]{2}","[\xF0-\xF7][\x80-\xBF]{3}"].join("|"),"g");var v=function(F){switch(F.length){case 4:var D=((7&F.charCodeAt(0))<<18)|((63&F.charCodeAt(1))<<12)|((63&F.charCodeAt(2))<<6)|(63&F.charCodeAt(3)),E=D-65536;return(z((E>>>10)+55296)+z((E&1023)+56320));case 3:return z(((15&F.charCodeAt(0))<<12)|((63&F.charCodeAt(1))<<6)|(63&F.charCodeAt(2)));default:return z(((31&F.charCodeAt(0))<<6)|(63&F.charCodeAt(1)))}};var b=function(D){return D.replace(d,v)};var a=function(H){var D=H.length,F=D%4,G=(D>0?c[H.charAt(0)]<<18:0)|(D>1?c[H.charAt(1)]<<12:0)|(D>2?c[H.charAt(2)]<<6:0)|(D>3?c[H.charAt(3)]:0),E=[z(G>>>16),z((G>>>8)&255),z(G&255)];E.length-=[0,0,2,1][F];return E.join("")};var h=t.atob?function(D){return t.atob(D)}:function(D){return D.replace(/[\s\S]{1,4}/g,a)};var A=u?function(D){return(new u(D,"base64")).toString()}:function(D){return b(h(D))};var o=function(D){return A(D.replace(/[-_]/g,function(E){return E=="-"?"+":"/"}).replace(/[^A-Za-z0-9\+\/]/g,""))};var C=function(){var D=t.Base64;t.Base64=j;return D};t.Base64={VERSION:e,atob:h,btoa:m,fromBase64:o,toBase64:f,utob:g,encode:f,encodeURI:w,btou:b,decode:o,noConflict:C};if(typeof Object.defineProperty==="function"){var p=function(D){return{value:D,enumerable:false,writable:true,configurable:true}};t.Base64.extendString=function(){Object.defineProperty(String.prototype,"fromBase64",p(function(){return o(this)}));Object.defineProperty(String.prototype,"toBase64",p(function(D){return f(this,D)}));Object.defineProperty(String.prototype,"toBase64URI",p(function(){return f(this,true)}))}}if(!t.atob){t.atob=t.Base64.atob;t.btoa=t.Base64.btoa}})(this);Array.prototype.remove=function(c,b){for(var a=0;a<this.length;++a){if(this[a]===c){this.splice(a,1);if(!b){break}}}return};Array.prototype.insert=function(a,b){if(a>=0&&a<this.length){this.splice(a,0,b)}else{this.push(b)}return};Array.prototype.indexOf=function(b){for(var a=0;a<this.length;++a){if(this[a]===b){return a}}return -1};Array.prototype.binarySearch=function(f,b){var c=0;var a=0;var e=0;var d=this.length-1;while(a<=d){c=(a+d)>>1;e=b(this[c],f);if(e<0){a=c+1;continue}if(e>0){d=c-1;continue}return c}return -1};Array.prototype.has=function(a){return this.indexOf(a)>=0};Array.prototype.clear=function(){for(var b=0;b<this.length;b++){var a=this[b];if(typeof a!="object"){continue}if(a&&a.destroy&&typeof a.destroy=="function"){a.destroy()}delete a}this.length=0};Array.prototype.copy=function(c){this.clear();for(var a=0;a<c.length;++a){var b=c[a];if(b&&b.dup){b=b.dup()}this.push(b)}return};function makeUniqRandArray(f,b){if(f>=b){return null}var a=[];var c=b-f+1;for(var e=0;e<c;e++){do{var d=f+Math.floor(Math.random()*c);if(!a.has(d)){a.push(d);break}}while(1)}return a}function fixRect(a){if(a.w<0){a.x=a.x+a.w;a.w=-a.w}if(a.h<0){a.y=a.y+a.h;a.h=-a.h}return a}function isPointInRect(a,b){return a.x>=b.x&&a.y>=b.y&&a.x<(b.x+b.w)&&a.y<(b.y+b.h)}function createXMLHTTTPRequest(){var c=null;if(isIE()){try{c=new ActiveXObject("Msxml2.XMLHTTP")}catch(b){try{c=new ActiveXObject("Microsoft.XMLHTTP")}catch(a){c=null}}}if(!c&&typeof XMLHttpRequest!=="undefined"){c=new XMLHttpRequest()}return c}function wtkAddEventListener(a,b){if(window.attachEvent){window.attachEvent(a,b)}else{if(window.addEventListener){window.addEventListener(a,b)}else{document.addEventListener(a,b,true)}}return}String.prototype.replaceAll=function(a,c,b){if(!RegExp.prototype.isPrototypeOf(a)){return this.replace(new RegExp(a,(b?"gi":"g")),c)}else{return this.replace(a,c)}};function fixJson(b){var a=0;var d="";b=b.replaceAll("<br>","");var f=b.length;for(a=0;a<f;a++){var e=b.charAt(a);if(e==="“"||e==="”"){e='"'}d=d+e}return d}String.prototype.trim=function(){return String(this).replace(/^\s+|\s+$|^\n+|\n+$/g,"")};function drawDashedRect(c,a,l,b,d){var g=8;var j=4;c.beginPath();drawDashedLine(c,{x:a,y:l},{x:b,y:l},g,j);drawDashedLine(c,{x:a,y:d},{x:b,y:d},g,j);drawDashedLine(c,{x:a,y:l},{x:a,y:d},g,j);drawDashedLine(c,{x:b,y:l},{x:b,y:d},g,j);return}function drawDashedLine(b,c,g,h,j){if(!b||!c||!g||!h){return}var m=c.x;var l=c.y;b.moveTo(m,l);if(!j){b.lineTo(g.x,g.y);return}var p=g.x-c.x;var o=g.y-c.y;var a=Math.sqrt(p*p+o*o);var d=Math.atan(o/p);b.save();b.translate(c.x,c.y);b.rotate(d);if(g.x<c.x){b.translate(-a,0)}b.moveTo(0,0);m=0;while(m<a){m+=h;if(m>a){m=a}b.lineTo(m,0);m+=j;b.moveTo(m,0)}b.restore();return}var C_ARROW_NONE=0;var C_ARROW_NORMAL=1;var C_ARROW_CIRCLE=2;var C_ARROW_RECT=3;var C_ARROW_DIAMOND=4;var C_ARROW_TRI=5;var C_ARROW_FILL_CIRCLE=1<<8|C_ARROW_CIRCLE;var C_ARROW_FILL_RECT=1<<8|C_ARROW_RECT;var C_ARROW_FILL_DIAMOND=1<<8|C_ARROW_DIAMOND;var C_ARROW_FILL_TRI=1<<8|C_ARROW_TRI;function drawArrowHeaderNormal(a,b){a.translate(-b/2,0);a.moveTo(-b/2,-b/2);a.lineTo(b/2,0);a.lineTo(-b/2,b/2);a.stroke();a.beginPath();return}function drawArrowHeaderTri(a,b){a.translate(-b/2,0);a.moveTo(b/2,0);a.lineTo(-b/2,-b/2);a.lineTo(-b/2,b/2);a.lineTo(b/2,0);return}function drawArrowHeaderCircle(a,b){a.translate(-b/2,0);a.arc(0,0,b/2,Math.PI*2,0);return}function drawArrowHeaderRect(a,b){a.translate(-b/2,0);a.rect(-b/2,-b/2,b,b);return}function drawArrowHeaderRRect(a,b){a.translate(-b/2,0);a.rotate(Math.PI/4);a.rect(-b/2,-b/2,b,b);return}var arrow_draw_header=[null,drawArrowHeaderNormal,drawArrowHeaderCircle,drawArrowHeaderRect,drawArrowHeaderRRect,drawArrowHeaderTri];function drawArrow(a,g,b,d,f){var m=10;if(!a||!b||!d){return}var l=g>>8;g=g&255;if(g<=0||g>=arrow_draw_header.length){return}if(f){m=f}var e=(d.y-b.y)/(d.x-b.x);var c=Math.atan(e);if(d.x<b.x){c=c+Math.PI}var j=a.fillStyle;var h=a.strokeStyle;a.save();a.translate(d.x,d.y);a.rotate(c);a.beginPath();m=m+a.lineWidth-1;arrow_draw_header[g](a,m);a.closePath();if(l){a.fillStyle=h}else{a.fillStyle="White"}if(g>1){a.fill()}a.stroke();a.restore();a.fillStyle=j;a.strokeStyle=h;return}var gCacheCanvas=null;function CacheCanvasGet(b,a){if(!gCacheCanvas){gCacheCanvas=document.createElement("canvas");gCacheCanvas.type="backend_canvas";gCacheCanvas.width=b;gCacheCanvas.height=a}if(gCacheCanvas){if(gCacheCanvas.width<b){gCacheCanvas.width=b}if(gCacheCanvas.height<a){gCacheCanvas.height=a}}return gCacheCanvas}function drawNinePatchOnCanvas(b,q,p,o,r,z,e,u){var t=0;var g=0;var l=0;var v=0;var c=Math.floor(r/2)+1;var d=r-c;var j=Math.floor(z/2)+1;var m=z-j;var a=e-r+1;var f=u-z+1;var s=b.getContext("2d");s.clearRect(0,0,e,u);if(e<r){c=Math.floor(e/2)+1;d=e-c}if(u<z){j=Math.floor(u/2)+1;m=u-j}s.drawImage(q,p,o,c,j,0,0,c,j);s.drawImage(q,p+c,o,d,j,e-d,0,d,j);s.drawImage(q,p,o+j,c,m,0,u-m,c,m);s.drawImage(q,p+c,o+j,d,m,e-d,u-m,d,m);if(e>r){v=Math.floor(r/2);for(t=0;;t++){l=Math.pow(2,t);g=v+l;l=Math.min(l,a-l);if(l<=0){break}s.drawImage(b,v,0,l,u,g,0,l,u)}}if(u>z){v=Math.floor(z/2);for(t=0;;t++){dh=Math.pow(2,t);dy=v+dh;dh=Math.min(dh,f-dh);if(dh<=0){break}s.drawImage(b,0,v,e,dh,0,dy,e,dh)}}return}function drawNinePatchEx1(a,c,m,j,o,d,p,l,q,f){var b=CacheCanvasGet(q,f);if(q<0||f<0||o<0||d<0){return}try{drawNinePatchOnCanvas(b,c,m,j,o,d,q,f)}catch(g){console.log(g.message)}a.drawImage(b,0,0,q,f,p,l,q,f);return}function drawNinePatchEx2(a,q,d,c,e,r,g,f,l,t){var o=0;var u=0;var m=0;var j=0;if(!q){a.fillRect(g,f,l,t);return}if(t&1){t=t+1}if(l&1){l=l+1}if(!d){d=0}if(!c){c=0}if(!e||e>q.width){e=q.width}if(!r||r>q.height){r=q.height}var s=Math.floor(e/2);var p=Math.floor(r/2);if(e>l&&r>t){a.drawImage(q,d,c,e,r,g,f,l,t);return}var v=Math.min(s,l/2);var b=Math.min(p,t/2);a.drawImage(q,d,c,v,b,g,f,v,b);a.drawImage(q,d+e-v,c,v,b,g+l-v,f,v,b);a.drawImage(q,d,c+r-b,v,b,g,f+t-b,v,b);a.drawImage(q,d+e-v,c+r-b,v,b,g+l-v,f+t-b,v,b);if(l>e){o=l-2*s;a.drawImage(q,d+v,c,1,b,g+v,f,o,b);a.drawImage(q,d+v,c+r-b,1,b,g+v,f+t-b,o,b)}if(t>r){a.drawImage(q,d,c+b,v,1,g,f+b,v,t-r);m=g+l-s;o=s;a.drawImage(q,d+e-v,c+b,v,1,m,f+b,o,t-r)}if(l>e&&t>r){o=l-2*s;a.drawImage(q,d+v,c+b,1,1,g+v,f+b,o,t-r)}return}function drawNinePatchEx(a,r,e,d,f,s,j,g,m,t){var o=0;var l=0;var v=0;var c=0;var b=0;var q=0;var p=0;var u=0;if(!r){a.fillRect(j,g,m,t);return}if(!f||f>r.width){f=r.width}if(!s||s>r.height){s=r.height}v=Math.floor(f/3);c=Math.floor(s/3);b=f-v-v;q=s-c-c;p=m-v-v;u=t-c-c;a.drawImage(r,e,d,v,c,j,g,v,c);a.drawImage(r,e+f-v,d,v,c,j+m-v,g,v,c);a.drawImage(r,e,d+s-c,v,c,j,g+t-c,v,c);a.drawImage(r,e+f-v,d+s-c,v,c,j+m-v,g+t-c,v,c);if(p>0){if(isWebkit()){a.drawImage(r,e+v,d,b,c,j+v-1,g,p+2,c-1);a.drawImage(r,e+v,d+s-c,b,c,j+v-1,g+t-c+1,p+2,c-1)}else{a.drawImage(r,e+v,d,b,c,j+v-1,g,p+2,c);a.drawImage(r,e+v,d+s-c,b,c,j+v-1,g+t-c,p+2,c)}}if(u>0){a.drawImage(r,e,d+c,v,q,j,g+c-1,v,u+2);a.drawImage(r,e+f-v,d+c,v,q,j+m-v,g+c-1,v,u+2)}if(p>0&&u>0){a.drawImage(r,e+v,d+c,b,q,j+v-1,g+c-1,p+2,u+2)}return}function drawNinePatch(c,e,a,f,b,d){if(!e){c.fillRect(a,f,b,d);return}return drawNinePatchEx(c,e,0,0,e.width,e.height,a,f,b,d)}function drawNinePatchIcon(a,g,m,f,o,d){var b=g.getImage();var j=g.getX();var e=g.getY();var l=g.getWidth();var c=g.getHeight();if(!b){a.fillRect(m,f,o,d);return}return drawNinePatchEx(a,b,j,e,l,c,m,f,o,d)}function drawRoundRect(b,a,c,d){if(d){b.arc(d,d,d,Math.PI,1.5*Math.PI,false);b.lineTo(a-d,0);b.arc(a-d,d,d,1.5*Math.PI,2*Math.PI,false);b.lineTo(a,c-d);b.arc(a-d,c-d,d,0,0.5*Math.PI,false);b.lineTo(d,c);b.arc(d,c-d,d,0.5*Math.PI,Math.PI,false);b.lineTo(0,d)}else{b.rect(0,0,a,c)}return}function getViewPort(){var b;var a;if(typeof window.innerWidth!="undefined"){b=window.innerWidth;a=window.innerHeight}else{if(typeof document.documentElement!="undefined"&&typeof document.documentElement.clientWidth!="undefined"&&document.documentElement.clientWidth!=0){b=document.documentElement.clientWidth;a=document.documentElement.clientHeight}else{b=document.getElementsByTagName("body")[0].clientWidth;a=document.getElementsByTagName("body")[0].clientHeight}}return{width:b,height:a}}if(!window.orgViewPort){window.orgViewPort=getViewPort()}function layoutText(d,r,o,c){var l=0;var h=0;var p=0;var f=0;var m="";var b=new Array();var e=o.split("\n");var g=new TextLayout(d);for(l=0;l<e.length;l++){var q=e[l];if(q){g.setText(q);while(g.hasNext()){var a=g.nextLine(c,r);b.push(a.text)}}else{b.push(" ")}}return b}function codeIsLetter(a){return((a>=97&&a<=122)||(a>=65&&a<=90))}function TextLayout(a){this.canvas=a;this.setText=function(b){this.str=b;this.startOffset=0;this.lineInfo={text:"",width:0};return};this.canBreakBefore=function(b){if(b===" "||b==="\t"||b==="."||b==="]"||b===")"||b==="}"||b===","||b==="?"||b===";"||b===":"||b==="!"||b==='"'||b==="'"||b==="。"||b==="？"||b==="、"||b==="”"||b==="’"||b==="】"||b==="》"||b==="〉"||b==="〕"||b==="）"||b==="："||b==="；"||b==="，"){return false}return true};this.hasNext=function(){return this.startOffset<this.str.length};this.nextLine=function(o,d){var j=false;var f="";var q=this.str;var u=this.startOffset;var e=q.length;var m=Math.floor((o/d)*0.75);var s=e-this.startOffset;if(s<1){this.lineInfo.text="";this.lineInfo.width=0;return null}if(s<m){f=q.substr(this.startOffset,s);this.lineInfo.text=f;this.lineInfo.width=a.measureText(f).width;this.startOffset=this.startOffset+f.length;return this.lineInfo}if(m>3){m=m-3}f=q.substr(this.startOffset,m);var c=0;var t=null;var l=0;var g=null;var b=a.measureText(f).width;var z=Math.floor(o*0.3);var v=2*d;var w=o+z;var h=o-v;for(u=this.startOffset+m;u<e;u++){t=q.charAt(u);c=q.charCodeAt(u);f+=t;l=a.measureText(t).width;b=b+1+l;if(t=="'"){continue}if(b>w){break}if(b<h){continue}if(codeIsLetter(c)){continue}if(c==32){if(b>=o){break}var p=0;for(var r=u+1;r<e;r++){c=q.charCodeAt(r);if(codeIsLetter(c)){p++}else{break}}if(p>7){break}else{continue}}if((u+1)<e){g=q.charAt(u+1);if(b>=o&&this.canBreakBefore(g)){break}}}this.lineInfo.text=f;this.lineInfo.width=a.measureText(f).width;this.startOffset=this.startOffset+f.length;return this.lineInfo};return this}function httpDoRequest(f){var g=null;g=createXMLHTTTPRequest();if(!f||!f.url){return false}var a=f.url;var e=f.data;var h=f.method?f.method:"GET";if(!f.noProxy&&a.indexOf("http")===0&&a.indexOf(window.location.hostname)<0){a="/proxy.php?url="+window.btoa(a)+"&mode=native&full_headers=1&send_cookies=1&send_session=0";if(f.headers&&f.headers["User-Agent"]){var c=f.headers["User-Agent"];a=a+"&ua="+encodeURI(c);delete f.headers["User-Agent"]}}g.open(h,a,true);if(f.noCache){g.setRequestHeader("If-Modified-Since","0")}if(f.headers){for(var b in f.headers){var d=f.headers[b];g.setRequestHeader(b,d)}}if(g){g.send(f.data?f.data:null);if(!g.onprogress){g.onreadystatechange=function(){if(f.onProgress){f.onProgress(g)}if(g.readyState===4){if(f.onDone){f.onDone(true,g,g.responseText)}}return}}else{g.onprogress=function(l){var j=l.total;if(f.onProgress){f.onProgress(g)}console.log("get:"+j)};g.onload=function(j){if(f.onDone){f.onDone(true,g,j.target.responseText)}};g.onerror=function(j){if(f.onDone){f.onDone(false,g,g.responseText)}}}}return true}function dappModifyViewPort(){var f="";var g=document.createElement("meta");var d=document.getElementsByTagName("head")[0];var e=window.devicePixelRatio?window.devicePixelRatio:1;var h=1/e;var c="initial-scale="+h+", minimum-scale="+h+", maximum-scale="+h+", user-scalable=0";if(browser.versions.iPhone){f="width=device-width, "+c}else{if(isAndroid()){var a=browserVersion();if(a>535){f="width=device-width, "+c}else{f="target-densitydpi=device-dpi, width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0"}}else{if(isFirefoxMobile()){var b=getViewPort();f="width="+b.width+", "+c}else{f="width=device-width, "+c}}}g.name="viewport";g.content=f;console.log("viewport: "+f);d.appendChild(g);return}function wtkLog(a){console.log(a);return}var gDelayScripts=new Array();function idrawDelayLoadScript(a){gDelayScripts.push(a);return}function loadDelayScriptsNow(){var c=0;var a=null;var b=null;var d=document.head?document.head:document.body;for(c=0;c<gDelayScripts.length;c++){b=gDelayScripts[c];a=document.createElement("script");a.src=b;d.appendChild(a);console.log("Load: "+b)}gDelayScripts.clear();return}function loadScriptOnce(f){var b=document.scripts;if(b){for(var d=0;d<b.length;d++){var c=b[d];if(c.src&&c.src.indexOf(f)>=0){console.log("script is loaded: "+f);return}}}var e=document.head?document.head:document.body;var a=document.createElement("script");a.src=f;e.appendChild(a);console.log("load script: "+f);return}setTimeout(function(){loadDelayScriptsNow();return},800);function delayLoadScripts(b){var a=getLanguageName();if(b){dappSetResHostName(b)}return}function getScriptByUrl(c){var a=document.getElementsByTagName("script");if(a){for(var d=0;d<a.length;d++){var b=a[d];var e=b.src;if(e.indexOf(c)>=0){return b}}}return null}function isScriptLoaded(a){return getScriptByUrl(a)!=null}var gUserAppScripts=[];function clearUserAppScript(){for(var b=0;b<gUserAppScripts.length;b++){var a=gUserAppScripts[b];if(a.script){console.log("Remove Script:"+a.url);if(a.script.parentNode){try{a.script.parentNode.removeChild(a.script)}catch(c){console.log("Remove Script Failed:"+c.message)}}}}gUserAppScripts.clear();return}function addUserAppScript(a){var b={};b.url=a;b.script=null;b.loaded=false;gUserAppScripts.push(b);return}function notifyUserAppScriptsLoadDone(c){for(var b=0;b<gUserAppScripts.length;b++){var a=gUserAppScripts[b];if(!a.script||!a.script.loaded){return}}c();return}function loadUserAppScripts(d){var c=document.head?document.head:document.body;for(var b=0;b<gUserAppScripts.length;b++){var a=gUserAppScripts[b];a.script=getScriptByUrl(a.url);if(a.script){a.script.loaded=true;notifyUserAppScriptsLoadDone(d);console.log("User App Script Already Loaded: "+a.url);continue}a.script=document.createElement("script");a.script.onload=function(){this.loaded=true;notifyUserAppScriptsLoadDone(d)};a.script.onerror=function(){this.loaded=true;this.error=true;notifyUserAppScriptsLoadDone(d)};a.script.src=a.url;c.appendChild(a.script);console.log("Load User App Script: "+a.url)}return}function getLanguageName(){var a="";if(navigator.language){a=navigator.language}else{if(navigator.userLanguage){a=navigator.userLanguage}}a=a.toLowerCase();return a}var requestAnimFrame=(function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(a){window.setTimeout(a,5)}})();function getQueryParameter(a){var a=a+"=";var b=window.top.location.search.substring(1);if(b.length>0){begin=b.indexOf(a);if(begin!=-1){begin+=a.length;end=b.indexOf("&",begin);if(end==-1){end=b.length}return unescape(b.substring(begin,end))}}return null}window.Modernizr=(function(o,t,g){var c="2.5.3",l={},F=t.documentElement,G="modernizr",D=t.createElement(G),p=D.style,d,w={}.toString,A=" -webkit- -moz- -o- -ms- ".split(" "),h={},b={},u={},C=[],v=C.slice,a,B=function(P,R,K,Q){var J,O,M,I=t.createElement("div"),N=t.body,L=N?N:t.createElement("body");if(parseInt(K,10)){while(K--){M=t.createElement("div");M.id=Q?Q[K]:G+(K+1);I.appendChild(M)}}J=["&#173;","<style>",P,"</style>"].join("");I.id=G;(N?I:L).innerHTML+=J;L.appendChild(I);if(!N){L.style.background="";F.appendChild(L)}O=R(I,P);!N?L.parentNode.removeChild(L):I.parentNode.removeChild(I);return !!O},s=({}).hasOwnProperty,q;if(!j(s,"undefined")&&!j(s.call,"undefined")){q=function(I,J){return s.call(I,J)}}else{q=function(I,J){return((J in I)&&j(I.constructor.prototype[J],"undefined"))}}if(!Function.prototype.bind){Function.prototype.bind=function H(K){var L=this;if(typeof L!="function"){throw new TypeError()}var I=v.call(arguments,1),J=function(){if(this instanceof J){var O=function(){};O.prototype=L.prototype;var N=new O;var M=L.apply(N,I.concat(v.call(arguments)));if(Object(M)===M){return M}return N}else{return L.apply(K,I.concat(v.call(arguments)))}};return J}}function r(I){p.cssText=I}function f(J,I){return r(A.join(J+";")+(I||""))}function j(J,I){return typeof J===I}function m(J,I){return !!~(""+J).indexOf(I)}function z(J,M,L){for(var I in J){var K=M[J[I]];if(K!==g){if(L===false){return J[I]}if(j(K,"function")){return K.bind(L||M)}return K}}return false}var E=(function(L,K){var J=L.join(""),I=K.length;B(J,function(P,R){var O=t.styleSheets[t.styleSheets.length-1],N=O?(O.cssRules&&O.cssRules[0]?O.cssRules[0].cssText:O.cssText||""):"",M=P.childNodes,Q={};while(I--){Q[M[I].id]=M[I]}l.touch=("ontouchstart" in o)||o.DocumentTouch&&t instanceof DocumentTouch||(Q.touch&&Q.touch.offsetTop)===9},I,K)})([,["@media (",A.join("touch-enabled),("),G,")","{#touch{top:9px;position:absolute}}"].join("")],[,"touch"]);h.touch=function(){return l.touch};for(var e in h){if(q(h,e)){a=e.toLowerCase();l[a]=h[e]();C.push((l[a]?"":"no-")+a)}}r("");D=d=null;l._version=c;l._prefixes=A;l.testStyles=B;return l})(this,this.document);(function(C){var c=1;function h(D,E,F){this.screenX=F.screenX||0;this.screenY=F.screenY||0;this.pageX=F.pageX||0;this.pageY=F.pageY||0;this.x=F.x||0;this.y=F.y||0;this.clientX=F.clientX||0;this.clientY=F.clientY||0;this.tiltX=F.tiltX||0;this.tiltY=F.tiltY||0;this.pressure=F.pressure||0;this.hwTimestamp=F.hwTimestamp||0;this.pointerType=E;this.identifier=D}var d={TOUCH:"touch",MOUSE:"mouse",PEN:"pen"};function B(D){D.target.mouseEvent=D}function e(D){D.target.mouseEvent=null}function z(D){D.target.touchList=D.targetTouches}function v(){var D=[];var G;if(this.touchList){for(var F=0;F<this.touchList.length;F++){var H=this.touchList[F];G=new h(H.identifier+2,d.TOUCH,H);D.push(G)}}else{if(this.msPointerList){for(var E in this.msPointerList){if(!this.msPointerList.hasOwnProperty(E)){continue}G=this.msPointerList[E];G=new h(E,G.textPointerType,G);D.push(G)}}}if(this.mouseEvent){D.push(new h(c,d.MOUSE,this.mouseEvent))}return D}function m(E,H,G){var F={};for(var D in G){F[D]=G[D]}F.type=E;F.target=H;H.dispatchEvent(F)}function a(D){D.preventDefault();B(D);var E={pointerType:"mouse",getPointerList:v.bind(this),originalEvent:D};m("pointerdown",D.target,E)}function f(D){D.preventDefault();B(D);var E={pointerType:"mouse",getPointerList:v.bind(this),originalEvent:D};m("pointermove",D.target,E)}function w(D){D.preventDefault();B(D);var E={pointerType:"mouse",getPointerList:v.bind(this),originalEvent:D};m("pointerup",D.target,E)}function A(D){console.log("touchstart");D.preventDefault();z(D);var E={pointerType:"touch",getPointerList:v.bind(this),originalEvent:D};m("pointerdown",D.target,E)}function p(D){D.preventDefault();z(D);var E={pointerType:"touch",getPointerList:v.bind(this),originalEvent:D};m("pointermove",D.target,E)}function r(D){D.preventDefault();z(D);var E={pointerType:"touch",getPointerList:v.bind(this),originalEvent:D};m("pointerup",D.target,E)}function u(D){if(D.target.mouseEvent){console.log(D);D.preventDefault();var E={pointerType:"mouse",getPointerList:v.bind(this),originalEvent:D};m("pointerup",D.target,E)}}function q(D){if(D.pointerType==2){D.textPointerType=d.TOUCH}else{if(D.pointerType==3){D.textPointerType=d.PEN}else{if(D.pointerType==4){D.textPointerType=d.MOUSE}}}if(D.textPointerType==d.MOUSE){D.target.msMouseDown=true}if(!D.target.msPointerList){D.target.msPointerList={}}D.target.msPointerList[D.pointerId]=D;var E={pointerType:D.textPointerType,getPointerList:v.bind(this),originalEvent:D};m("pointerdown",D.target,E)}function t(D){if(D.pointerType==2){D.textPointerType=d.TOUCH}else{if(D.pointerType==3){D.textPointerType=d.PEN}else{if(D.pointerType==4){D.textPointerType=d.MOUSE}}}if(D.textPointerType==d.MOUSE&&!D.target.msMouseDown){return}if(!D.target.msPointerList){D.target.msPointerList={}}D.target.msPointerList[D.pointerId]=D;var E={pointerType:D.textPointerType,getPointerList:v.bind(this),originalEvent:D};m("pointermove",D.target,E)}function j(D){if(D.target.msPointerList){delete D.target.msPointerList[D.pointerId]}if(D.pointerType==2){D.textPointerType=d.TOUCH}else{if(D.pointerType==3){D.textPointerType=d.PEN}else{if(D.pointerType==4){D.textPointerType=d.MOUSE}}}if(D.textPointerType==d.MOUSE){D.target.msMouseDown=false}var E={pointerType:D.textPointerType,getPointerList:v.bind(this),originalEvent:D};m("pointerup",D.target,E)}function b(F){if(!F.isPointerEmitter){if(s()){F.addEventListener("pointerdown",q);F.addEventListener("pointermove",t);F.addEventListener("pointerup",j)}else{if(o()){F.addEventListener("MSPointerDown",q);F.addEventListener("MSPointerMove",t);F.addEventListener("MSPointerUp",j)}else{if(l()){F.addEventListener("touchstart",A);F.addEventListener("touchmove",p);F.addEventListener("touchend",r)}if(!isAndroid()){F.addEventListener("mousedown",a);F.addEventListener("mousemove",f);F.addEventListener("mouseup",w);F.addEventListener("mouseout",u)}}}F.listeners={};F.addEventListener=function(I,J,G){var H=F.listeners[I]?F.listeners[I]:[];H.push(J);F.listeners[I]=H;console.log("addEventListener: "+I);return};F.dispatchEvent=function(K){var J=K.type;var I=F.listeners[J]?F.listeners[J]:[];for(var H=0;H<I.length;H++){var G=I[H];G(K)}return};for(var E in Gesture._gestureHandlers){var D=Gesture._gestureHandlers[E];if(D){D(F)}}F.isPointerEmitter=true}}function l(){return Modernizr.touch}function o(){return window.navigator.msPointerEnabled}function s(){return window.navigator.pointerEnabled}C.pointer={emitPointers:b};function g(F,D){var E=F.prototype.addEventListener;F.prototype.addEventListener=function(H,I,G){D.call(this,H,I,G);E.call(this,H,I,G)}}C._createCustomEvent=m;C._augmentAddEventListener=g;C.PointerTypes=d})(window);(function(b){function a(e,f,c){if(e.indexOf("gesture")===0){var d=Gesture._gestureHandlers[e];if(d){d(this)}else{console.error("Warning: no handler found for {{evt}}.".replace("{{evt}}",e))}}}b.Gesture=b.Gesture||{};b.Gesture._gestureHandlers=b.Gesture._gestureHandlers||{}})(window);(function(c){var d=500;var g=30;function b(h){this.x=h.clientX;this.y=h.clientY}b.prototype.calculateSquaredDistance=function(l){var j=this.x-l.clientX;var h=this.y-l.clientY;return j*j+h*h};function e(m){var h=m.getPointerList();if(h.length!=1){return}var l=new Date();var j=m.originalEvent&&isRightMouseEvent(m.originalEvent);if(l-this.lastDownTime<d&&this.lastPosition&&this.lastPosition.calculateSquaredDistance(h[0])<g*g&&!j){this.isDoubleTap=true;this.eTarget=m.target}this.lastPosition=new b(h[0]);this.lastDownTime=l}function f(j){if(this.isDoubleTap){this.isDoubleTap=false;this.lastDownTime=0;this.lastPosition=null;var h={};clearTimeout(this.longPressTimer);window._createCustomEvent("gesturedoubletap",this.eTarget,h)}}function a(h){h.addEventListener("pointerdown",e);h.addEventListener("pointerup",f)}c.Gesture._gestureHandlers.gesturedoubletap=a})(window);(function(c){var b=600;var g=5;function a(j){this.x=j.clientX;this.y=j.clientY}a.prototype.calculateSquaredDistance=function(m){var l=this.x-m.clientX;var j=this.y-m.clientY;return l*l+j*j};function d(l){clearTimeout(this.longPressTimer);var j=l.getPointerList();if(j.length===1){l.target.longpressInitPosition=new a(j[0]);this.longPressTimer=setTimeout(function(){payload={};window._createCustomEvent("gesturelongpress",l.target,payload)},b)}}function e(l){var j=l.getPointerList();if(l.pointerType===PointerTypes.MOUSE){clearTimeout(this.longPressTimer)}else{if(j.length===1){var m=l.target.longpressInitPosition;if(m&&m.calculateSquaredDistance(j[0])>g*g){clearTimeout(this.longPressTimer)}}}}function f(j){clearTimeout(this.longPressTimer)}function h(j){j.addEventListener("pointerdown",d);j.addEventListener("pointermove",e);j.addEventListener("pointerup",f)}c.Gesture._gestureHandlers.gesturelongpress=h})(window);(function(b){var g=0.2;function e(j,h){this.p1=j;this.p2=h}e.prototype.center=function(){return[(this.p1.pageX+this.p2.pageX)/2,(this.p1.pageY+this.p2.pageY)/2]};e.prototype.span=function(){var j=this.p1.pageX-this.p2.pageX;var h=this.p1.pageY-this.p2.pageY;return Math.sqrt(j*j+h*h)};e.prototype.scaleSince=function(j){var l=this.span();var h=j.span();if(h===0){return 0}else{return l/h}};function c(l){var h=l.getPointerList();if(h.length==2){l.target.scaleReferencePair=new e(h[0],h[1]);var j={scale:1,scaleStart:true};window._createCustomEvent("gesturescale",l.target,j);this.isGestureScale=true}else{this.isGestureScale=false}}function d(l){var h=l.getPointerList();if(h.length==2&&l.target.scaleReferencePair){var o=new e(h[0],h[1]);var m=o.scaleSince(l.target.scaleReferencePair);if(Math.abs(1-m)>g){var j={scale:m,centerX:(l.target.scaleReferencePair.p1.clientX+l.target.scaleReferencePair.p2.clientX)/2,centerY:(l.target.scaleReferencePair.p1.clientY+l.target.scaleReferencePair.p2.clientY)/2};window._createCustomEvent("gesturescale",l.target,j)}}}function f(j){if(this.isGestureScale){var h={scale:1,scaleEnd:true};window._createCustomEvent("gesturescale",j.target,h)}j.target.scaleReferencePair=null}function a(h){h.addEventListener("pointerdown",c);h.addEventListener("pointermove",d);h.addEventListener("pointerup",f)}b.Gesture._gestureHandlers.gesturescale=a})(window);if(typeof KeyEvent==="undefined"){var KeyEvent={DOM_VK_CANCEL:3,DOM_VK_HELP:6,DOM_VK_BACK_SPACE:8,DOM_VK_TAB:9,DOM_VK_CLEAR:12,DOM_VK_RETURN:13,DOM_VK_ENTER:14,DOM_VK_SHIFT:16,DOM_VK_CONTROL:17,DOM_VK_ALT:18,DOM_VK_PAUSE:19,DOM_VK_CAPS_LOCK:20,DOM_VK_ESCAPE:27,DOM_VK_SPACE:32,DOM_VK_PAGE_UP:33,DOM_VK_PAGE_DOWN:34,DOM_VK_END:35,DOM_VK_HOME:36,DOM_VK_LEFT:37,DOM_VK_UP:38,DOM_VK_RIGHT:39,DOM_VK_DOWN:40,DOM_VK_PRINTSCREEN:44,DOM_VK_INSERT:45,DOM_VK_DELETE:46,DOM_VK_0:48,DOM_VK_1:49,DOM_VK_2:50,DOM_VK_3:51,DOM_VK_4:52,DOM_VK_5:53,DOM_VK_6:54,DOM_VK_7:55,DOM_VK_8:56,DOM_VK_9:57,DOM_VK_SEMICOLON:59,DOM_VK_EQUALS:61,DOM_VK_A:65,DOM_VK_B:66,DOM_VK_C:67,DOM_VK_D:68,DOM_VK_E:69,DOM_VK_F:70,DOM_VK_G:71,DOM_VK_H:72,DOM_VK_I:73,DOM_VK_J:74,DOM_VK_K:75,DOM_VK_L:76,DOM_VK_M:77,DOM_VK_N:78,DOM_VK_O:79,DOM_VK_P:80,DOM_VK_Q:81,DOM_VK_R:82,DOM_VK_S:83,DOM_VK_T:84,DOM_VK_U:85,DOM_VK_V:86,DOM_VK_W:87,DOM_VK_X:88,DOM_VK_Y:89,DOM_VK_Z:90,DOM_VK_CONTEXT_MENU:93,DOM_VK_NUMPAD0:96,DOM_VK_NUMPAD1:97,DOM_VK_NUMPAD2:98,DOM_VK_NUMPAD3:99,DOM_VK_NUMPAD4:100,DOM_VK_NUMPAD5:101,DOM_VK_NUMPAD6:102,DOM_VK_NUMPAD7:103,DOM_VK_NUMPAD8:104,DOM_VK_NUMPAD9:105,DOM_VK_MULTIPLY:106,DOM_VK_ADD:107,DOM_VK_SEPARATOR:108,DOM_VK_SUBTRACT:109,DOM_VK_DECIMAL:110,DOM_VK_DIVIDE:111,DOM_VK_BACK_BUTTON:115,DOM_VK_MENU_BUTTON:118,DOM_VK_SEARCH_BUTTON:120,DOM_VK_F1:112,DOM_VK_F2:113,DOM_VK_F3:114,DOM_VK_F4:115,DOM_VK_F5:116,DOM_VK_F6:117,DOM_VK_F7:118,DOM_VK_F8:119,DOM_VK_F9:120,DOM_VK_F10:121,DOM_VK_F11:122,DOM_VK_F12:123,DOM_VK_F13:124,DOM_VK_F14:125,DOM_VK_F15:126,DOM_VK_F16:127,DOM_VK_F17:128,DOM_VK_F18:129,DOM_VK_F19:130,DOM_VK_F20:131,DOM_VK_F21:132,DOM_VK_F22:133,DOM_VK_F23:134,DOM_VK_F24:135,DOM_VK_NUM_LOCK:144,DOM_VK_SCROLL_LOCK:145,DOM_VK_COMMA:188,DOM_VK_PERIOD:190,DOM_VK_SLASH:191,DOM_VK_BACK_QUOTE:192,DOM_VK_OPEN_BRACKET:219,DOM_VK_BACK_SLASH:220,DOM_VK_CLOSE_BRACKET:221,DOM_VK_QUOTE:222,DOM_VK_META:224}}KeyEvent.DOM_VK_BACK=225;var C_EVT_POINTER_DOWN=1;var C_EVT_POINTER_MOVE=0;var C_EVT_POINTER_UP=-1;var C_EVT_KEY_DOWN=2;var C_EVT_KEY_UP=3;var C_EVT_DOUBLE_CLICK=4;var C_EVT_CONTEXT_MENU=5;var C_EVT_LONG_PRESS=6;var C_EVT_SCALE=7;var gCancelDefaultAction=false;function canvasMaxizeIt(b,c){var a=getViewPort();b.style.position="absolute";b.style.top=0;b.style.left=0;if(c||isMobile()){b.width=a.width;b.height=a.height}else{b.width=a.width-20;b.height=a.height*1.8}console.log("canvas size:"+b.width+"x"+b.height);if(b.height<200){b.height=600}if(b.width<300){b.width=600}return}function canvasCreate(b){var a=null;if("string"===typeof b){a=document.getElementById(b)}else{a=b}if(!a){a=document.createElement("canvas");a.type="idraw_canvas";document.body.appendChild(a)}return a}function canvasAttachManager(f,p,j){window.pointer.emitPointers(f);function h(C){return C?C:window.event}function e(E){E=h(E);var D=E.keyCode;if(D===KeyEvent.DOM_VK_F5||D===KeyEvent.DOM_VK_F12||D===KeyEvent.DOM_VK_F11){return true}if(targetIsEditor(E)){return true}if(!p.preprocessEvent(C_EVT_KEY_DOWN,E,D)){return true}p.onKeyDown(D);if(D===KeyEvent.DOM_VK_F8){var C={scale:1,rotation:0};C.isStart=true;p.onGesture(C);C.isStart=false;C.isChange=true;p.onGesture(C);C.isChange=false;C.isEnd=true;p.onGesture(C)}return returnDefaultAction(E)}function c(D){D=h(D);var C=D.keyCode;if(C===KeyEvent.DOM_VK_F5||C===KeyEvent.DOM_VK_F12||C===KeyEvent.DOM_VK_F11){return true}if(targetIsEditor(D)){return true}if(!p.preprocessEvent(C_EVT_KEY_UP,D,C)){return true}p.onKeyUp(C);return returnDefaultAction(D)}if(isTizen()){document.addEventListener("tizenhwkey",function(C){if(C.keyName=="back"){p.onKeyDown(KeyEvent.DOM_VK_BACK_BUTTON);p.onKeyUp(KeyEvent.DOM_VK_BACK_BUTTON);console.log("tizenhwkey back button.")}else{if(C.keyName=="menu"){p.onKeyDown(KeyEvent.DOM_VK_MENU_BUTTON);p.onKeyUp(KeyEvent.DOM_VK_MENU_BUTTON);console.log("tizenhwkey menu button.")}}})}else{if(isPhoneGap()){function u(){p.onKeyDown(KeyEvent.DOM_VK_BACK_BUTTON);p.onKeyUp(KeyEvent.DOM_VK_BACK_BUTTON);return true}function d(){p.onKeyDown(KeyEvent.DOM_VK_MENU_BUTTON);p.onKeyUp(KeyEvent.DOM_VK_MENU_BUTTON);return true}function b(){p.onKeyDown(KeyEvent.DOM_VK_SEARCH_BUTTON);p.onKeyUp(KeyEvent.DOM_VK_SEARCH_BUTTON);return true}document.addEventListener("backbutton",u,false);document.addEventListener("menubutton",d,false);document.addEventListener("searchbutton",b,false)}else{if(!isMobile()){wtkAddEventListener("keyup",c);wtkAddEventListener("keydown",e)}}}function g(D){var C=Math.max(D.pageX,D.x);var E=Math.max(D.pageY,D.y);return{x:C,y:E}}function w(C){return C.originalEvent&&C.originalEvent.touches&&C.originalEvent.touches.length>1}function A(){var C={};C.x=p.lastPointerPoint.x;C.y=p.lastPointerPoint.y;return C}function m(E){var D=E.getPointerList();if(w(E)){console.log("onPointerDown Multi touch.");return cancelDefaultAction(E)}if(isRightMouseEvent(E.originalEvent)){console.log("Right button.");return cancelDefaultAction(E)}var F=D[0];var C=g(F);var G=F.identifier||0;if(p.preprocessEvent(C_EVT_POINTER_DOWN,E,C)){p.onPointerDown(C)}return cancelDefaultAction(E)}function r(E){var D=E.getPointerList();if(w(E)){console.log("onPointerMove Multi touch.");return cancelDefaultAction(E)}if(isRightMouseEvent(E.originalEvent)){console.log("Right button.");return cancelDefaultAction(E)}var F=D[0];var C=g(F);if(p.preprocessEvent(C_EVT_POINTER_MOVE,E,C)){p.onPointerMove(C)}return cancelDefaultAction(E)}function t(D){if(w(D)){console.log("onPointerUp Multi touch.");return cancelDefaultAction(D)}var C=A();if(isRightMouseEvent(D.originalEvent)){console.log("Right mouse up");if(p.preprocessEvent(C_EVT_CONTEXT_MENU,D,C)){p.onContextMenu(C)}return true}else{if(p.preprocessEvent(C_EVT_POINTER_UP,D,C)){p.onPointerUp(C)}}return cancelDefaultAction(D)}f.addEventListener("pointerdown",m,false);f.addEventListener("pointermove",r,false);f.addEventListener("pointerup",t,false);function a(D){var E=D.scale;var C={scale:E,rotation:0};C.isChange=false;C.isStart=D.scaleStart;C.isEnd=D.scaleEnd;if(C.isStart){console.log("scaleStart")}if(C.isEnd){console.log("scaleEnd")}p.onGesture(C);console.log("onGestureScale:"+E);return}function z(D){var C={};C.x=p.lastPointerPoint.x;C.y=p.lastPointerPoint.y;p.onLongPress(C);console.log("onGestureLongPress");return cancelDefaultAction(D)}function l(D){var C=A();p.onDoubleClick(C);console.log("onGestureDoubleTap");return cancelDefaultAction(D)}f.addEventListener("gesturedoubletap",l);f.addEventListener("gesturelongpress",z);f.addEventListener("gesturescale",a);var s=getViewPort();var v=screen.height;function B(){var C=getViewPort();if(s.width!=C.width||s.height!=C.height){j.onSizeChanged();s=C}}window.onresize=function(C){setTimeout(B,50);return};var q=window.orientation;function o(){if(q!==window.orientation){j.onSizeChanged();q=window.orientation}}window.onorientationchange=function(C){setTimeout(o,50);return};document.ontouchend=function(C){return true};return}function cancelDefaultAction(b){var a=b?b:window.event;if(a.preventDefault){a.preventDefault()}else{a.returnValue=false}return false}function filterResults(d,b,a){var c=d?d:0;if(b&&(!c||(c>b))){c=b}return a&&(!c||(c>a))?a:c}function scrollLeft(){return filterResults(window.pageXOffset?window.pageXOffset:0,document.documentElement?document.documentElement.scrollLeft:0,document.body?document.body.scrollLeft:0)}function scrollTop(){return filterResults(window.pageYOffset?window.pageYOffset:0,document.documentElement?document.documentElement.scrollTop:0,document.body?document.body.scrollTop:0)}function isRightMouseEvent(b){var a=false;if(b.which===null){a=(b.button>2&&b.button!==4)}else{a=(b.which>2&&b.which!==2)}return a}function setCancelDefaultAction(a){gCancelDefaultAction=a;return}function returnDefaultAction(a){return(gCancelDefaultAction)?cancelDefaultAction(a):true}function targetIsEditor(c){var a=c.srcElement?c.srcElement:c.target;var b=a.localName?a.localName:a.tagName;b=b.toLowerCase();if(b!="body"&&b!="canvas"){return true}return false}function targetIsCanvas(c){var a=c.srcElement?c.srcElement:c.target;var b=a.localName?a.localName:a.tagName;b=b.toLowerCase();if(b==="canvas"){return true}return false}function Rect(a,d,b,c){this.x=a;this.y=d;this.w=b;this.h=c;return this}Rect.prototype.dup=function(){return new Rect(this.x,this.y,this.w,this.h)};function Point(a,b){this.x=a;this.y=b;return this}Point.prototype.dup=function(){return new Point(this.x,this.y)};Point.prototype.copy=function(a){this.x=a.x;this.y=a.y;return};function pointEqual(b,a){return b.x===a.x&&b.y===a.y}function distanceBetween(f,c){var b=c.x-f.x;var a=c.y-f.y;var e=Math.sqrt(b*b+a*a);return e}function EditorElement(){this.element=null}EditorElement.prototype.setElement=function(a){this.element=a;return};EditorElement.prototype.removeBorder=function(){this.element.style.background="transparent";this.element.style.border="0px solid";this.element.style.outline="none";return};EditorElement.prototype.setFontSize=function(a){this.element.style["font-size"]=a+"pt";return};EditorElement.prototype.show=function(){this.isVisibile=true;this.element.style.visibility="visible";this.element.focus();return};EditorElement.prototype.setInputType=function(a){this.element.type=a;return};EditorElement.prototype.hide=function(){this.isVisibile=false;this.element.style.visibility="hidden";this.element.blur();this.element.onchange=null;return};EditorElement.prototype.move=function(a,b){this.element.style.position="absolute";this.element.style.left=a+"px";this.element.style.top=b+"px";return};EditorElement.prototype.setFontSize=function(a){this.element.style.fontSize=a+"px";return};EditorElement.prototype.resize=function(a,b){this.element.style.width=a+"px";this.element.style.height=b+"px";return};EditorElement.prototype.getText=function(){return this.element.value};EditorElement.prototype.setText=function(a){this.element.value=a;return};function createElement(c,g,a,f,b,d){var e=new EditorElement();c.id=g;e.setElement(c);e.move(a,f);e.resize(b,d);e.setFontSize(14);e.show();return e}var gWtkInput=null;function wtkShowInput(a,e,b,c){var d="wtk_input";if(!gWtkInput){gWtkInput=createSingleLineEdit(d,a,e,b,c)}else{gWtkInput.move(a,e);gWtkInput.resize(b,c);gWtkInput.show()}return gWtkInput}var gWtkTextArea=null;function wtkShowTextArea(a,e,b,c){var d="wtk_textarea";if(!gWtkTextArea){gWtkTextArea=createMultiLineEdit(d,a,e,b,c)}else{gWtkTextArea.move(a,e);gWtkTextArea.resize(b,c);gWtkTextArea.show()}return gWtkTextArea}function wtkMoveEditorWhenResize(){if(gWtkInput&&gWtkInput.isVisibile&&gWtkInput.shape&&gWtkInput.shape.isUIElement){var c=gWtkInput.shape;var e=c.getEditorRect();var a=e.x;var f=e.y;var b=e.w;var d=e.h;gWtkInput.move(a,f);gWtkInput.resize(b,d);console.log("Move Input To: ("+a+", "+f+")")}if(gWtkTextArea&&gWtkTextArea.isVisibile&&gWtkTextArea.shape&&gWtkTextArea.shape.isUIElement){var c=gWtkTextArea.shape;var e=c.getEditorRect();var a=e.x;var f=e.y;var b=e.w;var d=e.h;gWtkTextArea.move(a,f);gWtkTextArea.resize(b,d);console.log("Move TextArea To: ("+a+", "+f+")")}return}function wtkIsEditorActive(){if(gWtkInput&&gWtkInput.isVisibile){return true}if(gWtkTextArea&&gWtkTextArea.isVisibile){return true}return false}function wtkHideAllInput(){if(gWtkInput&&gWtkInput.isVisibile){if(gWtkInput.element.onchange){gWtkInput.element.onchange()}gWtkInput.hide()}if(gWtkTextArea&&gWtkTextArea.isVisibile){if(gWtkTextArea.element.onchange){gWtkTextArea.element.onchange()}gWtkTextArea.hide()}return}function createSingleLineEdit(f,a,e,b,d){var c=document.getElementById(f);if(!c){c=document.createElement("input");document.body.appendChild(c)}return createElement(c,f,a,e,b,d)}function createMultiLineEdit(f,a,e,b,d){var c=document.getElementById(f);if(!c){c=document.createElement("textarea");document.body.appendChild(c)}return createElement(c,f,a,e,b,d)}var C_WIDGET_STATE_NORMAL=0;var C_WIDGET_STATE_ACTIVE=1;var C_WIDGET_STATE_OVER=2;var C_WIDGET_STATE_INSENSITIVE=3;var C_WIDGET_STATE_NR=4;var C_WIDGET_TYPE_NONE=0;var C_WIDGET_TYPE_WINDOW=1;var C_WIDGET_TYPE_DIALOG=2;var C_WIDGET_TYPE_MENU_BAR=3;var C_WIDGET_TYPE_TOOL_BAR=4;var C_WIDGET_TYPE_MENU_ITEM=5;var C_WIDGET_TYPE_MENU_BUTTON=6;var C_WIDGET_TYPE_CONTEXT_MENU_BAR=7;var C_WIDGET_TYPE_MENU=8;var C_WIDGET_TYPE_POPUP=9;var C_WIDGET_TYPE_HBOX=10;var C_WIDGET_TYPE_VBOX=11;var C_WIDGET_TYPE_GRID=12;var C_WIDGET_TYPE_USER=13;var C_WIDGET_TYPE_NR=14;var C_MENU_ITEM_HEIGHT=40;function Widget(d,a,e,b,c){this.id=0;this.text="";this.enable=1;this.visible=0;this.listener=0;this.focusable=1;this.insensitive=0;this.parent=d;this.rect=new Rect(a,e,b,c);this.state=C_WIDGET_STATE_NORMAL;this.point=new Point(0,0);this.children=new Array();this.theme=WidgetThemeGet(this.type);this.lastPointerPoint=new Point(0,0);this.pointerDownPoint=new Point(0,0);if(this.parent!==null){d.appendChild(this)}this.setNeedRelayout=function(f){this.needRelayout=f;return};this.appendChild=function(f){f.parent=this;this.children.push(f);return};this.getManager=function(){return this.getTopWindow().manager};this.isPointerDown=function(){return this.getManager().isPointerDown()};this.isClicked=function(){return this.getManager().isClicked()};this.isAltDown=function(){return this.getManager().isAltDown()};this.isCtrlDown=function(){return this.getManager().isCtrlDown()};this.getApp=function(){return this.getManager().getApp()};this.getCanvas2D=function(){return this.getManager().getCanvas2D()};this.getTopWindow=function(){if(this.parent){return this.parent.getTopWindow()}return this};this.getWidth=function(){return this.rect.w};this.getHeight=function(){return this.rect.h};this.getAbsPosition=function(){var f=this.rect.x;var h=this.rect.y;for(var g=this.parent;g;g=g.parent){f=f+g.rect.x;h=h+g.rect.y}return{x:f,y:h}};this.postRedrawAll=function(){this.getManager().postRedraw(null);return};this.postRedraw=function(f){var g=this.getAbsPosition();if(!f){f={x:0,y:0,w:this.rect.w,h:this.rect.h}}f.x=g.x+f.x;f.y=g.y+f.y;this.getManager().postRedraw(f);return};this.redraw=function(f){var g=this.getAbsPosition();if(!f){f={x:0,y:0,w:this.rect.w,h:this.rect.h}}f.x=g.x+f.x;f.y=g.y+f.y;this.getManager().redraw(f);return};this.findTargetWidgetEx=function(f,h){if(!this.visible){return null}if(!isPointInRect(f,this.rect)){return null}if(h&&this.children.length>0){var o=this.children.length-1;var l=this.point;l.x=f.x-this.rect.x;l.y=f.y-this.rect.y;for(var j=o;j>=0;j--){var m=this.children[j];var g=m.findTargetWidget(l);if(g!==null){return g}}}return this};this.findTargetWidget=function(f){return this.findTargetWidgetEx(f,true)};this.removeChild=function(f){this.children.remove(f);f.parent=null;return};this.setText=function(f){this.text=f;return};this.setID=function(f){this.id=f;return};this.setUserData=function(f){this.userData=f;return};this.setEnable=function(f){this.enable=f;if(!f){this.state=C_WIDGET_STATE_INSENSITIVE}else{if(this.state===C_WIDGET_STATE_INSENSITIVE){this.state=C_WIDGET_STATE_NORMAL}}return};this.setState=function(f){if(this.enable){this.state=f}return};this.measure=function(f){return};this.move=function(f,g){this.rect.x=f;this.rect.y=g;return};this.moveDelta=function(g,f){this.rect.x=this.rect.x+g;this.rect.y=this.rect.y+f;return};this.resize=function(f,g){this.rect.w=f;this.rect.h=g;this.setNeedRelayout(true);return};this.setListener=function(f){this.listener=f;return};this.lookup=function(j){if(this.id===j){return this}if(this.children.length===0){return null}for(var f=0;f<this.children.length;f++){var h=this.children[f];var g=h.lookup(j);if(g!==null){return g}}return null};this.relayout=function(f,g){return};this.paintBackground=function(f){var g=this.theme[this.state].image;if(g){g.draw9Patch(f,this.rect.x,this.rect.y,this.rect.w,this.rect.h)}else{if(this.theme[this.state].bg){f.fillStyle=this.theme[this.state].bg;f.fillRect(this.rect.x,this.rect.y,this.rect.w,this.rect.h)}}return};this.paintSelf=function(f){return};this.beforePaint=function(f){return};this.afterPaint=function(f){return};this.draw=function(f){var h=null;if(!this.visible){return}f.lineWidth=1;f.fillStyle="White";f.strokeStyle="Black";f.beginPath();this.beforePaint(f);this.relayout(f,0);this.paintBackground(f);this.paintSelf(f);if(this.children.length===0){return}f.save();f.translate(this.rect.x,this.rect.y);for(var g=0;g<this.children.length;g++){child=this.children[g];if(child.state===C_WIDGET_STATE_OVER){h=child}else{child.draw(f)}}if(h){h.draw(f)}f.restore();this.afterPaint(f);f.closePath();return};this.isVisible=function(){return this.visible};this.onShow=function(f){return true};this.show=function(f){if(f!=this.visible){this.visible=f;this.onShow(f)}return};this.showAll=function(g){this.show(g);for(var f=0;f<this.children.length;f++){this.children[f].showAll(g)}this.relayout(this.getCanvas2D(),false);if(!this.parent){this.postRedraw()}return};this.onDoubleClick=function(f){return};this.onLongPress=function(f){return};this.onGesture=function(f){return};this.onGesture=function(f){return};this.onPointerDown=function(f){this.getTopWindow().grab(this);if(this.state!==C_WIDGET_STATE_INSENSITIVE){this.state=C_WIDGET_STATE_ACTIVE;this.postRedraw()}return};this.onPointerMove=function(f){return};this.onPointerUp=function(f){if(this.state!==C_WIDGET_STATE_INSENSITIVE){this.state=C_WIDGET_STATE_NORMAL}this.getTopWindow().ungrab();if(this.listener&&this.state!==C_WIDGET_STATE_INSENSITIVE){this.listener(this)}this.postRedraw();return};this.onContextMenu=function(f){return};this.onKeyDown=function(f){console.log("onKeyUp Widget:"+this.id+" code="+f);return};this.onKeyUp=function(f){console.log("onKeyUp Widget:"+this.id+" code="+f);return};return this}function WtkImage(a){this.url=a;this.image=WtkImage.createImage(a);this.setImageSrc=function(b){this.image=WtkImage.createImage(b);return};this.getImageSrc=function(){return this.image.src};this.getImage=function(){var b=this.image;return(b&&b.imageLoaded)?b:null};return}var gRefreshAfterImageLoaded=null;function setRefreshAfterImageLoaded(a){gRefreshAfterImageLoaded=a;return}WtkImage.images={};WtkImage.nullImage=new Image();WtkImage.findImage=function(a){return WtkImage.images[a]};WtkImage.createImage=function(b){if(!b){return WtkImage.nullImage}var a=WtkImage.findImage(b);if(!a){a=new Image();a.src=b;WtkImage.images[b]=a;a.onload=function(c){this.imageLoaded=true;if(gRefreshAfterImageLoaded){gRefreshAfterImageLoaded()}};a.onerror=function(c){this.imageLoaded=false;if(b){console.log("load "+b+" failed:"+c.message)}};a.onabort=function(c){this.imageLoaded=false;if(b){console.log("load "+b+" failed(abort):"+c.message)}}}return a};var gWtkBgIcon=null;function wtkGetBgIconInfo(){if(!gWtkBgIcon){gWtkBgIcon=new IconInfo(wtkGetImageURL("wtk.png"),1,20,20,50)}return gWtkBgIcon}var WtkBgImage={MENU_BAR_BG:0,MENU_BAR_ITEM_ACTIVE_BG:1,MENU_BAR_ITEM_OVER_BG:2,MENU_ITEM_H_SEPERATOR:3,MENU_ITEM_V_SEPERATOR:4,MENU_NORMAL_BG:5};function Gc(b,c,a,d){this.bg=c;this.fg=a;this.font=b;this.image=d;this.dup=function(){var e=new Gc(this.font,this.bg,this.fg,this.image);return e};return}function themeDup(b){var c=new Array();if(!b){console.log("Invalid params.");return null}for(var a=0;a<b.length;a++){c.push(b[a].dup())}return c}function themeCreate(){var a=new Array();a.push(new Gc("13pt Bold sans-serif ","#FFFFFF","#000000",null));a.push(new Gc("13pt Bold sans-serif ","#FFFFFF","#000000",null));a.push(new Gc("13pt Bold sans-serif ","#FFFFFF","#000000",null));a.push(new Gc("13pt Bold sans-serif ","#FFFFFF","Gray",null));return a}var gTheme=null;function wtkThemeGet(){var c=null;var b=null;if(gTheme!==null){return gTheme}gTheme=new Array();for(var a=0;a<C_WIDGET_TYPE_NR;a++){gTheme.push(themeCreate())}c=gTheme[C_WIDGET_TYPE_WINDOW];c[C_WIDGET_STATE_NORMAL].fg="#FFFF00";c=gTheme[C_WIDGET_TYPE_MENU_BUTTON];c[C_WIDGET_STATE_NORMAL].font="10pt sans-serif";c[C_WIDGET_STATE_INSENSITIVE].font="10pt sans-serif";c[C_WIDGET_STATE_OVER].font="10pt sans-serif";c[C_WIDGET_STATE_ACTIVE].font="10pt sans-serif";return gTheme}function WidgetThemeGet(a){var b=wtkThemeGet()[a];return themeDup(b)}function toolbarPaintBackground(b,a){a.save();a.translate(b.rect.x,b.rect.y);if(!b.grad){b.grad=a.createLinearGradient(0,0,0,b.rect.h);b.grad.addColorStop(0,"#A0A0A0");b.grad.addColorStop(0.9,"#D0D0D0");b.grad.addColorStop(1,"#B8B8B8")}a.fillStyle=b.grad;a.shadowColor="Black";a.shadowOffsetX=0;a.shadowOffsetY=0;a.shadowBlur=10;a.beginPath();a.lineWidth=2;drawRoundRect(a,b.rect.w,b.rect.h,5);a.fill();a.restore();return true}function gridMenuPaintBackground(b,a){a.save();a.translate(b.rect.x,b.rect.y);if(!b.grad){b.grad=a.createLinearGradient(0,0,0,b.rect.h);b.grad.addColorStop(0,"#E0E0E0");b.grad.addColorStop(0.99,"#484848");b.grad.addColorStop(1,"#E0E0E0")}a.fillStyle=b.grad;a.shadowColor="Black";a.shadowOffsetX=0;a.shadowOffsetY=0;a.shadowBlur=10;a.beginPath();drawRoundRect(a,b.rect.w,b.rect.h,8);a.fill();a.restore();return true}function menuPaintBackground(b,a){a.save();a.translate(b.rect.x,b.rect.y);if(!b.grad){b.grad=a.createLinearGradient(0,0,0,b.rect.h*3);b.grad.addColorStop(0,"#E0E0E0");b.grad.addColorStop(0.95,"#484848");b.grad.addColorStop(1,"#E0E0E0")}a.fillStyle="White";a.shadowColor="Gray";a.shadowOffsetX=0;a.shadowOffsetY=2;a.shadowBlur=5;a.beginPath();a.lineWidth=1;a.strokeStyle="Gray";if(b.asPopup){drawRoundRect(a,b.rect.w,b.rect.h,5)}else{drawRoundRect(a,b.rect.w,b.rect.h,3)}a.fill();a.shadowBlur=0;a.stroke();a.beginPath();a.restore();return true}function contextMenuBarPaintBackground(b,a){a.save();a.translate(b.rect.x,b.rect.y);a.fillStyle="White";a.strokeStyle="#E0E0E0";drawRoundRect(a,b.rect.w,b.rect.h,5);a.fill();a.stroke();a.restore();return true}function menuBarPaintBackground2(d,a){a.save();a.translate(d.rect.x,d.rect.y);if(!d.grad){d.grad=a.createLinearGradient(0,0,0,d.rect.h);d.grad.addColorStop(0,"#FFFFFF");d.grad.addColorStop(0.25,"#E0E0E0");d.grad.addColorStop(0.5,"#D0D0D0");d.grad.addColorStop(0.75,"#C0C0C0");d.grad.addColorStop(0.95,"gray");d.grad.addColorStop(1,"#D0D0D0");var c=d.children;for(var b=0;b<c.length;b++){var e=c[b];e.theme[0].fg="#000000"}}a.fillStyle=d.grad;a.shadowColor="Black";a.shadowOffsetX=0;a.shadowOffsetY=0;a.shadowBlur=10;a.beginPath();a.fillRect(0,0,d.rect.w,d.rect.h);a.restore();return true}function menuBarPaintBackground(d,a){a.save();a.translate(d.rect.x,d.rect.y);if(!d.grad){d.grad=a.createLinearGradient(0,0,0,d.rect.h);d.grad.addColorStop(0,"#3a3a38");d.grad.addColorStop(0.25,"#33322f");d.grad.addColorStop(0.5,"#2c2c26");d.grad.addColorStop(0.75,"#24231a");d.grad.addColorStop(0.9,"#1c1c11");d.grad.addColorStop(1,"gray");var c=d.children;for(var b=0;b<c.length;b++){var e=c[b];e.theme[0].fg="#F0F0F0"}}a.fillStyle=d.grad;a.shadowColor="Black";a.shadowOffsetX=0;a.shadowOffsetY=0;a.shadowBlur=10;a.beginPath();a.fillRect(0,0,d.rect.w,d.rect.h);a.restore();return true}function menuItemPaintBackground(b,a){if(b.state===C_WIDGET_STATE_NORMAL||b.state===C_WIDGET_STATE_INSENSITIVE){return}a.save();a.translate(b.rect.x,b.rect.y);a.lineWidth=1;a.strokeStyle="Gray";if(b.state===C_WIDGET_STATE_OVER){a.fillStyle="#E0E0E0"}else{a.fillStyle="#C0C0C0"}a.beginPath();drawRoundRect(a,b.rect.w,b.rect.h,8);a.fill();a.stroke();a.restore();return true}function toolbarPaintTitle(d,f,c,a,g,b,e){d.font=c;d.textAlign="left";d.textBaseline="middle";d.fillStyle="Black";d.fillText(f,a+5,g+e/2,b-30);return}function Window(d,a,f,b,e){var c=[null,a,f,b,e];this.type=C_WIDGET_TYPE_WINDOW;Widget.apply(this,c);this.center=false;this.grabWidget=null;this.focusWidget=null;this.manager=d;this.setManager=function(g){this.manager=g;return};this.grab=function(g){this.grabWidget=g};this.ungrab=function(){this.grabWidget=0};this.setCenter=function(g){this.center=g;return};this.moveToCenter=function(){var j=getViewPort();var h=Math.min(this.manager.w,j.width);var l=Math.min(this.manager.h,j.height);var g=(h-this.rect.w)/2;var m=(l-this.rect.h)/2+scrollTop();this.rect.x=g;this.rect.y=m;return};this.onDoubleClick=function(g){var h=this;if(this.grabWidget){h=this.grabWidget}else{h=this.findTargetWidget(g)}if(h&&h!==this){h.onDoubleClick(g);this.focusWidget=h}return};this.onLongPress=function(g){var h=this;if(this.grabWidget){h=this.grabWidget}else{h=this.findTargetWidget(g)}if(h&&h!==this){h.onLongPress(g)}return};this.onGesture=function(g){var h=this;if(this.grabWidget){h=this.grabWidget}else{h=this.findTargetWidget(point)}if(h&&h!==this){h.onGesture(g)}return};this.onPointerDown=function(g){var h=this;if(this.grabWidget){h=this.grabWidget}else{h=this.findTargetWidget(g)}if(h&&h!==this){h.onPointerDown(g);this.focusWidget=h}return};this.onPointerMove=function(g){var h=this;if(this.grabWidget){h=this.grabWidget}else{h=this.findTargetWidget(g)}if(h&&h!==this){if(this.lastTarget&&h!=this.lastTarget){this.lastTarget.onPointerMove(g)}h.onPointerMove(g);this.lastTarget=h}return};this.onPointerUp=function(g){var h=this;if(this.grabWidget){h=this.grabWidget}else{h=this.findTargetWidget(g)}if(h&&h!==this){h.onPointerUp(g)}return};this.onContextMenu=function(g){var h=this;if(this.grabWidget){h=this.grabWidget}else{h=this.findTargetWidget(g)}if(h&&h!==this){h.onContextMenu(g)}return};this.onKeyDown=function(g){if(this.grabWidget){this.grabWidget.onKeyDown(g)}else{if(this.focusWidget){this.focusWidget.onKeyDown(g)}else{if(this.children.length>0){this.focusWidget=this.children[this.children.length-1];this.focusWidget.onKeyDown(g)}}}return};this.onKeyUp=function(g){if(this.grabWidget){this.grabWidget.onKeyUp(g)}if(this.focusWidget!==0){this.focusWidget.onKeyUp(g)}return};this.manager.addWindow(this)}var C_APP_TYPE_WEBAPP=1;var C_APP_TYPE_PREVIEW=2;var C_APP_TYPE_PC_VIEWER=3;var C_APP_TYPE_PC_EDITOR=4;var C_APP_TYPE_MOBILE_EDITOR=5;var C_APP_TYPE_INLINE_EDITOR=6;function AppBase(b,a){this.win=null;this.view=null;this.type=a;this.minHeight=0;this.setMinHeight=function(c){this.minHeight=c;return};this.exec=function(c){c.doit();delete c;return};this.init=function(){if(this.type===C_APP_TYPE_INLINE_EDITOR){this.isInlineEdit=true}else{this.isInlineEdit=false}this.canvas=canvasCreate(b);this.adjustCanvasSize();this.manager=new WindowManager(this,this.canvas);canvasAttachManager(this.canvas,this.manager,this);return};this.onShapeSelected=function(c){return};this.onSizeChanged=function(){return};this.adjustCanvasSize=function(){var d=0;var f=0;var e=this.canvas;var c=getViewPort();switch(this.type){case C_APP_TYPE_WEBAPP:case C_APP_TYPE_INLINE_EDITOR:case C_APP_TYPE_MOBILE_EDITOR:d=c.width;f=c.height;break;case C_APP_TYPE_PREVIEW:d=c.width;f=c.height;this.setMinHeight(1500);break;default:d=c.width-20;f=c.height*1.5;break}f=Math.max(f,this.minHeight);this.resizeCanvasTo(d,f);return};this.resizeCanvasTo=function(c,e){var d=this.canvas;d.width=c;d.height=e;d.style.top=0;d.style.left=0;d.style.position="absolute";return};this.loadData=function(c){return this.view.loadFromJson(c)};this.exitApp=function(){console.log("exitApp");return};this.init();return this}var gGridImage=null;var gBeforeLoadCallBacks=[];var gAfterLoadCallBacks=[];function registerViewBeforeLoadListener(a){if(a){gBeforeLoadCallBacks.push(a)}return}function registerViewAfterLoadListener(a){if(a){gAfterLoadCallBacks.push(a)}return}function notifyViewBeforeLoad(a,c){for(var b=0;b<gBeforeLoadCallBacks.length;b++){gBeforeLoadCallBacks[b](a,c)}return}function notifyViewAfterLoad(a,c){for(var b=0;b<gAfterLoadCallBacks.length;b++){gAfterLoadCallBacks[b](this,c)}return}function ViewBase(d,a,e,b,c){this.type=C_WIDGET_TYPE_USER;Widget.apply(this,arguments);this.grid=10;this.showGrid=true;this.snapGrid=false;this.fillColor="white";this.autoResize=false;this.allShapes=new Array();this.theme=new Array();this.xscale=1;this.yscale=1;this.pointerDownPosition=new Point(0,0);this.lastPointerPosition=new Point(0,0);this.theme.push(new Gc("18px sans-serif","#FFFFFF","#000000",null));this.theme.push(new Gc("18px sans-serif","#FFFFFF","#000000",null));this.theme.push(new Gc("18px sans-serif","#FFFFFF","#000000",null));this.theme.push(new Gc("18px sans-serif","#FFFFFF","#D0D0D0",null));this.onShapeSelected=function(f){this.getApp().onShapeSelected(f);return};this.setFillColor=function(g){this.fillColor=g;for(var f=0;f<this.theme.length;f++){this.theme[f].bg=g}return};this.setGrid=function(f,g){this.showGrid=f;this.snapGrid=g;return};this.setShowGrid=function(f){this.showGrid=f;return};this.setSnapGrid=function(f){this.snapGrid=f;return};this.snapToGrid=function(f,j){var g=f;var h=j;if(this.snapGrid){g=Math.floor((f+this.grid/2)/this.grid)*this.grid;h=Math.floor((j+this.grid/2)/this.grid)*this.grid}return{x:g,y:h}};this.setAutoResize=function(){this.autoResize=true;return};this.initPage=function(g,f){var h=new Object();h.index=g?g:0;h.shapes=f?f:(new Array());return h};this.getPages=function(){return this.pages};this.newPage=function(){var j=this.getPageNr();var g=this.currentPage+1;var h=this.initPage(g,null);this.pages.push(h);this.saveCurrentPage();if(j>1){for(var f=j;f>g;f--){this.pages[f]=this.pages[f-1]}this.pages[g]=h}this.currentPage=g;this.showCurrentPage();this.getApp().updateContextMenu();return};this.removeCurrentPage=function(){var f=this.getPageNr();if(f>1){this.removePage(this.currentPage)}else{this.allShapes.clear()}this.getApp().updateContextMenu();return};this.removePage=function(f){var h=this.getPageNr();if(f<0||f>=h){f=this.currentPage}var g=this.pages[f];if(this.pages.length>1){this.pages.remove(g)}if(f<=this.currentPage&&this.currentPage>=0){this.currentPage--}this.showCurrentPage();this.getApp().updateContextMenu();return};this.saveCurrentPage=function(){var f=new Array();for(var h=0;h<this.allShapes.length;h++){var g=this.allShapes[h];f.push(g.toJson())}this.pages[this.currentPage]=this.initPage(this.currentPage,f);return};this.setMetaInfo=function(f){this.meta=f;return};this.getMetaInfo=function(){return this.meta};this.saveAsJson=function(){var j=new Object();var g=null;var f=ShapeFactoryGet().getDiagramTypes();this.saveCurrentPage();j.w=this.rect.w;j.h=this.rect.h;j.fillColor=this.fillColor;j.version=1;j.magic="5idraw";j.scale=this.xscale;j.type=this.type?this.type:f[0].name;j.meta=this.meta;j.pages=this.pages;var h=JSON.stringify(j,null,"\t");return h};this.parseJson=function(f){var j=null;var g=null;try{if(f){j=JSON.parse(f);this.reset()}}catch(h){ret=false;console.log("JSON.parse failed:"+h.message);console.log("JSON.parse failed:"+f)}if(!j){return null}if(!j.magic||j.magic!=="5idraw"){console.log("Not supported type");return null}return j};this.beforeLoad=function(f){notifyViewBeforeLoad(this,f);return};this.afterLoad=function(g){notifyViewAfterLoad(this,g);var f=this;setRefreshAfterImageLoaded(function(){f.postRedraw()});return};this.loadJson=function(g){var f=null;if(!g||!g.pages){this.pages=new Array();this.pages.push(this.initPage(0,null));this.currentPage=0;this.showCurrentPage();return}this.beforeLoad(g);if(this.autoResize){this.xscale=this.rect.w/g.w;this.yscale=this.rect.h/g.h;this.xscale=this.xscale<this.yscale?this.xscale:this.yscale;this.yscale=this.xscale}else{this.xscale=1;this.yscale=1}this.meta=g.meta;this.pages=g.pages;this.currentPage=0;this.fillColor=g.fillColor;this.loading=true;this.showCurrentPage();if(g.scale){this.xscale=g.scale;this.yscale=g.scale}this.afterLoad(g);this.loading=false;return};this.loadFromJson=function(f){var h=this.parseJson(f);var g=this;if(h&&h.type==="EDA"){setTimeout(function(){g.loadJson(h)},1500)}else{this.loadJson(h);setTimeout(function(){g.postRedraw()},500)}return};this.onPageShow=function(){};this.showCurrentPage=function(){var h=null;var g=this.pages[this.currentPage].shapes;if(!g){g=this.pages[this.currentPage].glyphs}this.allShapes.clear();if(g){var f=0;for(var j=0;j<g.length;j++){var m=g[j];var l=m.type?m.type:m.id;h=ShapeFactoryGet().createShape(l,C_CREATE_FOR_PROGRAM);if(h){h.fromJson(m);this.addShape(h);if(h.h>f){f=h.h}}else{console.log("createShape "+m.type+" fail.")}}}this.onPageShow();this.postRedraw();return};this.autoScale=function(){var j=null;for(var l=0;l<this.allShapes.length;l++){var h=this.allShapes[l];if(!j){j=h}else{if((h.h+h.w)>(j.h+j.w)){j=h}}}if(j){var g=j.w/this.rect.w;var f=j.h/this.rect.h;if(g>0.8||f>1.4){if(g>1.2||f>2){this.zoomTo(0.5)}else{this.zoomTo(0.7)}}else{this.zoomTo(1)}}return};this.getPageNr=function(){return this.pages?this.pages.length:0};this.gotoPrevPage=function(){var f=this.pages.length;var g=this.currentPage-1;if(g<0){g=g+f}this.gotoPage(g);return};this.getPagesNr=function(){return this.pages.length};this.gotoNextPage=function(){var f=this.pages.length;var g=this.currentPage+1;if(g>=f){g=g-f}this.gotoPage(g);return};this.gotoPage=function(f){if(f<0||f>=this.getPageNr()){return}if(f===this.currentPage){return}this.saveCurrentPage();this.currentPage=f;this.showCurrentPage();return};this.reset=function(){this.allShapes.clear();this.postRedraw();this.pages=new Array();this.pages.push(this.initPage(0,null));this.meta=null;this.currentPage=0;return};this.translatePoint=function(g){var f={x:(g.x-this.rect.x),y:(g.y-this.rect.y)};f.x=Math.round(f.x/this.xscale);f.y=Math.round(f.y/this.yscale);return f};this.canZoomIn=function(){return this.xscale<2&&this.yscale<2};this.canZoomOut=function(){return this.xscale>0.5&&this.yscale>0.5};this.onZoomed=function(){return};this.zoomTo=function(j){var g=null;for(var h=0;h<this.allShapes.length;h++){var f=this.allShapes[h];if(!g){g=f}else{if((f.h+f.w)>(g.h+g.w)){g=f}}}if(!this.loading&&g&&g.isUIDevice){var l=this.xscale-j;g.x=Math.floor(g.x+g.x*l);g.y=Math.floor(g.y+g.y*l)}this.xscale=j;this.yscale=j;this.onZoomed();this.postRedraw();return};this.zoomIn=function(){if(this.canZoomIn()){this.zoomTo(this.xscale*1.25)}return};this.zoomOut=function(){if(this.canZoomOut()){this.zoomTo(this.xscale*0.75)}return};this.getCreatingShape=function(){return this.creatingShape};this.addShape=function(f){this.allShapes.push(f);f.setView(this);f.setApp(this.getApp());if(this.creatingShape){this.removeShape(this.creatingShape);this.creatingShape=null}if(f.state!==C_STAT_NORMAL){this.creatingShape=f}if(f.mode!=C_MODE_RUNNING&&f.isUIDevice){this.autoScale()}return};this.removeShape=function(f){this.allShapes.remove(f);f.setView(null);return};this.getSelectedShapes=function(h){var f=[];for(var j=0;j<this.allShapes.length;j++){var g=this.allShapes[j];if(g.selected){f.push(g);continue}if(h&&g.isContainer){g.findSelectedShapes(f)}}return f};this.countShape=function(g){if(!this.allShapes){return 0}var h=this.allShapes.length;if(g){var f=this.getSelectedShapes(true);h=f.length}return h};this.getSelectedShape=function(){var f=this.getSelectedShapes(true);if(f.length){return f[0]}return null};this.selectAll=function(h){for(var g=0;g<this.allShapes.length;g++){var f=this.allShapes[g];f.setSelected(h)}this.postRedraw();return};this.beforePaint=function(f){return};this.afterPaint=function(f){return};this.drawSelf=function(f){this.postRedraw();return};this.paintBackground=function(f){this.canvas=f;if(!this.showGrid){f.fillStyle="White";f.fillRect(this.rect.x,this.rect.y,this.rect.w,this.rect.h);f.beginPath()}return};this.drawGrid=function(g){if(this.showGrid&&this.grid){var I=0;var G=0;var u=0;var q=0;var B=0;var F=0;var z=this.rect.w;var J=this.rect.h;var o=this.rect.x;var m=this.rect.y;var f=this.grid;var C=f-1;var D=J/f;var L=z/f;var K=5;var H=gGridImage.getImage();if(H){var l=H.width;var A=H.height;var E=0;var M=0;preDrawGrids=l/this.grid;var p=L/preDrawGrids;var v=D/preDrawGrids;for(I=0;I<p;I++){u=I*preDrawGrids*f;E=Math.min(l,o+z-u);for(G=0;G<v;G++){q=G*preDrawGrids*f;M=Math.min(A,m+J-q);g.drawImage(H,u,q)}}}}return};this.showLogo=function(j){if(this.shouldShowLogo){var f=0;var m=0;var g=this.rect.w;var l=this.rect.h;j.beginPath();j.textAlign="right";j.textBaseline="bottom";j.font="12pt sans";j.fillStyle="Gold";f=g-20+this.rect.x;m=this.rect.y+l-5;j.fillText(drawingGetLogoText(),f,m)}return};this.showPageIndicator=function(j){var f=0;var o=0;var g=this.rect.w;var l=this.rect.h;var m=dappGetText("Page")+" "+(this.currentPage+1)+"/"+this.getPageNr();j.beginPath();j.textAlign="right";j.textBaseline="top";j.font="18pt sans";j.fillStyle="Gray";f=this.parent.rect.w-10;o=30;j.fillText(m,f,o);return};this.paintSelf=function(j){var f=this.rect.w;var m=this.rect.h;var r=null;var q=this.getAbsPosition();j.save();j.beginPath();j.rect(q.x,q.y,f,m);j.stroke();j.clip();j.beginPath();j.save();this.beforePaint(j);j.translate(this.rect.x,this.rect.y);j.shadowBlur=0;this.drawGrid(j);j.scale(this.xscale,this.yscale);for(var l=0;l<this.allShapes.length;l++){var g=this.allShapes[l];if(g.selected&&!r&&g.isLine){r=g}else{g.paint(j)}}if(r){r.paint(j)}this.afterPaint(j);j.restore();j.restore();var o=m/30;if(o>10){o=10}if(o>8){this.showLogo(j)}if(this.getPageNr()>1){this.showPageIndicator(j)}this.drawStatus(j);return};this.drawStatus=function(f){return};this.selectShapeByPoint=function(f,h){for(var j=this.allShapes.length-1;j>=0;j--){var g=this.allShapes[j];if(g.hitTest(f)){if(g.isContainer){g=g.findShapeByPoint(f,h)}this.postRedraw();this.targetShape=null;if(g.parentShape){g.parentShape.selected=false}if(!g.selected){g.setSelected(false)}g.setSelected(!g.selected);return g}}return null};this.getMoveDeltaX=function(){return this.moveDeltaX};this.getMoveDeltaY=function(){return this.moveDeltaY};this.getMoveAbsDeltaX=function(){return this.moveAbsDeltaX};this.getMoveAbsDeltaY=function(){return this.moveAbsDeltaY};this.updateLastPointerPoint=function(f){this.moveDeltaX=f.x-this.lastPointerPosition.x;this.moveDeltaY=f.y-this.lastPointerPosition.y;this.moveAbsDeltaX=f.x-this.pointerDownPosition.x;this.moveAbsDeltaY=f.y-this.pointerDownPosition.y;this.lastPointerPosition.x=f.x;this.lastPointerPosition.y=f.y;return};this.onDoubleClick=function(h){var f=this.translatePoint(h);var g=this.targetShape;if(g){g.onDoubleClick(f)}return};this.onLongPress=function(h){var f=this.translatePoint(h);var g=this.targetShape;if(g){g.onLongPress(f)}return};this.onGesture=function(g){var f=this.targetShape;if(f){f.onGesture(g)}return};return}function WindowManager(b,a){this.app=b;this.canvas=a;this.w=a.width;this.h=a.height;this.last_point=0;this.pointerDown=0;this.target=null;this.windows=new Array();this.grabWindows=new Array();this.dirtyRegion=new Array();this.eventLogging=false;this.pointerDownPoint={x:0,y:0};this.lastPointerPoint={x:0,y:0};return}WindowManager.prototype.getApp=function(){return this.app};WindowManager.prototype.logEvent=function(d,c,j){var g={t:d};var b=new Date();var f=b.getTime();var a=this.events.length>0?this.events[this.events.length-1]:null;if(!this.pointerDown&&a&&d===C_EVT_POINTER_MOVE&&a.t===C_EVT_POINTER_MOVE){var l=a.p.x-j.x;var h=a.p.y-j.y;if(Math.abs(l)<5&&Math.abs(h)<5){console.log("Skip move event");return}}g.tm=b.getTime()-f;this.lastEventTime=f;switch(d){case C_EVT_POINTER_DOWN:console.log("Record: Mouse down:"+j.x+" x "+j.y);case C_EVT_POINTER_UP:console.log("Record: Mouse up:"+j.x+" x "+j.y);case C_EVT_CONTEXT_MENU:case C_EVT_POINTER_MOVE:case C_EVT_DOUBLE_CLICK:g.p=j;break;case C_EVT_KEY_DOWN:case C_EVT_KEY_UP:g.c=j;break;default:break}if(targetIsEditor(c)){g.other=true}this.events.push(g);return};WindowManager.prototype.replayEvents=function(b){if(b){try{this.events=JSON.parse(b)}catch(d){return}}if(!this.events||this.events.length<1){return}var a=this;this.replayIndex=0;a.eventReplaying=true;console.log("replay events start.");function c(){var e=a.events[a.replayIndex];var f=e.t;if(e.other){if(f===C_EVT_KEY_DOWN){}else{if(f===C_EVT_KEY_UP){}}}else{switch(f){case C_EVT_CONTEXT_MENU:a.onContextMenu(e.p);console.log("Inject: Mouse down:"+e.p.x+" x "+e.p.y);break;case C_EVT_POINTER_DOWN:a.onPointerDown(e.p);console.log("Inject: Mouse down:"+e.p.x+" x "+e.p.y);break;case C_EVT_POINTER_MOVE:a.onPointerMove(e.p);break;case C_EVT_POINTER_UP:a.onPointerUp(e.p);console.log("Inject: Mouse up:"+e.p.x+" x "+e.p.y);break;case C_EVT_DOUBLE_CLICK:a.onDoubleClick(e.p);break;case C_EVT_KEY_DOWN:a.onKeyDown(e.c);break;case C_EVT_KEY_UP:a.onKeyUp(e.c);break;default:break}}a.replayIndex++;if(a.replayIndex<a.events.length){e=a.events[a.replayIndex];setTimeout(c,e.t)}else{a.eventReplaying=false;console.log("replay events end.")}}setTimeout(c,0);return};WindowManager.prototype.preprocessEvent=function(b,c,a){this.currentEvent=c.originalEvent?c.originalEvent:c;return true};WindowManager.prototype.getCanvas2D=function(){return this.canvas.getContext("2d")};WindowManager.prototype.findTargetWin=function(a){var e=null;var c=this.grabWindows.length;if(c>0){e=this.grabWindows[c-1]}else{c=this.windows.length;for(var b=c-1;b>=0;b--){var d=this.windows[b];if(!d.visible||d.insensitive||!d.focusable){continue}if(isPointInRect(a,d.rect)){e=d;break}}}return e};WindowManager.prototype.resize=function(a,b){this.w=a;this.h=b;this.postRedraw();return};WindowManager.prototype.grab=function(a){this.grabWindows.push(a);return};WindowManager.prototype.ungrab=function(a){this.grabWindows.remove(a);return};WindowManager.prototype.onDoubleClick=function(a){this.target=this.findTargetWin(a);if(this.target){this.target.onDoubleClick(a)}else{console.log("Window Manager: no target for x="+a.x+" y="+a.y)}return};WindowManager.prototype.onLongPress=function(a){this.target=this.findTargetWin(a);if(this.target){this.target.onLongPress(a)}else{console.log("Window Manager: no target for x="+a.x+" y="+a.y)}return};WindowManager.prototype.onGesture=function(b){wtkHideAllInput();var a={x:this.w/2,y:this.h/2};this.target=this.findTargetWin(a);if(this.target){this.target.onGesture(b);console.log("WindowManager.prototype.onGesture: scale="+b.scale+" rotation="+b.rotation)}else{console.log("Window Manager: no target for x="+a.x+" y="+a.y)}return};WindowManager.prototype.onPointerDown=function(a){wtkHideAllInput();this.target=this.findTargetWin(a);this.pointerDown=true;this.pointerDownPoint.x=a.x;this.pointerDownPoint.y=a.y;this.lastPointerPoint.x=a.x;this.lastPointerPoint.y=a.y;if(this.target){this.target.onPointerDown(a)}else{console.log("Window Manager: no target for x="+a.x+" y="+a.y)}return};WindowManager.prototype.onPointerMove=function(a){this.target=this.findTargetWin(a);this.lastPointerPoint.x=a.x;this.lastPointerPoint.y=a.y;if(this.target){this.target.onPointerMove(a)}return};WindowManager.prototype.onPointerUp=function(a){this.target=this.findTargetWin(a);this.lastPointerPoint.x=a.x;this.lastPointerPoint.y=a.y;if(this.target){this.target.onPointerUp(a)}else{console.log("Window Manager: no target for x="+a.x+" y="+a.y)}this.pointerDown=false;return};WindowManager.prototype.isPointerDown=function(){return this.pointerDown};WindowManager.prototype.isClicked=function(){var b=Math.abs(this.lastPointerPoint.x-this.pointerDownPoint.x);var a=Math.abs(this.lastPointerPoint.y-this.pointerDownPoint.y);return(b<10&&a<10)};WindowManager.prototype.isCtrlDown=function(){return this.currentEvent&&(this.currentEvent.ctrlKey||this.ctrlDown)};WindowManager.prototype.isAltDown=function(){return this.currentEvent&&(this.currentEvent.altKey||this.altDown)};WindowManager.prototype.onContextMenu=function(a){this.target=this.findTargetWin(a);if(this.target){this.target.onContextMenu(a)}else{console.log("Window Manager: no target for x="+a.x+" y="+a.y)}return};WindowManager.prototype.onKeyDown=function(a){if(!this.target){this.target=this.findTargetWin({x:50,y:50});console.log("onKeyDown: findTargetWin="+this.target)}switch(a){case KeyEvent.DOM_VK_SHIFT:this.shitfDown=true;break;case KeyEvent.DOM_VK_CONTROL:this.ctrlDown=true;break;case KeyEvent.DOM_VK_ALT:this.altDown=true;break;default:if(this.target!==null){this.target.onKeyDown(a)}}return};WindowManager.prototype.onKeyUp=function(a){switch(a){case KeyEvent.DOM_VK_SHIFT:this.shitfDown=false;break;case KeyEvent.DOM_VK_CONTROL:this.ctrlDown=false;break;case KeyEvent.DOM_VK_ALT:this.altDown=false;break;default:if(this.target!==null){this.target.onKeyUp(a)}}return};WindowManager.prototype.addWindow=function(a){this.windows.push(a);return};WindowManager.prototype.removeWindow=function(a){this.windows.remove(a);console.log("remove nr="+this.windows.length);this.postRedraw();return};WindowManager.prototype.postRedraw=function(c){this.dirtyRegion.push(1);var a=this;function b(){a.draw()}requestAnimFrame(b);return};WindowManager.prototype.drawWindows=function(a){var c=this.windows.length;for(var b=0;b<c;b++){var d=this.windows[b];d.draw(a)}return};WindowManager.prototype.redraw=function(b){var a=this.getCanvas2D();a.save();if(b){a.beginPath();a.rect(b.x,b.y,b.w,b.h);a.clip()}this.drawWindows(a);a.restore();return};WindowManager.prototype.draw=function(){if(!this.dirtyRegion.length){return}var a=this.getCanvas2D();a.save();this.drawWindows(a);a.restore();this.dirtyRegion.clear();return;var c=this.windows.length;for(var b=0;b<c;b++){var d=this.windows[b];d.draw(a)}a.beginPath();a.strokeStyle="Black";if(this.eventLogging){a.fillStyle="Red";a.arc(30,30,10,0,2*Math.PI)}a.fill();a.stroke();this.dirtyRegion.clear();a.restore();return};function Command(){this.count=0;this.doit=function(){this.count=this.count+1;console.log("command: doit "+this.count);return};this.undo=function(){this.count=this.count-1;console.log("command: undo "+this.count);return}}function CompositeCommand(){this.cmds=new Array();this.addCommand=function(a){this.cmds.push(a);return};this.clear=function(){this.cmds.clear();return};this.doit=function(){for(var a=0;a<this.cmds.length;a++){var b=this.cmds[a];b.doit()}return};this.undo=function(){for(var a=0;a<this.cmds.length;a++){var b=this.cmds[a];b.undo()}return}}function CommandHistory(){this.listeners=new Array();this.redos=new Array();this.undos=new Array();this.clear=function(){this.redos.clear();this.undos.clear();return};this.notify=function(){for(var a=0;a<this.listeners.length;a++){var b=this.listeners[a];b.onChanged(this.redos.length,this.undos.length)}return};this.exec=function(a){a.doit();this.undos.push(a);this.redos.clear();this.notify();return};this.redo=function(){if(this.redos.length>0){var a=this.redos.pop();a.doit();this.undos.push(a);this.notify()}return};this.undo=function(){if(this.undos.length>0){var a=this.undos.pop();a.undo();this.redos.push(a);this.notify()}return};this.countRedo=function(){return this.redos.length};this.countUndo=function(){return this.undos.length};this.addListener=function(a){this.listeners.push(a);return};this.removeListener=function(a){this.listeners.remove(a);return};return}var C_MODE_EDITING=0;var C_MODE_RUNNING=1;var C_MODE_PREVIEW=2;var C_HIT_TEST_NONE=0;var C_HIT_TEST_TL=1;var C_HIT_TEST_TM=2;var C_HIT_TEST_TR=3;var C_HIT_TEST_ML=4;var C_HIT_TEST_MR=5;var C_HIT_TEST_BL=6;var C_HIT_TEST_BM=7;var C_HIT_TEST_BR=8;var C_HIT_TEST_HANDLE=9;var C_HIT_TEST_WORKAREA=10;var C_HIT_TEST_MAX=11;var C_HIT_TEST_MM=-1;var C_ALIGN_LEFT=1;var C_ALIGN_RIGHT=2;var C_ALIGN_TOP=3;var C_ALIGN_BOTTOM=4;var C_ALIGN_CENTER=5;var C_ALIGN_MIDDLE=6;var C_ALIGN_TO_SAME_WIDTH=7;var C_ALIGN_TO_SAME_HEIGHT=8;var C_ALIGN_DIST_VER=9;var C_ALIGN_DIST_HOR=10;var C_STAT_CREATING_0=0;var C_STAT_CREATING_1=1;var C_STAT_CREATING_2=2;var C_STAT_NORMAL=3;var C_SHAPE_TEXT_NONE=0;var C_SHAPE_TEXT_INPUT=1;var C_SHAPE_TEXT_TEXTAREA=2;function Shape(){this.textTitle="Text";return}Shape.prototype.canBindingData=function(){return false};Shape.prototype.afterCreated=function(a){return true};Shape.prototype.setNearRange=function(a){this.nearRange=a;return};Shape.prototype.getNearRange=function(){return this.nearRange?this.nearRange:20};Shape.prototype.findNear=function(a){return null};Shape.prototype.getCreatingShape=function(){return this.view?this.view.getCreatingShape():null};Shape.prototype.getTextCookie=function(a){return 0};Shape.prototype.isFillColorTransparent=function(){return !this.style.fillColor||this.style.fillColor==="rgba(0,0,0,0)"};Shape.prototype.isStrokeColorTransparent=function(){return !this.style.lineColor||this.style.lineColor==="rgba(0,0,0,0)"};Shape.prototype.setParent=function(a){this.parentShape=a;return};Shape.prototype.getParent=function(b){if(b){for(var a=this.parentShape;a!=null;a=a.parentShape){if(a.name===b){return a}}}return b?null:this.parentShape};Shape.prototype.textEditable=function(a){return true};Shape.prototype.setInputType=function(a){this.inputType=a;return};Shape.prototype.editText=function(r){if(this.textType&&this.textEditable(r)){var b=this.getPositionInView();var f=this.getRealScale();var d=this.view.rect.x;var c=this.view.rect.y;var o=b.x*f+d;var q=this.getWidth()*f;var g=this.getHeight()*f;var a=this.getTextCookie(r);var l=this;var j=null;var e=this.inputType?this.inputType:"text";if(this.textType===C_SHAPE_TEXT_INPUT){var m=b.y*f+g/3+c;if(q<60){q=60}j=wtkShowInput(o,m,q,18);j.setInputType(e)}else{var m=b.y*f+c;if(g<60){g=60}j=wtkShowTextArea(o,m,q,g)}l.editing=true;j.setText(this.getText(a));j.element.onchange=function(){if(l.text!==this.value){l.exec(new SetTextCommand(l,this.value,a));l.postRedraw()}j.hide();l.editing=false;return}}return};Shape.prototype.exec=function(a){if(this.app){this.app.exec(a)}else{a.doit();delete a}return};Shape.prototype.setTextTitle=function(a){this.textTitle=a;return};Shape.prototype.initShape=function(a,e,b,d,c){this.w=b;this.h=d;this.x=a;this.y=e;this.type=c;this.text="";this.app=null;this.view=null;this.rotate=0;this.saveDx=0;this.saveDy=0;this.scale=1;this.parentShape=null;this.pointerDown=false;this.selected=false;this.userMovable=true;this.userResizable=true;this.hignlighted=false;this.state=C_STAT_NORMAL;this.hitTestResult=C_HIT_TEST_NONE;this.lastPosition=new Point(0,0);this.selectMarkPoint=new Point(0,0);this.textType=C_SHAPE_TEXT_INPUT;this.setDefaultStyle();this.setTextAlignV("middle");this.setTextAlignH("center");return};Shape.prototype.setDefaultStyle=function(){this.style=new ShapeStyle();this.setStyle(DefaultShapeStyleGet());return};Shape.prototype.setState=function(a){this.state=a;return};Shape.prototype.setTextType=function(a){this.textType=a;return};Shape.prototype.isSelected=function(){return this.selected};Shape.prototype.userRemovable=function(){return true};Shape.prototype.intersectWithRect=function(d){var b=false;var f=this.getX();var c=this.getY();var j=this.getWidth();var a=this.getHeight();var m={x:f,y:c};var l={x:f+j,y:c+a};var g={x:f+j,y:c};var e={x:f,y:c+a};return isPointInRect(m,d)||isPointInRect(l,d)||isPointInRect(g,d)||isPointInRect(e,d)};Shape.prototype.isThisInRect=function(e){var c=false;var a=this.getX();var f=this.getY();var b=this.getWidth();var d=this.getHeight();if((a>=e.x&&a<(e.x+e.w))&&(f>=e.y&&f<(e.y+e.h))){c=true}return c};Shape.prototype.snapToGrid=function(a,d){var b=a;var c=d;if(this.view){return this.view.snapToGrid(a,d)}else{return{x:b,y:c}}};Shape.prototype.isClicked=function(){if(this.view){return this.view.isClicked()}return false};Shape.prototype.isAltDown=function(){if(this.view){return this.view.isAltDown()}return false};Shape.prototype.isCtrlDown=function(){if(this.view){return this.view.isCtrlDown()}return false};Shape.prototype.showIconPreview=function(a){return true};Shape.prototype.onMoving=function(){};Shape.prototype.onMoved=function(){};Shape.prototype.onSized=function(){};Shape.prototype.onUserResized=function(){};Shape.prototype.fixChildPosition=function(e){var d=this.w;var c=this.h;var b=e.x>=0?e.x:0;var a=e.y>=0?e.y:0;if((b+e.w)>d){b=d-e.w}if((a+e.h)>c){a=c-e.h}e.x=b;e.y=a;return};Shape.prototype.fixPosition=function(){if(!this.parentShape){return}this.parentShape.fixChildPosition(this);return};Shape.prototype.move=function(b,a){b=Math.floor(b);a=Math.floor(a);if(this.x!=b||this.y!=a){this.x=b;this.y=a;if(!this.isIcon){this.fixPosition();this.onMoved()}this.x=Math.floor(this.x);this.y=Math.floor(this.y)}return};Shape.prototype.moveDelta=function(b,a){this.move(this.x+b,this.y+a);return};Shape.prototype.getWidth=function(){return this.w};Shape.prototype.getHeight=function(){return this.h};Shape.prototype.getPositionInScreen=function(){var a={x:0,y:0};var c=this.getRealScale();var b=this.getPositionInView();if(this.view){a=this.view.getAbsPosition()}b.x=a.x+b.x*c;b.y=a.y+b.y*c;return b};Shape.prototype.getRealScale=function(){return this.view?this.view.xscale:1};Shape.prototype.getAbsPosition=function(){var b=this.getPositionInView();if(this.view){var a=this.view.getAbsPosition();b.x=b.x+a.x;b.y=b.y+a.y}return b};Shape.prototype.getPositionInView=function(){var b=this.getX();var d=this.getY();var a={x:0,y:0};var c=this.parentShape;while(c!=null){b+=c.getX();d+=c.getY();c=c.parentShape}a.x=b;a.y=d;return a};Shape.prototype.getXinView=function(){var a=this.getPositionInView().x;return a};Shape.prototype.getYinView=function(){var a=this.getPositionInView().y;return a};Shape.prototype.getX=function(){return this.x};Shape.prototype.getY=function(){return this.y};Shape.prototype.align=function(a,b){return};Shape.prototype.setRotatable=function(a){this.rotatable=a;return};Shape.prototype.setScale=function(a){this.scale=a;if(a<0.1){this.scale=0.1}if(a>4){this.scale=4}return};Shape.prototype.setRotate=function(a){this.rotate=a%360;return};Shape.prototype.setStyle=function(a){this.style.copy(a);this.textNeedRelayout=true;return};Shape.prototype.getStyle=function(){return this.style};Shape.prototype.setName=function(a){this.name=a;return};Shape.prototype.getName=function(){return this.name};Shape.prototype.getLocaleText=function(a){return a};Shape.prototype.setNeedRelayoutText=function(){this.textNeedRelayout=true;return};Shape.prototype.setTextAlignH=function(a){this.hAlign=a;return};Shape.prototype.setTextAlignV=function(a){this.vAlign=a;return};Shape.prototype.getTextAlignH=function(){var a=this.hAlign?this.hAlign:"left";return a};Shape.prototype.getTextAlignV=function(){var a=this.vAlign?this.vAlign:"top";return a};Shape.prototype.toText=function(a){if(a!==null&&a!=undefined){return a+""}else{return""}};Shape.prototype.setText=function(b,a){a=a?a:0;b=(b!=null&&b!=undefined)?b+"":"";switch(a){case 2:this.text2=b;break;case 3:this.text3=b;break;default:this.text=b}this.textNeedRelayout=true;return};Shape.prototype.setText2=function(a){this.text2=a;return};Shape.prototype.setText3=function(a){this.text3=a;return};Shape.prototype.getText=function(a){a=a?a:0;switch(a){case 2:return this.text2;case 3:return this.text3;default:break}return this.text};Shape.prototype.getApp=function(){return this.app};Shape.prototype.getView=function(){return this.view};Shape.prototype.setApp=function(a){this.app=a;return};Shape.prototype.setView=function(a){this.view=a;return};Shape.prototype.redrawSelf=function(){if(this.view){var c=this.getRealScale();var b=this.getPositionInView();var a={x:b.x*c,y:b.y*c,w:this.w*c,h:this.h*c};this.view.redraw(a)}return};Shape.prototype.postRedraw=function(a){if(this.view){this.view.postRedraw(a)}return};Shape.prototype.beforePropertyChanged=function(){return};Shape.prototype.afterPropertyChanged=function(){return};Shape.prototype.showProperty=function(){return};Shape.prototype.setSelectedMarkSize=function(a){this.selectedMarkSize=a;return};Shape.prototype.createSelectedMark=function(c,a,e,b){var d=this.selectedMarkSize?this.selectedMarkSize:10;if(b){d=d+d}c.rect(a-d,e-d,d*2,d*2);return};Shape.prototype.isInSelectedMark=function(c,b,d,a){c.beginPath();this.createSelectedMark(c,b,d);return c.isPointInPath(a.x,a.y)};Shape.prototype.paint=function(a){this.paintSelf(a);if(this.near){var c=this.near.point;var b=this.getNearRange();a.beginPath();a.arc(c.x,c.y,4,0,Math.PI*2);a.fillStyle="Red";a.fill();a.beginPath();a.lineWidth=2;a.arc(c.x,c.y,b,0,Math.PI*2);a.strokeStyle="Black";a.stroke()}return};Shape.prototype.paintSelf=function(a){return};Shape.prototype.setSelected=function(a){if(this.selected===a){return}this.selected=a;if(this.view){this.view.onShapeSelected(this)}return};Shape.prototype.isVisible=function(){return true};Shape.prototype.findNearPoint=function(c){var d=null;for(var a=0;a<100;a++){d=this.getNearPoint(a);if(!d){break}if(isPointInRect(d,c)){var b={shape:this};b.nearPointIndex=a;b.point={x:d.x,y:d.y};return b}}return null};Shape.prototype.dup=function(){var a=ShapeFactoryGet().createShape(this.type,C_CREATE_FOR_PROGRAM);a.fromJson(this.toJson());a.state=C_STAT_NORMAL;return a};Shape.prototype.hitTest=function(a){return C_HIT_TEST_NONE};Shape.prototype.showProperty=function(){return};Shape.prototype.onLongPress=function(a){return};Shape.prototype.onGesture=function(a){};Shape.prototype.onDoubleClick=function(a){if(this.textType!=C_SHAPE_TEXT_NONE){this.editText(a)}else{this.showProperty()}return true};Shape.prototype.onPointerDown=function(a){this.pointerDown=true;this.hitTestResult=this.hitTest(a);if(!this.hitTestResult){return false}this.setSelected(true);this.lastPosition.x=a.x;this.lastPosition.y=a.y;this.handlePointerEvent(a,C_EVT_POINTER_DOWN);return true};Shape.prototype.handlePointerEvent=function(a,b){return false};Shape.prototype.onPointerMove=function(a){if(this.hitTestResult){this.handlePointerEvent(a,C_EVT_POINTER_MOVE);return true}return false};Shape.prototype.onPointerUp=function(a){if(this.hitTestResult){this.handlePointerEvent(a,C_EVT_POINTER_UP);this.hitTestResult=C_HIT_TEST_NONE;return true}this.pointerDown=false;return false};Shape.prototype.onKeyDown=function(a){console.log("onKeyUp Widget: code="+a);return};Shape.prototype.onKeyUp=function(a){console.log("onKeyUp Widget: code="+a);return};Shape.prototype.canBeComponent=function(){return false};Shape.prototype.shouldShowContextMenu=function(){return true};Shape.prototype.toJson=function(){return""};Shape.prototype.fromJson=function(a){return this};Shape.prototype.extractFormat=function(){var d=new Object();d.type="";d.name="";for(var a in this){var c=this[a];var b=typeof c;if(b==="function"||b==="object"||b==="undefined"){continue}if(b==="number"||b==="string"||b==="boolean"){d[a]=c}}if(this.images){d.images=this.images}delete d.x;delete d.y;delete d.name;delete d.text;delete d.state;delete d.mode;delete d.selected;delete d.pointerDown;delete d.xAttr;delete d.yAttr;delete d.xParam;delete d.yParam;d.style=this.style.toJson();return d};Shape.prototype.afterApplyFormat=function(){return};Shape.prototype.applyFormat=function(e){if(!e){return}var a=e.type===this.type;for(var b in e){var d=e[b];var c=typeof d;if(c==="function"||c==="object"||c==="undefined"){continue}if(b=="type"){continue}if(!a&&(b==="w"||b==="h")){continue}if(c==="number"||c==="string"||c==="boolean"){if(a||this[b]!=undefined){this[b]=d}}}if(a){if(e.images){for(var b in e.images){var d=e.images[b];if(b==="display"){this.images[b]=d}else{var f=d.getImageSrc();this.setImage(b,f)}}}}if(e.style){this.style.fromJson(e.style)}this.afterApplyFormat();this.textNeedRelayout=true;return};Shape.prototype.setUserMovable=function(a){this.userMovable=a;return};Shape.prototype.setUserResizable=function(a){this.userResizable=a;return};Shape.prototype.isUserMovable=function(){return this.userMovable};Shape.prototype.isUserResizable=function(){return this.userResizable};function splitText(a){a=a.replaceAll("\r\n","\n");a=a.replaceAll("\r","\n");return a.split("\n--\n")}function restackShapeInArray(b,e){var h=0;var g=0;var d=null;var a=0;var f=null;for(var c=0;c<b.length;c++){d=b[c];if(d.selected){h++;if(!f){f=d;g=c}}}if(h>1||!f){return}a=g+e;if(a<0||a>=b.length){return}b[g]=b[a];b[a]=f;return}function getParentShapeOfShape(b,a){var c=b.parentShape?b.parentShape:b.container;if(!c){c=a}return c}function getParentShapeOfShapes(b){if(!b||b.length===0){return null}var a=b[0];var d=a.parentShape;for(var e=0;e<b.length;e++){var c=b[e];if(c.parentShape!=d){return null}}return d?d:a.view}Shape.prototype.defaultDrawText=function(b){var c=this.getWidth(true);var d=this.getLocaleText(this.text);if(!d||this.editing){return}b.save();b.beginPath();b.lineWidth=1;b.font=this.style.getFont();b.fillStyle=this.style.textColor;b.strokeStyle=this.style.lineColor;var a=d.split(/\n/);if(a.length<2){if(b.measureText(d).width<1.2*c){this.draw1LText(b)}else{this.drawMLText(b)}}else{this.drawMLText(b)}b.restore();return};Shape.prototype.draw1LText=function(d,h){var q=this.getLocaleText(this.text);if(!q||this.editing){return}var p=0;var o=0;var a=this.hMargin;var b=this.getWidth(true);var g=this.getTextAlignH();var j=this.getTextAlignV();var l=this.style.textU;var r=this.style.fontSize;var m=d.measureText(q).width;var e=0;var c=0;var f=Math.min(m,b);switch(j){case"middle":o=this.h>>1;d.textBaseline="middle";if(l){c=Math.floor(o+r*0.8)}break;case"bottom":o=this.h-this.vMargin;d.textBaseline="bottom";if(l){c=o}break;default:o=this.vMargin;d.textBaseline="top";if(l){c=Math.floor(o+r*1.5)}break}switch(g){case"center":p=this.w>>1;d.textAlign="center";if(l){e=Math.max((this.w-m)>>1,0)}break;case"right":p=this.w-this.hMargin;d.textAlign="right";if(l){e=Math.max((this.w-m-a),0)}break;default:p=this.hMargin;d.textAlign="left";if(l){e=p}break}if(l){d.moveTo(e,c);d.lineTo(e+f,c);d.stroke()}d.fillText(q,p,o,b);return m};Shape.prototype.drawMLText=function(e,b){this.layoutText(e);var o=0;var l=0;var g=0;var f=0;var h=0;var v=this.vMargin;var j=this.hMargin;var q=this.getWidth(true);var t=this.getTextAlignH();var p=this.getTextAlignV();var s=this.style.textU;var d=this.style.fontSize;var m=this.getTextLineHeight();var a=this.getTextHeight();e.textBaseline="top";switch(p){case"middle":l=(this.h-a)>>1;break;case"bottom":l=this.h-a-v;break;default:l=v;break}l=l<0?0:l;for(var u=0;u<this.lines.length;u++){var r=this.lines[u];if(!r||r==" "){l+=d;continue}if((l+m)>=this.h&&!b){break}var c=e.measureText(r).width;h=Math.min(c,q);f=Math.floor(l+(d+m)/2);switch(t){case"center":o=this.w>>1;e.textAlign="center";if(s){g=Math.max((this.w-c)>>1,0)}break;case"right":o=this.w-j;e.textAlign="right";if(s){g=Math.max((this.w-c-j),0)}break;default:o=j;e.textAlign="left";if(s){g=o}break}if(s){e.moveTo(g,f);e.lineTo(g+h,f);e.stroke()}e.fillText(r,o,l,q);l+=m}return};Shape.prototype.getTextHeight=function(){var c=0;var d=this.style.fontSize;var b=this.getTextLineHeight();if(!this.text||!this.lines){return b}for(var a=0;a<this.lines.length;a++){var e=this.lines[a];if(!e||e==" "){c+=d}else{c+=b}}return c};Shape.prototype.getTextLineHeight=function(){return Math.floor(this.style.fontSize*1.5)};Shape.prototype.setTextShadow=function(a){this.textShadow=a;return};Shape.prototype.isValid=function(){return !this.isInvalid};Shape.prototype.destroy=function(){this.app=null;this.view=null;this.parentShape=null;this.isInvalid=true;if(this.children){this.children.clear()}return};function RShape(){return}var gSelectMarkColor="Red";RShape.prototype=new Shape();RShape.prototype.MIN_SIZE=10;RShape.prototype.isRect=true;RShape.prototype.initRShape=function(a,e,b,d,c){this.initShape(a,e,b,d,c);this.saveWidth=0;this.saveHeight=0;this.image=null;this.imageUrl="";this.rect=new Rect(0,0,b,d);this.lastPosition=new Point(0,0);this.pointerDownPosition=new Point(0,0);this.defWidth=200;this.defHeight=60;this.pointerDown=false;if(b===0||d===0){this.w=this.MIN_SIZE;this.h=this.MIN_SIZE;this.setState(C_STAT_CREATING_0);this.onPointerDown=function(f){this.pointerDownPosition.x=f.x;this.pointerDownPosition.y=f.y;this.postRedraw();if(this.onPointerDownCreating(f)){return true}return this.onPointerDownNormal(f)};this.onPointerMove=function(f){if(this.onPointerMoveCreating(f)){return true}return this.onPointerMoveNormal(f)};this.onPointerUp=function(f){var g=false;if(this.onPointerUpCreating(f)){g=true}else{g=this.onPointerUpNormal(f)}this.pointerDown=false;return g}}return};RShape.prototype.onPointerDownCreating=function(a){if(this.state===C_STAT_CREATING_0){this.state=C_STAT_CREATING_1;this.move(a.x,a.y);this.lastPosition.x=a.x;this.lastPosition.y=a.y;this.postRedraw();this.pointerDown=true;return true}return false};RShape.prototype.onPointerUpCreating=function(a){if(this.state!==C_STAT_NORMAL){var c=a.x-this.lastPosition.x;var b=a.y-this.lastPosition.y;if(this.isClicked()||!this.pointerDown){this.resize(this.defWidth,this.defHeight)}else{this.resizeDelta(c,b)}this.state=C_STAT_NORMAL;this.setSelected(true);this.afterCreated();this.postRedraw()}return false};RShape.prototype.onPointerMoveCreating=function(a){if(this.state===C_STAT_CREATING_0){this.move(a.x,a.y);this.lastPosition.x=a.x;this.lastPosition.y=a.y;this.postRedraw();return true}else{if(this.state===C_STAT_CREATING_1){var b=a.x-this.view.pointerDownPosition.x;var c=a.y-this.view.pointerDownPosition.y;this.resize(b,c);this.lastPosition.x=a.x;this.lastPosition.y=a.y;this.postRedraw();return true}}return false};RShape.prototype.onPointerDownNormal=function(a){this.hitTestResult=this.hitTest(a);if(!this.hitTestResult){return false}this.pointerDown=true;this.setSelected(true);this.lastPosition.x=a.x;this.lastPosition.y=a.y;this.handlePointerEvent(a,1);return true};RShape.prototype.onPointerMoveNormal=function(a){if(this.hitTestResult){this.handlePointerEvent(a,0);return true}return false};RShape.prototype.onPointerUpNormal=function(a){if(this.hitTestResult){this.handlePointerEvent(a,-1);this.hitTestResult=C_HIT_TEST_NONE;return true}return false};RShape.prototype.fixSize=function(){if(this.w<this.MIN_SIZE){this.w=this.MIN_SIZE}if(this.h<this.MIN_SIZE){this.h=this.MIN_SIZE}if(this.wMin&&this.w<this.wMin){this.w=this.wMin}if(this.wMax&&this.w>this.wMax){this.w=this.wMax}if(this.hMax&&this.h>this.hMax){this.h=this.hMax}if(this.hMin&&this.h<this.hMin){this.h=this.hMin}if(this.whRadio){if(this.whRadio>1){this.h=Math.floor(this.w/this.whRadio)}else{this.w=Math.floor(this.h*this.whRadio)}}if(this.parentShape){this.parentShape.fixChildSize(this)}return};RShape.prototype.fixChildSize=function(c){var b=this.w;var a=this.h;if((c.x+c.w)>b){c.w=b-c.x}if((c.y+c.h)>a){c.h=a-c.y}return};RShape.prototype.setDefSize=function(a,b){this.defWidth=a;this.defHeight=b;this.w=a;this.h=b;return};RShape.prototype.setSizeLimit=function(d,e,b,c,a){this.wMin=d;this.wMax=b;this.hMin=e;this.hMax=c;this.whRadio=a;return};RShape.prototype.resizeDelta=function(a,b){this.resize(this.w+a,this.h+b);return};RShape.prototype.setPosition=function(a,b){this.x=a;this.y=b;return};RShape.prototype.setSize=function(a,b){this.w=Math.floor(a);this.h=Math.floor(b);return};RShape.prototype.resize=function(a,b){if(this.w!==a||this.h!==b){this.realResize(a,b)}return};RShape.prototype.realResize=function(a,b){a=Math.floor(a);b=Math.floor(b);if(this.w!=a||this.h!=b){this.w=a;this.h=b;this.textNeedRelayout=true;if(!this.isIcon){this.onSized();this.fixSize()}}return};RShape.prototype.translate=function(b){b.translate(this.x+this.w/2,this.y+this.h/2);if(this.rotate){var a=Math.PI*(this.rotate/180);b.rotate(a)}if(this.scale&&this.scale!=1){b.scale(this.scale,this.scale)}b.translate(-this.w/2,-this.h/2);return};RShape.prototype.isPointInThis=function(b,a){b.beginPath();b.rect(0,0,this.w,this.h);return b.isPointInPath(a.x,a.y)};RShape.prototype.getMoreSelectMark=function(b,a){return false};RShape.prototype.getNearPoint=function(c){var a=this.getX();var f=this.getY();var b=this.getWidth();var d=this.getHeight();var e={x:0,y:0};switch(c){case 0:e.x=a;e.y=f;break;case 1:e.x=a+b/2;e.y=f;break;case 2:e.x=a+b;e.y=f;break;case 3:e.x=a+b;e.y=f+d/2;break;case 4:e.x=a+b;e.y=f+d;break;case 5:e.x=a+b/2;e.y=f+d;break;case 6:e.x=a;e.y=f+d;break;case 7:e.x=a;e.y=f+d/2;break;case 8:e.x=a+b/2;e.y=f+d/2;break;default:if(b>d){switch(c){case 9:e.x=a+b/4;e.y=f;break;case 10:e.x=a+3*b/4;e.y=f;break;case 11:e.x=a+b/4;e.y=f+d;break;case 12:e.x=a+3*b/4;e.y=f+d;break;default:return null}}else{return null}}return e};RShape.prototype.getSelectMarkMobile=function(c,a){var b=true;switch(c){case C_HIT_TEST_TL:a.x=0;a.y=0;break;case C_HIT_TEST_TR:a.x=this.w;a.y=0;break;case C_HIT_TEST_BL:a.x=0;a.y=this.h;break;case C_HIT_TEST_BR:a.x=this.w;a.y=this.h;break;default:b=this.getMoreSelectMark(c,a)}return b};RShape.prototype.getSelectMarkPC=function(c,a){var b=true;switch(c){case C_HIT_TEST_TL:a.x=0;a.y=0;break;case C_HIT_TEST_TM:a.x=this.w/2;a.y=0;break;case C_HIT_TEST_TR:a.x=this.w;a.y=0;break;case C_HIT_TEST_ML:a.x=0;a.y=this.h/2;break;case C_HIT_TEST_MR:a.x=this.w;a.y=this.h/2;break;case C_HIT_TEST_BL:a.x=0;a.y=this.h;break;case C_HIT_TEST_BM:a.x=this.w/2;a.y=this.h;break;case C_HIT_TEST_BR:a.x=this.w;a.y=this.h;break;default:b=this.getMoreSelectMark(c,a)}return b};RShape.prototype.getSelectMark=function(b,a){if(isMobile()){return this.getSelectMarkMobile(b,a)}else{return this.getSelectMarkPC(b,a)}};RShape.prototype.drawImage=function(a){return};RShape.prototype.paintShape=function(a){a.rect(0,0,this.w,this.h);return};RShape.prototype.setTextNeedRelayout=function(a){this.textNeedRelayout=a;return};RShape.prototype.layoutText=function(b){if(!this.textNeedRelayout||this.textType===C_SHAPE_TEXT_NONE){return}b.font=this.style.getFont();var c=this.vMargin?this.vMargin:10;var a=this.w-2*c;if(a>0){this.lines=layoutText(b,this.style.fontSize,this.getLocaleText(this.text),a)}else{this.lines=[]}this.textNeedRelayout=false;return};RShape.prototype.drawTextUnderLine=function(e,d,b,g){var a=0;var j=0;var f=0;var c=0;if(!this.style.textU){return}c=e.measureText(g).width;if(this.textBaseline==="middle"){f=this.style.fontSize/2;if(this.textAlign==="center"){a=d-c/2}else{if(this.textAlign==="left"){a=d}else{a=d-c}}}else{if(this.textBaseline==="top"){f=this.style.fontSize;if(this.textAlign==="center"){a=d-c/2}else{if(this.textAlign==="left"){a=d}else{a=d-c}}}else{if(this.textAlign==="center"){a=d-c/2}else{if(this.textAlign==="left"){a=d}else{a=d-c}}}}j=b+f;e.moveTo(a,j);e.lineTo(a+c,j);e.lineWidth=1;e.stroke();return};RShape.prototype.needDrawTextTips=function(){return true};RShape.prototype.setInputTips=function(a){this.inputTips=a;return};RShape.prototype.drawTextTips=function(b){if(this.text||this.isIcon||this.w<150||this.h<40||this.editing){return}var a=this.getWidth()/2;var c=this.getHeight()/2;b.textAlign="center";b.textBaseline="middle";b.font=this.style.getFont();b.fillStyle="#E0E0E0";if(this.inputTips){b.fillText(dappGetText(this.inputTips),a,c,this.getWidth())}else{if(this.needDrawTextTips()&&this.selected&&!isMobile()){b.fillText(dappGetText("double click to edit text."),a,c,this.getWidth())}}return};RShape.prototype.getOneLineText=function(c,f){var b="";var a=this.getWidth(true);if(c.measureText(f).width<=a){return f}for(var d=0;d<f.length;d++){var e=f[d];a=a-c.measureText(e).width;if(a<0){break}b=b+e}return b};RShape.prototype.setMargin=function(b,a){this.vMargin=b;this.hMargin=a;return};RShape.prototype.getVMargin=function(){return this.vMargin?this.vMargin:0};RShape.prototype.getHMargin=function(){return this.hMargin?this.hMargin:0};RShape.prototype.getWidth=function(a){if(a){return this.w-2*this.getHMargin()}else{return this.w}};RShape.prototype.getHeight=function(a){if(a){return this.h-2*this.getVMargin()}else{return this.h}};RShape.prototype.drawText=function(a){this.defaultDrawText(a);return};RShape.prototype.prepareStyle=function(a){var b=this.style;a.lineWidth=b.lineWidth;a.strokeStyle=b.lineColor;if(b.enableGradient){a.fillStyle=b.getGradFillStyle(a,0,0,this.w,this.h)}else{a.fillStyle=b.fillColor}if(b.enableShadow){a.shadowColor=b.shadow.color;a.shadowOffsetX=b.shadow.x;a.shadowOffsetY=b.shadow.y;a.shadowBlur=b.shadow.blur}else{a.shadowOffsetX=0;a.shadowOffsetY=0;a.shadowBlur=0}return};RShape.prototype.resetStyle=function(a){a.shadowOffsetX=0;a.shadowOffsetY=0;a.shadowBlur=0;a.fillStyle="White";a.beginPath();return};RShape.prototype.strokeFill=function(a){if(this.style.enableShadow||isOldIE()){if(a.lineWidth>=1){if(!this.isStrokeColorTransparent()){a.stroke()}}if(!this.isFillColorTransparent()){a.fill()}}else{if(!this.isFillColorTransparent()){a.fill()}if(a.lineWidth>=1){if(!this.isStrokeColorTransparent()){a.stroke()}}}return};RShape.prototype.drawSizeTips=function(a){var b=Math.abs(this.w)+" x "+Math.abs(this.h);a.font="14px serif";a.textAlign="center";a.textBaseline="bottom";a.fillStyle=this.style.textColor;a.beginPath();a.fillText(b,this.w/2,0,this.w);a.fill();return};RShape.prototype.drawSelectMarks=function(a){a.save();a.beginPath();if(this.selected&&!this.hideSelectMark){a.beginPath();a.rect(0,0,this.w,this.h);a.closePath();a.lineWidth=1;a.fillStyle=this.style.fillColor;a.strokeStyle=gSelectMarkColor;a.stroke();a.beginPath();a.lineWidth=1;for(var b=C_HIT_TEST_NONE+1;b<C_HIT_TEST_MAX;b++){if(this.getSelectMark(b,this.selectMarkPoint)){this.createSelectedMark(a,this.selectMarkPoint.x,this.selectMarkPoint.y,b==this.hitTestResult)}}a.closePath();a.stroke()}a.restore();return};RShape.prototype.paintSelf=function(a){a.save();this.translate(a);a.save();a.beginPath();this.prepareStyle(a);this.paintShape(a);a.closePath();this.strokeFill(a);a.restore();this.resetStyle(a);this.drawImage(a);if(this.drawText&&this.textType!==C_SHAPE_TEXT_NONE){this.drawText(a);this.drawTextTips(a)}if(this.hitTestResult!==C_HIT_TEST_NONE||this.state!==C_STAT_NORMAL){this.drawSizeTips(a)}this.drawSelectMarks(a);a.restore();return};RShape.prototype.hitTest=function(a){var c=C_HIT_TEST_NONE;var b=this.view.getCanvas2D();b.save();this.translate(b);if(this.selected){for(var d=C_HIT_TEST_NONE+1;d<C_HIT_TEST_MAX;d++){var e=this.selectMarkPoint;if(this.getSelectMark(d,e)){if(this.isInSelectedMark(b,e.x,e.y,a)){b.restore();return d}}}if(this.isPointInThis(b,a)){c=C_HIT_TEST_MM}}else{if(this.isPointInThis(b,a)){c=C_HIT_TEST_MM}}b.restore();return c};RShape.prototype.lockPosition=function(a){this.userMovable=!a;this.isPositionLocked=a;return};RShape.prototype.execMoveResize=function(a,d,b,c){this.exec(new MoveResizeCommand(this,a,d,b,c));return};RShape.prototype.handlePointerEvent=function(m,g){if(g===C_EVT_POINTER_DOWN){this.saveDx=this.x;this.saveDy=this.y;this.saveWidth=this.w;this.saveHeight=this.h;return}var p=m.x-this.lastPosition.x;var o=m.y-this.lastPosition.y;var b=p;var a=o;var f=0;var e=0;var j=this.w;var c=this.h;switch(this.hitTestResult){case C_HIT_TEST_TL:f=b;e=a;j=this.w-b;c=this.h-a;break;case C_HIT_TEST_TM:e=a;c=this.h-a;break;case C_HIT_TEST_TR:f=0;e=a;j=this.w+b;c=this.h-a;break;case C_HIT_TEST_ML:f=b;j=this.w-b;break;case C_HIT_TEST_MR:j=this.w+b;break;case C_HIT_TEST_BL:f=b;j=this.w-b;c=this.h+a;break;case C_HIT_TEST_BM:c=this.h+a;break;case C_HIT_TEST_BR:j=this.w+b;c=this.h+a;break;case C_HIT_TEST_MM:f=b;e=a;break;default:break}if(g===C_EVT_POINTER_UP){if(this.x!==this.saveDx||this.y!==this.saveDy){var p=this.x;var o=this.y;this.x=this.saveDx;this.y=this.saveDy;if(this.isUserMovable()){this.execMoveResize(p,o)}}if(this.w!==this.saveWidth||this.h!==this.saveHeight){var l=this.w;var d=this.h;this.w=this.saveWidth;this.h=this.saveHeight;if(this.isUserResizable()){this.execMoveResize(null,null,l,d);this.onUserResized()}}this.hitTestResult=C_HIT_TEST_NONE}else{if(f||e){if(this.isUserMovable()){this.setPosition(this.x+f,this.y+e)}this.onMoving()}if(this.w!==j||this.h!==c){if(this.isUserResizable()){this.setSize(j,c)}}}if(this.hitTestResult===C_HIT_TEST_HANDLE){this.moveHandle(p,o)}this.postRedraw();this.lastPosition.x=m.x;this.lastPosition.y=m.y;return true};RShape.prototype.onKeyDown=function(a){return};RShape.prototype.onKeyUp=function(a){return};RShape.prototype.toJsonMore=function(a){return};RShape.prototype.toJson=function(){var d=new Object();d.type="";d.name="";for(var a in this){var c=this[a];var b=typeof c;if(b==="function"||b==="object"||b==="undefined"){continue}if(b==="number"||b==="string"||b==="boolean"){d[a]=c}}delete d.mode;delete d.state;delete d.saveDx;delete d.saveDy;delete d.MIN_SIZE;delete d.selected;delete d.animating;delete d.pointerDown;delete d.saveWidth;delete d.saveHeight;delete d.hignlighted;delete d.textNeedRelayout;delete d.openPending;delete d.pointerDownTime;delete d.hitTestResult;delete d.pointerDownPosition;if(d.rotate==0){delete d.rotate}if(!d.imageUrl){delete d.imageUrl}if(d.offset){d.offset=0}d.x=Math.floor(this.x);d.y=Math.floor(this.y);d.w=Math.floor(this.w);d.h=Math.floor(this.h);d.style=this.style.toJson();delete d.style.arrowSize;delete d.style.lineStyle;delete d.style.firstArrowType;delete d.style.secondArrowType;if(this.handle){d.handle=this.handle}this.toJsonMore(d);return d};RShape.prototype.fromJsonMore=function(a){return};RShape.prototype.onFromJsonDone=function(){};RShape.prototype.fromJson=function(d){this.isUnpacking=true;for(var a in d){var c=d[a];var b=typeof c;if(b==="function"||b==="object"||b==="undefined"){continue}if(b==="number"||b==="string"||b==="boolean"){this[a]=c}}this.fromJsonMore(d);if(d.style){this.style.fromJson(d.style)}if(d.handle){this.handle=d.handle}if(d.dx!=undefined){this.x=d.dx}if(d.dy!=undefined){this.y=d.dy}this.setText(this.text);this.textNeedRelayout=true;this.state=C_STAT_NORMAL;delete this.isUnpacking;this.onFromJsonDone();return};RShape.prototype.setImage=function(a){if(a===this.imageUrl){return}this.imageUrl=a;this.image=new WtkImage(a);return};RShape.prototype.asIcon=function(){this.resize(36,36);if(!this.isIcon){this.setStyle(getIconShapeStyle())}this.isIcon=true;return};RShape.prototype.showProperty=function(){showGeneralPropertyDialog(this,this.textType,true,false);return};RShape.prototype.getMoveDeltaX=function(){return this.view?this.view.getMoveDeltaX():0};RShape.prototype.getMoveDeltaY=function(){return this.view?this.view.getMoveDeltaY():0};RShape.prototype.getMoveAbsDeltaX=function(){return this.view?this.view.getMoveAbsDeltaX():0};RShape.prototype.getMoveAbsDeltaY=function(){return this.view?this.view.getMoveAbsDeltaY():0};function RShapeInit(e,d){var a=0;var f=0;var b=0;var c=0;e.initRShape(a,f,b,c,d);e.setSize(40,40);e.setText("");return e}function LShape(){return}LShape.prototype=new Shape();LShape.prototype.initDefault=function(){return};LShape.prototype.isLine=true;LShape.prototype.resizeDelta=function(a,b){return};LShape.prototype.setOptions=function(b,c,a,d){this.firstArrowUnchangable=b;this.secondArrowUnchangable=c;this.lineStyleUnchangable=a;this.arrowSizeUnchangable=d;return};LShape.prototype.setStyle=function(d){var e=this.style.firstArrowType;var c=this.style.secondArrowType;var a=this.style.lineStyle;var b=this.style.arrowSize;this.style.copy(d);this.needRelayout=true;if(this.firstArrowUnchangable){this.style.setFirstArrowType(e)}if(this.secondArrowUnchangable){this.style.setSecondArrowType(c)}if(this.lineStyleUnchangable){this.style.setLineStyle(a)}if(this.arrowSizeUnchangable){this.style.setArrowSize(b)}return};LShape.prototype.getWidth=function(){var c=this.points[0].x;var a=this.points[0].x;for(var b=0;b<this.points.length;b++){var d=this.points[b];if(c>d.x){c=d.x}if(a<d.x){a=d.x}}return a-c};LShape.prototype.getHeight=function(){var c=this.points[0].y;var a=this.points[0].y;for(var b=0;b<this.points.length;b++){var d=this.points[b];if(c>d.y){c=d.y}if(a<d.y){a=d.y}}return a-c};LShape.prototype.getX=function(){var a=this.points[0].x;for(var b=0;b<this.points.length;b++){var c=this.points[b];if(a>c.x){a=c.x}}return a};LShape.prototype.getY=function(){var c=this.points[0].y;for(var a=0;a<this.points.length;a++){var b=this.points[a];if(c>b.y){c=b.y}}return c};LShape.prototype.updatePoint=function(b,a){return false};LShape.prototype.isPointInThis=function(b,a){return false};LShape.prototype.getPoint=function(a){return a<this.points.length?this.points[a]:null};LShape.prototype.saveState=function(){if(!this.savePoints){this.savePoints=new Array()}this.savePoints.copy(this.points);return};LShape.prototype.findNear=function(b){this.near=null;if(this.view){var c=this.getNearRange();var a=c+c;var d={x:b.x-c,y:b.y-c,w:a,h:a};this.near=this.view.findNear(this,d)}return this.near};LShape.prototype.getNearPoint=function(a){if(a<this.points.length){return this.points[a]}return null};LShape.prototype.initLShape=function(e,d){this.points=new Array();this.savePoints=new Array();this.initDefault();var a=this.getX();var f=this.getY();var b=this.getWidth();var c=this.getHeight();this.initShape(a,f,b,c,d);if(e){this.points.copy(e);this.state=C_STAT_NORMAL}else{this.state=C_STAT_CREATING_0}this.style.setLineWidth(2);return};LShape.prototype.onPointerDown=function(a){this.pointerDown=true;this.lastPosition.copy(a);if(this.state===C_STAT_NORMAL){this.hitTestResult=this.hitTest(a)}this.setSelected(this.hitTestResult);this.handlePointerEvent(a,C_EVT_POINTER_DOWN);this.postRedraw();this.saveState();return this.hitTestResult};LShape.prototype.move=function(a,d){var c=a-this.getX();var b=d-this.getY();this.moveDelta(c,b);return};LShape.prototype.moveDelta=function(b,a){for(var c in this.points){this.points[c].x+=b;this.points[c].y+=a}return};LShape.prototype.isPointInSegment=function(b,f,c,h){if(!f||!c){return}var g=false;var e=10;var l=c.x-f.x;var j=c.y-f.y;var a=Math.sqrt(l*l+j*j);var d=Math.atan(j/l);b.save();b.translate((f.x+c.x)/2,(f.y+c.y)/2);b.rotate(d);b.beginPath();b.rect(-a/2,-e,a,2*e);b.restore();g=b.isPointInPath(h.x,h.y);b.beginPath();return g};LShape.prototype.onPointerMove=function(a){var d=true;if(this.state===C_STAT_NORMAL){if(this.hitTestResult){if(this.hitTestResult===C_HIT_TEST_MM){var c=a.x-this.lastPosition.x;var b=a.y-this.lastPosition.y;this.moveDelta(c,b)}else{this.findNear(a);this.updatePoint(this.hitTestResult-1,a)}this.postRedraw()}}else{this.findNear(a)}this.handlePointerEvent(a,C_EVT_POINTER_MOVE);this.lastPosition.copy(a);this.onMoved();return this.hitTestResult};LShape.prototype.clearAttachedNearPoints=function(){this.observers=[];return};LShape.prototype.updateNearPoints=function(){for(var a=0;a<this.points.length;a++){var b=this.findNear(this.points[a]);this.attachToNearPoint(b,a);this.near=null}return};LShape.prototype.attachToNearPoint=function(e,f){if(!this.observers){this.observers=[]}for(var d=this.observers.length;d<(f+1);d++){this.observers.push(null)}if(!e){this.observers[f]=null;return}var a=this;var b={};var c=e.shape;b.line=this;b.object=e.shape;b.pointIndex=f;b.observerPointIndex=e.nearPointIndex;this.points[f].copy(e.point);b.update=function(j){if(this.object!=j){return false}if(!this.line.view){return false}if(this.line.selected&&this.line.view.isPointerDown()){return true}var m=this.line.observers;for(var l=0;l<m.length;l++){var h=m[l];if(!h){continue}if(h.object===j){var g=j.getNearPoint(this.observerPointIndex);this.line.updatePoint(this.pointIndex,g);return true}}return false};this.observers[f]=null;this.observers[f]=b;c.registerChangedListener(b);return};LShape.prototype.onPointerUp=function(a){var c=this.state;this.handlePointerEvent(a,C_EVT_POINTER_UP);this.lastPosition.copy(a);this.postRedraw();this.pointerDown=false;if(this.hitTestResult>0){var b=this.hitTestResult-1;this.attachToNearPoint(this.near,b);if(this.near){this.updatePoint(b,this.near.point)}}else{if(!this.isClicked()&&c===C_STAT_NORMAL){this.clearAttachedNearPoints()}}this.hitTestResult=C_HIT_TEST_NONE;this.exec(new LineMoveCommand(this,this.savePoints,!this.near));this.near=null;if(!this.isClicked()){this.onMoved()}return this.hitTestResult};LShape.prototype.resize=function(a,b){return};LShape.prototype.translate=function(a){a.translate(this.x,this.y);return};LShape.prototype.drawSelectMarks=function(b){if(this.selected){b.beginPath();b.lineWidth=1;b.shadowBlur=0;b.strokeStyle=this.style.lineColor;for(var c=0;c<this.points.length;c++){var d=this.points[c];var a=(c===(this.hitTestResult-1));this.createSelectedMark(b,d.x,d.y,a)}b.stroke();b.beginPath()}return};LShape.prototype.drawTips=function(a){if((this.selected&&this.pointerDown)){a.fillStyle=this.style.lineColor;for(var b=0;b<this.points.length;b++){var c=this.points[b];var d=Math.floor(c.x)+"x"+Math.floor(c.y);a.font="14px serif";a.textAlign="center";a.textBaseline="bottom";a.fillText(d,c.x,c.y,100)}}return};LShape.prototype.hitTest=function(a){var c=C_HIT_TEST_NONE;var b=this.view.getCanvas2D();b.save();this.translate(b);for(var d=0;d<this.points.length;d++){var e=this.points[d];if(this.isInSelectedMark(b,e.x,e.y,a)){b.restore();return this.selected?(d+1):C_HIT_TEST_MM}}if(this.isPointInThis(b,a)){c=C_HIT_TEST_MM}b.restore();return c};LShape.prototype.onKeyDown=function(a){return};LShape.prototype.onKeyUp=function(a){return};LShape.prototype.pointsToJson=function(){var b="";for(var a=0;a<this.points.length;a++){var c=this.points[a];if(a>0){b+=","}b+="{x:"+c.x+",y:"+c.y+"}"}return b};LShape.prototype.toJson=function(){var a=new Object();a.type=this.type;a.points=this.points;a.text=this.text;a.style=this.style.toJson();return a};LShape.prototype.pointsFromJson=function(c){for(var a=0;a<c.points.length;a++){var b=c.points[a];this.points.push(new Point(b.x,b.y))}return};LShape.prototype.fromJson=function(a){this.points.clear();this.text=a.text;this.style.fromJson(a.style);this.pointsFromJson(a);this.state=C_STAT_NORMAL;return};LShape.prototype.drawText=function(c){var d=this.getLocaleText(this.text);if(d){var a=(this.points[0].x+this.points[1].x)/2;var e=(this.points[0].y+this.points[1].y)/2;c.beginPath();c.textAlign="center";c.textBaseline="bottom";var b=this.style.getFont();c.font=b;c.fillStyle=this.style.textColor;c.fillText(d,a,e);c.fill()}return};LShape.prototype.prepareStyle=function(a){var b=this.style;a.lineWidth=b.lineWidth;a.strokeStyle=b.lineColor;a.fillStyle=b.fillColor;if(b.enableGradient){a.strokeStyle=b.getStrokeStyle(a)}else{a.strokeStyle=b.lineColor}if(b.enableShadow){a.shadowColor=b.shadow.color;a.shadowOffsetX=b.shadow.x;a.shadowOffsetY=b.shadow.y;a.shadowBlur=b.shadow.blur}return};LShape.prototype.resetStyle=function(a){a.shadowOffsetX=0;a.shadowOffsetY=0;a.shadowBlur=0;a.strokeStyle=this.style.lineColor;a.beginPath();return};LShape.prototype.showProperty=function(){showLinePropertyDialog(this,this.textType);return};LShape.prototype.asIcon=function(){this.isIcon=true;this.setStyle(getIconShapeStyle());return};Shape.prototype.setDefaultStyle=function(){this.style=new ShapeStyle();this.setStyle(DefaultShapeStyleGet());if(this.isLine){this.style.setShadow(true,{x:0,y:0,blur:8,color:"#D0D0D0"})}return};RShape.prototype.onSized=function(){var a=this;setTimeout(function(){a.notifyChanged()},10);return};Shape.prototype.onMoving=function(){var a=this;setTimeout(function(){a.notifyChanged()},10);return};Shape.prototype.notifyChanged=function(){if(!this.changedListeners){return}for(var a=0;a<this.changedListeners.length;a++){var b=this.changedListeners[a];if(b){if(!b.update(this)){this.changedListeners[a]=null}}}this.postRedraw();return};Shape.prototype.removeChangedListener=function(a){if(this.changedListeners){this.changedListeners.remove(a)}return};Shape.prototype.registerChangedListener=function(a){if(!a){return}if(!this.changedListeners){this.changedListeners=[]}this.changedListeners.remove(null);this.changedListeners.remove(a);this.changedListeners.push(a);return};function RectShape(){return}RectShape.prototype=new RShape();RectShape.prototype.initRectShape=function(c,a,b){RShapeInit(this,c);this.setDefSize(a,b);this.setMargin(10,10);return this};function RectShapeCreator(){var a=["rect","",null,1];ShapeCreator.apply(this,a);this.createShape=function(c){var b=new RectShape();b.initRectShape(this.type,200,60);b.setTextType(C_SHAPE_TEXT_TEXTAREA);return b};return}function CircleShapeCreator(d,a,c){d=d?d:"circle";var b=[d,"Circle",null,1];ShapeCreator.apply(this,b);this.createShape=function(f){var e=new CircleShape();return e.initRectShape(this.type,a?a:100,c?c:100)};return}function CircleShape(){return}CircleShape.prototype=new RectShape();CircleShape.prototype.getNearPoint=function(c){var a=this.getX();var f=this.getY();var b=this.getWidth();var d=this.getHeight();var e={x:0,y:0};switch(c){case 0:e.x=a+b/2;e.y=f;break;case 1:e.x=a+b;e.y=f+d/2;break;case 2:e.x=a+b/2;e.y=f+d;break;case 3:e.x=a;e.y=f+d/2;break;case 4:e.x=a+b/2;e.y=f+d/2;break;default:return null}return e};CircleShape.prototype.paintShape=function(b){var a=this.w/2;var d=this.h/2;var c=this.h/this.w;b.translate(a,d);b.scale(1,c);b.arc(0,0,this.w/2,0,2*Math.PI);return};function ImageRectShapeCreator(){var a=["image","Image",null,1];ShapeCreator.apply(this,a);this.createShape=function(c){var b=new ImageRectShape();return b.initRectShape(this.type,200,200)};return}function ImageRectShape(){return}ImageRectShape.prototype=new RectShape();ImageRectShape.prototype.showProperty=function(){showGeneralPropertyDialog(this,this.textType,true,true);return};ImageRectShape.prototype.drawImage=function(c){if(!this.image){this.setImage(drawingGetImageURL("earth.jpg"));return}var e=this.image.getImage();if(!e){return}var d=e.width;var f=e.height;if(d<=0||f<=0){return}var b=(this.w-d)/2;var a=(this.h-f)/2;c.drawImage(e,0,0,d,f,b,a,d,f);return};ImageRectShape.prototype.paintShape=function(a){a.rect(0,0,this.w,this.h);return};ImageRectShape.prototype.asIcon=function(a){this.isIcon=true;this.resize(36,36);this.setStyle(getIconShapeStyle());this.setImage("editor/images/image.png");return};function CubeShapeCreator(){var a=["cube","Cube",null,1];ShapeCreator.apply(this,a);this.createShape=function(c){var b=new CubeShape();return b.initRectShape(this.type,200,200)};return}function CubeShape(){return}CubeShape.prototype=new RectShape();CubeShape.prototype.paintShape=function(b){var c=this.R;var d=0.25*this.h;var a=0.25*this.w;b.beginPath();b.rect(0,d,this.w-a,this.h-d);b.stroke();b.fill();b.beginPath();b.moveTo(0,d);b.lineTo(a,0);b.lineTo(this.w,0);b.lineTo(this.w-a,d);b.lineTo(0,d);b.stroke();b.fill();b.beginPath();b.moveTo(this.w-a,d);b.lineTo(this.w-a,this.h);b.lineTo(this.w,this.h-d);b.lineTo(this.w,0);return};function CylinderShapeCreator(){var a=["cylinder","Cylinder",null,1];ShapeCreator.apply(this,a);this.createShape=function(c){var b=new CylinderShape();return b.initRectShape(this.type,200,200)};return}function CylinderShape(){return}CylinderShape.prototype=new RectShape();CylinderShape.prototype.getNearPoint=CircleShape.prototype.getNearPoint;CylinderShape.prototype.paintShape=function(b){var d=this.R;var c=0.5*this.h;var a=this.w/2;var f=c/2;var e=c/this.w;b.save();b.translate(a,f);b.scale(1,e);b.arc(0,0,this.w/2,0,2*Math.PI);b.restore();b.stroke();b.fill();b.beginPath();b.save();b.translate(a,f);b.scale(1,e);b.arc(0,0,this.w/2,0,Math.PI);b.restore();b.moveTo(0,c/2);b.lineTo(0,this.h-c/2);b.save();f=this.h-c/2;b.translate(a,f);b.scale(1,e);b.arc(0,0,this.w/2,0,Math.PI);b.restore();b.moveTo(this.w,c/2);b.lineTo(this.w,this.h-c/2);b.stroke();b.fill();b.beginPath();return};function FourArrowShapeCreator(c,b){var e=100;var d=80;switch(b){case C_SHAPE_THREE_LEFT_ARROW:e=0;d=120;break;case C_SHAPE_THREE_RIGHT_ARROW:e=80;d=80;break;case C_SHAPE_THREE_DOWN_ARROW:e=20;d=120;break;case C_SHAPE_THREE_UP_ARROW:e=40;d=120;break;default:break}this.feature=b;var a=[c,"Four arrow",null,1];ShapeCreator.apply(this,a);this.createShape=function(h){var m=1;var l=1;var o=1;var j=1;switch(this.feature){case C_SHAPE_THREE_LEFT_ARROW:l=0;break;case C_SHAPE_THREE_RIGHT_ARROW:j=0;break;case C_SHAPE_THREE_DOWN_ARROW:m=0;break;case C_SHAPE_THREE_UP_ARROW:o=0;break;default:break}var f=new FourArrowShape();f.initRectShape(this.type,200,200);f.setAttr(m,l,o,j);return f};return}var C_SHAPE_FOUR_ARROW=50;var C_SHAPE_THREE_LEFT_ARROW=60;var C_SHAPE_THREE_RIGHT_ARROW=70;var C_SHAPE_THREE_DOWN_ARROW=80;var C_SHAPE_THREE_UP_ARROW=90;function FourArrowShape(){return}FourArrowShape.prototype=new RectShape();FourArrowShape.prototype.setAttr=function(c,b,d,a){this.has_left=a;this.has_right=b;this.has_up=c;this.has_down=d;return};FourArrowShape.prototype.paintShape=function(a){var b=Math.min(this.w/4,this.h/4);if(b>30){b=30}if(this.has_up){a.moveTo(this.w/2-0.5*b,(this.h/2)-0.5*b);a.lineTo(this.w/2-0.5*b,b);a.lineTo(this.w/2-1.5*b,b);a.lineTo(this.w/2,0);a.lineTo(this.w/2+1.5*b,b);a.lineTo(this.w/2+0.5*b,b)}if(this.has_right){a.lineTo(this.w/2+0.5*b,(this.h-b)/2);a.lineTo(this.w-b,(this.h-b)/2);a.lineTo(this.w-b,(this.h-b)/2-b);a.lineTo(this.w,(this.h/2));a.lineTo(this.w-b,(this.h/2)+1.5*b);a.lineTo(this.w-b,(this.h/2)+0.5*b);a.lineTo(this.w/2+0.5*b,(this.h/2)+0.5*b)}if(this.has_down){a.lineTo(this.w/2+0.5*b,this.h-b);a.lineTo(this.w/2+1.5*b,this.h-b);a.lineTo(this.w/2,this.h);a.lineTo(this.w/2-1.5*b,this.h-b);a.lineTo(this.w/2-0.5*b,this.h-b);a.lineTo(this.w/2-0.5*b,(this.h/2)+0.5*b)}if(this.has_left){a.lineTo(b,(this.h/2)+0.5*b);a.lineTo(b,(this.h/2)+1.5*b);a.lineTo(0,(this.h/2));a.lineTo(b,(this.h/2)-1.5*b);a.lineTo(b,(this.h/2)-0.5*b)}return};FourArrowShape.prototype.asIcon=function(a){this.isIcon=true;this.resize(36,36);this.setStyle(getIconShapeStyle());if(!this.has_up||!this.has_down){this.resize(20,36)}if(!this.has_left||!this.has_right){this.resize(20,36)}return};function LeftArrowShapeCreator(){var a=["left-arrow","Left Arrow",null,1];ShapeCreator.apply(this,a);this.createShape=function(c){var b=new RectShape();b.initRectShape(this.type,200,60);b.paintShape=function(e){var d=this.w/4;var f=this.h/2;e.beginPath();e.moveTo(d,0.5*f);e.lineTo(d,0);e.lineTo(0,f);e.lineTo(d,2*f);e.lineTo(d,1.5*f);e.lineTo(this.w,1.5*f);e.lineTo(this.w,0.5*f);e.lineTo(d,0.5*f);this.strokeFill(e);e.beginPath()};return b};return}function RightArrowShapeCreator(){var a=["right-arrow","Right Arrow",null,1];ShapeCreator.apply(this,a);this.createShape=function(c){var b=new RectShape();b.initRectShape(this.type,200,60);b.paintShape=function(e){var d=this.w/4;var f=this.h/2;e.beginPath();e.moveTo(0,0.5*f);e.lineTo(this.w-d,0.5*f);e.lineTo(this.w-d,0);e.lineTo(this.w,this.h/2);e.lineTo(this.w-d,this.h);e.lineTo(this.w-d,this.h-0.5*f);e.lineTo(0,1.5*f);e.lineTo(0,0.5*f);e.lineTo(this.w-d,0.5*f);this.strokeFill(e);e.beginPath()};return b};return}function UpArrowShapeCreator(){var a=["up-arrow","Up Arrow",null,1];ShapeCreator.apply(this,a);this.createShape=function(c){var b=new RectShape();b.initRectShape(this.type,60,200);b.oldDrawText=b.drawText;b.drawText=function(d){d.save();d.translate(this.w/2,this.h/2);d.rotate(Math.PI*1.5);d.translate(-this.w/2,-this.h/2);this.oldDrawText(d);d.restore();return};b.paintShape=function(e){var f=this.h/4;var d=this.w/2;e.beginPath();e.moveTo(0.5*d,f);e.lineTo(0,f);e.lineTo(d,0);e.lineTo(this.w,f);e.lineTo(this.w-0.5*d,f);e.lineTo(this.w-0.5*d,this.h);e.lineTo(0.5*d,this.h);e.lineTo(0.5*d,f);this.strokeFill(e);e.beginPath()};return b};return}function DownArrowShapeCreator(){var a=["down-arrow","Down Arrow",null,1];ShapeCreator.apply(this,a);this.createShape=function(c){var b=new RectShape();b.initRectShape(this.type,60,200);b.oldDrawText=b.drawText;b.drawText=function(d){d.save();d.translate(this.w/2,this.h/2);d.rotate(Math.PI*0.5);d.translate(-this.w/2,-this.h/2);this.oldDrawText(d);d.restore();return};b.paintShape=function(e){var f=this.h/4;var d=this.w/2;e.beginPath();e.moveTo(this.w-0.5*d,this.h-f);e.lineTo(this.w,this.h-f);e.lineTo(d,this.h);e.lineTo(0,this.h-f);e.lineTo(0.5*d,this.h-f);e.lineTo(0.5*d,0);e.lineTo(this.w-0.5*d,0);e.lineTo(this.w-0.5*d,this.h-f);this.strokeFill(e);e.beginPath()};return b};return}function HorArrowShapeCreator(){var a=["hor-arrow","Hor Arrow",null,1];ShapeCreator.apply(this,a);this.createShape=function(c){var b=new RectShape();b.initRectShape(this.type,200,60);b.paintShape=function(e){var d=this.w/4;var f=this.h/2;e.beginPath();e.moveTo(d,0.5*f);e.lineTo(d,0);e.lineTo(0,f);e.lineTo(d,2*f);e.lineTo(d,1.5*f);e.lineTo(this.w-d,1.5*f);e.lineTo(this.w-d,2*f);e.lineTo(this.w,f);e.lineTo(this.w-d,0);e.lineTo(this.w-d,0.5*f);e.lineTo(d,0.5*f);this.strokeFill(e);e.beginPath()};return b};return}function VerArrowShapeCreator(){var a=["ver-arrow","Ver Arrow",null,1];ShapeCreator.apply(this,a);this.createShape=function(c){var b=new RectShape();b.initRectShape(this.type,60,200);b.oldDrawText=b.drawText;b.drawText=function(d){d.save();d.translate(this.w/2,this.h/2);d.rotate(Math.PI*1.5);d.translate(-this.w/2,-this.h/2);this.oldDrawText(d);d.restore();return};b.paintShape=function(e){var f=this.h/4;var d=this.w/2;e.beginPath();e.moveTo(0.5*d,f);e.lineTo(0,f);e.lineTo(d,0);e.lineTo(this.w,f);e.lineTo(this.w-0.5*d,f);e.lineTo(this.w-0.5*d,this.h-f);e.lineTo(this.w,this.h-f);e.lineTo(d,this.h);e.lineTo(0,this.h-f);e.lineTo(0.5*d,this.h-f);e.lineTo(0.5*d,f);this.strokeFill(e);e.beginPath()};return b};return}function TriRectShapeCreator(){var a=["tri-rect","Tri Rect",null,1];ShapeCreator.apply(this,a);this.createShape=function(c){var b=new TriRectShape();return b.initRectShape(this.type,200,60)};return}function TriRectShape(){return}TriRectShape.prototype=new RectShape();TriRectShape.prototype.getNearPoint=CircleShape.prototype.getNearPoint;TriRectShape.prototype.paintShape=function(b){var c=this.h/2;var a=this.w/2;if(a>c){a=c}b.moveTo(0,c);b.lineTo(a,0);b.lineTo(this.w-a,0);b.lineTo(this.w,c);b.lineTo(this.w-a,this.h);b.lineTo(a,this.h);b.lineTo(0,c);return};TriRectShape.prototype.asIcon=function(){this.isIcon=true;this.resize(44,30);this.setStyle(getIconShapeStyle());return};function RoundRectShapeCreator(b){b=b?b:"rounded-rect";var a=[b,"Rounded Rect",null,1];ShapeCreator.apply(this,a);this.createShape=function(d){var c=new RoundRectShape();c.initRectShape(this.type,200,60);c.setTextType(C_SHAPE_TEXT_TEXTAREA);return c};return}function RoundRectShape(){this.R=10;return}RoundRectShape.prototype=new RectShape();RoundRectShape.prototype.getNearPoint=CircleShape.prototype.getNearPoint;RoundRectShape.prototype.paintShape=function(a){var b=this.R;if(b>this.w/2){b=Math.round(this.w/2)}if(b>this.h/2){b=Math.round(this.h/2)}if(this.isIcon){b=5}a.arc(b,b,b,Math.PI,1.5*Math.PI,false);a.lineTo(this.w-b,0);a.arc(this.w-b,b,b,1.5*Math.PI,2*Math.PI,false);a.lineTo(this.w,this.h-b);a.arc(this.w-b,this.h-b,b,0,0.5*Math.PI,false);a.lineTo(b,this.h);a.arc(b,this.h-b,b,0.5*Math.PI,Math.PI,false);a.lineTo(0,b);return};RoundRectShape.prototype.asIcon=function(){this.isIcon=true;this.resize(36,30);this.setStyle(getIconShapeStyle());return};function ParallRectShapeCreator(d,a,c){d=d?d:"parall-rect";var b=[d,"Parall Rect",null,1];ShapeCreator.apply(this,b);this.createShape=function(f){var e=new ParallRectShape();return e.initRectShape(this.type,a?a:200,c?c:60)};return}function ParallRectShape(){return}ParallRectShape.prototype=new RectShape();ParallRectShape.prototype.getSelectMark=function(c,a){var b=true;switch(c){case C_HIT_TEST_TL:a.x=this.h;a.y=0;break;case C_HIT_TEST_TM:a.x=(this.w)/2;a.y=0;break;case C_HIT_TEST_TR:a.x=this.w;a.y=0;break;case C_HIT_TEST_ML:a.x=this.h/2;a.y=this.h/2;break;case C_HIT_TEST_MR:a.x=this.w-this.h/2;a.y=this.h/2;break;case C_HIT_TEST_BL:a.x=0;a.y=this.h;break;case C_HIT_TEST_BM:a.x=(this.w)/2;a.y=this.h;break;case C_HIT_TEST_BR:a.x=this.w-this.h;a.y=this.h;break;default:b=false}a.x=Math.round(a.x);a.y=Math.round(a.y);return b};ParallRectShape.prototype.paintShape=function(a){if(this.isIcon){var b=10;a.moveTo(0,this.h);a.lineTo(b,0);a.lineTo(this.w,0);a.lineTo(this.w-b,this.h);a.lineTo(0,this.h)}else{a.moveTo(0,this.h);a.lineTo(this.h,0);a.lineTo(this.w,0);a.lineTo(this.w-this.h,this.h);a.lineTo(0,this.h)}return};ParallRectShape.prototype.asIcon=function(){this.resize(40,32);if(!this.isIcon){this.setStyle(getIconShapeStyle())}this.isIcon=true;return};function DiamondShapeCreator(d,a,c){d=d?d:"diamond";var b=[d,"Diamond",null,1];ShapeCreator.apply(this,b);this.createShape=function(f){var e=new DiamondShape();return e.initRectShape(this.type,a?a:200,c?c:60)};return}function DiamondShape(){return}DiamondShape.prototype=new RectShape();DiamondShape.prototype.getNearPoint=CircleShape.prototype.getNearPoint;DiamondShape.prototype.paintShape=function(a){var c=Math.round(this.h/2);var b=Math.round(this.w/2);a.moveTo(0,c);a.lineTo(b,0);a.lineTo(this.w,c);a.lineTo(b,this.h);a.lineTo(0,c);return};function ArcRectShapeCreator(b){b=b?b:"arc-rect";var a=[b,"Arc Rect",null,1];ShapeCreator.apply(this,a);this.createShape=function(d){var c=new ArcRectShape();c.initRectShape(this.type,200,60);c.setTextType(C_SHAPE_TEXT_TEXTAREA);return c};return}function ArcRectShape(){return}ArcRectShape.prototype=new RectShape();ArcRectShape.prototype.getNearPoint=CircleShape.prototype.getNearPoint;ArcRectShape.prototype.paintShape=function(a){var b=Math.floor(this.h/2);if(b>this.w/2){b=Math.floor(this.w/2)}if(b>this.h/2){b=Math.floor(this.h/2)}a.arc(b,b,b,Math.PI,1.5*Math.PI,false);a.lineTo(this.w-b,0);a.arc(this.w-b,b,b,1.5*Math.PI,2*Math.PI,false);a.lineTo(this.w,this.h-b);a.arc(this.w-b,this.h-b,b,0,0.5*Math.PI,false);a.lineTo(b,this.h);a.arc(b,this.h-b,b,0.5*Math.PI,Math.PI,false);a.lineTo(0,b);return};ArcRectShape.prototype.asIcon=function(){this.isIcon=true;this.resize(40,30);this.setStyle(getIconShapeStyle());return};function LineShapeCreator(){var a=["line","Line",null,1];ShapeCreator.apply(this,a);this.createShape=function(c){var b=new LineShape();b.initLShape(null,this.type);return b};return}function LineShape(){return}LineShape.prototype=new LShape();LineShape.prototype.initDefault=function(){this.type="line";this.points_nr=0;this.points.push(new Point(0,0));this.points.push(new Point(50,50));this.state=C_STAT_CREATING_0;return};LineShape.prototype.updatePoint=function(e,b){if(e<this.points.length){this.points[e].copy(b);var a=e===1?0:1;var d=Math.abs(b.x-this.points[a].x);var c=Math.abs(b.y-this.points[a].y);if(this.isCtrlDown()){if(d<c){this.points[e].x=this.points[a].x}else{this.points[e].y=this.points[a].y}}else{if(d<=5&&c>20){this.points[e].x=this.points[a].x}else{if(c<=5&&d>20){this.points[e].y=this.points[a].y}}}}return true};LineShape.prototype.getNearPoint=function(a){var b=null;switch(a){case 0:b=this.points[0];break;case 1:b=this.points[1];break;case 2:b={x:0,y:0};b.x=(this.points[0].x+this.points[1].x)/2;b.y=(this.points[0].y+this.points[1].y)/2;break}return b};LineShape.prototype.isPointInThis=function(b,a){return this.isPointInSegment(b,this.points[0],this.points[1],a)};LineShape.prototype.handlePointerEvent=function(a,c){if(this.state===C_STAT_NORMAL){return true}if(c===C_EVT_POINTER_DOWN){this.points[0].copy(a);this.attachToNearPoint(this.near,0);this.points[1].x=a.x+10;this.points[1].y=a.y+10}else{if(c===C_EVT_POINTER_MOVE){var d=a.x-this.lastPosition.x;var b=a.y-this.lastPosition.y;if(this.pointerDown){this.updatePoint(1,a)}else{this.moveDelta(d,b)}this.postRedraw()}else{if(c===C_EVT_POINTER_UP){this.setSelected(true);this.state=C_STAT_NORMAL;if(this.isClicked()){var e=new Point(this.points[0].x+100,this.points[0].y+100);this.updatePoint(1,e)}else{this.attachToNearPoint(this.near,1)}}}}return true};LineShape.prototype.drawArrows=function(a){var b=this.style.arrowSize;var c=this.style.firstArrowType;if(c){drawArrow(a,c,this.points[1],this.points[0],b)}var c=this.style.secondArrowType;if(c){drawArrow(a,c,this.points[0],this.points[1],b)}a.beginPath();return};LineShape.prototype.drawLine=function(a){var b=(this.style.lineStyle>>8)&255;var c=(this.style.lineStyle)&255;drawDashedLine(a,this.points[0],this.points[1],b,c);a.stroke();return};LineShape.prototype.paintSelf=function(a){a.save();this.translate(a);a.beginPath();this.prepareStyle(a);this.drawLine(a);this.drawArrows(a);this.resetStyle(a);this.drawText(a);this.drawSelectMarks(a);this.drawTips(a);a.restore();return};LineShape.prototype.asIcon=function(){this.points[0].x=0;this.points[0].y=0;this.points[1].x=20;this.points[1].y=20;this.isIcon=true;this.setStyle(getIconShapeStyle());return};function VLineShapeCreator(b){var a=[b,b,null,1];ShapeCreator.apply(this,a);this.createShape=function(d){var c=new VLineShape();c.initLShape(null,this.type);return c};return}function VLineShape(){}VLineShape.prototype=new LineShape();VLineShape.prototype.updatePoint=function(b,a){if(b===0){this.points[0].x=this.points[1].x;this.points[0].y=a.y}else{this.points[1].x=this.points[0].x;this.points[1].y=a.y}return true};VLineShape.prototype.asIcon=function(){this.points[0].x=0;this.points[0].y=0;this.points[1].x=0;this.points[1].y=30;this.isIcon=true;this.setStyle(getIconShapeStyle());return};VLineShape.prototype.initDefault=function(){this.type="line";this.points_nr=0;this.points.push(new Point(0,0));this.points.push(new Point(0,50));this.state=C_STAT_CREATING_0;return};function HLineShapeCreator(b){var a=[b,b,null,1];ShapeCreator.apply(this,a);this.createShape=function(d){var c=new HLineShape();c.initLShape(null,this.type);return c};return}function HLineShape(){}HLineShape.prototype=new LineShape();HLineShape.prototype.updatePoint=function(b,a){if(b===0){this.points[0].y=this.points[1].y;this.points[0].x=a.x}else{this.points[1].y=this.points[0].y;this.points[1].x=a.x}return true};HLineShape.prototype.asIcon=function(){this.points[0].x=0;this.points[0].y=0;this.points[1].x=30;this.points[1].y=0;this.isIcon=true;this.setStyle(getIconShapeStyle());return};HLineShape.prototype.initDefault=function(){this.type="line";this.points_nr=0;this.points.push(new Point(0,0));this.points.push(new Point(50,0));this.state=C_STAT_CREATING_0;return};function ArrowShapeCreator(c,d,a){var b=[c,"Arrow",null,1];this.arrowType=d;this.lineStyle=a;ShapeCreator.apply(this,b);this.createShape=function(f){var e=new LineShape();e.initLShape(null,this.type);e.style.setFirstArrowType(C_ARROW_NONE);e.style.setSecondArrowType(this.arrowType);e.style.setLineStyle(this.lineStyle);e.setOptions(true,true,true,(this.arrowType==C_ARROW_NONE));return e};return}function SegmentsShapeCreator(b){b=b?b:"segments";var a=[b,"Segments",null,1];ShapeCreator.apply(this,a);this.createShape=function(d){var c=new SegmentsShape();c.initLShape(null,this.type);c.style.setSecondArrowType(C_ARROW_NORMAL);return c};return}function SegmentsShape(){return}SegmentsShape.prototype=new LShape();SegmentsShape.prototype.initDefault=function(){this.type="segments";this.points_nr=0;this.points.push(new Point(0,0));this.points.push(new Point(60,0));this.points.push(new Point(60,60));this.points.push(new Point(0,60));this.state=C_STAT_CREATING_0;return};SegmentsShape.prototype.updatePoint=function(d,a){var c=0;var b=0;if(d<this.points.length){this.points[d].copy(a)}if(this.state===C_STAT_NORMAL){var e=(d===0)?1:(d-1);c=Math.abs(this.points[d].x-this.points[e].x);b=Math.abs(this.points[d].y-this.points[e].y);if(c<5&&b>10){this.points[d].x=this.points[e].x}if(b<5&&c>10){this.points[d].y=this.points[e].y}if(d==1||d==2){c=Math.abs(this.points[3].x-this.points[0].x);b=Math.abs(this.points[3].y-this.points[0].y);if(c<b){if(d==1){this.points[2].x=this.points[1].x}else{this.points[1].x=this.points[2].x}}else{if(d==1){this.points[2].y=this.points[1].y}else{this.points[1].y=this.points[2].y}}}}else{if(d===3){this.points[1].x=this.points[0].x+100;this.points[1].y=this.points[0].y;this.points[2].x=this.points[1].x;this.points[2].y=this.points[3].y}}return true};SegmentsShape.prototype.isPointInThis=function(b,a){if(this.isPointInSegment(b,this.points[0],this.points[1],a)){return true}if(this.isPointInSegment(b,this.points[1],this.points[2],a)){return true}if(this.isPointInSegment(b,this.points[2],this.points[3],a)){return true}return false};SegmentsShape.prototype.handlePointerEvent=function(a,c){if(this.state===C_STAT_NORMAL){return true}if(c===C_EVT_POINTER_DOWN){if(!this.near){this.points[0].copy(a)}this.attachToNearPoint(this.near,0);this.points[1].x=a.x+60;this.points[1].y=a.y;this.points[2].x=a.x+60;this.points[2].y=a.y+60;this.points[3].x=a.x;this.points[3].y=a.y+60}else{if(c===C_EVT_POINTER_MOVE){var d=a.x-this.lastPosition.x;var b=a.y-this.lastPosition.y;if(this.pointerDown){this.updatePoint(3,a)}else{this.moveDelta(d,b)}this.postRedraw()}else{if(c===C_EVT_POINTER_UP){this.setSelected(true);this.state=C_STAT_NORMAL;this.attachToNearPoint(this.near,3)}}}return true};SegmentsShape.prototype.drawArrows=function(a){var b=this.style.arrowSize;var c=this.style.firstArrowType;if(c){drawArrow(a,c,this.points[1],this.points[0],b)}var c=this.style.secondArrowType;if(c){drawArrow(a,c,this.points[2],this.points[3],b)}a.beginPath();return};SegmentsShape.prototype.drawSegments=function(a){var b=(this.style.lineStyle>>8)&255;var c=(this.style.lineStyle)&255;drawDashedLine(a,this.points[0],this.points[1],b,c);drawDashedLine(a,this.points[1],this.points[2],b,c);drawDashedLine(a,this.points[2],this.points[3],b,c);a.stroke();return};SegmentsShape.prototype.paintSelf=function(a){a.save();this.translate(a);a.beginPath();this.prepareStyle(a);this.drawSegments(a);this.drawArrows(a);this.resetStyle(a);this.drawText(a);this.drawSelectMarks(a);this.drawTips(a);a.restore();return};SegmentsShape.prototype.asIcon=function(){this.points[0].x=0;this.points[0].y=0;this.points[1].x=20;this.points[1].y=0;this.points[2].x=20;this.points[2].y=20;this.points[3].x=0;this.points[3].y=20;this.isIcon=true;this.setStyle(getIconShapeStyle());this.style.setSecondArrowType(C_ARROW_NORMAL);return};function CurveShapeCreator(){var a=["curve","Curve",null,1];ShapeCreator.apply(this,a);this.createShape=function(c){var b=new CurveShape();b.initLShape(null,this.type);b.style.setSecondArrowType(C_ARROW_NORMAL);return b};return}function CurveShape(){return}CurveShape.prototype=new LShape();CurveShape.prototype.isCurve=true;CurveShape.prototype.initDefault=function(){this.type="curve";this.points_nr=0;this.points.push(new Point(0,0));this.points.push(new Point(0,60));this.points.push(new Point(60,30));this.state=C_STAT_CREATING_0;return};CurveShape.prototype.isPointsEnough=function(){return this.points_nr>=3};CurveShape.prototype.updatePoint=function(b,a){if(b<this.points.length){this.points[b].copy(a)}return true};CurveShape.prototype.isPointInThis=function(b,a){var d=this.points;b.beginPath();b.moveTo(d[0].x,d[0].y);for(var c=0;c<d.length;c++){b.lineTo(d[c].x,d[c].y)}b.lineTo(d[0].x,d[0].y);return b.isPointInPath(a.x,a.y)};CurveShape.prototype.handlePointerEvent=function(a,c){if(this.state===C_STAT_NORMAL){return true}if(c===C_EVT_POINTER_DOWN){if(!this.near){this.points[0].copy(a)}this.attachToNearPoint(this.near,0);this.points[1].x=a.x;this.points[1].y=a.y+30;this.points[2].x=a.x+30;this.points[2].y=a.y+15}else{if(c===C_EVT_POINTER_MOVE){if(this.pointerDown){this.points[1].copy(a);var e=this.points[0].x-this.points[1].x;var b=this.points[0].y-this.points[1].y;var h=Math.atan(b/e);var g=Math.sqrt(e*e+b*b);var f=(this.points[0].x+this.points[1].x)/2;var d=(this.points[0].y+this.points[1].y)/2;if(h>Math.PI){h=h-Math.PI}this.points[2].x=f+Math.sin(Math.PI-h)*g/2;this.points[2].y=d+Math.cos(Math.PI-h)*g/2}else{var e=a.x-this.lastPosition.x;var b=a.y-this.lastPosition.y;this.moveDelta(e,b)}this.postRedraw()}else{if(c===C_EVT_POINTER_UP){this.setSelected(true);this.state=C_STAT_NORMAL;this.attachToNearPoint(this.near,1)}}}return true};CurveShape.prototype.drawArrows=function(a){var b=this.style.arrowSize;var c=this.style.firstArrowType;if(c){drawArrow(a,c,this.points[2],this.points[0],b)}var c=this.style.secondArrowType;if(c){drawArrow(a,c,this.points[2],this.points[1],b)}return};CurveShape.prototype.drawCurve=function(a){a.lineWidth=this.style.lineWidth;a.fillStyle=this.style.fillColor;a.strokeStyle=this.style.lineColor;var b=this.points;a.moveTo(b[0].x,b[0].y);a.quadraticCurveTo(b[2].x,b[2].y,b[1].x,b[1].y);a.stroke();return};CurveShape.prototype.paintSelf=function(a){a.save();this.translate(a);this.prepareStyle(a);this.drawCurve(a);this.drawArrows(a);this.resetStyle(a);this.drawText(a);this.drawSelectMarks(a);this.drawTips(a);a.restore();return};var C_CREATE_FOR_USER=0;var C_CREATE_FOR_ICON=1;var C_CREATE_FOR_PROGRAM=2;function ShapeCreator(c,a,b,d){this.type=c;this.icon=b;this.name=a;this.visible=d;this.useCount=0;this.incUseCount=function(){this.useCount++;return};this.isVisibleToUser=function(){return this.visible};this.getID=function(){return this.type};this.getIcon=function(){return this.icon};this.getName=function(){return this.name};this.createIconShape=function(){if(!this.iconShape){this.iconShape=this.createShape(C_CREATE_FOR_ICON)}return this.iconShape};this.createShape=function(e){return null};return}function ShapeFactory(){this.defaultCategory=null;this.creators=new Array();this.categories=new Object();this.categoryNames=new Array();this.diagramTypes=new Array();this.OnCategoryChangeListeners={};this.setOnCategoryChangeListener=function(a,b){this.OnCategoryChangeListeners[a]=b;return};this.setDefaultCategory=function(a){this.defaultCategory=a;var b=this.OnCategoryChangeListeners[a];if(b){b(a)}return};this.getDiagramTypes=function(){return this.diagramTypes};this.addDiagramType=function(b,a){var c={name:b,defaultCategory:a};this.diagramTypes.push(c);return};this.removeCategoryName=function(a){this.categoryNames.remove(a);return};this.removeShapeCreator=function(a,b){var e=this.find(a);var d=this.categories[b];if(e){this.creators.remove(e);if(d){d.remove(e);if(d.length===0){this.categoryNames.remove(b)}}}return};this.isPlacehodler=function(a){return a==="---"};this.addPlaceholder=function(){this.categoryNames.push("---");return};this.addShapeCreator=function(a,b){this.creators.push(a);if(b){if(!this.defaultCategory){this.setDefaultCategory(b)}if(!this.categories[b]){this.categories[b]=new Array();this.categoryNames.push(b)}else{if(!this.categoryNames.has(b)){this.categoryNames.push(b)}}this.categories[b].push(a)}return};this.getCategoryNames=function(){return this.categoryNames};this.sortDefaultCategoryByUseCount=function(){return;var a=this.categories[this.defaultCategory];if(a&&a.length>30){a.sort(function(d,c){return c.useCount-d.useCount})}return};this.getDefaultCategory=function(){return this.categories[this.defaultCategory]};this.getByCategory=function(a){return this.categories[a]};this.find=function(b){for(var a=0;a<this.creators.length;a++){var d=this.creators[a];if(d.getID()===b){return d}}return null};this.createShape=function(a,b){var d=this.find(a);if(d){d.incUseCount();return d.createShape(b)}else{return null}};return}var gShapeFactory=null;function ShapeFactoryGet(){if(!gShapeFactory){gShapeFactory=new ShapeFactory()}return gShapeFactory}function dappSetDefaultCategory(a){return ShapeFactoryGet().setDefaultCategory(a)}var C_LINE_STYLE_0=(255<<8)|0;var C_LINE_STYLE_1=(2<<8)|4;var C_LINE_STYLE_2=(4<<8)|4;var C_LINE_STYLE_3=(8<<8)|8;var C_LINE_STYLE_4=(10<<8)|10;function resetShapeStyle(a){a.lineStyle=65280;a.lineWidth=2;a.lineColor="Orange";a.fillColor="White";a.textColor="Blue";a.fontSize=24;a.fontFamily="sans";a.arrowSize=12;a.firstArrowType=0;a.secondArrowType=0;a.textB=0;a.textI=0;a.textU=0;a.enableShadow=false;a.shadow={x:0,y:0,blur:8,color:"Black"};a.enableGradient=false;a.listener=null;return a}function createShapeStyle(){var a=new ShapeStyle();return resetShapeStyle(a)}function ShapeStyle(){}ShapeStyle.prototype.getFont=function(){var a="";if(this.textI){a="italic  "}if(this.textB){a=a+"bold "}a=a+this.fontSize+"pt "+this.fontFamily;return a};ShapeStyle.prototype.setListener=function(a){this.listener=a;return};ShapeStyle.prototype.notify=function(){if(this.listener){this.listener.setNewStyle(this)}return};ShapeStyle.prototype.setLineStyle=function(a){this.lineStyle=a;return};ShapeStyle.prototype.setLineWidth=function(a){this.lineWidth=a>0?a:1;return};ShapeStyle.prototype.setLineColor=function(a){this.lineColor=a;return};ShapeStyle.prototype.setFillColor=function(a){if("string"!=typeof a){this.fillColor=a;this.enableGradient=true}else{if(a.length>12&&a.indexOf("rgb")<0){this.fillColor=JSON.parse(a);this.enableGradient=true}else{this.fillColor=a}}return};ShapeStyle.prototype.setTextColor=function(a){this.textColor=a;return};ShapeStyle.prototype.setFontSize=function(b){var a=Math.max(b,6);this.fontSize=a;return};ShapeStyle.prototype.setFontFamily=function(a){this.fontFamily=a?a:"serif";return};ShapeStyle.prototype.setFirstArrowType=function(a){this.firstArrowType=a;return};ShapeStyle.prototype.setSecondArrowType=function(a){this.secondArrowType=a;return};ShapeStyle.prototype.setArrowSize=function(a){this.arrowSize=a;return};ShapeStyle.prototype.setTextB=function(a){this.textB=a;return};ShapeStyle.prototype.setTextU=function(a){this.textU=a;return};ShapeStyle.prototype.setTextI=function(a){this.textI=a;return};ShapeStyle.prototype.setShadow=function(a,b){this.enableShadow=a;this.shadow=b;return};ShapeStyle.prototype.getStrokeStyle=function(a){var b=this.strokeColor;return b};ShapeStyle.prototype.getGradFillStyle=function(c,o,l,q,g){var d=this.fillColor;if(!d){return"White"}var b=o;var p=l;var a=o+(d.x1<0?q:d.x1);var m=l+(d.y1<0?g:d.y1);if(isNaN(a)||isNaN(m)||isNaN(b)||isNaN(p)){return this.fillColor}var j=c.createLinearGradient(b,p,a,m);for(var f=0;f<d.data.length;f++){var e=d.data[f];j.addColorStop(e.o,e.c)}return j};ShapeStyle.prototype.copy=function(a){var b=a.toJson();this.fromJson(b);return};ShapeStyle.prototype.toJson=function(){var d=new Object();for(var a in this){var c=this[a];var b=typeof c;if(b==="function"||b==="object"||b==="undefined"){continue}if(b==="number"||b==="string"||b==="boolean"){d[a]=c}}if(this.enableShadow){d.shadow=this.shadow}else{delete d.enableShadow}if(this.enableGradient){d.fillColor=this.fillColor}else{delete d.enableGradient}if(!this.textI){delete d.textI}if(!this.textU){delete d.textU}if(!this.textB){delete d.textB}delete d.textAlignment;return d};ShapeStyle.prototype.fromJson=function(d){resetShapeStyle(this);if(d.ls){this.lineStyle=d.ls;this.lineWidth=d.lw;this.lineColor=d.lc;this.fillColor=d.fc;this.textColor=d.tc;this.fontSize=d.fs;this.fontFamily=(d.fm!=undefined)?d.fm:"serif";this.arrowSize=d.as;this.firstArrowType=d.fat;this.secondArrowType=d.sat;this.textB=d.b;this.textI=d.i;this.textU=d.u;this.enableShadow=d.es}else{for(var a in d){var c=d[a];var b=typeof c;if(b==="function"||b==="undefined"){continue}this[a]=c}}if(this.enableShadow){this.shadow=d.shadow;if(!this.shadow){this.enableShadow=false}}if(this.enableGradient){this.setFillColor(this.fillColor)}return};ShapeStyle.prototype.dup=function(){var a=new ShapeStyle();a.copy(this);return a};ShapeStyle.prototype.equalTo=function(c){var b=JSON.stringify(this.toJson());var a=JSON.stringify(c.toJson());return b===a};var gShapeStyle=null;function DefaultShapeStyleGet(){if(gShapeStyle){return gShapeStyle}gShapeStyle=createShapeStyle();return gShapeStyle}function saveDefaultShapeStyle(){var a=DefaultShapeStyleGet();var b=a.toJson();localStorage.style=JSON.stringify(b);return}function loadDefaultShapeStyle(){var a=false;var b=DefaultShapeStyleGet();if(localStorage.style){var c=JSON.parse(localStorage.style);b.fromJson(c);a=true}return a}var gIconShapeStyle=null;function getIconShapeStyle(){if(!gIconShapeStyle){gIconShapeStyle=createShapeStyle();gIconShapeStyle.setLineWidth(1);gIconShapeStyle.setFontSize(8);gIconShapeStyle.setLineColor("Black");gIconShapeStyle.setFillColor("White");gIconShapeStyle.setTextColor("Black")}return gIconShapeStyle}function MoveResizeCommand(c,a,e,b,d){this.x=a;this.y=e;this.w=b;this.h=d;if(a===undefined||a===null){this.x=c.getX()}if(e===undefined||e===null){this.y=c.getY()}if(b===undefined||b===null){this.w=c.getWidth()}if(d===undefined||d===null){this.h=c.getHeight()}this.saveX=c.getX();this.saveY=c.getY();this.saveW=c.getWidth();this.saveH=c.getHeight();this.doit=function(){c.move(this.x,this.y);c.resize(this.w,this.h);c.postRedraw();return};this.undo=function(){c.move(this.saveX,this.saveY);c.resize(this.saveW,this.saveH);c.postRedraw();return};return}function MoveResizeDeltaCommand(c,b,a,d,e){this.dx=b?b:0;this.dy=a?a:0;this.dw=d?d:0;this.dh=e?e:0;this.saveX=c.getX();this.saveY=c.getY();this.saveW=c.getWidth();this.saveH=c.getHeight();this.doit=function(){c.moveDelta(this.dx,this.dy);c.resizeDelta(this.dw,this.dh);c.postRedraw();return};this.undo=function(){c.move(this.saveX,this.saveY);c.resize(this.saveW,this.saveH);c.postRedraw();return};return}function LineMoveCommand(b,c,a){this.oldPoints=new Array();this.oldPoints.copy(c);this.newPoints=new Array();this.newPoints.copy(b.points);this.eanbleSnap=a;this.doit=function(){b.points.copy(this.newPoints);b.postRedraw();return};this.undo=function(){b.points.copy(this.oldPoints);b.postRedraw();return};return}function RotateCommand(a,b){this.rotate=b;this.oldRatate=a.rotate;this.doit=function(){a.setRotate(this.rotate);a.postRedraw();return};this.undo=function(){a.setRotate(this.oldRatate);a.postRedraw();return};return}function SetTextCommand(a,c,b){this.text=c;this.cookie=b;this.oldText=a.getText(b);this.doit=function(){a.setText(this.text,b);a.postRedraw();return};this.undo=function(){a.setText(this.oldText,b);a.postRedraw();return};return}function SetStyleCommand(a,b){this.style=b;this.oldStyle=a.style.dup();this.doit=function(){a.setStyle(this.style);a.postRedraw();return};this.undo=function(){a.setStyle(this.oldStyle);a.postRedraw();return};return}function AddCommand(a,b){this.doit=function(){var c=getParentShapeOfShape(b,a);c.addShape(b);b.postRedraw();return};this.undo=function(){var c=getParentShapeOfShape(b,a);b.container=c;c.removeShape(b);b.postRedraw();return};return}function CutCommand(b,a){this.shapes=new Array();for(var d=0;d<a.length;d++){var c=a[d];if(c.userRemovable()){this.shapes.push(c)}}this.doit=function(){for(var g=0;g<this.shapes.length;g++){var f=this.shapes[g];if(f.parentShape){var e=f.parentShape;f.container=e;f.indexInContainor=e.children.indexOf(f);e.removeShape(f)}else{b.removeShape(f)}}b.postRedraw();return};this.undo=function(){for(var g=0;g<this.shapes.length;g++){var f=this.shapes[g];if(f.container){var e=f.container;e.addShape(f,false,null,f.indexInContainor);if(e.isUIElement){e.relayout()}delete f.indexInContainor;delete f.container}else{b.addShape(f)}}b.postRedraw();return};return}function PasteCommand(b,a){this.shapes=new Array();for(var d=0;d<a.length;d++){var c=a[d].dup();delete c.indexInContainor;c.container=getParentShapeOfShape(a[d],b);this.shapes.push(c)}this.doit=function(){var e=b.getSelectedShape();b.selectAll(false);for(var g=0;g<this.shapes.length;g++){var f=this.shapes[g];f.moveDelta(20,20);f.setSelected(true);if(e.type===f.type&&e.w===f.w&&e.h===f.h){e=getParentShapeOfShape(f,b)}if(e&&e!==f&&f.isUIElement&&e.isUIElement&&!e.isUIDevice&&!e.isUIScreen&&e!==f.parentShape){if(e.shapeCanBeChild(f)){f.container=e;f.moveDelta(-20,-20)}}if(f.container.isVisible()){f.container.addShape(f);if(f.container.isUIElement){f.container.relayout()}}}b.postRedraw();return};this.undo=function(){for(var f=0;f<this.shapes.length;f++){var e=this.shapes[f];e.container.removeShape(e)}b.postRedraw();return};return}function PropertyCommand(a,b,c){a.fromJson(JSON.parse(b));this.oldJson=strCompress(b);this.newJson=strCompress(c);delete b;delete c;this.destroy=function(){delete this.oldJson;delete this.newJson;return};this.doit=function(){var d=strDecompress(this.newJson);a.beforePropertyChanged();a.fromJson(JSON.parse(d));a.afterPropertyChanged();if(a.isUIDevice){a.view.autoScale()}a.postRedraw();return};this.undo=function(){var d=strDecompress(this.oldJson);a.beforePropertyChanged();a.fromJson(JSON.parse(d));a.afterPropertyChanged();if(a.isUIDevice){a.view.autoScale()}a.postRedraw();return};return}function CompositeShapeCommand(b,a){this.cg=null;this.shapes=new Array();for(var d=0;d<a.length;d++){var c=a[d];if(c.selected){this.shapes.push(c)}}this.doit=function(){var f=getParentShapeOfShapes(this.shapes);if(!f){console.log("shapes have different parent.");return}this.cg=createCompositeShape();for(var g=0;g<this.shapes.length;g++){var e=this.shapes[g];f.removeShape(e);this.cg.addShape(e)}f.addShape(this.cg);b.postRedraw();return};this.undo=function(){var f=getParentShapeOfShape(this.cg,b);if(!f){console.log("shapes have different parent.");return}this.cg.removeAll();f.removeShape(this.cg);for(var g=0;g<this.shapes.length;g++){var e=this.shapes[g];f.addShape(e)}b.postRedraw();return};return}var createCompositeShapeCommand=function(b,a){return new CompositeShapeCommand(b,a)};function DecompositeShapeCommand(a,d){this.cg=d;this.shapes=new Array();for(var c=0;c<d.children.length;c++){var b=d.children[c];this.shapes.push(b)}this.doit=function(){var f=getParentShapeOfShape(this.cg,a);this.cg.removeAll();f.removeShape(this.cg);for(var g=0;g<this.shapes.length;g++){var e=this.shapes[g];f.addShape(e)}this.cg.container=f;a.postRedraw();return};this.undo=function(){var f=this.cg.container;for(var g=0;g<this.shapes.length;g++){var e=this.shapes[g];this.cg.addShape(e);f.removeShape(e)}f.addShape(this.cg);a.postRedraw();return};return}var createDecompositeShapeCommand=function(a,b){return new DecompositeShapeCommand(a,b)};function PositionSizeAttrCommand(c,b,e,d,a){this.xAttr=b;this.yAttr=e;this.widthAttr=d;this.heightAttr=a;this.saveX=c.getX();this.saveY=c.getY();this.saveW=c.getWidth();this.saveH=c.getHeight();if(b===undefined||b===null){this.xAttr=c.xAttr}if(e===undefined||e===null){this.yAttr=c.yAttr}if(d===undefined||d===null){this.widthAttr=c.widthAttr}if(a===undefined||a===null){this.heightAttr=c.heightAttr}this.saveXAttr=c.xAttr;this.saveYAttr=c.yAttr;this.saveWidthAttr=c.widthAttr;this.saveHeightAttr=c.heightAttr;this.doit=function(){c.xAttr=this.xAttr;c.yAttr=this.yAttr;c.widthAttr=this.widthAttr;c.heightAttr=this.heightAttr;c.relayout();return};this.undo=function(){c.xAttr=this.saveXAttr;c.yAttr=this.saveYAttr;c.widthAttr=this.saveWidthAttr;c.heightAttr=this.saveHeightAttr;c.move(this.saveX,this.saveY);c.resize(this.saveW,this.saveH);c.relayout();return};return}function CalloutShape(){return}CalloutShape.prototype=new RectShape();CalloutShape.prototype.initCalloutShape=function(a){this.initRectShape(a,200,200);this.setTextType(C_SHAPE_TEXT_TEXTAREA);this.setMargin(10,10);return this};CalloutShape.prototype.getMoreSelectMark=function(b,a){if(b===C_HIT_TEST_HANDLE){a.x=this.handle.x;a.y=this.handle.y;return true}return false};CalloutShape.prototype.moveHandle=function(b,a){this.handle.x+=b;this.handle.y+=a;return};CalloutShape.prototype.isPointInThis=function(b,a){this.drawPath(b);return b.isPointInPath(a.x,a.y)};CalloutShape.prototype.setStyle=function(a){this.style.copy(a);this.style.setLineWidth(1);this.needRelayout=true;return};CalloutShape.prototype.asIcon=function(){this.isIcon=true;this.resize(36,30);this.setStyle(getIconShapeStyle());return};CalloutShape.prototype.drawHandle=function(b){var a=this.handle.x;var c=this.handle.y;if(a>=0&&a<=this.w&&c<=0){this.from.x=this.w/2;this.from.y=0}else{if(a>=0&&a<=this.w&&c>=this.h){this.from.x=this.w/2;this.from.y=this.h}else{if(c>=0&&c<=this.h&&a<=0){this.from.x=0;this.from.y=this.h/2}else{if(c>=0&&c<=this.h&&a>=this.w){this.from.x=this.w;this.from.y=this.h/2}else{this.from.x=this.w/2;this.from.y=this.h/2}}}}drawDashedLine(b,this.from,this.handle,8,8);b.stroke();b.fill();b.beginPath();drawArrow(b,C_ARROW_NORMAL,this.from,this.handle,10);b.beginPath()};function RoundCalloutShapeCreator(){var a=["round-callout","round-callout",null,1];ShapeCreator.apply(this,a);this.createShape=function(c){var b=new RoundCalloutShape();b.initCalloutShape(this.type);b.handle=new Point(-30,0);b.setDefSize(300,200);b.style.setFontSize(14);return b};return}function RoundCalloutShape(){this.R=20;return}RoundCalloutShape.prototype=new CalloutShape();RoundCalloutShape.prototype.paintShape=function(a){this.drawPath(a);a.stroke();a.fill();a.beginPath();return};RoundCalloutShape.prototype.drawPath=function(d){var e=0;var a=this.handle.x;var g=this.handle.y;var f=this.R;var c=this.w/4;var b=this.h/4;if(this.isIcon){f=10}if(f>this.w/2){f=this.w/2}if(f>this.h/2){f=this.h/2}if(a<=0&&g<=0){d.moveTo(0,f);d.lineTo(a,g);d.lineTo(f,0)}else{d.arc(f,f,f,Math.PI,1.5*Math.PI,false)}if(g<=0&&a>0&&a<=this.w){if(a<=this.w/2){d.lineTo(this.w/2-c,0);d.lineTo(a,g);d.lineTo(this.w/2,0)}else{d.lineTo(this.w/2,0);d.lineTo(a,g);d.lineTo(this.w/2+c,0)}}else{d.lineTo(this.w-f,0)}if(g<=0&&a>this.w){d.lineTo(a,g);d.lineTo(this.w,f)}else{d.arc(this.w-f,f,f,1.5*Math.PI,2*Math.PI,false)}if(a>this.w&&g>0&&g<=this.h){if(g<=this.h/2){d.lineTo(this.w,this.h/2-b);d.lineTo(a,g);d.lineTo(this.w,this.h/2)}else{d.lineTo(this.w,this.h/2);d.lineTo(a,g);d.lineTo(this.w,this.h/2+b)}}else{d.lineTo(this.w,this.h-f)}if(a>this.w&&g>this.h){d.lineTo(a,g);d.lineTo(this.w-f,this.h)}else{d.arc(this.w-f,this.h-f,f,0,0.5*Math.PI,false)}if(g>this.h&&a>0&&a<=this.w){if(a<=this.w/2){d.lineTo(this.w/2-c,this.h);d.lineTo(a,g);d.lineTo(this.w/2,this.h)}else{d.lineTo(this.w/2,this.h);d.lineTo(a,g);d.lineTo(this.w/2+c,this.h)}}else{d.lineTo(f,this.h)}if(a<=0&&g>this.h){d.lineTo(a,g);d.lineTo(0,this.h-f)}else{d.arc(f,this.h-f,f,0.5*Math.PI,Math.PI,false)}if(a<=0&&g>0&&g<=this.h){if(g<=this.h/2){d.lineTo(0,this.h/2-b);d.lineTo(a,g);d.lineTo(0,this.h/2)}else{d.lineTo(0,this.h/2);d.lineTo(a,g);d.lineTo(0,this.h/2+b)}}else{d.lineTo(0,f)}return};function RectCalloutShapeCreator(){var a=["rect-callout","rect-callout",null,1];ShapeCreator.apply(this,a);this.createShape=function(c){var b=new RectCalloutShape();b.initCalloutShape(this.type);b.handle=new Point(-30,0);b.setDefSize(300,200);b.style.setFontSize(14);return b};return}function RectCalloutShape(){return}RectCalloutShape.prototype=new CalloutShape();RectCalloutShape.prototype.paintShape=function(a){this.drawPath(a);a.stroke();a.fill();a.beginPath();return};RectCalloutShape.prototype.drawPath=function(d){var a=this.handle.x;var e=this.handle.y;var c=this.w/4;var b=this.h/4;c=Math.min(c,b);b=c;d.moveTo(0,b);if(a<=0&&e<=0){d.lineTo(a,e);d.lineTo(c,0)}else{d.lineTo(0,0);d.lineTo(c,0)}if(e<=0&&a>0&&a<=this.w){if(a<=this.w/2){d.lineTo(this.w/2-c,0);d.lineTo(a,e);d.lineTo(this.w/2,0)}else{d.lineTo(this.w/2,0);d.lineTo(a,e);d.lineTo(this.w/2+c,0)}}else{d.lineTo(this.w-c,0)}if(e<=0&&a>this.w){d.lineTo(a,e);d.lineTo(this.w,c)}else{d.lineTo(this.w,0);d.lineTo(this.w,b)}if(a>this.w&&e>0&&e<=this.h){if(e<=this.h/2){d.lineTo(this.w,this.h/2-b);d.lineTo(a,e);d.lineTo(this.w,this.h/2)}else{d.lineTo(this.w,this.h/2);d.lineTo(a,e);d.lineTo(this.w,this.h/2+b)}}else{d.lineTo(this.w,this.h-c)}if(a>this.w&&e>this.h){d.lineTo(a,e);d.lineTo(this.w-c,this.h)}else{d.lineTo(this.w,this.h);d.lineTo(this.w-c,this.h)}if(e>this.h&&a>0&&a<=this.w){if(a<=this.w/2){d.lineTo(this.w/2-c,this.h);d.lineTo(a,e);d.lineTo(this.w/2,this.h)}else{d.lineTo(this.w/2,this.h);d.lineTo(a,e);d.lineTo(this.w/2+c,this.h)}}else{d.lineTo(c,this.h)}if(a<=0&&e>this.h){d.lineTo(a,e);d.lineTo(0,this.h-c)}else{d.lineTo(0,this.h);d.lineTo(0,this.h-b)}if(a<=0&&e>0&&e<=this.h){if(e<=this.h/2){d.lineTo(0,this.h/2-b);d.lineTo(a,e);d.lineTo(0,this.h/2)}else{d.lineTo(0,this.h/2);d.lineTo(a,e);d.lineTo(0,this.h/2+b)}}else{d.lineTo(0,c)}return};function RoundArrowCalloutShapeCreator(){var a=["round-arrow-callout","round-arrow-callout",null,1];ShapeCreator.apply(this,a);this.createShape=function(c){var b=new RoundArrowCalloutShape();b.initCalloutShape(this.type);b.handle=new Point(-30,0);b.from=new Point(0,0);b.setDefSize(300,200);b.style.setFontSize(14);return b};return}function RoundArrowCalloutShape(){this.R=20;return}RoundArrowCalloutShape.prototype=new CalloutShape();RoundArrowCalloutShape.prototype.drawPath=function(a){var b=this.R;if(b>this.w/2){b=this.w/2}if(b>this.h/2){b=this.h/2}a.arc(b,b,b,Math.PI,1.5*Math.PI,false);a.lineTo(this.w-b,0);a.arc(this.w-b,b,b,1.5*Math.PI,2*Math.PI,false);a.lineTo(this.w,this.h-b);a.arc(this.w-b,this.h-b,b,0,0.5*Math.PI,false);a.lineTo(b,this.h);a.arc(b,this.h-b,b,0.5*Math.PI,Math.PI,false);a.lineTo(0,b);return};RoundArrowCalloutShape.prototype.paintShape=function(a){this.drawPath(a);this.drawHandle(a);a.stroke();a.fill();a.beginPath();return};function RectArrowCalloutShapeCreator(){var a=["rect-arrow-callout","rect-arrow-callout",null,1];ShapeCreator.apply(this,a);this.createShape=function(c){var b=new RectArrowCalloutShape();b.initCalloutShape(this.type);b.handle=new Point(-30,0);b.from=new Point(0,0);b.setDefSize(300,200);b.style.setFontSize(14);return b};return}function RectArrowCalloutShape(){return}RectArrowCalloutShape.prototype=new CalloutShape();RectArrowCalloutShape.prototype.drawPath=function(a){a.rect(0,0,this.w,this.h);return};RectArrowCalloutShape.prototype.paintShape=function(a){this.drawPath(a);this.drawHandle(a);a.stroke();a.fill();a.beginPath();return};function NotesCalloutShapeCreator(){var a=["notes-callout","notes-callout",null,1];ShapeCreator.apply(this,a);this.createShape=function(c){var b=new NotesCalloutShape();b.initCalloutShape(this.type);b.from=new Point(0,0);b.handle=new Point(-30,0);b.setDefSize(300,200);b.style.setFontSize(14);return b};return}function NotesCalloutShape(){return}NotesCalloutShape.prototype=new CalloutShape();NotesCalloutShape.prototype.paintShape=function(a){this.drawPath(a);this.drawHandle(a);a.stroke();a.fill();a.beginPath();return};NotesCalloutShape.prototype.drawPath=function(c){var b=this.w>64?this.w/16:this.w/8;var a=this.h>64?this.h/16:this.h/8;c.moveTo(0,0);c.lineTo(this.w-b,0);c.lineTo(this.w-b,a);c.lineTo(this.w,a);c.lineTo(this.w,this.h);c.lineTo(0,this.h);c.lineTo(0,0);c.moveTo(this.w-b,0);c.lineTo(this.w,a);return};function TextCalloutShapeCreator(d,c,b){var a=[d?d:"text-callout","text-callout",null,1];ShapeCreator.apply(this,a);this.createShape=function(f){var e=new TextCalloutShape();e.initCalloutShape(this.type);e.handle=new Point(1,1);e.setText(b?b:dappGetText("Text"));e.iconText=c?dappGetText(c):dappGetText("Text");e.setDefSize(300,200);e.style.setFontSize(14);e.setSizeLimit(60,30,0,0,0);return e};return}function TextCalloutShape(){return}TextCalloutShape.prototype=new CalloutShape();TextCalloutShape.prototype.isPointInThis=function(b,a){b.rect(0,0,this.w,this.h);return b.isPointInPath(a.x,a.y)};TextCalloutShape.prototype.drawPath=function(a){return};TextCalloutShape.prototype.paintShape=function(a){return};TextCalloutShape.prototype.asIcon=function(){this.margin=2;this.isIcon=true;this.setStyle(getIconShapeStyle());this.style.setFontSize(16);this.setText(this.iconText);return};var C_DEFAULT_DATA='{"unit":"%","fillColor":"gold", "lineColor":"black", "yMin":0, "yMax":100, "items":[{"fillColor":"red", "lineColor":"blue", "title":"First", "value":60 }, {"fillColor":"green", "lineColor":"blue", "title":"Second", "value":80 }, {"fillColor":"blue", "lineColor":"blue", "title":"Third", "value":40 }]}';function ChartShape(){return}ChartShape.prototype=new RectShape();ChartShape.prototype.setStyle=function(a){this.style.copy(a);this.style.enableShadow=false;this.style.enableGradientFill=false;return};ChartShape.prototype.fixMinMax=function(){if(this.hasData()){n=this.data.items.length;for(i=0;i<n;i++){var a=this.data.items[i];if(!a.value){a.value=0}if(this.yMin>a.value){this.yMin=a.value}if(this.yMax<a.value){this.yMax=a.value}}}else{this.yMin=0;this.yMax=100}return};ChartShape.prototype.getTextCookie=function(b){var a=this.getX();var j=this.getY();var c=this.getWidth();var e=this.getHeight();var f=1;var g=2;var d=3;if(b.x<(a+0.25*c)&&b.y>(j+0.25*e)){return d}if(b.y>(j+0.8*e)){return g}return f};ChartShape.prototype.setData=function(b){var a=0;var d=0;this.yMin=0;this.yMax=100;this.dataText=b;try{this.data=JSON.parse(b)}catch(c){console.log("parse:"+b+" "+c.message)}this.unit="";if(this.data.unit){this.unit=this.data.unit}if(this.data){if(this.data.yMin){this.yMin=this.data.yMin}if(this.data.yMax){this.yMax=this.data.yMax}}this.fixMinMax();return};function XyChartShape(){this.setMargin(100,40,20,40);return}XyChartShape.prototype=new ChartShape();XyChartShape.prototype.toJson=function(){var a=new Object();a.type=this.type;a.x=this.x;a.y=this.y;a.w=this.w;a.h=this.h;a.text=this.text;a.text2=this.text2;a.imageUrl=this.imageUrl;a.style=this.style.toJson();if(this.handle){a.handle=this.handle}a.unit=this.unit;a.yMax=this.yMax;a.yMin=this.yMin;a.text2=this.text2;a.text3=this.text3;a.leftMargin=this.leftMargin;a.rightMargin=this.rightMargin;a.topMargin=this.topMargin;a.bottomMargin=this.bottomMargin;a.data=this.data;a.xGrids=this.xGrids;a.yGrids=this.yGrids;return a};XyChartShape.prototype.fromJson=function(a){this.x=a.x;this.y=a.y;this.w=a.w;this.h=a.h;this.setText(a.text);this.setText2(a.text2);if(a.style){this.style.fromJson(a.style)}this.setImage(a.imageUrl);this.state=C_STAT_NORMAL;if(a.handle){this.handle=a.handle}this.unit=a.unit;this.yMax=a.yMax;this.yMin=a.yMin;this.text2=a.text2;this.text3=a.text3;this.leftMargin=a.leftMargin;this.rightMargin=a.rightMargin;this.topMargin=a.topMargin;this.bottomMargin=a.bottomMargin;this.data=a.data;this.xGrids=a.xGrids;this.yGrids=a.yGrids;return};XyChartShape.prototype.getXTitle=function(){return this.text2};XyChartShape.prototype.getYTitle=function(){return this.text3};XyChartShape.prototype.setXTitle=function(a){this.text2=a;return};XyChartShape.prototype.setYTitle=function(a){this.text3=a;return};XyChartShape.prototype.setGrids=function(b,a){this.xGrids=b>=0?b:0;this.yGrids=a>=0?a:0;return};XyChartShape.prototype.setRange=function(a,b){this.yMin=a;this.yMax=b;return};XyChartShape.prototype.setUnit=function(a){this.unit=a;return};XyChartShape.prototype.setMargin=function(c,a,d,b){this.leftMargin=c;this.topMargin=a;this.rightMargin=d;this.bottomMargin=b;return};XyChartShape.prototype.asIcon=function(){this.isIcon=true;this.resize(40,40);this.setMargin(2,2,2,2);return};XyChartShape.prototype.initDefaultData=function(){this.setText("Title");this.setXTitle("X Title");this.setYTitle("Y Title");this.setRange(0,100);this.setGrids(10,10);this.resize(400,200);this.setDefSize(500,300);this.setData(C_DEFAULT_DATA);this.setMargin(100,40,20,40);this.setSizeLimit(200,100,0,0,0);return};XyChartShape.prototype.setStyle=function(a){this.style.copy(a);this.style.enableShadow=false;this.style.enableGradientFill=false;this.style.setLineWidth(a.lineWidth>3?3:a.lineWidth);return};XyChartShape.prototype.drawText=function(a){if(this.isIcon){return}a.textAlign="center";a.font=this.style.getFont();a.fillStyle=this.style.textColor;if(this.text){a.beginPath();a.textBaseline="top";a.fillText(this.text,this.w/2,0,this.w)}if(this.text3){a.beginPath();a.textBaseline="top";a.save();a.translate(0,this.h/2);a.rotate(-Math.PI/2);a.fillText(this.text3,0,0,this.w);a.restore()}if(this.text2){a.beginPath();a.textBaseline="bottom";a.fillText(this.text2,this.w/2,this.h,this.w)}return};XyChartShape.prototype.paintBackground=function(c){var m=0;var o=0;var f=0;var e=0;var j=0;var q="";var a=0;var p=this.topMargin;var l=this.leftMargin;var h=this.rightMargin;var b=this.bottomMargin;c.fillStyle="White";c.rect(0,0,this.w,this.h);c.fill();c.beginPath();c.fillStyle=this.style.fillColor;c.rect(l,p,this.w-l-h,this.h-p-b);c.fill();c.beginPath();c.moveTo(l,p);c.lineTo(l,this.h-b);c.lineTo(this.w-h,this.h-b);if(!this.isIcon){if(this.yGrids>0){var g=this.yMax-this.yMin;m=p;o=l;e=this.yGrids;j=(this.h-p-b)/e;if(g>10){a=Math.floor(g/e)}else{a=g/e}c.textAlign="right";c.textBaseline="middle";c.fillStyle=this.style.textColor;for(f=0;f<e;f++){q=(this.yMax-a*f)+"";c.fillText(q,o-10,m);c.moveTo(o,m);c.lineTo(this.w-h,m);m=m+j}}if(this.xGrids>0){m=p;o=l;e=this.xGrids;j=(this.w-l-h)/e;for(f=0;f<e;f++){o=o+j;c.moveTo(o,m);c.lineTo(o,this.h-b)}}}c.lineWidth=1;c.stroke();c.beginPath();return};XyChartShape.prototype.paintData=function(a){if(this.hasData()){this.drawItems(a)}return};XyChartShape.prototype.paintShape=function(a){this.paintBackground(a);try{this.paintData(a)}catch(b){console.log("paintData failed.")}return};XyChartShape.prototype.showProperty=function(){showChartPropertyDialog(this);return};XyChartShape.prototype.hasData=function(){return this.data&&this.data.items&&this.data.items.length};XyChartShape.prototype.drawItemTitle=function(c,e,a,g,b,d){var f=e.title;c.fillText(f,a,g,b);return};XyChartShape.prototype.drawItemValue=function(c,e,a,g,b,d){var f=e.value+""+this.unit;c.fillText(f,a,g,b);return};XyChartShape.prototype.drawItemShape=function(d,c,f,a,g,b,e){return};XyChartShape.prototype.drawItems=function(c){if(!this.hasData()){return}var f=0;var e=0;var l=this.leftMargin;var d=this.data.items.length;var b=this.h-this.bottomMargin;var h=this.h-this.bottomMargin;var j=this.w-this.leftMargin-this.rightMargin;var o=j/d;var g=this.yMax-this.yMin;var p=this.style.fontSize;this.style.setFontSize(p/2);if(g===0){g=100}var a=(this.h-this.topMargin-this.bottomMargin)/g;c.textAlign="center";c.font=this.style.getFont();for(f=0;f<d;f++){var m=this.data.items[f];l=l+o/2;e=m.value*a;h=this.h-this.bottomMargin-e;c.fillStyle=this.style.textColor;if(!this.isIcon){c.textBaseline="top";this.drawItemTitle(c,m,l,b,o,e);c.textBaseline="bottom";this.drawItemValue(c,m,l,h,o,e)}c.fillStyle=this.style.fillColor;if(this.data.fillColor){c.fillStyle=this.data.fillColor}if(this.data.lineColor){c.strokeStyle=this.data.lineColor}this.drawItemShape(c,f,m,l,h,o,e);l=l+o/2}this.style.setFontSize(p);c.beginPath();return};function RectXyChartShapeShapeCreator(){var a=["chart-xy-rect","Rect XY Chart",null,1];ShapeCreator.apply(this,a);this.createShape=function(c){var b=new XyChartShape();b.initRectShape(this.type,200,200);b.style.setFillColor("gray");b.drawItemShape=function(j,g,m,d,o,f,l){var e=f/2;if(e>60){e=60}j.rect(d-e/2,o,e,l);if(m.fillColor){j.fillStyle=m.fillColor}if(m.lineColor){j.strokeStyle=m.lineColor}j.fill();j.stroke();j.beginPath();return};b.initDefaultData();return b};return}function VLineXyChartShapeShapeCreator(){var a=["chart-xy-vline","Vline XY Chart",null,1];ShapeCreator.apply(this,a);this.createShape=function(c){var b=new XyChartShape();b.initRectShape(this.type,200,200);b.style.setFillColor("gray");b.drawItemShape=function(g,f,l,d,m,e,j){g.moveTo(d,m);g.lineTo(d,m+j);if(l.lineColor){g.strokeStyle=l.lineColor}g.lineWidth=this.style.lineWidth;g.stroke();g.beginPath();return};b.initDefaultData();return b};return}function LineXyChartShapeShapeCreator(){var a=["chart-xy-line","Line XY Chart",null,1];ShapeCreator.apply(this,a);this.createShape=function(c){var b=new XyChartShape();b.initRectShape(this.type,200,200);b.style.setFillColor("gray");b.drawItemShape=function(g,f,l,d,m,e,j){if(f===0){g.moveTo(d,m)}else{g.lineTo(d,m)}if(l.lineColor){g.strokeStyle=l.lineColor}g.lineWidth=this.style.lineWidth;g.stroke();return};b.initDefaultData();return b};return}function DotXyChartShapeShapeCreator(){var a=["chart-xy-dot","Dot XY Chart",null,1];ShapeCreator.apply(this,a);this.createShape=function(c){var b=new XyChartShape();b.initRectShape(this.type,200,200);b.style.setFillColor("gray");b.drawItemShape=function(g,f,l,d,m,e,j){g.arc(d,m,3,0,2*Math.PI);if(l.lineColor){g.strokeStyle=l.lineColor}if(l.fillColor){g.fillStyle=l.fillColor}g.lineWidth=this.style.lineWidth;g.fill();g.stroke();g.beginPath();return};b.initDefaultData();return b};return}function FillXyChartShapeShapeCreator(){var a=["chart-xy-fill","Fill XY Chart",null,1];ShapeCreator.apply(this,a);this.createShape=function(c){var b=new XyChartShape();b.initRectShape(this.type,200,200);b.style.setFillColor("gray");b.drawItemTitle=function(f,j,d,o,e,g){var m=d-e/2;var l=j.title;f.textAlign="left";f.fillText(l,m,o,e);return};b.drawItemValue=function(f,j,d,o,e,g){var m=d-e/2;var l=j.value+""+this.unit;f.textAlign="left";f.fillText(l,m,o,e);return};b.drawItemShape=function(g,f,l,d,o,e,j){var m=d-e/2;if(f===0){g.moveTo(m,o+j);g.lineTo(m,o)}else{if(f===(this.data.items.length-1)){g.lineTo(m,o);g.lineTo(m,o+j);g.fill()}else{g.lineTo(m,o)}}if(l.lineColor){g.strokeStyle=l.lineColor}g.lineWidth=this.style.lineWidth;g.stroke();return};b.initDefaultData();return b};return}var C_COMPOSITE_ID="composite";function CompositeShapeCreator(){var a=[C_COMPOSITE_ID,"Composite",null,0];ShapeCreator.apply(this,a);this.createShape=function(c){var b=new CompositeShape();b.initCompositeShape();return b};return}ShapeFactoryGet().addShapeCreator(new CompositeShapeCreator(),"");function CompositeShape(){return}CompositeShape.prototype=new RectShape();CompositeShape.prototype.showProperty=function(){return};CompositeShape.prototype.initCompositeShape=function(){this.x=0;this.y=0;this.children=new Array();this.rect=new Rect(0,0,0,0);this.lastPosition=new Point(0,0);this.initShape(0,0,0,0,C_COMPOSITE_ID);this.setTextType(C_SHAPE_TEXT_NONE);return this};CompositeShape.prototype.addShape=function(d){var c=this.x;var a=this.y;if(this.children.length===0){this.x=d.getX();this.y=d.getY();this.w=d.getWidth();this.h=d.getHeight()}else{var f=0;var j=0;var e=this.x+this.w;var b=this.y+this.h;if(d.getX()<this.x){this.x=d.getX()}if(d.getY()<this.y){this.y=d.getY()}if((d.getX()+d.getWidth())>e){this.w=d.getX()+d.getWidth()-this.x}else{this.w=e-this.x}if((d.getY()+d.getHeight())>b){this.h=d.getY()+d.getHeight()-this.y}else{this.h=b-this.y}c=this.x-c;a=this.y-a;for(f=0;f<this.children.length;f++){var h=this.children[f];h.moveDelta(-c,-a)}}c=d.getX()-this.x;a=d.getY()-this.y;d.move(c,a);d.setSelected(false);this.children.push(d);return};CompositeShape.prototype.removeAll=function(){for(var b=0;b<this.children.length;b++){var a=this.children[b];a.moveDelta(this.x,this.y)}this.children.clear();return};CompositeShape.prototype.setStyle=function(c){for(var b=0;b<this.children.length;b++){var a=this.children[b];a.setStyle(c)}return};CompositeShape.prototype.hasChildren=true;CompositeShape.prototype.isComposite=true;CompositeShape.prototype.resize=function(a,b){return};CompositeShape.prototype.getSelectMark=function(c,a){var b=true;switch(c){case C_HIT_TEST_TL:a.x=0;a.y=0;break;case C_HIT_TEST_TR:a.x=this.w;a.y=0;break;case C_HIT_TEST_BL:a.x=0;a.y=this.h;break;case C_HIT_TEST_BR:a.x=this.w;a.y=this.h;break;default:b=false}return b};CompositeShape.prototype.paintSelf=function(b){b.save();b.beginPath();this.translate(b);this.drawSelectMarks(b);for(var c=0;c<this.children.length;c++){var a=this.children[c];a.paintSelf(b)}b.restore();return};CompositeShape.prototype.dup=function(){var c=new CompositeShape();c.initCompositeShape();c.w=this.w;c.h=this.h;c.x=this.x;c.y=this.y;c.rotate=this.rotate;c.style.copy(this.style);c.setText(this.text);for(var b=0;b<this.children.length;b++){var a=this.children[b].dup();c.children.push(a)}return c};CompositeShape.prototype.toJson=function(){var c=new Object();c.type=this.type;c.x=this.x;c.y=this.y;c.w=this.w;c.h=this.h;c.style=this.style.toJson();c.children=new Array();for(var b=0;b<this.children.length;b++){var a=this.children[b];c.children.push(a.toJson())}return c};CompositeShape.prototype.fromJson=function(d){if(d.children){for(var a=0;a<d.children.length;a++){var c=d.children[a];var b=c.type?c.type:c.id;shape=ShapeFactoryGet().createShape(b,C_CREATE_FOR_PROGRAM);shape.fromJson(c);this.addShape(shape)}}this.x=d.x;this.y=d.y;return this};function createCompositeShape(){var a=new CompositeShape();a.initCompositeShape();return a}function ActorShapeCreator(){var a=["uml-actor","UML Actor",null,1];ShapeCreator.apply(this,a);this.createShape=function(c){var b=new RectShape();b.initRectShape(this.type,80,120);b.setTextTitle("Name");b.setTextAlignV("bottom");b.setTextAlignH("center");b.asIcon=function(){this.isIcon=true;this.resize(40,40);this.setStyle(getIconShapeStyle());this.style.setFontSize(10);return};b.paintShape=function(d){var e=this.h/8;d.arc(this.w/2,e,e/2,0,2*Math.PI);d.stroke();d.moveTo(this.w/2,1.5*e);d.lineTo(this.w/2,4*e);d.moveTo(this.w/2-e,2.5*e);d.lineTo(this.w/2+e,2.5*e);d.moveTo(this.w/2,4*e);d.lineTo(this.w/2-e,5*e);d.moveTo(this.w/2,4*e);d.lineTo(this.w/2+e,5*e);d.stroke();d.beginPath();return};b.setText("Actor");b.setTextAlignH("center");b.setTextAlignV("bottom");b.setSizeLimit(80,120,160,240,1);return b};return}function UserCaseShapeCreator(){var a=["uml-user-case","UML User Case",null,1];ShapeCreator.apply(this,a);this.createShape=function(c){var b=new CircleShape();b.initRectShape(this.type,200,80);b.setTextTitle("Name");b.asIcon=function(){this.isIcon=true;this.resize(40,20);this.setStyle(getIconShapeStyle());return};return b};return}function SystemBoudaryShapeCreator(){var a=["uml-system-bounary","UML System Boudary",null,1];ShapeCreator.apply(this,a);this.createShape=function(c){var b=new RectShape();b.initRectShape(this.type,200,200);b.setTextTitle("Name");b.setTextAlignH("right");b.setTextAlignV("top");b.setDefSize(400,500);return b};return}function ClassShapeCreator(b){var a=["uml-class","UML Class",null,1];if(b){this.isInterface=b;a[0]="uml-interface";a[1]="UML Class"}ShapeCreator.apply(this,a);this.createShape=function(d){var c=new RectShape();c.initRectShape(this.type,200,80);c.setTextTitle("Name");c.setTextType(C_SHAPE_TEXT_TEXTAREA);c.isInterface=this.isInterface;c.setText=function(h){this.name="";this.variables=null;this.operations=null;if(h){var g=null;var f=splitText(h);g=f[0];this.name=g.trim();if(f.length>1){g=f[1];g=g.trim();this.variables=g.split("\n")}if(f.length>2){g=f[2];g=g.trim();this.operations=g.split("\n")}}this.text=h;return};c.drawText=function(f){var j=0;var g=0;var m=0;var o=this.w/2;var l=null;var h=0;var q=this.style.fontSize;var p=this.isIcon?"<<I>>":"<<interface>>";f.beginPath();f.font=this.style.getFont();f.fillStyle=this.style.textColor;if(this.w<100||this.h<100||(!this.variables&&!this.operations)){f.textAlign="center";f.textBaseline="middle";if(this.isInterface){f.textBaseline="bottom";this.style.setFontSize(q*0.8);f.font=this.style.getFont();f.fillText(p,this.w/2,this.h/2,this.w);f.textBaseline="top";this.style.setFontSize(q);f.font=this.style.getFont()}f.fillText(this.name,this.w/2,this.h/2,this.w);return}f.textAlign="center";f.textBaseline="top";if(this.isInterface){this.style.setFontSize(q*0.8);f.font=this.style.getFont();f.fillText(p,o,m,this.w);m=m+q;this.style.setFontSize(q);f.font=this.style.getFont()}f.fillText(this.name,o,m,this.w);m=m+q;m=m+10;f.moveTo(0,m);f.lineTo(this.w,m);f.strokeStyle=this.style.lineColor;f.stroke();f.strokeStyle=this.style.textColor;f.textAlign="left";f.textBaseline="top";this.style.setFontSize(q*0.7);f.font=this.style.getFont();m=m+10;h=this.style.fontSize;if(this.variables){f.fillStyle=this.style.textColor;g=this.variables.length;for(j=0;j<g;j++){if((m+h)>=this.h){break}l=this.variables[j];if(l){f.fillText("-",10,m,this.w);f.fillText(l,30,m,this.w);m+=h}}}if(this.operations){m=m+10;f.fillStyle=this.style.strokeStyle;f.moveTo(0,m);f.lineTo(this.w,m);f.strokeStyle=this.style.lineColor;f.stroke();f.strokeStyle=this.style.textColor;f.fillStyle=this.style.textColor;g=this.operations.length;for(j=0;j<g;j++){if((m+h)>=this.h){break}l=this.operations[j];if(l){f.fillText("+",10,m,this.w);f.fillText(l,30,m,this.w);m+=h}}}this.style.setFontSize(q)};c.asIcon=function(){this.isIcon=true;this.setText("Class");this.resize(40,40);this.setStyle(getIconShapeStyle());return};var e=this.isInterface?"Animal":"Dog";c.setText(e+"\n--\nint age;\nstring name;\n--\nvoid eat(int food);\nvoid run(void);");return c};return}function PackageShapeCreator(){var a=["uml-package","UML Package",null,1];ShapeCreator.apply(this,a);this.createShape=function(c){var b=new RectShape();b.initRectShape(this.type,200,200);b.setTextTitle("Name");b.drawText=function(e){if(this.text){var f=this.h/6;var d=this.w/2;if(f<30){d=this.w/4}if(f<20){f=this.h/4}e.beginPath();e.textAlign=this.textAlign;e.textBaseline=this.textBaseline;e.font=this.style.getFont();e.fillStyle=this.style.textColor;if(this.h<200||this.w<200){e.fillText(this.text,this.textX,this.textY,this.w)}else{e.fillText(this.text,d/2,f/2,this.w)}e.fill()}return};b.paintShape=function(e){var f=this.h/6;var d=this.w/2;if(f<30){d=this.w/4}if(f<20){f=this.h/4}e.rect(0,0,d,f);e.rect(0,f,this.w,this.h-f);e.stroke();e.fill();e.beginPath();e.moveTo(0,f);e.lineTo(d,f);e.stroke();e.beginPath();return};b.asIcon=function(){this.isIcon=true;this.setText("Package");this.resize(40,40);this.setStyle(getIconShapeStyle());return};b.setDefSize(400,400);return b};return}function SelfAggregationShapeCreator(){var a=["uml-self-aggregation","UML Self Aggregation",null,1];ShapeCreator.apply(this,a);this.createShape=function(c){var b=new RectShape();b.initRectShape(this.type,200,200);b.p1=new Point(0,0);b.p2=new Point(0,0);b.paintShape=function(d){d.moveTo(0,this.h/2);d.lineTo(0,0);d.lineTo(this.w,0);d.lineTo(this.w,this.h);d.lineTo(this.w/2,this.h);d.stroke();this.p1.x=this.w;this.p1.y=this.h;this.p2.x=this.w/2;this.p2.y=this.h;drawArrow(d,C_ARROW_DIAMOND,this.p1,this.p2,this.style.arrowSize);d.beginPath();return};b.asIcon=function(){this.isIcon=true;this.resize(32,32);this.setText("");this.setStyle(getIconShapeStyle());return};return b};return}function StateShapeCreator(){var a=["uml-state","UML state",null,1];ShapeCreator.apply(this,a);this.createShape=function(c){var b=new ArcRectShape();b.initRectShape(this.type,200,60);b.setTextTitle("Name");return b};return}function StateActivityShapeCreator(){var a=["uml-state-activity","UML State Activity",null,1];ShapeCreator.apply(this,a);this.createShape=function(c){var b=new RoundRectShape();b.initRectShape(this.type,200,200);b.setTextTitle("Name");b.setTextType(C_SHAPE_TEXT_TEXTAREA);b.setText=function(f){this.name="";this.activities=null;if(f){var e=null;var d=splitText(f);e=d[0];this.name=e.trim();if(d.length>1){e=d[1];e=e.trim();this.activities=e.split("\n")}}this.text=f;return};b.drawText=function(e){var f=0;var m=0;var l=0;var d=this.w/2;var h=null;var j=0;var g=this.style.fontSize;e.beginPath();e.font=this.style.getFont();e.fillStyle=this.style.textColor;e.textAlign="center";e.textBaseline="top";if(!this.activities){l=this.h/2-g}e.fillText(this.name,d,l,this.w);if(this.activities){l=l+g+10;e.moveTo(0,l);e.lineTo(this.w,l);e.stroke();e.textAlign="left";this.style.setFontSize(g*0.7);e.font=this.style.getFont();l=l+10;j=this.style.fontSize;e.fillStyle=this.style.textColor;m=this.activities.length;for(f=0;f<m;f++){if((l+j)>=this.h){break}h=this.activities[f];if(h){e.fillText(h,20,l,this.w);l+=j}}}this.style.setFontSize(g)};b.asIcon=function(){this.isIcon=true;this.resize(36,36);this.setText("");this.setStyle(getIconShapeStyle());return};b.setDefSize(200,80);b.setText("Idle\n--\ndo/sleeping\n");return b};return}function CompositeStateShapeCreator(){var a=["uml-state-composite","UML Composite State",null,1];ShapeCreator.apply(this,a);this.createShape=function(c){var b=new RoundRectShape();b.initRectShape(this.type,200,200);b.drawText=function(f){var g=this.h*0.25;g=g<80?g:80;if(this.text&&!this.isIcon){var d=this.w/2;var h=g/2;f.beginPath();f.textAlign="center";f.textBaseline="middle";var e=this.style.getFont();f.font=e;f.fillStyle=this.style.textColor;f.fillText(this.text,d,h);f.fill();f.beginPath()}f.moveTo(0,g);f.lineTo(this.w,g);f.stroke();f.beginPath();return};b.setDefSize(400,300);b.setText(dappGetText("Composite State"));return b};return}function StateInitialShapeCreator(){var a=["uml-state-initial","UML State Initial",null,1];ShapeCreator.apply(this,a);this.createShape=function(c){var b=new RectShape();b.initRectShape(this.type,200,200);b.setTextTitle("Name");b.paintShape=function(e){var f=(this.w<this.h?this.w:this.h)/2;var d=(this.w/2-f)/2+f;var g=(this.h/2-f)/2+f;e.fillStyle=this.style.lineColor;e.arc(d,g,f,0,2*Math.PI,false);e.stroke();e.fill();e.beginPath();return};b.setTextAlignV("bottom");b.setTextAlignH("center");b.asIcon=function(){this.isIcon=true;this.resize(20,20);this.setStyle(getIconShapeStyle());this.style.setFontSize(10);return};b.setSizeLimit(30,30,100,100,1);b.setDefSize(30,30);b.getNearPoint=CircleShape.prototype.getNearPoint;return b};return}function StateEndShapeCreator(){var a=["uml-state-end","UML State End",null,1];ShapeCreator.apply(this,a);this.createShape=function(c){var b=new RectShape();b.initRectShape(this.type,60,60);b.setTextTitle("Name");b.paintShape=function(e){var f=(this.w<this.h?this.w:this.h)/2;var d=(this.w/2-f)/2+f;var g=(this.h/2-f)/2+f;e.arc(d,g,f,0,2*Math.PI,false);e.stroke();e.beginPath();e.fillStyle=this.style.lineColor;e.arc(d,g,f*0.5,0,2*Math.PI,false);e.stroke();e.fill();e.beginPath();return};b.setTextAlignV("bottom");b.setTextAlignH("center");b.setSizeLimit(30,30,100,100,1);b.getNearPoint=CircleShape.prototype.getNearPoint;return b};return}function StateHTransShapeCreator(){var a=["uml-state-h-trans","UML State H Trans",null,1];ShapeCreator.apply(this,a);this.createShape=function(c){var b=new HLineShape();b.setTextTitle("Name");b.initLShape(null,this.type);b.style.setFirstArrowType(C_ARROW_NONE);b.style.setSecondArrowType(C_ARROW_NORMAL);b.style.setLineStyle(C_LINE_STYLE_0);b.setOptions(true,true,true,true);return b};return}function StateVTransShapeCreator(){var a=["uml-state-v-trans","UML State V Trans",null,1];ShapeCreator.apply(this,a);this.createShape=function(c){var b=new VLineShape();b.setTextTitle("Name");b.initLShape(null,this.type);b.style.setFirstArrowType(C_ARROW_NONE);b.style.setSecondArrowType(C_ARROW_NORMAL);b.style.setLineStyle(C_LINE_STYLE_0);b.setOptions(true,true,true,true);return b};return}function StateCurveTransShapeCreator(b){b=b?b:"uml-state-curve-trans";var a=[b,"UML State Curve Trans",null,1];ShapeCreator.apply(this,a);this.createShape=function(d){var c=new CurveShape();c.setTextTitle("Name");c.drawArrows=function(e){drawArrow(e,C_ARROW_NORMAL,this.points[2],this.points[1],this.style.arrowSize);return};c.initLShape(null,this.type);c.setOptions(true,true,true,true);return c};return}function ActiveObjectShapeCreator(){var a=["uml-active-object","UML Active Object",null,1];ShapeCreator.apply(this,a);this.createShape=function(c){var b=new RectShape();b.initRectShape(this.type,200,60);b.handle=new Point(b.w/2,b.h+100);b.from=new Point(b.w/2,b.h);b.setTextTitle("Name");b.asIcon=function(){this.isIcon=true;b.handle.y=b.h+5;this.resize(36,30);this.setStyle(getIconShapeStyle());return};b.getMoreSelectMark=function(e,d){if(e===C_HIT_TEST_HANDLE){this.handle.x=this.w/2;d.x=this.handle.x;d.y=this.handle.y<=this.h?this.h+100:this.handle.y;return true}return false};b.moveHandle=function(e,d){this.handle.x=this.w/2;this.handle.y+=d;if(this.handle.y<=this.h){this.handle.y=this.h+10}return};b.paintShape=function(e){var d=this.handle.x;var f=this.handle.y;e.rect(0,0,this.w,this.h);e.stroke();e.fill();this.from.x=this.w/2;this.from.y=this.h;this.handle.x=this.w/2;if(this.handle.y<=this.h){this.handle.y=this.h+10}e.beginPath();drawDashedLine(e,this.from,this.handle,8,8);e.stroke();e.beginPath();return};b.setStyle=function(d){this.style.copy(d);this.style.setTextU(true);this.style.setTextI(false);this.style.setTextB(false);return};b.style.setTextU(true);return b};return}function ActivationShapeCreator(){var a=["uml-activation","UML ACtivation",null,1];ShapeCreator.apply(this,a);this.createShape=function(c){var b=new RectShape();b.initRectShape(this.type,200,200);b.setTextType(C_SHAPE_TEXT_NONE);b.asIcon=function(){this.isIcon=true;this.resize(20,40);this.setStyle(getIconShapeStyle());return};b.setSizeLimit(20,0,40,0,0);b.setDefSize(20,200);return b};return}function CallShapeCreator(){var a=["uml-call","UML Call",null,1];ShapeCreator.apply(this,a);this.createShape=function(c){var b=new HLineShape();b.setTextTitle("Name");b.initLShape(null,this.type);b.style.setFirstArrowType(C_ARROW_NONE);b.style.setSecondArrowType(C_ARROW_FILL_TRI);b.style.setLineStyle(C_LINE_STYLE_0);b.setOptions(true,true,true,true);return b};return}function SyncMsgShapeCreator(){var a=["uml-sync-msg","UML Sync Message",null,1];ShapeCreator.apply(this,a);this.createShape=function(c){var b=new HLineShape();b.initLShape(null,this.type);b.style.setFirstArrowType(C_ARROW_NONE);b.style.setSecondArrowType(C_ARROW_NORMAL);b.style.setLineStyle(C_LINE_STYLE_0);b.setOptions(true,true,true,true);return b};return}function ASyncMsgShapeCreator(){var a=["uml-asyn-msg","UML Async Message",null,1];ShapeCreator.apply(this,a);this.createShape=function(c){var b=new HLineShape();b.initLShape(null,this.type);b.style.setFirstArrowType(C_ARROW_NONE);b.style.setSecondArrowType(C_ARROW_NORMAL);b.style.setLineStyle(C_LINE_STYLE_4);b.setOptions(true,true,true,true);return b};return}function LifeLineShapeCreator(){var a=["uml-life-line","UML Object Life Line",null,1];ShapeCreator.apply(this,a);this.createShape=function(c){var b=new VLineShape();b.initLShape(null,this.type);b.style.setFirstArrowType(C_ARROW_NONE);b.style.setSecondArrowType(C_ARROW_NONE);b.style.setLineStyle(C_LINE_STYLE_4);b.setOptions(true,true,true,true);return b};return}function SelfActivationShapeCreator(){var a=["uml-self-activation","UML Self Activation",null,1];ShapeCreator.apply(this,a);this.createShape=function(c){var b=new RectShape();b.initRectShape(this.type,200,200);b.p1=new Point(0,0);b.p2=new Point(0,0);b.setTextTitle("Name");b.paintShape=function(d){d.moveTo(0,0);d.lineTo(this.w,0);d.lineTo(this.w,this.h);d.lineTo(0,this.h);d.stroke();this.p1.x=this.w;this.p1.y=this.h;this.p2.x=0;this.p2.y=this.h;drawArrow(d,C_ARROW_FILL_TRI,this.p1,this.p2,this.style.arrowSize);d.beginPath();return};return b};return}function ActiveObjectKillerShapeCreator(){var a=["uml-active-object-killer","UML Active Object Killer",null,1];ShapeCreator.apply(this,a);this.createShape=function(c){var b=new RectShape();b.initRectShape(this.type,40,40);b.setTextType(C_SHAPE_TEXT_NONE);b.paintShape=function(d){d.moveTo(0,0);d.lineTo(this.w,this.h);d.moveTo(this.w,0);d.lineTo(0,this.h);return};b.setSizeLimit(40,40,100,100,1);return b};return}function SyncHBarShapeCreator(){var a=["uml-sync-hbar","UML Sync HBar",null,1];ShapeCreator.apply(this,a);this.createShape=function(c){var b=new HLineShape();b.initLShape(null,this.type);b.style.setFirstArrowType(C_ARROW_NONE);b.style.setSecondArrowType(C_ARROW_NONE);b.style.setLineWidth(3);b.style.setLineStyle(C_LINE_STYLE_0);b.setOptions(true,true,true,true);return b};return}function SyncVBarShapeCreator(){var a=["uml-sync-vbar","UML Sync VBar",null,1];ShapeCreator.apply(this,a);this.createShape=function(c){var b=new VLineShape();b.initLShape(null,this.type);b.style.setFirstArrowType(C_ARROW_NONE);b.style.setSecondArrowType(C_ARROW_NONE);b.style.setLineWidth(3);b.style.setLineStyle(C_LINE_STYLE_0);b.setOptions(true,true,true,true);return b};return}function ActionShapeCreator(){var a=["uml-action","UML Action",null,1];ShapeCreator.apply(this,a);this.createShape=function(c){var b=new RoundRectShape();b.setTextTitle("Name");return b.initRectShape(this.type,200,60)};return}function ActivityShapeCreator(){var a=["uml-activity","UML Activity",null,1];ShapeCreator.apply(this,a);this.createShape=function(c){var b=new ArcRectShape();b.setTextTitle("Name");return b.initRectShape(this.type,200,60)};return}function SingalReceiptShapeCreator(){var a=["uml-signal-receipt","UML Signal Receipt",null,1];ShapeCreator.apply(this,a);this.createShape=function(c){var b=new RectShape();b.initRectShape(this.type,200,60);b.setTextTitle("Name");b.paintShape=function(d){var e=Math.min(this.h,this.w)/2;d.moveTo(0,0);d.lineTo(e,this.h/2);d.lineTo(0,this.h);d.lineTo(this.w,this.h);d.lineTo(this.w,0);d.lineTo(0,0)};b.asIcon=function(){this.isIcon=true;this.resize(40,20);this.setStyle(getIconShapeStyle());return};b.getNearPoint=function(f){var d=this.getX();var l=this.getY();var e=this.getWidth();var g=this.getHeight();var j={x:0,y:0};switch(f){case 0:j.x=d;j.y=l;break;case 1:j.x=d+e/2;j.y=l;break;case 2:j.x=d+e;j.y=l;break;case 3:j.x=d+e;j.y=l+g/2;break;case 4:j.x=d+e;j.y=l+g;break;case 5:j.x=d+e/2;j.y=l+g;break;case 6:j.x=d;j.y=l+g;break;case 7:j.x=d+g/2;j.y=l+g/2;break;case 8:j.x=d+e/2;j.y=l+g/2;break;default:return null}return j};return b};return}function SingalSindingShapeCreator(){var a=["uml-signal-sending","UML Signal Sending",null,1];ShapeCreator.apply(this,a);this.createShape=function(c){var b=new RectShape();b.initRectShape(this.type,200,60);b.setTextTitle("Name");b.paintShape=function(d){var e=Math.min(this.h,this.w)/2;d.moveTo(0,0);d.lineTo(this.w-e,0);d.lineTo(this.w,this.h/2);d.lineTo(this.w-e,this.h);d.lineTo(0,this.h);d.lineTo(0,0)};b.asIcon=function(){this.isIcon=true;this.resize(40,20);this.setStyle(getIconShapeStyle());return};b.getNearPoint=function(f){var d=this.getX();var l=this.getY();var e=this.getWidth();var g=this.getHeight();var j={x:0,y:0};switch(f){case 0:j.x=d;j.y=l;break;case 1:j.x=d+e/2;j.y=l;break;case 2:j.x=d+e-g/2;j.y=l;break;case 3:j.x=d+e;j.y=l+g/2;break;case 4:j.x=d+e-g/2;j.y=l+g;break;case 5:j.x=d+e/2;j.y=l+g;break;case 6:j.x=d;j.y=l+g;break;case 7:j.x=d;j.y=l+g/2;break;case 8:j.x=d+e/2;j.y=l+g/2;break;default:return null}return j};return b};return}function ObjectShapeCreator(){var a=["uml-object","UML Object",null,1];ShapeCreator.apply(this,a);this.createShape=function(c){var b=new RectShape();b.initRectShape(this.type,200,60);b.setStyle=function(d){this.style.copy(d);this.style.setTextU(true);this.style.setTextI(false);this.style.setTextB(false);return};return b};return}function BranchShapeCreator(){var a=["uml-branch","UML Branch",null,1];ShapeCreator.apply(this,a);this.createShape=function(c){var b=new DiamondShape();return b.initRectShape(this.type,60,60)};return}function ActivityInitialShapeCreator(){var a=["uml-init-activity","UML Init Activity",null,1];ShapeCreator.apply(this,a);this.createShape=function(c){var b=new RectShape();b.initRectShape(this.type,30,30);b.setTextTitle("Name");b.paintShape=function(e){var f=(this.w<this.h?this.w:this.h)/2;var d=(this.w/2-f)/2+f;var g=(this.h/2-f)/2+f;e.fillStyle=this.style.lineColor;e.arc(d,g,f,0,2*Math.PI,false);e.stroke();e.fill();e.beginPath();return};b.setTextAlignV("bottom");b.setTextAlignH("center");b.asIcon=function(){this.isIcon=true;this.resize(20,20);this.setStyle(getIconShapeStyle());this.style.setFontSize(10);return};b.setSizeLimit(30,30,100,100,1);b.getNearPoint=CircleShape.prototype.getNearPoint;return b};return}function ActivityFinalShapeCreator(){var a=["uml-final-activity","UML Final Activity",null,1];ShapeCreator.apply(this,a);this.createShape=function(c){var b=new RectShape();b.initRectShape(this.type,60,60);b.setTextTitle("Name");b.paintShape=function(e){var f=(this.w<this.h?this.w:this.h)/2;var d=(this.w/2-f)/2+f;var g=(this.h/2-f)/2+f;e.fillStyle=this.style.lineColor;e.arc(d,g,f*0.5,0,2*Math.PI,false);e.stroke();e.fill();e.beginPath();e.arc(d,g,f,0,2*Math.PI,false);e.stroke();e.beginPath();return};b.setTextAlignV("bottom");b.setTextAlignH("center");b.setSizeLimit(30,30,100,100,1);b.getNearPoint=CircleShape.prototype.getNearPoint;return b};return}function HourGlassShapeCreator(){var a=["uml-hour-glass","UML Hour Glass",null,1];ShapeCreator.apply(this,a);this.createShape=function(c){var b=new RectShape();b.initRectShape(this.type,40,60);b.paintShape=function(d){d.moveTo(0,0);d.lineTo(this.w,0);d.lineTo(0,this.h);d.lineTo(this.w,this.h);d.lineTo(0,0);return};b.setTextAlignV("bottom");b.setTextAlignH("center");b.setSizeLimit(40,60,80,120,0);return b};return}function FlowEndShapeCreator(){var a=["uml-flow-end","UML Flow End",null,1];ShapeCreator.apply(this,a);this.createShape=function(c){var b=new RectShape();b.initRectShape(this.type,40,40);b.setTextTitle("Name");b.paintShape=function(d){var f=this.w/2;var e=f/1.414;d.arc(f,this.h/2,this.w/2,0,2*Math.PI,0);d.stroke();d.fill();d.beginPath();d.moveTo(f-e,f-e);d.lineTo(f+e,f+e);d.moveTo(f+e,f-e);d.lineTo(f-e,f+e);d.stroke();d.beginPath()};b.setTextAlignV("bottom");b.setTextAlignH("center");b.setSizeLimit(40,40,80,80,1);b.getNearPoint=CircleShape.prototype.getNearPoint;return b};return}function SwinLaneShapeCreator(){var a=["uml-swin-lane","UML Swin Lane",null,1];ShapeCreator.apply(this,a);this.createShape=function(c){var b=new RectShape();b.initRectShape(this.type,400,600);b.setTextTitle("Obejct names");b.drawText=function(d){return};b.setText=function(d){this.text=d.length>0?d:"Object1,Object2,Object3";this.names=this.text.split(",");return};b.paintShape=function(e){var g=this.names.length;var d=this.w/g;e.rect(0,0,this.w,this.h);e.stroke();e.fill();e.beginPath();for(var f=0;f<g;f++){e.moveTo(f*d,0);e.lineTo(f*d,this.h)}e.stroke();e.beginPath();if(e.measureText(this.text).width<this.w){e.textAlign="center";e.textBaseline="top";e.font=this.style.getFont();e.fillStyle=this.style.textColor;for(var f=0;f<g;f++){e.fillText(this.names[f],d*f+d/2,5,d)}}};b.setText("Object1,Object2,Object3");b.setSizeLimit(400,500,0,0);return b};return}function AssocShapeCreator(){var a=["uml-assoc","UML Assoc",null,1];ShapeCreator.apply(this,a);this.createShape=function(c){var b=new LineShape();b.initLShape(null,this.type);b.setTextType(C_SHAPE_TEXT_TEXTAREA);b.style.setFirstArrowType(C_ARROW_NONE);b.style.setSecondArrowType(C_ARROW_NONE);b.setOptions(true,true,true,true);b.drawText=function(g){if(!this.text){return}var f=null;var j=null;var e=null;var h=null;var d=splitText(this.text);if(d.length===1){f=d[0]}else{j=d[0];f=d[1];if(d.length>2){e=d[2]}}g.save();g.beginPath();g.font=this.style.getFont();g.fillStyle=this.style.textColor;g.textBaseline="bottom";if(j){g.textAlign="left";g.fillText(j,this.points[0].x,this.points[0].y)}if(e){g.textAlign="right";g.fillText(e,this.points[1].x,this.points[1].y)}if(f){g.textAlign="center";g.fillText(f,(this.points[1].x+this.points[0].x)/2,(this.points[1].y+this.points[0].y)/2)}g.restore()};return b};return}function mathInitShape(c,d,a,b){c.asIcon=function(){this.isIcon=true;this.resize(d,a);this.setStyle(getIconShapeStyle());this.style.setLineWidth(2);return};if(!b){c.setTextType(C_SHAPE_TEXT_NONE)}else{c.setTextType(C_SHAPE_TEXT_INPUT)}c.showProperty=function(){showGeneralPropertyDialog(this,this.textType,false,false);return};c.getNearPoint=function(e){return null};c.setSizeLimit(5,40,40,0,0);c.setDefSize(40,40);c.style.setLineWidth(3);return c}function LBraceShapeCreator(){var a=["math-l-brace","Math Left Brace",null,1];ShapeCreator.apply(this,a);this.createShape=function(c){var b=new RectShape();b.initRectShape(this.type,200,200);b.paintShape=function(d){d.moveTo(this.w,0);d.lineTo(0,0);d.lineTo(0,this.h);d.lineTo(this.w,this.h);d.stroke();d.beginPath();return};return mathInitShape(b,20,36)};return}function RBraceShapeCreator(){var a=["math-r-brace","Math right Brace",null,1];ShapeCreator.apply(this,a);this.createShape=function(c){var b=new RectShape();b.initRectShape(this.type,200,200);b.paintShape=function(d){d.moveTo(0,0);d.lineTo(this.w,0);d.lineTo(this.w,this.h);d.lineTo(0,this.h);d.stroke();d.beginPath();return};return mathInitShape(b,20,36)};return}function LBracketShapeCreator(){var a=["math-l-bracket","Math Left Bracket",null,1];ShapeCreator.apply(this,a);this.createShape=function(c){var b=new RectShape();b.initRectShape(this.type,200,200);b.paintShape=function(e){var f=this.w<this.h/4?this.w:this.h/4;e.moveTo(0,f);e.arc(f,f,f,Math.PI,Math.PI*1.5);e.moveTo(f,this.h);e.arc(f,this.h-f,f,Math.PI/2,Math.PI);var d=f/2;e.moveTo(0,f);e.lineTo(0,this.h/2-d);e.lineTo(-d,this.h/2);e.lineTo(0,this.h/2+d);e.lineTo(0,this.h-f);e.stroke();e.beginPath();return};return mathInitShape(b,20,36)};return}function RBracketShapeCreator(){var a=["math-r-bracket","Math right Bracket",null,1];ShapeCreator.apply(this,a);this.createShape=function(c){var b=new RectShape();b.initRectShape(this.type,200,200);b.paintShape=function(e){e.translate(this.w/2,this.h/2);e.rotate(Math.PI);e.translate(-this.w/2,-this.h/2);var f=this.w<this.h/4?this.w:this.h/4;e.moveTo(0,f);e.arc(f,f,f,Math.PI,Math.PI*1.5);e.moveTo(f,this.h);e.arc(f,this.h-f,f,Math.PI/2,Math.PI);var d=f/2;e.moveTo(0,f);e.lineTo(0,this.h/2-d);e.lineTo(-d,this.h/2);e.lineTo(0,this.h/2+d);e.lineTo(0,this.h-f);e.stroke();e.beginPath();return};return mathInitShape(b,20,36)};return}function LParenthesisShapeCreator(){var a=["math-l-parenthesis","Math Left Parenthesis",null,1];ShapeCreator.apply(this,a);this.createShape=function(c){var b=new RectShape();b.initRectShape(this.type,200,200);b.paintShape=function(d){var e=(0.25*this.h*this.h+this.w*this.w)/(2*this.w);d.arc(this.w+0.5*this.h,this.h/2,this.h/Math.sqrt(2),0.75*Math.PI,1.25*Math.PI);d.stroke();d.beginPath();return};return mathInitShape(b,20,36)};return}function RParenthesisShapeCreator(){var a=["math-r-parenthesis","Math right Parenthesis",null,1];ShapeCreator.apply(this,a);this.createShape=function(c){var b=new RectShape();b.initRectShape(this.type,200,200);b.paintShape=function(d){d.translate(this.w/2,this.h/2);d.rotate(Math.PI);d.translate(-this.w/2,-this.h/2);var e=(0.25*this.h*this.h+this.w*this.w)/(2*this.w);d.arc(this.w+0.5*this.h,this.h/2,this.h/Math.sqrt(2),0.75*Math.PI,1.25*Math.PI);d.stroke();d.beginPath();return};return mathInitShape(b,20,36)};return}function MultiplicationShapeCreator(){var a=["math-multiplication","Math Multiplication",null,1];ShapeCreator.apply(this,a);this.createShape=function(c){var b=new RectShape();b.initRectShape(this.type,200,200);b.paintShape=function(d){d.moveTo(0,0);d.lineTo(this.w,0);d.moveTo(this.w/4,0);d.lineTo(this.w/4,this.h);d.moveTo(this.w*0.75,0);d.lineTo(this.w*0.75,this.h);d.stroke();d.beginPath();return};mathInitShape(b,20,36);b.setSizeLimit(40,40,100,100,0);return b};return}function SumShapeCreator(){var a=["math-sum","Math Sum",null,1];ShapeCreator.apply(this,a);this.createShape=function(c){var b=new RectShape();b.initRectShape(this.type,200,200);b.paintShape=function(d){d.moveTo(this.w,0);d.lineTo(0,0);d.lineTo(this.w/2,this.h/2);d.lineTo(0,this.h);d.lineTo(this.w,this.h);d.stroke();d.beginPath();return};mathInitShape(b,20,36);b.setSizeLimit(40,40,100,100,0);return b};return}function MathVLineShapeCreator(){var a=["math-vline","Math VLine",null,1];ShapeCreator.apply(this,a);this.createShape=function(c){var b=new VLineShape();b.initLShape(null,this.type);b.style.setFirstArrowType(C_ARROW_NONE);b.style.setSecondArrowType(C_ARROW_NONE);b.style.setLineWidth(2);b.style.setLineStyle(C_LINE_STYLE_0);b.setOptions(true,true,true,true);return b};return}function MathHLineShapeCreator(){var a=["math-hline","Math HLine",null,1];ShapeCreator.apply(this,a);this.createShape=function(c){var b=new HLineShape();b.initLShape(null,this.type);b.style.setFirstArrowType(C_ARROW_NONE);b.style.setSecondArrowType(C_ARROW_NONE);b.style.setLineWidth(2);b.style.setLineStyle(C_LINE_STYLE_0);b.setOptions(true,true,true,true);return b};return}function MathLineShapeCreator(){var a=["math-line","Math Line",null,1];ShapeCreator.apply(this,a);this.createShape=function(c){var b=new LineShape();b.initLShape(null,this.type);b.style.setFirstArrowType(C_ARROW_NONE);b.style.setSecondArrowType(C_ARROW_NONE);b.style.setLineWidth(2);b.style.setLineStyle(C_LINE_STYLE_0);b.setOptions(true,true,true,true);return b};return}function SqrtShapeCreator(){var a=["math-sqrt","Math Sqrt",null,1];ShapeCreator.apply(this,a);this.createShape=function(c){var b=new RectShape();b.initRectShape(this.type,200,200);b.paintShape=function(d){var e=this.h/4;if(e>20){e=20}d.moveTo(0,this.h);d.lineTo(e,this.h-e);d.lineTo(2*e,this.h);d.lineTo(3*e,0);d.lineTo(this.w,0);d.stroke();d.beginPath();return};mathInitShape(b,36,36,true);b.setSizeLimit(80,30,0,0,0);return b};return}function IntegralShapeCreator(){var a=["math-integral","Math Integral",null,1];ShapeCreator.apply(this,a);this.createShape=function(c){var b=new RectShape();b.initRectShape(this.type,200,200);b.paintShape=function(d){d.moveTo(this.w,0);d.bezierCurveTo(this.w*0.2,0.25*this.h,this.w*0.8,0.75*this.h,0,this.h);d.stroke();d.beginPath();return};mathInitShape(b,36,36);b.setSizeLimit(20,40,100,200,0);return b};return}function ExpressionShapeCreator(){var a=["math-expr","Math Expression",null,1];ShapeCreator.apply(this,a);this.createShape=function(c){var b=new RectShape();b.initRectShape(this.type,200,200);b.asIcon=function(){this.isIcon=true;this.resize(40,40);this.setStyle(getIconShapeStyle());this.setText(dappGetText("Expression"));return};b.paintShape=function(d){d.beginPath()};b.showProperty=function(){showGeneralPropertyDialog(this,this.textType,false,false,"Expression");return};b.setText("(a+b)");b.setDefSize(200,40);b.getNearPoint=function(d){return null};return b};return}function UpRightShapeCreator(){var a=["math-up-right","Math UP Right",null,1];ShapeCreator.apply(this,a);this.createShape=function(c){var b=new RectShape();b.initRectShape(this.type,200,200);mathInitShape(b,36,36);b.setSizeLimit(40,40,0,0,0);b.paintShape=function(d){d.moveTo(this.w/2,0);d.lineTo(this.w/2,this.h);d.moveTo(0,this.h);d.lineTo(this.w,this.h);d.stroke();d.beginPath()};return b};return}function ReasonShapeCreator(){var a=["math-reason","Math Reason",null,1];ShapeCreator.apply(this,a);this.createShape=function(c){var b=new RectShape();b.initRectShape(this.type,200,200);mathInitShape(b,36,36);b.setSizeLimit(40,40,0,0,0);b.paintShape=function(d){var e=Math.min(this.w,this.h)/8;d.fillStyle=d.strokeStyle;d.arc(this.w/2,e,e,0,2*Math.PI);d.fill();d.beginPath();d.arc(e,this.h-e,e,0,2*Math.PI);d.fill();d.beginPath();d.arc(this.w-e,this.h-e,e,0,2*Math.PI);d.fill();d.beginPath()};return b};return}function ResultShapeCreator(){var a=["math-result","Math Result",null,1];ShapeCreator.apply(this,a);this.createShape=function(c){var b=new RectShape();b.initRectShape(this.type,200,200);mathInitShape(b,36,36);b.setSizeLimit(40,40,0,0,0);b.paintShape=function(d){var e=Math.min(this.w,this.h)/8;d.translate(this.w/2,this.h/2);d.rotate(Math.PI);d.translate(-this.w/2,-this.h/2);d.fillStyle=d.strokeStyle;d.arc(this.w/2,e,e,0,2*Math.PI);d.fill();d.beginPath();d.arc(e,this.h-e,e,0,2*Math.PI);d.fill();d.beginPath();d.arc(this.w-e,this.h-e,e,0,2*Math.PI);d.fill();d.beginPath()};return b};return}function ExistShapeCreator(){var a=["math-exist","Math Exist",null,1];ShapeCreator.apply(this,a);this.createShape=function(c){var b=new RectShape();b.initRectShape(this.type,200,200);mathInitShape(b,36,36);b.setSizeLimit(40,40,0,0,0);b.paintShape=function(d){d.moveTo(0,0);d.lineTo(this.w/2,this.h);d.lineTo(this.w,0);d.moveTo(0,this.h/2);d.lineTo(this.w,this.h/2);d.stroke();d.beginPath()};return b};return}function UnionShapeCreator(){var a=["math-union","Math Union",null,1];ShapeCreator.apply(this,a);this.createShape=function(c){var b=new RectShape();b.initRectShape(this.type,200,200);mathInitShape(b,30,36);b.setSizeLimit(30,40,0,0,0);b.paintShape=function(d){var e=Math.min(this.w,this.h)/2;d.moveTo(this.w/2-e,this.h);d.lineTo(this.w/2-e,e);d.arc(this.w/2,e,e,Math.PI,Math.PI*2);d.lineTo(this.w/2+e,this.h);d.stroke();d.beginPath()};return b};return}function IntersectionShapeCreator(){var a=["math-intersection","Math Intersection",null,1];ShapeCreator.apply(this,a);this.createShape=function(c){var b=new RectShape();b.initRectShape(this.type,200,200);mathInitShape(b,30,36);b.setSizeLimit(30,40,0,0,0);b.paintShape=function(d){var e=Math.min(this.w,this.h)/2;d.translate(this.w/2,this.h/2);d.rotate(Math.PI);d.translate(-this.w/2,-this.h/2);d.moveTo(this.w/2-e,this.h);d.lineTo(this.w/2-e,e);d.arc(this.w/2,e,e,Math.PI,Math.PI*2);d.lineTo(this.w/2+e,this.h);d.stroke();d.beginPath()};return b};return}function BelongShapeCreator(){var a=["math-belong","Math belong",null,1];ShapeCreator.apply(this,a);this.createShape=function(c){var b=new RectShape();b.initRectShape(this.type,200,200);mathInitShape(b,30,36);b.setSizeLimit(30,40,0,0,0);b.paintShape=function(e){var d=this.w/2;var g=this.h/2;var f=this.h/this.w;e.translate(d,g);e.scale(1,f);e.arc(0,0,this.w/2,0.5*Math.PI,1.5*Math.PI);e.moveTo(-this.w/2,0);e.lineTo(0,0);e.stroke();e.beginPath()};return b};return}function EllipsisShapeCreator(){var a=["math-ellipsis","Math Ellipsis",null,1];ShapeCreator.apply(this,a);this.createShape=function(c){var b=new RectShape();b.initRectShape(this.type,200,200);mathInitShape(b,30,36);b.setSizeLimit(30,40,0,0,0);b.paintShape=function(d){var e=Math.min(this.w,this.h)/12;d.arc(e,this.h/2,e,0,Math.PI*2);d.arc(this.w/2,this.h/2,e,0,Math.PI*2);d.arc(this.w-e,this.h/2,e,0,Math.PI*2);d.fillStyle=d.strokeStyle;d.fill();d.beginPath()};return b};return}function NotEqualShapeCreator(){var a=["math-not-equal","Math Not Equal",null,1];ShapeCreator.apply(this,a);this.createShape=function(c){var b=new RectShape();b.initRectShape(this.type,200,200);mathInitShape(b,30,36);b.setSizeLimit(30,40,0,0,0);b.paintShape=function(d){d.moveTo(0,this.h/4);d.lineTo(this.w,this.h/4);d.moveTo(0,3*this.h/4);d.lineTo(this.w,3*this.h/4);d.moveTo(this.w/4,0);d.lineTo(this.w*3/4,this.h);d.stroke();d.beginPath()};return b};return}function EqualShapeCreator(){var a=["math-equal","Math Equal",null,1];ShapeCreator.apply(this,a);this.createShape=function(c){var b=new RectShape();b.initRectShape(this.type,200,200);mathInitShape(b,30,36);b.setSizeLimit(30,40,0,0,0);b.paintShape=function(d){d.moveTo(0,this.h/4);d.lineTo(this.w,this.h/4);d.moveTo(0,3*this.h/4);d.lineTo(this.w,3*this.h/4);d.stroke();d.beginPath()};return b};return}function LessShapeCreator(){var a=["math-less","Math Less",null,1];ShapeCreator.apply(this,a);this.createShape=function(c){var b=new RectShape();b.initRectShape(this.type,200,200);mathInitShape(b,30,30);b.setSizeLimit(30,40,0,0,0);b.paintShape=function(d){d.moveTo(this.w,0);d.lineTo(0,this.h/2);d.lineTo(this.w,this.h);d.stroke();d.beginPath()};return b};return}function LessEqualShapeCreator(){var a=["math-less-equal","Math Less Equal",null,1];ShapeCreator.apply(this,a);this.createShape=function(c){var b=new RectShape();b.initRectShape(this.type,200,200);mathInitShape(b,30,30);b.setSizeLimit(30,40,0,0,0);b.paintShape=function(d){d.moveTo(this.w,0);d.lineTo(0,this.h*0.25);d.lineTo(this.w,this.h*0.75);d.moveTo(0,this.h*0.5);d.lineTo(this.w,this.h);d.stroke();d.beginPath()};return b};return}function GreateShapeCreator(){var a=["math-greate","Math Greate",null,1];ShapeCreator.apply(this,a);this.createShape=function(c){var b=new RectShape();b.initRectShape(this.type,200,200);mathInitShape(b,30,30);b.setSizeLimit(30,40,0,0,0);b.paintShape=function(d){d.moveTo(0,0);d.lineTo(this.w,this.h*0.5);d.lineTo(0,this.h);d.stroke();d.beginPath()};return b};return}function GreateEqualShapeCreator(){var a=["math-greate-equal","Math Greate Equal",null,1];ShapeCreator.apply(this,a);this.createShape=function(c){var b=new RectShape();b.initRectShape(this.type,200,200);mathInitShape(b,30,30);b.setSizeLimit(30,40,0,0,0);b.paintShape=function(d){d.moveTo(0,0);d.lineTo(this.w,this.h*0.25);d.lineTo(0,this.h*0.75);d.moveTo(this.w,this.h*0.5);d.lineTo(0,this.h);d.stroke();d.beginPath()};return b};return}function LessLessShapeCreator(){var a=["math-less-less","Math Less Less",null,1];ShapeCreator.apply(this,a);this.createShape=function(c){var b=new RectShape();b.initRectShape(this.type,200,200);mathInitShape(b,30,30);b.setSizeLimit(30,40,0,0,0);b.paintShape=function(d){d.moveTo(this.w/2,0);d.lineTo(0,this.h/2);d.lineTo(this.w/2,this.h);d.moveTo(this.w,0);d.lineTo(this.w/2,this.h/2);d.lineTo(this.w,this.h);d.stroke();d.beginPath()};return b};return}function GreateGreateShapeCreator(){var a=["math-greate-greate","Math Greate Greate",null,1];ShapeCreator.apply(this,a);this.createShape=function(c){var b=new RectShape();b.initRectShape(this.type,200,200);mathInitShape(b,30,30);b.setSizeLimit(30,40,0,0,0);b.paintShape=function(d){d.moveTo(0,0);d.lineTo(this.w/2,this.h/2);d.lineTo(0,this.h);d.moveTo(this.w/2,0);d.lineTo(this.w,this.h/2);d.lineTo(this.w/2,this.h);d.stroke();d.beginPath()};return b};return}function AlmostEqualShapeCreator(){var a=["math-almost-equal","Math Almost Equal",null,1];ShapeCreator.apply(this,a);this.createShape=function(c){var b=new RectShape();b.initRectShape(this.type,200,200);mathInitShape(b,30,30);b.setSizeLimit(30,40,0,0,0);b.paintShape=function(d){d.moveTo(0,this.h/2);d.bezierCurveTo(this.w*0.25,-0.5*this.h,this.w*0.75,this.h,this.w,0);d.moveTo(0,this.h);d.bezierCurveTo(this.w*0.25,0,this.w*0.75,this.h*1.5,this.w,this.h/2);d.stroke();d.beginPath();d.stroke();d.beginPath()};return b};return}function InfiniteShapeCreator(){var a=["math-infinite","Math Infinite",null,1];ShapeCreator.apply(this,a);this.createShape=function(c){var b=new RectShape();b.initRectShape(this.type,200,200);mathInitShape(b,30,30);b.setSizeLimit(30,40,0,0,0);b.paintShape=function(e){var d=this.w/2;var g=this.h/2;var f=this.h/this.w;e.translate(d,g);e.scale(1,f);e.translate(-d,0);e.arc(this.w*0.25,0,this.w*0.25,0,2*Math.PI);e.stroke();e.beginPath();e.arc(this.w*0.75,0,this.w*0.25,0,2*Math.PI);e.stroke();e.beginPath()};return b};return}function SuperscriptShapeCreator(){var a=["math-super-script","Math Super Script",null,1];ShapeCreator.apply(this,a);this.createShape=function(c){var b=new RectShape();b.initRectShape(this.type,200,60);b.setSizeLimit(30,40,0,0,0);b.setText("(a+b)\n--\n(c+d)");b.setTextType(C_SHAPE_TEXT_TEXTAREA);b.asIcon=function(){this.isIcon=true;this.resize(30,30);this.setStyle(getIconShapeStyle());this.style.setLineWidth(2);b.style.setFontSize(32);b.setText("a\n--\nb");return};b.drawText=function(d){return};b.paintShape=function(e){if(this.text){e.beginPath();var d=splitText(this.text);var f=this.style.fontSize;if(d.length<2){return}e.translate(0,-f/2);e.textAlign="right";e.textBaseline="top";e.font=this.style.getFont();e.fillStyle=this.style.textColor;e.fillText(d[1],this.w/2,this.h/2,this.w/2);this.style.setFontSize(f*0.5);e.font=this.style.getFont();e.textAlign="left";e.textBaseline="bottom";e.fillText(d[0],this.w/2,this.h/2+f/2,this.w/2);this.style.setFontSize(f)}return};b.showProperty=function(){showGeneralPropertyDialog(this,this.textType,false,false);return};b.getNearPoint=function(d){return null};return b};return}function SubcriptShapeCreator(){var a=["math-sub-script","Math Sub Script",null,1];ShapeCreator.apply(this,a);this.createShape=function(c){var b=new RectShape();b.initRectShape(this.type,200,60);b.setSizeLimit(30,40,0,0,0);b.setText("(a+b)\n--\n(c+d)");b.setTextType(C_SHAPE_TEXT_TEXTAREA);b.asIcon=function(){this.isIcon=true;this.resize(36,36);this.setStyle(getIconShapeStyle());this.style.setLineWidth(2);b.style.setFontSize(32);b.setText("a\n--\n2");return};b.drawText=function(d){return};b.paintShape=function(e){if(this.text){e.beginPath();var d=splitText(this.text);var f=this.style.fontSize;if(d.length<2){return}e.translate(0,f/2);e.textAlign="right";e.textBaseline="bottom";e.font=this.style.getFont();e.fillStyle=this.style.textColor;e.fillText(d[0],this.w/2,this.h/2,this.w/2);this.style.setFontSize(f*0.5);e.font=this.style.getFont();e.textAlign="left";e.textBaseline="top";e.fillText(d[1],this.w/2,this.h/2-f/2,this.w/2);this.style.setFontSize(f)}return};b.showProperty=function(){showGeneralPropertyDialog(this,this.textType,false,false);return};b.getNearPoint=function(d){return null};return b};return}function DivisionShapeCreator(){var a=["math-division","Math Division",null,1];ShapeCreator.apply(this,a);this.createShape=function(c){var b=new RectShape();b.initRectShape(this.type,200,80);b.setSizeLimit(30,40,0,0,0);b.setText("(a+b)\n--\n(c+d)");b.setTextType(C_SHAPE_TEXT_TEXTAREA);b.asIcon=function(){this.isIcon=true;this.resize(20,36);this.setStyle(getIconShapeStyle());this.style.setLineWidth(2);b.style.setFontSize(16);b.setText("1\n--\n2");return};b.drawText=function(d){return};b.paintShape=function(e){if(this.text){e.beginPath();var d=splitText(this.text);if(d.length<2){return}e.textAlign="center";e.textBaseline="bottom";e.font=this.style.getFont();e.fillStyle=this.style.textColor;e.fillText(d[0],this.w/2,this.h/2,this.w/2);e.moveTo(0,this.h/2);e.lineTo(this.w,this.h/2);e.textAlign="center";e.textBaseline="top";e.fillText(d[1],this.w/2,this.h/2,this.w/2)}return};b.showProperty=function(){showGeneralPropertyDialog(this,this.textType,false,false);return};b.getNearPoint=function(d){return null};return b};return}function StoredDataShapeCreator(){var a=["fc-stored-data","Stored Data",null,1];ShapeCreator.apply(this,a);this.createShape=function(c){var b=new StoredDataShape();return b.initRectShape(this.type,200,100)};return}function StoredDataShape(){return}StoredDataShape.prototype=new RectShape();StoredDataShape.prototype.getNearPoint=function(c){var a=this.getX();var f=this.getY();var b=this.getWidth();var d=this.getHeight();var e={x:0,y:0};switch(c){case 0:e.x=a+b/2;e.y=f;break;case 1:e.x=a+b;e.y=f;break;case 2:e.x=a+b;e.y=f+d;break;case 3:e.x=a+b/2;e.y=f+d;break;case 4:e.x=a;e.y=f+d/2;break;case 5:e.x=a+b/2;e.y=f+d/2;break;default:return null}return e};StoredDataShape.prototype.paintShape=function(b){var a=this.w;var d=this.h;var e=0.707*d;var c=0.207*d;b.moveTo(c,0);b.lineTo(a,0);b.arc(a+d/2,d/2,e,1.25*Math.PI,0.75*Math.PI,true);b.lineTo(c,d);b.arc(e,d/2,e,0.75*Math.PI,1.25*Math.PI);return};function DirectDataShapeCreator(){var a=["fc-direct-data","Direct Data",null,1];ShapeCreator.apply(this,a);this.createShape=function(c){var b=new DirectDataShape();return b.initRectShape(this.type,200,100)};return}function DirectDataShape(){return}DirectDataShape.prototype=new RectShape();DirectDataShape.prototype.getNearPoint=CircleShape.prototype.getNearPoint;DirectDataShape.prototype.paintShape=function(b){var a=this.w;var d=this.h;var e=0.707*d;var c=0.207*d;b.moveTo(c,0);b.lineTo(a-c,0);b.arc(a-e,d/2,e,1.75*Math.PI,0.25*Math.PI,false);b.lineTo(c,d);b.arc(e,d/2,e,0.75*Math.PI,1.25*Math.PI,false);b.fill();b.stroke();b.beginPath();b.arc(a+d/2-c,d/2,e,1.25*Math.PI,0.75*Math.PI,true);b.stroke();b.beginPath();return};function SeqeuncialAccessShapeCreator(){var a=["fc-seq-access","Seqeuncial Access",null,1];ShapeCreator.apply(this,a);this.createShape=function(c){var b=new SeqeuncialAccessShape();return b.initRectShape(this.type,100,100)};return}function SeqeuncialAccessShape(){return}SeqeuncialAccessShape.prototype=new RectShape();SeqeuncialAccessShape.prototype.getNearPoint=CircleShape.prototype.getNearPoint;SeqeuncialAccessShape.prototype.paintShape=function(b){var a=this.w/2;var d=this.h/2;var c=this.h/this.w;b.save();b.translate(a,d);b.scale(1,c);b.arc(0,0,this.w/2,0,2*Math.PI);b.restore();b.fill();b.stroke();b.beginPath();b.moveTo(this.w/2,this.h);b.lineTo(this.w,this.h);b.stroke();b.beginPath();return};function ManualInputShapeCreator(){var a=["fc-manual-input","Manual Input",null,1];ShapeCreator.apply(this,a);this.createShape=function(c){var b=new ManualInputShape();return b.initRectShape(this.type,200,100)};return}function ManualInputShape(){return}ManualInputShape.prototype=new RectShape();ManualInputShape.prototype.getNearPoint=function(c){var a=this.getX();var f=this.getY();var b=this.getWidth();var d=this.getHeight();var e={x:0,y:0};switch(c){case 0:e.x=a+b;e.y=f;break;case 1:e.x=a+b;e.y=f+d/2;break;case 2:e.x=a+b;e.y=f+d;break;case 3:e.x=a+b/2;e.y=f+d;break;case 4:e.x=a;e.y=f+d;break;case 5:e.x=a;e.y=f+d/2;break;case 6:e.x=a+b/2;e.y=f+d/2;break;default:return null}return e};ManualInputShape.prototype.paintShape=function(a){a.moveTo(0,this.h/2);a.lineTo(this.w,0);a.lineTo(this.w,this.h);a.lineTo(0,this.h);a.lineTo(0,this.h/2);return};function DocumentShapeCreator(){var a=["fc-document","Document",null,1];ShapeCreator.apply(this,a);this.createShape=function(c){var b=new DocumentShape();return b.initRectShape(this.type,200,100)};return}function DocumentShape(){return}DocumentShape.prototype=new RectShape();DocumentShape.prototype.paintShape=function(a){a.moveTo(0,this.h);a.lineTo(0,0);a.lineTo(this.w,0);a.lineTo(this.w,this.h);a.bezierCurveTo(this.w*0.6,0.7*this.h,0.4*this.w,1.3*this.h,0,this.h);return};var CATEGORY_F_C_D="Flow Chart";var CATEGORY_F_C_B="Basic Shapes";var gHadRegisterBasic=false;function dappRegisterBasic(a){if(gHadRegisterBasic){return}gHadRegisterBasic=true;ShapeFactoryGet().addShapeCreator(new LineShapeCreator(),CATEGORY_F_C_D);ShapeFactoryGet().addShapeCreator(new SegmentsShapeCreator(),CATEGORY_F_C_D);ShapeFactoryGet().addShapeCreator(new CurveShapeCreator(),CATEGORY_F_C_D);ShapeFactoryGet().addShapeCreator(new HLineShapeCreator("h-line"),CATEGORY_F_C_D);ShapeFactoryGet().addShapeCreator(new VLineShapeCreator("v-line"),CATEGORY_F_C_D);ShapeFactoryGet().addShapeCreator(new ArcRectShapeCreator("fc-start-end"),CATEGORY_F_C_D);ShapeFactoryGet().addShapeCreator(new DiamondShapeCreator("fc-decision"),CATEGORY_F_C_D);ShapeFactoryGet().addShapeCreator(new RectShapeCreator("fc-process"),CATEGORY_F_C_D);ShapeFactoryGet().addShapeCreator(new ParallRectShapeCreator("fc-data"),CATEGORY_F_C_D);ShapeFactoryGet().addShapeCreator(new StoredDataShapeCreator(),CATEGORY_F_C_D);ShapeFactoryGet().addShapeCreator(new DirectDataShapeCreator(),CATEGORY_F_C_D);ShapeFactoryGet().addShapeCreator(new ManualInputShapeCreator(),CATEGORY_F_C_D);ShapeFactoryGet().addShapeCreator(new DocumentShapeCreator(),CATEGORY_F_C_D);ShapeFactoryGet().addShapeCreator(new SeqeuncialAccessShapeCreator(),CATEGORY_F_C_D);ShapeFactoryGet().addShapeCreator(new TextCalloutShapeCreator(),CATEGORY_F_C_D);ShapeFactoryGet().addShapeCreator(new RectCalloutShapeCreator(),CATEGORY_F_C_D);ShapeFactoryGet().addShapeCreator(new ArrowShapeCreator("line-normal-arrow",C_ARROW_NORMAL,C_LINE_STYLE_0),CATEGORY_F_C_D);ShapeFactoryGet().addShapeCreator(new ArrowShapeCreator("line-diamond-arrow",C_ARROW_DIAMOND,C_LINE_STYLE_0),CATEGORY_F_C_D);ShapeFactoryGet().addShapeCreator(new ArrowShapeCreator("line-fill-diamond-arrow",C_ARROW_FILL_DIAMOND,C_LINE_STYLE_0),CATEGORY_F_C_D);ShapeFactoryGet().addShapeCreator(new ArrowShapeCreator("line-tri-arrow",C_ARROW_TRI,C_LINE_STYLE_0),CATEGORY_F_C_D);ShapeFactoryGet().addShapeCreator(new ArrowShapeCreator("dash-line-normal-arrow",C_ARROW_NORMAL,C_LINE_STYLE_4),CATEGORY_F_C_D);ShapeFactoryGet().addShapeCreator(new RoundCalloutShapeCreator(),CATEGORY_F_C_D);ShapeFactoryGet().addShapeCreator(new NotesCalloutShapeCreator(),CATEGORY_F_C_D);ShapeFactoryGet().addShapeCreator(new RoundArrowCalloutShapeCreator(),CATEGORY_F_C_D);ShapeFactoryGet().addShapeCreator(new RectShapeCreator(),CATEGORY_F_C_B);ShapeFactoryGet().addShapeCreator(new CircleShapeCreator(),CATEGORY_F_C_B);ShapeFactoryGet().addShapeCreator(new RoundRectShapeCreator(),CATEGORY_F_C_B);ShapeFactoryGet().addShapeCreator(new TriRectShapeCreator(),CATEGORY_F_C_B);ShapeFactoryGet().addShapeCreator(new ImageRectShapeCreator(),CATEGORY_F_C_B);ShapeFactoryGet().addShapeCreator(new DiamondShapeCreator(),CATEGORY_F_C_B);ShapeFactoryGet().addShapeCreator(new FourArrowShapeCreator("4arrow",C_SHAPE_FOUR_ARROW),CATEGORY_F_C_B);ShapeFactoryGet().addShapeCreator(new FourArrowShapeCreator("3arrow-left",C_SHAPE_THREE_LEFT_ARROW),CATEGORY_F_C_B);ShapeFactoryGet().addShapeCreator(new FourArrowShapeCreator("3arrow-right",C_SHAPE_THREE_RIGHT_ARROW),CATEGORY_F_C_B);ShapeFactoryGet().addShapeCreator(new FourArrowShapeCreator("3arrow-down",C_SHAPE_THREE_DOWN_ARROW),CATEGORY_F_C_B);ShapeFactoryGet().addShapeCreator(new FourArrowShapeCreator("3arrow-up",C_SHAPE_THREE_UP_ARROW),CATEGORY_F_C_B);ShapeFactoryGet().addShapeCreator(new LeftArrowShapeCreator(),CATEGORY_F_C_B);ShapeFactoryGet().addShapeCreator(new RightArrowShapeCreator(),CATEGORY_F_C_B);ShapeFactoryGet().addShapeCreator(new UpArrowShapeCreator(),CATEGORY_F_C_B);ShapeFactoryGet().addShapeCreator(new DownArrowShapeCreator(),CATEGORY_F_C_B);ShapeFactoryGet().addShapeCreator(new HorArrowShapeCreator(),CATEGORY_F_C_B);ShapeFactoryGet().addShapeCreator(new VerArrowShapeCreator(),CATEGORY_F_C_B);ShapeFactoryGet().addShapeCreator(new ArrowShapeCreator("line-normal-arrow",C_ARROW_NORMAL,C_LINE_STYLE_0),CATEGORY_F_C_B);ShapeFactoryGet().addShapeCreator(new ArrowShapeCreator("line-diamond-arrow",C_ARROW_DIAMOND,C_LINE_STYLE_0),CATEGORY_F_C_B);ShapeFactoryGet().addShapeCreator(new ArrowShapeCreator("line-fill-diamond-arrow",C_ARROW_FILL_DIAMOND,C_LINE_STYLE_0),CATEGORY_F_C_B);ShapeFactoryGet().addShapeCreator(new ArrowShapeCreator("line-tri-arrow",C_ARROW_TRI,C_LINE_STYLE_0),CATEGORY_F_C_B);ShapeFactoryGet().addShapeCreator(new ArrowShapeCreator("dash-line-normal-arrow",C_ARROW_NORMAL,C_LINE_STYLE_4),CATEGORY_F_C_B);if(a){ShapeFactoryGet().addDiagramType(CATEGORY_F_C_D,CATEGORY_F_C_D)}return}var hadRegisterUML=false;var CATEGORY_U_U_C="UML User Case Diagram";var CATEGORY_U_S_C="UML Sequence Diagram";var CATEGORY_U_C_D="UML Class Diagram";var CATEGORY_U_S_D="UML State Diagram";var CATEGORY_U_A_D="UML Activity Diagram";function dappRegisterUML(a){if(hadRegisterUML){return}hadRegisterUML=true;ShapeFactoryGet().addShapeCreator(new ActorShapeCreator(),CATEGORY_U_U_C);ShapeFactoryGet().addShapeCreator(new UserCaseShapeCreator(),CATEGORY_U_U_C);ShapeFactoryGet().addShapeCreator(new SystemBoudaryShapeCreator(),CATEGORY_U_U_C);ShapeFactoryGet().addShapeCreator(new NotesCalloutShapeCreator(),CATEGORY_U_U_C);ShapeFactoryGet().addShapeCreator(new TextCalloutShapeCreator(),CATEGORY_U_U_C);ShapeFactoryGet().addShapeCreator(new AssocShapeCreator(),CATEGORY_U_U_C);ShapeFactoryGet().addShapeCreator(new ArrowShapeCreator("uml-direct_assoc",C_ARROW_NORMAL,C_LINE_STYLE_0),CATEGORY_U_U_C);ShapeFactoryGet().addShapeCreator(new ArrowShapeCreator("uml-aggregation",C_ARROW_DIAMOND,C_LINE_STYLE_0),CATEGORY_U_U_C);ShapeFactoryGet().addShapeCreator(new ArrowShapeCreator("uml-composition",C_ARROW_FILL_DIAMOND,C_LINE_STYLE_0),CATEGORY_U_U_C);ShapeFactoryGet().addShapeCreator(new ArrowShapeCreator("uml-generalization",C_ARROW_TRI,C_LINE_STYLE_0),CATEGORY_U_U_C);ShapeFactoryGet().addShapeCreator(new ArrowShapeCreator("uml-dependency",C_ARROW_NORMAL,C_LINE_STYLE_4),CATEGORY_U_U_C);ShapeFactoryGet().addShapeCreator(new ArrowShapeCreator("uml-realization",C_ARROW_TRI,C_LINE_STYLE_4),CATEGORY_U_U_C);ShapeFactoryGet().addShapeCreator(new ClassShapeCreator(),CATEGORY_U_C_D);ShapeFactoryGet().addShapeCreator(new ClassShapeCreator(true),CATEGORY_U_C_D);ShapeFactoryGet().addShapeCreator(new PackageShapeCreator(),CATEGORY_U_C_D);ShapeFactoryGet().addShapeCreator(new NotesCalloutShapeCreator(),CATEGORY_U_C_D);ShapeFactoryGet().addShapeCreator(new SelfAggregationShapeCreator(),CATEGORY_U_C_D);ShapeFactoryGet().addShapeCreator(new ArrowShapeCreator("uml-assoc",C_ARROW_NONE,C_LINE_STYLE_0),CATEGORY_U_C_D);ShapeFactoryGet().addShapeCreator(new ArrowShapeCreator("uml-direct_assoc",C_ARROW_NORMAL,C_LINE_STYLE_0),CATEGORY_U_C_D);ShapeFactoryGet().addShapeCreator(new ArrowShapeCreator("uml-aggregation",C_ARROW_DIAMOND,C_LINE_STYLE_0),CATEGORY_U_C_D);ShapeFactoryGet().addShapeCreator(new ArrowShapeCreator("uml-composition",C_ARROW_FILL_DIAMOND,C_LINE_STYLE_0),CATEGORY_U_C_D);ShapeFactoryGet().addShapeCreator(new ArrowShapeCreator("uml-generalization",C_ARROW_TRI,C_LINE_STYLE_0),CATEGORY_U_C_D);ShapeFactoryGet().addShapeCreator(new ArrowShapeCreator("uml-dependency",C_ARROW_NORMAL,C_LINE_STYLE_4),CATEGORY_U_C_D);ShapeFactoryGet().addShapeCreator(new ArrowShapeCreator("uml-realization",C_ARROW_TRI,C_LINE_STYLE_4),CATEGORY_U_C_D);ShapeFactoryGet().addShapeCreator(new StateShapeCreator(),CATEGORY_U_S_D);ShapeFactoryGet().addShapeCreator(new StateActivityShapeCreator(),CATEGORY_U_S_D);ShapeFactoryGet().addShapeCreator(new StateInitialShapeCreator(),CATEGORY_U_S_D);ShapeFactoryGet().addShapeCreator(new StateEndShapeCreator(),CATEGORY_U_S_D);ShapeFactoryGet().addShapeCreator(new CompositeStateShapeCreator(),CATEGORY_U_S_D);ShapeFactoryGet().addShapeCreator(new DiamondShapeCreator("uml-junction",60,60),CATEGORY_U_S_D);ShapeFactoryGet().addShapeCreator(new CircleShapeCreator("uml-choice",60,60),CATEGORY_U_S_D);ShapeFactoryGet().addShapeCreator(new SyncHBarShapeCreator(),CATEGORY_U_S_D);ShapeFactoryGet().addShapeCreator(new SyncVBarShapeCreator(),CATEGORY_U_S_D);ShapeFactoryGet().addShapeCreator(new TextCalloutShapeCreator(),CATEGORY_U_S_D);ShapeFactoryGet().addShapeCreator(new NotesCalloutShapeCreator(),CATEGORY_U_S_D);ShapeFactoryGet().addShapeCreator(new ArrowShapeCreator("uml-line-trans",C_ARROW_NORMAL,C_LINE_STYLE_0),CATEGORY_U_S_D);ShapeFactoryGet().addShapeCreator(new StateCurveTransShapeCreator(),CATEGORY_U_S_D);ShapeFactoryGet().addShapeCreator(new StateHTransShapeCreator(),CATEGORY_U_S_D);ShapeFactoryGet().addShapeCreator(new StateVTransShapeCreator(),CATEGORY_U_S_D);ShapeFactoryGet().addShapeCreator(new SegmentsShapeCreator("uml-segments-trans"),CATEGORY_U_S_D);ShapeFactoryGet().addShapeCreator(new ActorShapeCreator(),CATEGORY_U_S_C);ShapeFactoryGet().addShapeCreator(new ActiveObjectShapeCreator(),CATEGORY_U_S_C);ShapeFactoryGet().addShapeCreator(new ActivationShapeCreator(),CATEGORY_U_S_C);ShapeFactoryGet().addShapeCreator(new TextCalloutShapeCreator(),CATEGORY_U_S_C);ShapeFactoryGet().addShapeCreator(new CallShapeCreator(),CATEGORY_U_S_C);ShapeFactoryGet().addShapeCreator(new SyncMsgShapeCreator(),CATEGORY_U_S_C);ShapeFactoryGet().addShapeCreator(new ASyncMsgShapeCreator(),CATEGORY_U_S_C);ShapeFactoryGet().addShapeCreator(new SelfActivationShapeCreator(),CATEGORY_U_S_C);ShapeFactoryGet().addShapeCreator(new ActiveObjectKillerShapeCreator(),CATEGORY_U_S_C);ShapeFactoryGet().addShapeCreator(new LifeLineShapeCreator(),CATEGORY_U_S_C);ShapeFactoryGet().addShapeCreator(new NotesCalloutShapeCreator(),CATEGORY_U_S_C);ShapeFactoryGet().addShapeCreator(new RoundCalloutShapeCreator(),CATEGORY_U_S_C);ShapeFactoryGet().addShapeCreator(new ActivityShapeCreator(),CATEGORY_U_A_D);ShapeFactoryGet().addShapeCreator(new ObjectShapeCreator(),CATEGORY_U_A_D);ShapeFactoryGet().addShapeCreator(new ActivityInitialShapeCreator(),CATEGORY_U_A_D);ShapeFactoryGet().addShapeCreator(new ActivityFinalShapeCreator(),CATEGORY_U_A_D);ShapeFactoryGet().addShapeCreator(new SyncHBarShapeCreator(),CATEGORY_U_A_D);ShapeFactoryGet().addShapeCreator(new SyncVBarShapeCreator(),CATEGORY_U_A_D);ShapeFactoryGet().addShapeCreator(new BranchShapeCreator(),CATEGORY_U_A_D);ShapeFactoryGet().addShapeCreator(new HourGlassShapeCreator(),CATEGORY_U_A_D);ShapeFactoryGet().addShapeCreator(new FlowEndShapeCreator(),CATEGORY_U_A_D);ShapeFactoryGet().addShapeCreator(new SwinLaneShapeCreator(),CATEGORY_U_A_D);ShapeFactoryGet().addShapeCreator(new StateCurveTransShapeCreator("uml-curve-flow"),CATEGORY_U_A_D);ShapeFactoryGet().addShapeCreator(new ArrowShapeCreator("uml-activity-flow",C_ARROW_NORMAL,C_LINE_STYLE_0),CATEGORY_U_A_D);ShapeFactoryGet().addShapeCreator(new ArrowShapeCreator("uml-activity-async-flow",C_ARROW_NORMAL,C_LINE_STYLE_4),CATEGORY_U_A_D);ShapeFactoryGet().addShapeCreator(new SegmentsShapeCreator("uml-segments-flow"),CATEGORY_U_A_D);ShapeFactoryGet().addShapeCreator(new SingalReceiptShapeCreator(),CATEGORY_U_A_D);ShapeFactoryGet().addShapeCreator(new SingalSindingShapeCreator(),CATEGORY_U_A_D);ShapeFactoryGet().addShapeCreator(new NotesCalloutShapeCreator(),CATEGORY_U_A_D);ShapeFactoryGet().addShapeCreator(new TextCalloutShapeCreator(),CATEGORY_U_A_D);if(a){ShapeFactoryGet().addDiagramType(CATEGORY_U_U_C,CATEGORY_U_U_C);ShapeFactoryGet().addDiagramType(CATEGORY_U_C_D,CATEGORY_U_C_D);ShapeFactoryGet().addDiagramType(CATEGORY_U_S_D,CATEGORY_U_S_D);ShapeFactoryGet().addDiagramType(CATEGORY_U_S_C,CATEGORY_U_S_C);ShapeFactoryGet().addDiagramType(CATEGORY_U_A_D,CATEGORY_U_A_D)}return}var hadRegisterMath=false;function dappRegisterMath(){if(hadRegisterMath){return}hadRegisterMath=true;var a="Maths Symbols";ShapeFactoryGet().addShapeCreator(new ExpressionShapeCreator(),a);ShapeFactoryGet().addShapeCreator(new SubcriptShapeCreator(),a);ShapeFactoryGet().addShapeCreator(new SuperscriptShapeCreator(),a);ShapeFactoryGet().addShapeCreator(new DivisionShapeCreator(),a);ShapeFactoryGet().addShapeCreator(new SqrtShapeCreator(),a);ShapeFactoryGet().addShapeCreator(new LBraceShapeCreator(),a);ShapeFactoryGet().addShapeCreator(new RBraceShapeCreator(),a);ShapeFactoryGet().addShapeCreator(new LBracketShapeCreator(),a);ShapeFactoryGet().addShapeCreator(new RBracketShapeCreator(),a);ShapeFactoryGet().addShapeCreator(new LParenthesisShapeCreator(),a);ShapeFactoryGet().addShapeCreator(new RParenthesisShapeCreator(),a);ShapeFactoryGet().addShapeCreator(new MultiplicationShapeCreator(),a);ShapeFactoryGet().addShapeCreator(new SumShapeCreator(),a);ShapeFactoryGet().addShapeCreator(new MathHLineShapeCreator(),a);ShapeFactoryGet().addShapeCreator(new MathVLineShapeCreator(),a);ShapeFactoryGet().addShapeCreator(new IntegralShapeCreator(),a);ShapeFactoryGet().addShapeCreator(new UpRightShapeCreator(),a);ShapeFactoryGet().addShapeCreator(new ReasonShapeCreator(),a);ShapeFactoryGet().addShapeCreator(new ResultShapeCreator(),a);ShapeFactoryGet().addShapeCreator(new ExistShapeCreator(),a);ShapeFactoryGet().addShapeCreator(new UnionShapeCreator(),a);ShapeFactoryGet().addShapeCreator(new IntersectionShapeCreator(),a);ShapeFactoryGet().addShapeCreator(new BelongShapeCreator(),a);ShapeFactoryGet().addShapeCreator(new EllipsisShapeCreator(),a);ShapeFactoryGet().addShapeCreator(new EqualShapeCreator(),a);ShapeFactoryGet().addShapeCreator(new NotEqualShapeCreator(),a);ShapeFactoryGet().addShapeCreator(new LessShapeCreator(),a);ShapeFactoryGet().addShapeCreator(new LessEqualShapeCreator(),a);ShapeFactoryGet().addShapeCreator(new GreateShapeCreator(),a);ShapeFactoryGet().addShapeCreator(new GreateEqualShapeCreator(),a);ShapeFactoryGet().addShapeCreator(new LessLessShapeCreator(),a);ShapeFactoryGet().addShapeCreator(new GreateGreateShapeCreator(),a);ShapeFactoryGet().addShapeCreator(new AlmostEqualShapeCreator(),a);ShapeFactoryGet().addShapeCreator(new InfiniteShapeCreator(),a);ShapeFactoryGet().addShapeCreator(new MathLineShapeCreator(),a);ShapeFactoryGet().addShapeCreator(new NotesCalloutShapeCreator(),a);ShapeFactoryGet().addDiagramType(a,a);return}var hadRegisterChart=false;function dappRegisterChart(){if(hadRegisterChart){return}hadRegisterChart=true;var a="Chart";ShapeFactoryGet().addShapeCreator(new RectXyChartShapeShapeCreator(),a);ShapeFactoryGet().addShapeCreator(new LineXyChartShapeShapeCreator(),a);ShapeFactoryGet().addShapeCreator(new VLineXyChartShapeShapeCreator(),a);ShapeFactoryGet().addShapeCreator(new DotXyChartShapeShapeCreator(),a);ShapeFactoryGet().addShapeCreator(new FillXyChartShapeShapeCreator(),a);ShapeFactoryGet().addShapeCreator(new TextCalloutShapeCreator(),a);ShapeFactoryGet().addShapeCreator(new NotesCalloutShapeCreator(),a);ShapeFactoryGet().addShapeCreator(new LineShapeCreator(),a);ShapeFactoryGet().addDiagramType(a,a);return}function dappRegisterAll(){dappRegisterBasic(true);dappRegisterUML(true);return}function dappRegister(a){if(a==="flowchart"){dappRegisterBasic(true)}else{if(a==="uml"){dappRegisterUML(true)}else{if(a==="math"){dappRegisterMath()}else{if(a==="chart"){dappRegisterChart()}else{if(a==="eda"){dappRegisterEda()}else{dappRegisterAll()}}}}}console.log("dappRegister: category="+a);return}function dappRegisterBasicForDemo(){if(!gHadRegisterBasic){dappRegisterBasic(false);ShapeFactoryGet().removeCategoryName(CATEGORY_F_C_D);ShapeFactoryGet().removeCategoryName(CATEGORY_F_C_B)}return}function UIElement(){return}UIElement.prototype=new RShape();UIElement.prototype.isUIElement=true;UIElement.prototype.hasChildren=true;UIElement.prototype.isContainer=true;UIElement.prototype.execMoveResize=function(a,j,b,f){var e=this.getParent();if(!e||!e.isUILayout){this.exec(new MoveResizeCommand(this,a,j,b,f))}else{e.sortChildren();var d=e.toJson();var g=JSON.stringify(d);if(!isNaN(a)&&!isNaN(j)){this.move(a,j)}if(!isNaN(b)&&!isNaN(f)){this.resize(b,f)}e.sortChildren();var d=e.toJson();var c=JSON.stringify(d);e.exec(new PropertyCommand(e,g,c))}return};UIElement.prototype.setFreePosition=function(a){this.freePosition=a;return};UIElement.prototype.fixChildPosition=function(d){var a=d.x;var c=d.y;var b=d.h;if(d.freePosition){return}if(d.widthAttr===C_WIDTH_FILL_PARENT){a=this.getHMargin()}if(d.heightAttr===C_HEIGHT_FILL_PARENT){c=this.getVMargin()}d.x=a;d.y=c;return};UIElement.prototype.setFreeSize=function(a){this.freeSize=a;return};UIElement.prototype.fixChildSize=function(b){if(b.freeSize){return}if(this.autoAdjustHeight){if((b.y+b.h)>this.h){this.h=b.y+b.h+this.vMargin}}var g=b.x;var j=b.w;var f=b.y;var c=b.h;var e=this.getWidth(true);var d=this.getHeight(true);var l=e+this.hMargin;var a=d+this.vMargin;if((g+j)>l&&b.widthAttr!=C_WIDTH_FILL_PARENT&&b.xAttr!=C_X_AFTER_PREV&&b.widthAttr!=C_WIDTH_FILL_AVAILABLE&&this.mode===C_MODE_EDITING){g=l-j;if(g<0){g=0}j=l-g}if((f+c)>a&&b.heightAttr!=C_HEIGHT_FILL_PARENT&&b.yAttr!=C_Y_AFTER_PREV&&b.heightAttr!=C_HEIGHT_FILL_AVAILABLE&&this.mode===C_MODE_EDITING){f=a-c;if(f<0){f=0}c=a-f}if(g<0){g=0}if(f<0){f=0}b.x=g;b.y=f;b.w=j<=e?j:e;b.h=c<=d?c:d;return};UIElement.prototype.onInit=function(){if(this.offset){this.offset=0}if(this.mode!==C_MODE_EDITING){if(this.dataSourceUrl&&this.dataSourceUrl.length>5){this.bindDataUrl(this.dataSourceUrl)}this.callOnInit()}return};UIElement.prototype.onDeinit=function(){return};UIElement.prototype.init=function(){var c=0;var a=null;var b=this.children;var d=this.children.length;this.onInit();for(c=0;c<d;c++){a=b[c];a.init()}return};UIElement.prototype.deinit=function(){var c=0;var a=null;var b=this.children;var d=this.children.length;for(c=0;c<d;c++){a=b[c];a.deinit()}this.onDeinit();return};UIElement.prototype.onModeChanged=function(){return};UIElement.prototype.userRemovable=function(){return this.mode===C_MODE_EDITING};UIElement.prototype.postRedraw=function(){if(this.view){if(this.mode===C_MODE_RUNNING){var a={};var b=this.getPositionInView();a.x=b.x;a.y=b.y;a.w=this.w;a.h=this.h;this.view.postRedraw(a)}else{this.view.postRedrawAll()}}return};UIElement.prototype.setMode=function(c,a){this.mode=c;if(this.type!=="ui-menu-bar"){if(c===C_MODE_EDITING){this.setVisible(true)}}if(a){for(var b=0;b<this.children.length;b++){var d=this.children[b];if(d.isContainer){d.setMode(c,true)}}}this.onModeChanged();return};UIElement.prototype.calcChildrenRange=function(){return this.calcShapesRange(this.children)};UIElement.prototype.calcShapesRange=function(c){var p=0;var m=0;var q=0;var g=0;var a=0;var o=0;var s=10000;var d=10000;var f={};if(c.length>0){for(var e=0;e<c.length;e++){var j=c[e];p=j.getX();m=j.getY();q=j.getWidth();g=j.getHeight();if(p<d){d=p}if(m<s){s=m}if((p+q)>a){a=p+q}if((m+g)>o){o=m+g}}f.l=d;f.r=a;f.t=s;f.b=o}else{f.l=0;f.r=0;f.t=0;f.b=0}return f};UIElement.prototype.relayoutChildren=function(){};UIElement.prototype.onSized=function(){this.updateLayoutParams();this.relayout();return};UIElement.prototype.findSelectedShapes=function(a){for(var b=0;b<this.children.length;b++){var c=this.children[b];if(c.selected){a.push(c);continue}if(c.isContainer){c.findSelectedShapes(a)}}return};UIElement.prototype.setSelected=function(b){if(!b){for(var a=0;a<this.children.length;a++){var c=this.children[a];c.setSelected(false)}}if(this.selected===b){return}this.targetShape=null;this.selected=b;if(this.view){this.view.onShapeSelected(this)}return};UIElement.prototype.setPointerEventTarget=function(a){this.pointerEventTarget=a;return};UIElement.prototype.getPointerEventTarget=function(){return this.pointerEventTarget?this.pointerEventTarget:this.targetShape};UIElement.prototype.setTarget=function(a){for(var b=0;b<this.children.length;b++){var c=this.children[b];if(c!=a){c.setSelected(false)}}this.targetShape=a;this.selected=!a;return};UIElement.prototype.initContainerShape=function(a){this.children=new Array();this.toJsoners=new Array();this.fromJsoners=new Array();RShapeInit(this,a);this.mode=C_MODE_EDITING;this.rectSelectable=true;return this};UIElement.prototype.defaultDispatchPointerDownToChildren=function(b){for(var a=this.children.length;a>0;a--){var c=this.children[a-1];if(c.visible&&c.onPointerDown(b)){this.setTarget(c);return true}}return false};UIElement.prototype.dispatchPointerDownToChildren=function(a){return this.defaultDispatchPointerDownToChildren(a)};UIElement.prototype.callPointerDownHandler=function(point){if(!this.enable){return false}if(!this.handlePointerDown||this.mode===C_MODE_PREVIEW){var sourceCode=this.events.onPointerDown;if(sourceCode){sourceCode="this.handlePointerDown = function(point) {\n"+sourceCode+"\n}\n";try{eval(sourceCode)}catch(e){console.log("eval sourceCode failed: "+e.message+"\n"+sourceCode)}}}if(this.handlePointerDown){try{this.handlePointerDown(point)}catch(e){console.log("this.handlePointerDown:"+e.message)}}return true};UIElement.prototype.onPointerDownEditing=function(a,b){return};UIElement.prototype.onPointerDownRunning=function(a,b){if(!b){return}return this.callPointerDownHandler(a)};UIElement.prototype.callPointerMoveHandler=function(point){if(!this.enable){return false}if(!this.handlePointerMove||this.mode===C_MODE_PREVIEW){var sourceCode=this.events.onPointerMove;if(sourceCode){sourceCode="this.handlePointerMove = function(point) {\n"+sourceCode+"\n}\n";try{eval(sourceCode)}catch(e){console.log("eval sourceCode failed: "+e.message+"\n"+sourceCode)}}}if(this.handlePointerMove){try{this.handlePointerMove(point)}catch(e){console.log("this.handlePointerMove:"+e.message)}}return true};UIElement.prototype.onPointerMoveEditing=function(a,b){return};UIElement.prototype.onPointerMoveRunning=function(a,b){if(!b){return}return this.callPointerMoveHandler(a)};UIElement.prototype.callPointerUpHandler=function(point){if(!this.enable){return false}if(!this.handlePointerUp||this.mode===C_MODE_PREVIEW){var sourceCode=this.events.onPointerUp;if(sourceCode){sourceCode="this.handlePointerUp = function(point) {\n"+sourceCode+"\n}\n";try{eval(sourceCode)}catch(e){console.log("eval sourceCode failed: "+e.message+"\n"+sourceCode)}}}if(this.handlePointerUp){try{this.handlePointerUp(point)}catch(e){console.log("this.handlePointerUp:"+e.message)}}return true};UIElement.prototype.onPointerUpEditing=function(a,b){return};UIElement.prototype.onPointerUpRunning=function(a,b){if(!b){return}return this.callPointerUpHandler(a)};UIElement.prototype.callLongPressHandler=function(point){if(!this.enable){return false}if(!this.handleLongPress||this.mode===C_MODE_PREVIEW){var sourceCode=this.events.onLongPress;if(sourceCode){sourceCode="this.handleLongPress = function(point) {\n"+sourceCode+"\n}\n";try{eval(sourceCode)}catch(e){console.log("eval sourceCode failed: "+e.message+"\n"+sourceCode)}}}if(this.handleLongPress){try{this.handleLongPress(point)}catch(e){console.log("this.handleLongPress:"+e.message)}}return true};UIElement.prototype.callDoubleClickHandler=function(point){if(this.mode===C_MODE_EDITING){if(this.textType!=C_SHAPE_TEXT_NONE){this.editText(point)}else{this.showProperty()}return true}if(!this.enable){return false}if(!this.handleDoubleClick||this.mode===C_MODE_PREVIEW){var sourceCode=this.events.onDoubleClick;if(sourceCode){sourceCode="this.handleDoubleClick = function(point) {\n"+sourceCode+"\n}\n";try{eval(sourceCode)}catch(e){console.log("eval sourceCode failed: "+e.message+"\n"+sourceCode)}}}if(this.handleDoubleClick){try{this.handleDoubleClick(point)}catch(e){console.log("this.handleDoubleClick:"+e.message)}}this.hitTestResult=0;return true};UIElement.prototype.callTimerHandler=function(){var win=this.getWindow();if(win&&!win.visible){return true}if(this.mode===C_MODE_EDITING){return true}if(!this.enable){return false}if(!this.handleTimer||this.mode===C_MODE_PREVIEW){var sourceCode=this.events.onTimer;if(sourceCode){sourceCode="this.handleTimer = function() {\n"+sourceCode+"\n}\n";try{eval(sourceCode)}catch(e){console.log("eval sourceCode failed: "+e.message+"\n"+sourceCode)}}}if(this.handleTimer){try{this.handleTimer()}catch(e){console.log("this.handleTimer:"+e.message)}}return true};UIElement.prototype.callPaintHandler=function(canvas2dCtx){if(this.mode===C_MODE_EDITING){return true}if(!this.enable){return false}if(!this.handlePaint||this.mode===C_MODE_PREVIEW){var sourceCode=this.events.onPaint;if(sourceCode){sourceCode="this.handlePaint = function(canvas2dCtx) {\n"+sourceCode+"\n}\n";try{eval(sourceCode)}catch(e){console.log("eval sourceCode failed: "+e.message+"\n"+sourceCode)}}}if(this.handlePaint){try{this.handlePaint(canvas2dCtx)}catch(e){console.log("this.handlePaint:"+e.message)}}return true};UIElement.prototype.onDoubleClick=function(a){if(this.targetShape){var b=this.translatePoint(a);return this.targetShape.onDoubleClick(b)}else{return this.callDoubleClickHandler(a)}};UIElement.prototype.onGesture=function(a){if(this.targetShape){return this.targetShape.onGesture(a)}return};UIElement.prototype.onLongPress=function(a){this.longPressed=true;this.callLongPressHandler(a);if(this.targetShape){var b=this.translatePoint(a);return this.targetShape.onLongPress(b)}return};UIElement.prototype.callClickHandler=function(point,onChild){if(!this.enable){return false}if(this.mode===C_MODE_EDITING){return false}if(!this.handleClick||this.mode===C_MODE_PREVIEW){var sourceCode=this.events.onClick;if(sourceCode){sourceCode="this.handleClick = function(point) {\n"+sourceCode+"\n}\n";try{eval(sourceCode)}catch(e){console.log("eval sourceCode failed: "+e.message+"\n"+sourceCode)}}}if(!this.children.length){console.log("clicked: "+this.type+"("+this.name+")")}if(this.handleClick){try{this.handleClick(point)}catch(e){console.log("this.handleClick:"+e.message)}}return};UIElement.prototype.onClick=function(a,b){if(b){return}return this.callClickHandler(a,b)};UIElement.prototype.translatePoint=function(a){var b={x:(a.x-this.x),y:(a.y-this.y)};return b};UIElement.prototype.setCanRectSelectable=function(d,a){this.rectSelectable=d;for(var b=0;b<this.children.length;b++){var c=this.children[b];c.setCanRectSelectable(d,a)}return};UIElement.prototype.canRectSelectable=function(){return this.rectSelectable&&this.parentShape};UIElement.prototype.setDraggable=function(a){if(this.draggable===a){return}this.draggable=a;if(a){this.addEventNames(["onDragStart","onDragging","onDragEnd"])}else{this.removeEventNames(["onDragStart","onDragging","onDragEnd"])}return};UIElement.prototype.callOnDragStartHandler=function(){if(!this.enable){return false}if(this.mode===C_MODE_EDITING){return false}if(!this.handleDragStart||this.mode===C_MODE_PREVIEW){var sourceCode=this.events.onDragStart;if(sourceCode){sourceCode="this.handleDragStart = function() {\n"+sourceCode+"\n}\n";try{eval(sourceCode)}catch(e){console.log("eval sourceCode failed: "+e.message+"\n"+sourceCode)}}}if(this.handleDragStart){try{this.handleDragStart()}catch(e){console.log("this.handleDragStart:"+e.message)}}return};UIElement.prototype.callOnDragEndHandler=function(){if(!this.enable){return false}if(this.mode===C_MODE_EDITING){return false}if(!this.handleDragEnd||this.mode===C_MODE_PREVIEW){var sourceCode=this.events.onDragEnd;if(sourceCode){sourceCode="this.handleDragEnd = function() {\n"+sourceCode+"\n}\n";try{eval(sourceCode)}catch(e){console.log("eval sourceCode failed: "+e.message+"\n"+sourceCode)}}}if(this.handleDragEnd){try{this.handleDragEnd()}catch(e){console.log("this.handleDragEnd:"+e.message)}}return};UIElement.prototype.callOnDragingHandler=function(){if(!this.enable){return false}if(this.mode===C_MODE_EDITING){return false}if(!this.handleDraging||this.mode===C_MODE_PREVIEW){var sourceCode=this.events.onDragging;if(sourceCode){sourceCode="this.handleDraging = function() {\n"+sourceCode+"\n}\n";try{eval(sourceCode)}catch(e){console.log("eval sourceCode failed: "+e.message+"\n"+sourceCode)}}}if(this.handleDraging){try{this.handleDraging()}catch(e){console.log("this.handleDraging:"+e.message)}}return};UIElement.prototype.onDragStart=function(){console.log("Drag Start");this.callOnDragStartHandler();return};UIElement.prototype.onDragging=function(){console.log("Dragging");this.callOnDragingHandler();return};UIElement.prototype.onDragEnd=function(){console.log("Drag End");this.callOnDragEndHandler();return};UIElement.prototype.dragMove=function(c,b,a){this.x=this.x+c;this.y=this.y+b;this.onDragging(a);return};UIElement.prototype.handleDragMove=function(a){var c=this.getMoveDeltaX();var b=this.getMoveDeltaY();if(!this.dragging){var e=this.getMoveAbsDeltaX();var d=this.getMoveAbsDeltaY();if(Math.abs(e)>5||Math.abs(d)>5){this.dragging=true;this.onDragStart();c=e;b=d}}if(this.dragging){this.dragMove(c,b,a);if(this.parentShape){this.parentShape.onChildDragging(this,a)}}return};UIElement.prototype.onChildDragging=function(b,a){return};UIElement.prototype.onChildDragged=function(b,a){this.sortChildren();this.relayoutChildren("default");return};UIElement.prototype.handleDragUp=function(a){this.onDragEnd();delete this.dragging;if(this.parentShape){this.parentShape.onChildDragged(this,a)}return};UIElement.prototype.animMove=function(m,l,f){if((this.x===m&&this.y===l)||this.dragging){return}var c=this;var e=1000;var j=this.x;var o=this.y;var a=m-this.x;var d=l-this.y;var b=(new Date()).getTime();var h=new DecelerateInterpolator();function g(){var q=new Date();var p=(q.getTime()-b)/e;var r=h.get(p);if(c.dragging){return}if(p<1&&!c.pointerDown){c.x=Math.floor(j+r*a);c.y=Math.floor(o+r*d);setTimeout(g,10)}else{c.move(m,l);delete b;delete h}delete q;c.postRedraw()}setTimeout(function(){g()},5);return};UIElement.prototype.animate=function(E){if(this.animating||this.dragging||!E){return}var b=this;var a=isNaN(E.duration)?1000:E.duration;var g=isNaN(E.xStart)?this.x:E.xStart;var m=isNaN(E.yStart)?this.y:E.yStart;var c=isNaN(E.wStart)?this.w:E.wStart;var d=isNaN(E.hStart)?this.h:E.hStart;var l=isNaN(E.xEnd)?this.x:E.xEnd;var r=isNaN(E.yEnd)?this.y:E.yEnd;var e=isNaN(E.wEnd)?this.w:E.wEnd;var G=isNaN(E.hEnd)?this.h:E.hEnd;var z=isNaN(E.opacityStart)?this.opacity:E.opacityStart;var h=isNaN(E.opacityEnd)?this.opacity:E.opacityEnd;var A=isNaN(E.rotationStart)?0:E.rotationStart;var f=isNaN(E.rotationEnd)?0:E.rotationEnd;var q=isNaN(E.scaleStart)?this.scale:E.scaleStart;var t=isNaN(E.scaleEnd)?this.scale:E.scaleEnd;var j=E.onDone;var v=l-g;var B=r-m;var o=e-c;var s=G-d;var C=t-q;var F=h-z;var H=f-A;var u=(new Date()).getTime();var w=E.interpolator?E.interpolator:new DecelerateInterpolator();function p(){var J=new Date();var I=(J.getTime()-u)/a;var K=w.get(I);if(b.dragging){return}if(I<1&&!b.pointerDown){if(v){b.x=Math.floor(g+K*v)}if(B){b.y=Math.floor(m+K*B)}if(o){b.w=Math.floor(c+K*o)}if(s){b.h=Math.floor(d+K*s)}if(F){b.opacity=z+K*F}if(H){b.rotation=A+K*H}if(C){b.scale=q+K*C}setTimeout(p,10)}else{if(v||B){b.move(l,r)}if(o||s){b.w=e;b.h=G}if(F){b.opacity=h}if(H){b.rotation=f}if(j){j(b)}delete u;delete w}delete J;b.postRedraw()}var D=E.delay;if(D){setTimeout(function(){p()},D)}else{p()}return};UIElement.prototype.onPointerDownNormal=function(a){if(!this.getParent()){this.setLastEventStatus(UIElement.EVENT_STATUS_NONE)}var c=new Date();var d=this.translatePoint(a);this.hitTestResult=this.hitTest(a);if(!this.hitTestResult){return false}this.pointerDown=true;this.pointerDownTime=c.getTime();this.childrenRange=this.calcChildrenRange();if(this.mode===C_MODE_EDITING){this.onPointerDownEditing(a,true)}else{if(this.enable){this.onPointerDownRunning(d,true)}}if(this.hitTestResult===C_HIT_TEST_MM||!this.selected){if(this.dispatchPointerDownToChildren(d)){if(this.mode===C_MODE_EDITING){this.onPointerDownEditing(a,false)}else{if(this.enable){this.onPointerDownRunning(d,false)}}this.lastPosition.x=a.x;this.lastPosition.y=a.y;this.setPointerEventTarget(this.targetShape);return true}}if(this.hitTestResult===C_HIT_TEST_MM&&this.children.length>1&&this.canRectSelectable()){this.hitTestResult=C_HIT_TEST_WORKAREA}this.setTarget(null);this.setSelected(true);this.lastPosition.x=a.x;this.lastPosition.y=a.y;if(this.mode===C_MODE_EDITING){this.handlePointerEvent(a,1)}if(this.mode===C_MODE_EDITING){this.onPointerDownEditing(a,false)}else{if(this.enable){this.onPointerDownRunning(d,false)}}var b=this.view;if(this.isUIScrollView){setTimeout(function(){b.postRedraw()},100)}else{b.postRedraw()}return true};UIElement.prototype.onPointerMoveNormal=function(o){if(!this.getParent()){this.setLastEventStatus(UIElement.EVENT_STATUS_NONE)}if(this.draggable){if(this.mode!==C_MODE_EDITING){this.handleDragMove(o);return}else{delete this.dragging}}if(this.hitTestResult){var b=this.translatePoint(o);if(this.mode===C_MODE_EDITING){this.onPointerMoveEditing(o,true)}else{if(this.enable){this.onPointerMoveRunning(b,true)}}var f=this.getPointerEventTarget();if(f){f.onPointerMove(b);if(this.mode===C_MODE_EDITING){this.onPointerMoveEditing(o,false)}else{if(this.enable){this.onPointerMoveRunning(b,false)}}}else{if(this.mode===C_MODE_EDITING){this.onPointerMoveEditing(o,false);if(this.hitTestResult===C_HIT_TEST_WORKAREA){var b={x:0,y:0};var e=this.childrenRange;var m=o.x-this.pointerDownPosition.x;var d=o.y-this.pointerDownPosition.y;var l=this.pointerDownPosition.x-this.x;var j=this.pointerDownPosition.y-this.y;var a={x:l,y:j,w:m,h:d};if(((l>e.r)&&m>0)||((j>e.b)&&d>0)||((l<e.l)&&m<0)||((j<e.t)&&d<0)||((l>(this.w-30))&&m>0)||((j>(this.h-30))&&d>0)||((l<30)&&m<0)||((j<30)&&d<0)){this.hitTestResult=C_HIT_TEST_MM;this.handlePointerEvent(o,0)}else{if(Math.abs(m)>5&&Math.abs(d)>5){a=fixRect(a);this.setSelected(false);for(var c=this.children.length-1;c>=0;c--){var g=this.children[c];b.x=g.x+g.w/2;b.y=g.y+g.h/2;g.setSelected(isPointInRect(b,a))}}}}else{this.handlePointerEvent(o,0)}}else{if(this.enable){this.onPointerMoveRunning(b,false)}}}this.lastPosition.x=o.x;this.lastPosition.y=o.y;return true}this.lastPosition.x=o.x;this.lastPosition.y=o.y;return false};UIElement.prototype.needDrawTextTips=function(a){return this.mode===C_MODE_EDITING&&!this.children.length};UIElement.prototype.textEditable=function(a){return this.mode===C_MODE_EDITING};UIElement.prototype.isClicked=function(){if(!this.view){return false}if(this.longPressed&&this.events.onLongPress){console.log("Long Pressed, Ignore Click Event.");return false}return this.view.isClicked()};UIElement.prototype.onPointerUpNormal=function(a){if(!this.getParent()){this.setLastEventStatus(UIElement.EVENT_STATUS_NONE)}if(this.hitTestResult){var d=this.translatePoint(a);var c=this.isClicked();if(this.mode===C_MODE_EDITING){this.onPointerUpEditing(a,true)}else{if(this.enable){this.onPointerUpRunning(d,true)}}if(c&&this.enable){this.onClick(d,true)}var b=this.getPointerEventTarget();if(b){b.onPointerUp(d)}else{if(this.mode===C_MODE_EDITING){this.handlePointerEvent(a,-1)}}if(this.mode===C_MODE_EDITING){this.onPointerUpEditing(a,false)}else{if(this.dragging){this.handleDragUp(a)}else{if(this.enable){this.onPointerUpRunning(d,false)}}}if(c&&this.enable){this.onClick(d,false)}this.hitTestResult=C_HIT_TEST_NONE;if(this.longPressed){delete this.longPressed}return true}else{this.targetShape=null;if(this.mode!==C_MODE_EDITING&&this.enable){this.onPointerUpRunning(d,false);if(c){this.onClick(d,false)}}if(this.longPressed){delete this.longPressed}}return false};UIElement.prototype.onKeyDownRunning=function(code){if(!this.handleKeyDown||this.mode===C_MODE_PREVIEW){var sourceCode=this.events.onKeyDown;if(sourceCode){sourceCode="this.handleKeyDown = function(code) {\n"+sourceCode+"\n}\n";try{eval(sourceCode)}catch(e){console.log("eval sourceCode failed: "+e.message+"\n"+sourceCode)}}}if(this.handleKeyDown){try{this.handleKeyDown(code)}catch(e){console.log("this.handleKeyDown:"+e.message)}}return true};UIElement.prototype.onKeyDownEditing=function(a){};UIElement.prototype.onKeyDown=function(a){if(this.targetShape){this.targetShape.onKeyDown(a)}if(this.mode===C_MODE_EDITING){this.onKeyDownEditing(a)}else{this.onKeyDownRunning(a)}return};UIElement.prototype.onKeyUpRunning=function(code){if(!this.handleKeyUp||this.mode===C_MODE_PREVIEW){var sourceCode=this.events.onKeyUp;if(sourceCode){sourceCode="this.handleKeyUp = function(code) {\n"+sourceCode+"\n}\n";try{eval(sourceCode)}catch(e){console.log("eval sourceCode failed: "+e.message+"\n"+sourceCode)}}}if(this.handleKeyUp){try{this.handleKeyUp(code)}catch(e){console.log("this.handleKeyUp:"+e.message)}}else{if(this.isUIWindow&&code==KeyEvent.DOM_VK_BACK_BUTTON&&!wtkIsEditorActive()){console.log("Back Key Pressed On: "+this.name);if(this.isMainWindow()){var app=this.getApp();var wm=this.getWindowManager();if(this.mode===C_MODE_RUNNING){wm.systemExit();app.exitApp();console.log("Back Key Pressed, Exit App.")}}else{this.closeWindow(0);console.log("Back Key Pressed, Close Current Window.")}}}return true};UIElement.prototype.onKeyUpEditing=function(a){};UIElement.prototype.onKeyUp=function(a){if(a===KeyEvent.DOM_VK_BACK&&this.isUIWindow){this.closeWindow(0);return}if(this.targetShape){this.targetShape.onKeyUp(a)}if(this.mode===C_MODE_EDITING){this.onKeyUpEditing(a)}else{this.onKeyUpRunning(a)}return};UIElement.prototype.afterSetView=function(){return true};UIElement.prototype.setView=function(a){this.view=a;for(var b=0;b<this.children.length;b++){var c=this.children[b];c.setView(a)}this.afterSetView(a);return};UIElement.prototype.setApp=function(b){this.app=b;for(var a=0;a<this.children.length;a++){var c=this.children[a];c.setApp(b)}return};UIElement.prototype.shapeCanBeChild=function(a){return true};UIElement.prototype.onAppendedInParent=function(){};UIElement.prototype.afterChildAppended=function(a){return true};UIElement.prototype.beforeAddShapeIntoChildren=function(a){return true};UIElement.prototype.addShapeIntoChildren=function(b,e){var d={x:0,y:0,w:0,h:0};for(var c=this.children.length-1;c>=0;c--){var a=this.children[c];if(a===b){continue}if(a.isContainer&&a.visible){d.x=a.getX();d.y=a.getY();d.w=a.w;d.h=a.h;if(isPointInRect(e,d)){return a.addShape(b,true,e)}}}return false};UIElement.prototype.addChildWithJson=function(d,b){var c=d.type?d.type:d.id;var a=ShapeFactoryGet().createShape(c,C_CREATE_FOR_USER);if(a){a.fromJson(d);this.addShape(a,false,null,b)}return};UIElement.prototype.setAlwaysOnTop=function(a){this.alwaysOnTop=a;return};UIElement.prototype.addShape=function(j,a,o,h){if(!j.isUIElement){return false}if(a){j.moveDelta(-this.x,-this.y)}if(this.beforeAddShapeIntoChildren(j)&&o){var b=this.translatePoint(o);if(this.addShapeIntoChildren(j,b)){return true}j.move(b.x,b.y)}if(!this.shapeCanBeChild(j)){return false}if(a){var d={};if(j.deviceConfig){d=JSON.parse(j.deviceConfig);j.deviceConfig=null}else{d.version="5";d.platform="iphone";d.lcdDensity="xhdpi"}var e=1;var g=this.getWindow();var c=dupDeviceConfig(this.getDeviceConfig());var m=(g&&g.lcddensity)?g.lcddensity:c.lcdDensity;if(m!==d.lcdDensity||d.platform!==c.platform){if(m!="all"){c.lcdDensity=m}e=this.getSizeScale(d.lcdDensity,c.lcdDensity);j.notifyDeviceConfigChanged(d,c);if(m!==d.lcdDensity){j.scaleForDensity(e,c.lcdDensity,true)}}}j.setParent(this);j.setView(this.view);j.setApp(this.app);if(isNaN(h)||h<0){this.children.push(j)}else{this.children.insert(h,j)}if(j.isUIElement){j.setMode(this.mode,true)}for(var f=0;f<this.children.length;f++){var l=this.children[f];if(l.alwaysOnTop){this.children.remove(l);this.children.push(l);break}}this.afterChildAppended(j);j.onAppendedInParent();if(j.isCreatingElement()){this.relayout()}return true};UIElement.prototype.addShapeDirectly=function(a){if(!this.shapeCanBeChild(a)){return false}this.disableRelayout=true;a.disableRelayout=true;a.setParent(this);a.setView(this.view);a.setApp(this.app);this.children.push(a);if(a.isUIElement){a.mode=this.mode}this.afterChildAppended(a);delete a.disableRelayout;delete this.disableRelayout;return true};UIElement.prototype.addChild=function(b,a){return this.addShape(b,false,null,a)};UIElement.prototype.shapeCanBeRemove=function(a){return true};UIElement.prototype.afterChildRemoved=function(a){return true};UIElement.prototype.removeAll=function(){var c=this.children.length;for(var b=0;b<c;b++){var a=this.children[0];this.removeShape(a)}return};UIElement.prototype.removeChild=function(a){return this.removeShape(a)};UIElement.prototype.removeShape=function(a){if(!this.shapeCanBeRemove(a)){return false}if(this.targetShape===a){this.targetShape=null}this.children.remove(a);a.callOnRemoved();this.afterChildRemoved(a);if(a.getParent()===this){a.setParent(null);a.setView(null);a.setApp(null)}if(this.mode===C_MODE_EDITING){this.relayout()}return};UIElement.prototype.afterPropertyChanged=function(){if(this.parentShape){this.parentShape.sortChildren();this.sortChildren();this.parentShape.relayoutChildren()}else{this.sortChildren();this.relayout()}return};UIElement.prototype.getIndexOfChild=function(a){return this.children.indexOf(a)};UIElement.prototype.findChildByType=function(e,b){var c=0;var d=null;var a=null;var f=this.children.length;for(c=0;c<f;c++){a=this.children[c];if(a.type===e){return a}}if(b){for(c=0;c<f;c++){a=this.children[c];d=a.findChildByType(e,b);if(d){return d}}}return null};UIElement.prototype.findChildByName=function(c,b){var d=0;var e=null;var a=null;var f=this.children.length;for(d=0;d<f;d++){a=this.children[d];if(a.name===c){return a}}if(b){for(d=0;d<f;d++){a=this.children[d];e=a.findChildByName(c,b);if(e){return e}}}return null};UIElement.prototype.setValueOf=function(a,b){var c=this.findChildByName(a,true);return c?c.setValue(b):null};UIElement.prototype.getValueOf=function(a){var b=this.findChildByName(a,true);return b?b.getValue():null};UIElement.prototype.getSelectMark=function(c,a){if(this.mode!=C_MODE_EDITING){return false}var b=true;switch(c){case C_HIT_TEST_TL:a.x=0;a.y=0;break;case C_HIT_TEST_TR:a.x=this.w;a.y=0;break;case C_HIT_TEST_BL:a.x=0;a.y=this.h;break;case C_HIT_TEST_BR:a.x=this.w;a.y=this.h;break;default:b=this.getMoreSelectMark(c,a)}return b};UIElement.prototype.paintSelectingBox=function(c){if(this.hitTestResult===C_HIT_TEST_WORKAREA){var b=this.lastPosition.x-this.pointerDownPosition.x;var d=this.lastPosition.y-this.pointerDownPosition.y;if(Math.abs(b)>10&&Math.abs(d)>10){var a=this.pointerDownPosition.x-this.x;var e=this.pointerDownPosition.y-this.y;c.rect(a,e,b,d);c.strokeStyle="Gray";c.stroke()}}return true};UIElement.prototype.beforePaintChild=function(b,a){return};UIElement.prototype.afterPaintChild=function(b,a){return};UIElement.prototype.defaultPaintChildren=function(b){b.save();b.beginPath();var a=null;var e=this.children.length;var d=null;for(var c=0;c<e;c++){a=this.children[c];if(a.visible){if(a.pointerDown&&(a.selected&&this.mode===C_MODE_EDITING)||a.dragging){d=a}else{this.beforePaintChild(a,b);a.paintSelf(b);this.afterPaintChild(a,b)}}}if(d){a=d;this.beforePaintChild(a,b);a.paintSelf(b);this.afterPaintChild(a,b)}b.restore();return};UIElement.prototype.beforePaintChildren=function(a){return};UIElement.prototype.afterPaintChildren=function(a){return};UIElement.prototype.paintChildren=function(a){this.defaultPaintChildren(a);return};UIElement.prototype.paintSelfOnly=function(a){return};UIElement.prototype.drawImageAtCenter=function(q,c,j,g,m,d,l){if(c&&c.width>0){var o=c.width;var e=c.height;if(l){var b=Math.min(1,Math.min(d/e,m/o));var a=o*b;var f=e*b;var r=((m-a)>>1)+j;var p=((d-f)>>1)+g;r=Math.max(r,j);p=Math.max(p,g)}else{r=j;p=g;a=m;f=d}q.drawImage(c,0,0,o,e,r,p,a,f)}return};UIElement.prototype.drawImage=function(a){this.drawBgImage(a);this.drawFgImage(a);return};UIElement.prototype.drawFgImage=function(a){return};UIElement.prototype.getBgImage=function(){var a=null;if(this.enable){if(this.pointerDown&&!this.isClicked()){a=this.images.normal_bg}else{if(this.pointerDown){a=this.images.active_bg}else{if(this.selected){a=this.images.focused_bg}else{a=this.images.normal_bg}}}}else{a=this.images.disable_bg}if(!a||!a.getImage()){a=this.images.default_bg}if(!a||!a.getImage()){return}a=a.getImage();return a};UIElement.prototype.drawImageAt=function(b,d,g,q,o,a,l,t){if(!d){return}var j=t?t.w:d.width;var f=t?t.h:d.height;if(j<=0||f<=0){return}var p=t?t.x:0;var m=t?t.y:0;var u=0;var s=0;var r=j;var e=f;switch(g){case C_IMAGE_DISPLAY_CENTER:u=Math.floor(q+(a-j)/2);s=Math.floor(o+(l-f)/2);b.drawImage(d,p,m,r,e,u,s,r,e);break;case C_IMAGE_DISPLAY_SCALE:u=q;s=o;b.drawImage(d,p,m,j,f,u,s,a,l);break;case C_IMAGE_DISPLAY_TILE:u=q;s=o;while(s<this.h){u=q;e=Math.min(this.h-s,f);while(u<this.w){r=Math.min(this.w-u,j);b.drawImage(d,p,m,r,e,u,s,r,e);u=u+r;if(r===j){u=u-2}}s=s+e;if(e===f){s=s-2}}break;case C_IMAGE_DISPLAY_9PATCH:u=q;s=o;if(j>=a&&f>=l){b.drawImage(d,p,m,j,f,u,s,a,l)}else{drawNinePatchEx(b,d,p,m,j,f,u,s,a,l)}break;case C_IMAGE_DISPLAY_AUTO:var c=Math.min(a/j,l/f);r=j*c;e=f*c;u=Math.floor(q+(a-r)*0.5);s=Math.floor(o+(l-e)*0.5);b.drawImage(d,p,m,j,f,u,s,r,e);break;default:u=q;s=o;r=Math.min(j,this.w);e=Math.min(f,this.h);b.drawImage(d,p,m,r,e,u,s,r,e);break}return};UIElement.prototype.drawBgImage=function(a){var b=this.getBgImage();this.drawImageAt(a,b,this.images.display,0,0,this.w,this.h);return};UIElement.prototype.beforeDrawIcon=function(a){return false};UIElement.prototype.afterDrawIcon=function(a){return false};UIElement.prototype.getLockImage=function(){if(!this.aLockImage){this.aLockImage=new WtkImage("/drawapp8/images/lock.png")}if(this.aLockImage){return this.aLockImage.getImage()}return null};UIElement.prototype.prepareStyle=function(a){var b=this.style;a.lineWidth=b.lineWidth;a.strokeStyle=b.lineColor;if(b.enableGradient){a.fillStyle=b.getGradFillStyle(a,0,0,this.w,this.h)}else{if(!this.isFillColorTransparent()){a.fillStyle=b.fillColor}}a.shadowOffsetX=0;a.shadowOffsetY=0;a.shadowBlur=0;return};UIElement.prototype.resetStyle=function(a){a.shadowOffsetX=0;a.shadowOffsetY=0;a.shadowBlur=0;a.fillStyle="White";a.beginPath();return};UIElement.prototype.paintSelf=function(a){a.save();this.translate(a);a.globalAlpha=this.opacity;if(this.isIcon){this.beforeDrawIcon(a)}a.save();this.prepareStyle(a);this.paintSelfOnly(a);this.drawImage(a);if(this.drawText&&this.textType!==C_SHAPE_TEXT_NONE){this.drawText(a);this.drawTextTips(a)}if((this.hitTestResult!==C_HIT_TEST_NONE&&this.hitTestResult!==C_HIT_TEST_WORKAREA&&this.hitTestResult!==C_HIT_TEST_MM)||this.state!==C_STAT_NORMAL){this.drawSizeTips(a)}this.resetStyle(a);a.restore();a.save();this.beforePaintChildren(a);this.paintChildren(a);this.afterPaintChildren(a);a.restore();if(this.mode===C_MODE_EDITING){this.paintSelectingBox(a);this.drawSelectMarks(a)}if(this.isIcon){this.afterDrawIcon(a)}if(this.selected&&this.mode===C_MODE_EDITING){if(this.isPositionLocked){var b=this.getLockImage();if(b){a.drawImage(b,0,0)}}a.font="16pt Sans";a.textBaseline="bottom";a.textAlign="left";a.fillStyle="#202020";var d=10;if((this.parentShape&&this.parentShape.isUIWindow&&this.y<10)||this.h>400){d=24}var c=dappGetText(this.type);if(this.isUIScrollView){c=c+"(offset="+Math.floor(this.offset)+")"}a.fillText(c,0,d)}a.restore();return};UIElement.prototype.regSerializer=function(b,a){this.toJsoners.push(b);this.fromJsoners.push(a);return};UIElement.prototype.toJsonMore=function(d){if(this.isUIDevice){this.exitPreview()}for(var c=0;c<this.toJsoners.length;c++){var f=this.toJsoners[c];if(f){f.call(this,d)}}var e=this.children.length;var b=this.children;if(e){d.children=new Array();for(var c=0;c<e;c++){var a=b[c];d.children.push(a.toJson())}}return d};UIElement.prototype.childrenFromJson=function(e){if(e.children){var f=e.children.length;this.children.clear();for(var b=0;b<f;b++){var d=e.children[b];var c=d.type?d.type:d.id;var a=ShapeFactoryGet().createShape(c,C_CREATE_FOR_USER);if(a){this.addShapeDirectly(a);a.fromJson(d)}}}return};UIElement.prototype.fromJsonMore=function(b){for(var a=0;a<this.fromJsoners.length;a++){var c=this.fromJsoners[a];if(c){c.call(this,b)}}this.childrenFromJson(b);this.targetShape=null;this.selected=false;return this};UIElement.prototype.afterApplyFormat=function(){if(this.parentShape){this.parentShape.relayoutChildren()}else{this.relayout()}return};UIElement.prototype.findShapeByPoint=function(a,b){var d=this.translatePoint(a);for(var c=this.children.length;c>0;c--){var e=this.children[c-1];if(e.visible&&e.hitTest(d)){return e.findShapeByPoint(d,b)}}return this};UIElement.prototype.getChildren=function(){return this.children};UIElement.prototype.getChild=function(a){return(a<this.children.length&&a>=0)?this.children[a]:null};UIElement.prototype.canBindingData=function(){return(!this.isUIDevice&&!this.isUIScreen&&!this.isUIWindowManager&&this.children.length>0)};UIElement.prototype.onDataBindingTemplate=function(a){if(this.isUIImage){var b=this.getImageByType(C_SHAPE_IMAGE_ALL);var c=b?b.getImageSrc():"";c=c.replace(/http:\/\/www.drawapp8.net/,"");c=c.replace(/http:\/\/www.drawapp8.com/,"");a.image=c}else{if(this.value!==undefined){a.value=this.value}}if(this.text||this.isUILabel){a.text=this.text}return a};UIElement.prototype.getDataBindingTemplate=function(){var c=0;var a=null;var d={};var b=this.children;var e=this.children.length;this.onDataBindingTemplate(d);if(e>0){d.children=[];for(c=0;c<e;c++){a=b[c];if(!this.childIsBuiltin(a)){d.children.push(a.getDataBindingTemplate())}}}return d};UIElement.prototype.setUserData=function(a){this.userData=a;return};UIElement.prototype.getUserData=function(){return this.userData};UIElement.prototype.onBindData=function(b){var d=b.text;var c=b.image;var a=b.value;if(d!==undefined){this.setText(d)}if(c!==undefined){this.setImage(C_SHAPE_IMAGE_ALL,c)}if(a!==undefined){this.value=a}if(b.textColor){this.style.setTextColor(b.textColor)}if(b.fillColor){this.style.setFillColor(b.fillColor)}if(b.lineColor){this.style.setLineColor(b.lineColor)}if(b.fontSize){this.style.setFontSize(b.fontSize)}this.setUserData(b.userData);if(b.height){this.h=b.height}if(this.offset){this.offset=0}return};UIElement.prototype.moveMustBeLastItemToLast=function(){var d=null;var c=this.children;var e=this.children.length;for(var b=0;b<e;b++){var a=c[b];if(a.name==="ui-last"){d=a;c[b]=c[e-1];c[e-1]=d;break}}return};UIElement.prototype.childIsBuiltin=function(a){return false};UIElement.prototype.getTemplateChildJson=function(){if(!this.templateChildJson){var a=this.getTemplateChild();this.templateChildJson=a?a.toJson():null;if(this.templateChildJson){delete this.templateChildJson.isTemplate}else{console.log("No Template Child.")}}return this.templateChildJson};UIElement.prototype.getTemplateChild=function(){if(!this.templateChild){for(var b=0;b<this.children.length;b++){var a=this.children[b];if(a.isTemplate){this.children.remove(a);this.templateChild=a;break}}if(!this.templateChild){this.templateChild=this.getLastUserChild()}}return this.templateChild};UIElement.prototype.dupTemplateChild=function(){var a=this.getTemplateChild().dup();delete a.isTemplate;return a};UIElement.prototype.getLastUserChild=function(){var c=this.children;var d=this.children.length;if(d>0){for(var b=d-1;b>=0;b--){var a=c[b];if(!this.childIsBuiltin(a)){return a}}}return null};UIElement.prototype.countUserChildren=function(){var d=0;var c=this.children;var e=this.children.length;for(var b=0;b<e;b++){var a=this.children[b];if(!this.childIsBuiltin(a)){d=d+1}}return d};UIElement.prototype.bindData=function(c,b,d){var a=this;a.disableRelayout=true;a.doBindData(c,d);delete a.disableRelayout;a.relayoutChildren(b);console.log("bindData: done");setTimeout(function(){a.postRedraw()},500);return};UIElement.prototype.doBindData=function(e,h){var f=0;var d=0;var j=null;var l=(this.isUIList||this.isUIGrid)?this.getTemplateChildJson():null;this.onBindData(e);var a=this.children;var b=this.countUserChildren();if((b<1&&!l)||!e.children){return}var c=e.children.length;if((this.isUIList||this.isUIGrid)){if(c>b){l.y=0;for(f=b;f<c;f++){this.addChildWithJson(l)}}else{if(c<b&&h){var g=[];d=b-c;for(f=(this.children.length-1);f>=0;f--){var j=this.children[f];if(!this.childIsBuiltin(j)&&!j.isTemplate){g.push(j)}}for(var f=0;f<g.length;f++){var j=g[f];if(f===d){break}this.children.remove(j);j.setParent(null);j.setApp(null);j.setView(null)}}}b=this.children.length}else{b=this.children.length}for(f=0,d=0;d<b&f<c;d++){j=a[d];if(!this.childIsBuiltin(j)){j.doBindData(e.children[f]);f=f+1}}return};UIElement.prototype.bindDataUrl=function(e,b,d){var c={};var a=this;c.method="GET";c.url=e;c.noCache=true;c.onDone=function(f,o,g){var m=(o.status===200);if(o.status===200){var h=g;if(b){h=b(g)}try{var l=JSON.parse(h);a.bindData(l,"default",true);console.log("bindDataUrl: done")}catch(j){m=false;console.log("bindDataUrl: failed"+j.message)}}if(d){d(m)}return};httpDoRequest(c);return};var C_IMAGE_DISPLAY_CENTER=0;var C_IMAGE_DISPLAY_TILE=1;var C_IMAGE_DISPLAY_9PATCH=2;var C_IMAGE_DISPLAY_SCALE=3;var C_IMAGE_DISPLAY_AUTO=4;var C_IMAGE_DISPLAY_DEFAULT=5;var C_IMAGE_DISPLAY_NAMES=["incenter","tile","9patch","scale","auto","default"];var C_X_FIX_LEFT=0;var C_X_FIX_RIGHT=1;var C_X_SCALE=2;var C_X_CENTER_IN_PARENT=3;var C_X_LEFT_IN_PARENT=4;var C_X_RIGHT_IN_PARENT=5;var C_X_AFTER_PREV=6;var C_X_LAYOUT_NAMES=["fix_left","fix_right","scale","center_in_parent","left_in_parent","right_in_parent","after_prev"];var C_Y_FIX_TOP=0;var C_Y_FIX_BOTTOM=1;var C_Y_SCALE=2;var C_Y_MIDDLE_IN_PARENT=3;var C_Y_TOP_IN_PARENT=4;var C_Y_BOTTOM_IN_PARENT=5;var C_Y_AFTER_PREV=6;var C_Y_LAYOUT_NAMES=["fix_top","fix_bottom","scale","middle_in_parent","top_in_parent","bottom_in_parent","after_prev"];var C_WIDTH_FIX=0;var C_WIDTH_SCALE=1;var C_WIDTH_FILL_PARENT=2;var C_WIDTH_FILL_AVAILABLE=3;var C_HEIGHT_FIX=0;var C_HEIGHT_SCALE=1;var C_HEIGHT_FILL_PARENT=2;var C_HEIGHT_FILL_AVAILABLE=3;var C_SIZE_LAYOUT_NAMES=["fix","scale","fill_parent","fill_avaible"];var C_SHAPE_IMAGE_ALL="default_bg";var C_SHAPE_IMAGE_MASK="mask_fg";var C_SHAPE_IMAGE_NORMAL="normal_bg";var C_SHAPE_IMAGE_FOCUSED="focused_bg";var C_SHAPE_IMAGE_ACTIVE="active_bg";var C_SHAPE_IMAGE_DISABLE="disable_bg";var C_SHAPE_IMAGE_DISABLE_FG="disable_fg";var C_SHAPE_IMAGE_NORMAL_FG="normal_fg";var C_SHAPE_IMAGE_ACTIVE_FG="active_fg";var C_SHAPE_IMAGE_ON_FG="on_fg";var C_SHAPE_IMAGE_OFF_FG="off_fg";var C_SHAPE_IMAGE_CHECKED_FG="checked_fg";var C_SHAPE_IMAGE_UNCHECK_FG="uncheck_fg";var C_SHAPE_IMAGE_ON_FOCUSED="focused_on_bg";var C_SHAPE_IMAGE_ON_ACTIVE="active_on_bg";var C_SHAPE_IMAGE_OFF_FOCUSED="focused_off_bg";var C_SHAPE_IMAGE_OFF_ACTIVE="active_off_bg";var C_SHAPE_IMAGE_IMAGE="image";var C_SHAPE_IMAGE_NORMAL_DRAG="normal_drag";var C_SHAPE_IMAGE_DELETE_ITEM="delete_item";var C_SHAPE_ITEM_BG_NORMAL="item_bg_normal";var C_SHAPE_ITEM_BG_ACTIVE="item_bg_active";var C_SHAPE_ITEM_BG_CURRENT_NORMAL="item_bg_current_normal";var C_SHAPE_ITEM_BG_CURRENT_ACTIVE="item_bg_current_active";var C_TEXT_ALIGN_CENTER=0;var C_TEXT_ALIGN_LEFT=0;var C_TEXT_ALIGN_RIGHT=0;var C_TEXT_ALIGN_NAMES=["center","left","right"];function UIElementCreator(b){b=b?b:"ui-element";var a=[b,"UI-Element",null,1];ShapeCreator.apply(this,a);this.createShape=function(d){var c=new UIElement();return c.initUIElement(this.type)};return}UIElement.prototype.sortChildren=function(){return};UIElement.prototype.shouldShowContextMenu=function(){return this.mode===C_MODE_EDITING};UIElement.prototype.getValue=function(){return this.getText()};UIElement.prototype.setValue=function(a){this.setText(a);return};UIElement.prototype.getPositionInView=function(){var b=this.getX();var d=this.getY();var a={x:0,y:0};var c=this.parentShape;while(c!=null){b+=c.getX();d+=c.getY();if(c.isUIVScrollView){d=d-c.offset}else{if(c.isUIHScrollView){b=b-c.offset}}c=c.parentShape}a.x=b;a.y=d;return a};UIElement.prototype.getLocaleText=function(b){var a=webappGetText(b);if(!a){return b}if(!this.locale){this.locale={text:a};this.needRelayout=true}return a};UIElement.prototype.asIcon=function(){var b=0;var c=0;var a=dappGetShapeIconSize();this.isIcon=true;if(this.defWidth>a||this.defHeight>a){var d=this.defWidth/this.defHeight;if(d<1){b=d*a;c=a}else{b=a;c=a/d}}else{b=this.defWidth;c=this.defHeight}this.resize(b,c);return};UIElement.prototype.setImage=function(a,c){var b=this.images[a];if(b){b.setImageSrc(c)}else{b=new WtkImage(c)}this.images[a]=b;return};UIElement.prototype.getHtmlImageByType=function(a){var b=this.images[a];return b?b.getImage():null};UIElement.prototype.getImageByType=function(a){return this.images[a]};UIElement.prototype.getImageSrcByType=function(a){var b=this.images[a];return b?b.getImageSrc():""};UIElement.prototype.getImageTypes=function(){var c=[];for(var a in this.images){var b=this.images[a];if(a!="display"){c.push(a)}}return c};UIElement.prototype.addEventNames=function(c){if(c){for(var b=0;b<c.length;b++){var a=c[b];this.events[a]=null}}return};UIElement.prototype.removeEventNames=function(c){if(c){for(var b=0;b<c.length;b++){var a=c[b];delete this.events[a]}}return};UIElement.prototype.getEventNames=function(){var b=[];for(var a in this.events){b.push(a)}return b};UIElement.prototype.initUIElement=function(a){this.initContainerShape(a);this.enable=true;this.visible=true;this.opacity=1;this.vMargin=0;this.hMargin=0;this.xAttr=C_X_FIX_LEFT;this.yAttr=C_Y_FIX_TOP;this.widthAttr=C_WIDTH_FIX;this.heightAttr=C_HEIGHT_FIX;this.name=a;this.events={};this.images={};this.images.display=C_IMAGE_DISPLAY_9PATCH;this.addEventNames(["onClick"]);this.regSerializer(this.elementToJson,this.elementFromJson);return this};UIElement.prototype.updateLayoutParams=function(){this.xParam=1;this.yParam=1;this.widthParam=1;this.heightParam=1;var b=this.parentShape;if(!b){return}var c=b.getWidth(true);var a=b.getHeight(true);if(this.xAttr===C_X_SCALE){this.xParam=this.x/c}else{if(this.xAttr===C_X_FIX_RIGHT){this.xParam=c-(this.x+this.w)}}if(this.yAttr===C_Y_SCALE){this.yParam=this.y/a}else{if(this.yAttr===C_Y_FIX_BOTTOM){this.yParam=a-(this.y+this.h)}}if(this.widthAttr===C_WIDTH_SCALE){this.widthParam=this.w/c}if(this.heightAttr===C_HEIGHT_SCALE){this.heightParam=this.h/a}return};UIElement.prototype.elementToJson=function(d){this.updateLayoutParams();d.xAttr=this.xAttr;d.yAttr=this.yAttr;d.widthAttr=this.widthAttr;d.heightAttr=this.heightAttr;d.vMargin=this.vMargin;d.hMargin=this.hMargin;d.xParam=this.xParam;d.yParam=this.yParam;d.widthParam=this.widthParam;d.heightParam=this.heightParam;d.events=this.events;d.images={};d.enable=this.enable;d.opacity=this.opacity;if(this.value!=undefined){d.value=this.value}for(var a in this.images){var b=this.images[a];if(a==="display"){d.images[a]=b}else{var c=b.getImageSrc();c=c.replace(/http:\/\/www.drawapp8.net\//,"");c=c.replace(/http:\/\/www.drawapp8.com\//,"");if(c){d.images[a]=c}}}return d};UIElement.prototype.elementFromJson=function(c){if(c.events){for(var a in c.events){this.events[a]=c.events[a]}}for(var a in this.images){var b=this.images[a];if(a!=="display"){this.setImage(a,null)}}if(c.images){for(var a in c.images){var b=c.images[a];if(a==="display"){this.images[a]=b}else{this.setImage(a,b)}}}if(c.enable!=undefined){this.setEnable(c.enable)}if(c.opacity!=undefined){this.setOpacity(c.opacity)}return this};UIElement.prototype.setEnable=function(a){this.enable=a;return};UIElement.prototype.setOpacity=function(a){this.opacity=Math.max(0,a);this.opacity=Math.min(1,this.opacity);return};UIElement.prototype.setVisible=function(a){this.visible=a;return};UIElement.prototype.isVisible=function(){var a=this;if(!this.isValid()){return false}while(a!=null){if(!a.visible){return false}a=a.parentShape}return true};UIElement.prototype.hide=function(){this.visible=false;return};UIElement.prototype.onShowHTML=function(){return};UIElement.prototype.onHideHTML=function(){return};UIElement.prototype.showHTML=function(){var a=0;var c=this.children.length;for(a=0;a<c;a++){var b=this.children[a];b.showHTML()}this.onShowHTML();return};UIElement.prototype.hideHTML=function(){var a=0;var c=this.children.length;for(a=0;a<c;a++){var b=this.children[a];b.hideHTML()}this.onHideHTML();return};UIElement.prototype.show=function(){this.setVisible(true);return};UIElement.prototype.hide=function(){this.setVisible(false);return};UIElement.prototype.showEventDialog=function(){showUIPropertyDialog(this,this.textType,null,3);return};UIElement.prototype.showProperty=function(){showUIPropertyDialog(this,this.textType);return};UIElement.prototype.beforeRelayout=function(){};UIElement.prototype.afterRelayout=function(){};UIElement.prototype.getPrevSibling=function(){if(!this.parentShape||this.parentShape.children.length<2){return null}var a=0;for(a=0;a<this.parentShape.children.length;a++){if(this.parentShape.children[a]===this){break}}return a>0?this.parentShape.children[a-1]:null};UIElement.prototype.setAutoScaleFontSize=function(a){this.enableAutoScaleFontSize=a;return};UIElement.prototype.autoScaleFontSize=function(b){if(this.enableAutoScaleFontSize){var a=Math.round(this.style.fontSize*b);a=Math.min(a,36);a=Math.max(a,12);this.style.setFontSize(a)}return};UIElement.prototype.relayout=function(){if(this.disableRelayout){return}var c=getParentShapeOfShape(this);if(!c||!c.isUIElement){if(this.mode===C_MODE_EDITING){this.setUserMovable(true);this.setUserResizable(true)}}if(this.isUIDevice){this.setUserResizable(false)}if(!c){this.relayoutChildren();return}var t=0;var g=0;var s=0;var q=0;var m=c.getWidth(true);var j=c.getHeight(true);var b=c.getHMargin();var f=c.getVMargin();var a=this.y+this.h;var u=this.x+this.w;this.beforeRelayout();switch(this.widthAttr){case C_WIDTH_SCALE:t=m*this.widthParam;if(this.widthScaleMin&&t<this.widthScaleMin){if(this.pointerDown){this.widthScaleMin=t}else{t=this.widthScaleMin}}if(this.widthScaleMax&&t>this.widthScaleMax){if(this.pointerDown){this.widthScaleMax=t}else{t=this.widthScaleMax}}break;case C_WIDTH_FILL_PARENT:t=m;break;case C_WIDTH_FILL_AVAILABLE:break;default:t=this.w;break}switch(this.heightAttr){case C_HEIGHT_SCALE:g=j*this.heightParam;if(this.heightScaleMin&&g<this.heightScaleMin){if(this.pointerDown){this.heightScaleMin=g}else{g=this.heightScaleMin}}if(this.heightScaleMax&&g>this.heightScaleMax){if(this.pointerDown){this.heightScaleMax=g}else{g=this.heightScaleMax}}break;case C_HEIGHT_FILL_PARENT:g=j;break;case C_HEIGHT_FILL_AVAILABLE:break;default:g=this.h;break}switch(this.xAttr){case C_X_SCALE:s=m*this.xParam;break;case C_X_FIX_RIGHT:s=m-this.xParam-this.w;break;case C_X_CENTER_IN_PARENT:s=(m-t)/2+b;break;case C_X_LEFT_IN_PARENT:s=b;break;case C_X_RIGHT_IN_PARENT:s=m-t+b;break;case C_X_AFTER_PREV:var d=this.getPrevSibling();s=d?(d.x+d.w):0;break;default:s=this.x;break}switch(this.yAttr){case C_Y_SCALE:q=j*this.yParam;break;case C_Y_FIX_BOTTOM:q=j-this.yParam-this.h;break;case C_Y_MIDDLE_IN_PARENT:q=(j-g)/2+f;break;case C_Y_TOP_IN_PARENT:q=f;break;case C_Y_BOTTOM_IN_PARENT:q=j-g+f;break;case C_Y_AFTER_PREV:var d=this.getPrevSibling();q=d?(d.y+d.h):0;break;default:q=this.y;break}if(this.widthAttr===C_WIDTH_FILL_AVAILABLE||this.heightAttr===C_HEIGHT_FILL_AVAILABLE){var l=null;var r=null;this.x=s;this.y=q;for(var e=0;e<c.children.length;e++){var o=c.children[e];if(o.isUIMenu){continue}if(o.y>(this.y+30)&&this.x<(o.x+o.w)&&o.x<u){if(!l||o.y<l.y){l=o}}if(o.x>(this.x+30)&&this.y<(o.y+o.h)&&o.y<a){if(!r||o.x<r.x){r=o}}}if(this.widthAttr===C_WIDTH_FILL_AVAILABLE){if(r){t=r.x-s}else{t=m-s-c.hMargin}if(t<=0){t=this.w}}if(this.heightAttr===C_HEIGHT_FILL_AVAILABLE){if(l){g=l.y-q}else{g=j-q-c.vMargin}if(g<=0){g=this.h}}}var v=this.w;this.x=Math.round(s);this.y=Math.round(q);this.w=Math.round(t);this.h=Math.round(g);if(c.isUIElement){c.fixChildSize(this);c.fixChildPosition(this)}this.autoScaleFontSize(t/v);this.relayoutChildren();this.afterRelayout();this.setTextNeedRelayout(true);return};UIElement.prototype.getCustomProp=function(){return""};UIElement.prototype.loadCustomProp=function(a){return};UIElement.prototype.onMoved=function(){if(!this.parentShape||this.mode!=C_MODE_EDITING){return}if(this.fixedX!=null&&!isNaN(this.fixedX)){this.x=this.fixedX}if(this.fixedY!=null&&!isNaN(this.fixedY)){this.y=this.fixedY}this.updateLayoutParams();this.relayout();return};UIElement.prototype.setFixPosition=function(a,b){this.fixedX=a;this.fixedY=b;return};UIElement.prototype.beforeRelayoutChild=function(a){return true};UIElement.prototype.afterRelayoutChild=function(a){return true};UIElement.prototype.relayoutChildren=function(){if(this.disableRelayout){return}for(var a=0;a<this.children.length;a++){var b=this.children[a];if(b.widthAttr===C_WIDTH_FILL_AVAILABLE||b.heightAttr===C_HEIGHT_FILL_AVAILABLE){continue}if(this.beforeRelayoutChild(b)){b.relayout()}this.afterRelayoutChild(b)}for(var a=0;a<this.children.length;a++){var b=this.children[a];if(!(b.widthAttr===C_WIDTH_FILL_AVAILABLE||b.heightAttr===C_HEIGHT_FILL_AVAILABLE)){continue}if(this.beforeRelayoutChild(b)){b.relayout()}this.afterRelayoutChild(b)}return};UIElement.prototype.getWindowManager=function(){var a=this;while(a!=null&&!a.isUIWindowManager){a=a.parentShape}return a};UIElement.EVENT_STATUS_NONE=0;UIElement.EVENT_STATUS_HANDLED=1;UIElement.lastEventStatus=UIElement.EVENT_STATUS_NONE;UIElement.prototype.setLastEventStatus=function(a){UIElement.lastEventStatus=a;return};UIElement.prototype.getLastEventStatus=function(){return UIElement.lastEventStatus};UIElement.prototype.windowIsCurrent=function(){var c=this.getWindow();var b=this.getWindowManager();if(c&&b){var a=b.getCurrentWindow();return c===a}return false};UIElement.prototype.getDevice=function(){var a=this;while(a!=null&&!a.isUIDevice){a=a.parentShape}return a};UIElement.prototype.getDeviceConfig=function(){var a=this.getWindowManager();if(a){return a.getDeviceConfig()}return null};UIElement.prototype.isOnTopWindow=function(){var c=this.getWindow();var a=this.getWindowManager();var b=a.getCurrentFrame();if(c===b||c===b.popupWindow){return true}return false};UIElement.prototype.getWindow=function(){var a=this;while(a!=null&&!a.isUIWindow){a=a.parentShape}return a};UIElement.prototype.getPositionInWindow=function(){var b=this;var a=b.x;var c=b.y;while(b!=null&&!b.isUIWindow){b=b.parentShape;if(b.isUIWindow){break}a=a+b.x;c=c+b.y}return{x:a,y:c}};UIElement.prototype.getWindowNames=function(){var a=this.getWindowManager();if(a){return a.getWindowNames()}return[]};UIElement.prototype.openWindow=function(c,b,e,a){var d=this.getWindowManager();if(d){return d.openWindow(c,b,e,a)}return false};UIElement.prototype.closeWindow=function(a){var c=this.getWindow();var b=this.getWindowManager();if(b&&c){if(b.isWindowOpen(c)){return b.closeCurrentWindow(a)}else{console.log("Current Window Is Not Open.")}}return false};UIElement.prototype.canBeComponent=function(){return true};UIElement.prototype.makeItComponent=function(){showMakeItComponentDialog(this);return};UIElement.prototype.showBindingDataDialog=function(){showBindingDataDialog(this);return};UIElement.prototype.isCreatingElement=function(){if(this.view&&this.view.creatingShape===this){return true}return false};UIElement.prototype.onScaleForDensityDone=function(a,b){};UIElement.prototype.setNotScaleForDensity=function(a){this.notScaleForDensity=a;return};UIElement.prototype.scaleForDensity=function(a,f,e){if(!a||a===1||this.notScaleForDensity){return}if(this.widthAttr===C_WIDTH_FIX||this.widthAttr===C_WIDTH_SCALE){this.w=Math.floor(this.w*a)}if(this.heightAttr===C_HEIGHT_FIX||this.heightAttr===C_HEIGHT_SCALE){this.h=this.h*a;if(this.h<36&&(this.isUIButton||this.isUIProgressBar||this.isUIColorTile||this.isUIColorButton||this.isUIEdit||this.isUIRadioBox||this.isUICheckBox||this.isUIWaitBar||this.isUISwitch)){this.h=40}if(this.h<50&&(this.isUIToolBar||this.isUIButtonGroup)){this.h=50}if(this.hMin>this.h){this.hMin=this.h}}var c=this.isCreatingElement();if(this.yAttr===C_Y_SCALE||this.yAttr===C_Y_FIX_TOP){if(!c){this.y=Math.floor(this.y*a)}}if(this.xAttr===C_X_SCALE||this.xAttr===C_X_FIX_LEFT){if(!c){this.x=Math.floor(this.x*a)}}this.style.setFontSize(Math.floor(this.style.fontSize*a));if(this.itemHeight>40){this.itemHeight=Math.floor(this.itemHeight*a)}this.vMargin=Math.floor(this.vMargin*a);this.hMargin=Math.floor(this.hMargin*a);if(this.buttonHeight>40){this.buttonHeight=Math.floor(this.buttonHeight*a)}this.x=Math.floor(this.x);this.y=Math.floor(this.y);this.w=Math.floor(this.w);this.h=Math.floor(this.h);if(e){for(var d=0;d<this.children.length;d++){var b=this.children[d];b.scaleForDensity(a,f,true)}}if(this.isUIProgressBar){var g=this.getValue();this.setValue(0);this.setValue(g)}this.onScaleForDensityDone(a,f);return};UIElement.prototype.onDeviceConfigChanged=function(a,b){return};UIElement.prototype.fixImagePath=function(c,d){var f=c.version;var e=c.platform;var l=c.lcdDensity;var g=d.version;var b=d.platform;var m=d.lcdDensity;for(var j in this.images){var h=this.images[j];if(j==="display"){continue}var a=h.getImageSrc();if(a){a=a.replaceAll("/"+f+"/","/"+g+"/");a=a.replaceAll("/"+e+"/","/"+b+"/");a=a.replaceAll("/"+l+"/","/"+m+"/");h.setImageSrc(a)}}return};UIElement.prototype.getDensitySizeScale=function(a){switch(a){case"ldpi":return 80;case"mdpi":return 160;case"hdpi":return 240;case"xhdpi":return 350}return 160};UIElement.prototype.getSizeScale=function(b,e){var d=this.getDensitySizeScale(b);var c=this.getDensitySizeScale(e);var a=c/d;return a};UIElement.prototype.notifyDeviceConfigChanged=function(a,c){for(var b=0;b<this.children.length;b++){var d=this.children[b];d.notifyDeviceConfigChanged(a,c)}this.fixImagePath(a,c);this.onDeviceConfigChanged(a,c);return};UIElement.prototype.callOnScrollDone=function(){if(!this.enable){return false}if(!this.handleOnScrollDone||this.mode===C_MODE_PREVIEW){var sourceCode=this.events.onScrollDone;if(sourceCode){sourceCode="this.handleOnScrollDone = function() {\n"+sourceCode+"\n}\n";try{eval(sourceCode)}catch(e){console.log("eval sourceCode failed: "+e.message+"\n"+sourceCode)}}}if(this.handleOnScrollDone){try{this.handleOnScrollDone()}catch(e){console.log("this.handleOnScrollDone:"+e.message)}}return true};UIElement.prototype.callOnRemoved=function(){if(!this.enable){return false}if(!this.handleOnRemoved||this.mode===C_MODE_PREVIEW){var sourceCode=this.events.onRemoved;if(sourceCode){sourceCode="this.handleOnRemoved = function() {\n"+sourceCode+"\n}\n";try{eval(sourceCode)}catch(e){console.log("eval sourceCode failed: "+e.message+"\n"+sourceCode)}}}if(this.handleOnRemoved){try{this.handleOnRemoved()}catch(e){console.log("this.handleOnRemoved:"+e.message)}}return true};UIElement.prototype.callOnChildDragging=function(sourceChildIndex,targetChildIndex){if(!this.enable){return false}if(!this.handleOnChildDragging||this.mode===C_MODE_PREVIEW){var sourceCode=this.events.onChildDragging;if(sourceCode){sourceCode="this.handleOnChildDragging = function(sourceChildIndex, targetChildIndex) {\n"+sourceCode+"\n}\n";try{eval(sourceCode)}catch(e){console.log("eval sourceCode failed: "+e.message+"\n"+sourceCode)}}}if(this.handleOnChildDragging){try{this.handleOnChildDragging(sourceChildIndex,targetChildIndex)}catch(e){console.log("this.handleOnChildDragging:"+e.message)}}return true};UIElement.prototype.callOnChildDragged=function(sourceChildIndex,targetChildIndex){if(!this.enable){return false}if(!this.handleOnChildDragged||this.mode===C_MODE_PREVIEW){var sourceCode=this.events.onChildDragged;if(sourceCode){sourceCode="this.handleOnChildDragged = function(sourceChildIndex, targetChildIndex) {\n"+sourceCode+"\n}\n";try{eval(sourceCode)}catch(e){console.log("eval sourceCode failed: "+e.message+"\n"+sourceCode)}}}if(this.handleOnChildDragged){try{this.handleOnChildDragged(sourceChildIndex,targetChildIndex)}catch(e){console.log("this.handleOnChildDragged:"+e.message)}}return true};UIElement.prototype.callOnChanging=function(value){if(!this.enable){return false}if(!this.handleOnChanging||this.mode===C_MODE_PREVIEW){var sourceCode=this.events.onChanging;if(sourceCode){sourceCode="this.handleOnChanging = function(value) {\n"+sourceCode+"\n}\n";try{eval(sourceCode)}catch(e){console.log("eval sourceCode failed: "+e.message+"\n"+sourceCode)}}}if(this.handleOnChanging){try{this.handleOnChanging(value)}catch(e){console.log("this.handleOnChanging:"+e.message)}}return true};UIElement.prototype.callOnChanged=function(value){if(!this.enable){return false}if(!this.handleOnChanged||this.mode===C_MODE_PREVIEW){var sourceCode=this.events.onChanged;if(sourceCode){sourceCode="this.handleOnChanged = function(value) {\n"+sourceCode+"\n}\n";try{eval(sourceCode)}catch(e){console.log("eval sourceCode failed: "+e.message+"\n"+sourceCode)}}}if(this.handleOnChanged){try{this.handleOnChanged(value)}catch(e){console.log("this.handleOnChanged:"+e.message)}}return true};UIElement.prototype.callOnInit=function(){if(!this.handleOnInit||this.mode===C_MODE_PREVIEW){var sourceCode=this.events.onInit;if(sourceCode){sourceCode="this.handleOnInit = function() {\n"+sourceCode+"\n}\n";try{eval(sourceCode)}catch(e){console.log("eval sourceCode failed: "+e.message+"\n"+sourceCode)}}}if(this.handleOnInit){try{this.handleOnInit()}catch(e){console.log("this.handleOnInit:"+e.message)}}return true};UIElement.prototype.callOnChanging=function(value){if(!this.enable){return false}if(!this.handleOnChanging||this.mode===C_MODE_PREVIEW){var sourceCode=this.events.onChanging;if(sourceCode){sourceCode="this.handleOnChanging = function(value) {\n"+sourceCode+"\n}\n";try{eval(sourceCode)}catch(e){console.log("eval sourceCode failed: "+e.message+"\n"+sourceCode)}}}if(this.handleOnChanging){try{this.handleOnChanging(value)}catch(e){console.log("this.handleOnChanging:"+e.message)}}return true};UIElement.prototype.callOnFocusIn=function(){if(!this.handleOnFocusIn||this.mode===C_MODE_PREVIEW){var sourceCode=this.events.onFocusIn;if(sourceCode){sourceCode="this.handleOnFocusIn = function() {\n"+sourceCode+"\n}\n";try{eval(sourceCode)}catch(e){console.log("eval sourceCode failed: "+e.message+"\n"+sourceCode)}}}if(this.handleOnFocusIn){try{this.handleOnFocusIn()}catch(e){console.log("this.handleOnFocusIn:"+e.message)}}return true};UIElement.prototype.callOnFocusOut=function(){if(!this.handleOnFocusOut||this.mode===C_MODE_PREVIEW){var sourceCode=this.events.onFocusOut;if(sourceCode){sourceCode="this.handleOnFocusOut = function() {\n"+sourceCode+"\n}\n";try{eval(sourceCode)}catch(e){console.log("eval sourceCode failed: "+e.message+"\n"+sourceCode)}}}if(this.handleOnFocusOut){try{this.handleOnFocusOut()}catch(e){console.log("this.handleOnFocusOut:"+e.message)}}return true};UIElement.prototype.addMovementForVelocityTracker=function(){if(this.velocityTracker){var c={};c.x=this.getMoveAbsDeltaX();c.y=this.getMoveAbsDeltaY();var b=new Date();var a=b.getTime()*1000000;this.velocityTracker.addMovement(a,c);delete b}return};UIElement.prototype.animShow=function(a){if(!this.visible){animateUIElement(this,a)}return};UIElement.prototype.animHide=function(a){if(this.isVisible()){animateUIElement(this,a)}else{this.setVisible(false)}return};UIElement.prototype.atLeft=function(){this.exec(new PositionSizeAttrCommand(this,C_X_LEFT_IN_PARENT,null,null,null));return};UIElement.prototype.atRight=function(){this.exec(new PositionSizeAttrCommand(this,C_X_RIGHT_IN_PARENT,null,null,null));return};UIElement.prototype.atTop=function(){this.exec(new PositionSizeAttrCommand(this,null,C_Y_TOP_IN_PARENT,null,null));return};UIElement.prototype.atBottom=function(){this.exec(new PositionSizeAttrCommand(this,null,C_Y_BOTTOM_IN_PARENT,null,null));return};UIElement.prototype.atCenter=function(){this.exec(new PositionSizeAttrCommand(this,C_X_CENTER_IN_PARENT,null,null,null));return};UIElement.prototype.atMiddle=function(){this.exec(new PositionSizeAttrCommand(this,null,C_Y_MIDDLE_IN_PARENT,null,null));return};UIElement.prototype.saveState=function(){this.savedState={};this.savedState.json=this.toJson();return};UIElement.prototype.restoreState=function(){if(this.savedState&&this.savedState.json){this.fromJson(this.savedState.json);delete this.savedState.json}return};UIElement.prototype.isUserMovable=function(){if(this.widthAttr==C_WIDTH_FILL_PARENT&&(this.yAttr===C_Y_TOP_IN_PARENT||this.yAttr===C_Y_MIDDLE_IN_PARENT||this.yAttr===C_Y_BOTTOM_IN_PARENT)){return false}if(this.heightAttr===C_HEIGHT_FILL_PARENT&&(this.xAttr===C_X_LEFT_IN_PARENT||this.x===C_X_CENTER_IN_PARENT||this.xAttr===C_X_RIGHT_IN_PARENT)){return false}if(this.widthAttr===C_WIDTH_FILL_PARENT&&this.heightAttr===C_HEIGHT_FILL_PARENT){return false}return this.userMovable};UIElement.prototype.isUserResizable=function(){if(this.widthAttr===C_WIDTH_FILL_PARENT&&this.heightAttr===C_HEIGHT_FILL_PARENT){return false}return this.userResizable};UIElement.prototype.getEditorRect=function(){var a={};a.x=this.x;a.y=this.y;a.w=this.w;a.h=this.h;return a};function UIGroup(){return}UIGroup.prototype=new UIElement();UIGroup.prototype.isUIGroup=true;UIGroup.prototype.initUIGroup=function(d,a,c,b){this.initUIElement(d);this.roundRadius=5;this.setDefSize(a,c);this.setTextType(C_SHAPE_TEXT_NONE);this.setImage(C_SHAPE_IMAGE_ALL,b);this.images.display=C_IMAGE_DISPLAY_9PATCH;this.setCanRectSelectable(false,false);this.addEventNames(["onInit"]);return this};UIGroup.prototype.setRoundRadius=function(a){this.roundRadius=Math.max(0,a);this.roundRadius=Math.min(this.w/2,this.roundRadius);this.roundRadius=Math.min(this.h/2,this.roundRadius);return};UIGroup.prototype.getCustomProp=function(){var a=' 		<label class="description" for="border">'+dappGetText("Border")+':</label>		<input id="border"  class="element text small" type="number" maxlength="2" value="0"/> 		<label class="description" for="linewidth1">'+dappGetText("Line Width")+':</label>		<input id="linewidth1"  class="element text small" type="number" maxlength="2" value="0"/> 		<label class="description" for="roundradius">'+dappGetText("Round Radius")+':</label>		<input id="roundradius"  class="element text small" type="number" maxlength="2" value="0"/>';return a};UIGroup.prototype.loadCustomProp=function(a){var b=this;a.roundradius.value=this.roundRadius;a.roundradius.onchange=function(c){b.setRoundRadius(parseInt(this.value));return};a.border.value=this.getHMargin();a.border.onchange=function(d){var c=parseInt(this.value);b.setMargin(c,c);return};a.linewidth1.value=this.style.lineWidth;a.linewidth1.onchange=function(d){var c=parseInt(this.value);b.style.setLineWidth(c);return};return};UIGroup.prototype.shapeCanBeChild=function(a){if(a.isUIDevice||a.isUIScreen||a.isUIStatusBar||a.isUIWindow||a.isUIPageManager||a.isUIPage){return false}return true};UIGroup.prototype.onPointerUpEditing=function(a,b){if(!b){this.relayoutChildren()}return};UIGroup.prototype.paintSelfOnly=function(a){var b=this.getHtmlImageByType(C_SHAPE_IMAGE_ALL);if(!b){a.beginPath();a.lineWidth=this.style.lineWidth;a.fillStyle=this.style.fillColor;a.strokeStyle=this.style.lineColor;drawRoundRect(a,this.w,this.h,this.roundRadius);if(!this.isFillColorTransparent()){a.fillStyle=this.style.fillColor;a.fill()}if(!this.isStrokeColorTransparent()){a.stroke()}}return};function UIGroupCreator(a,d,b){var c=["ui-group","ui-group",null,1];ShapeCreator.apply(this,c);this.createShape=function(f){var e=new UIGroup();return e.initUIGroup(this.type,a,d,b)};return}function createUIGroupShape(){var a=new UIGroup();a.initUIGroup("ui-group",200,200,null);a.state=C_STAT_NORMAL;return a}function dupDeviceConfig(a){var b={};b.name=a.name;b.bg=a.bg;b.platform=a.platform;b.version=a.version;b.lcdDensity=a.lcdDensity;b.width=a.width;b.height=a.height;b.screenX=a.screenX;b.screenY=a.screenY;b.screenW=a.screenW;b.screenH=a.screenH;b.hasMenuBar=a.hasMenuBar;return b}function isDeviceConfigEqual(d,c){var b=JSON.stringify(d);var a=JSON.stringify(c);return b===a}function webappPreloadImage(b){var a=new WtkImage(b);return a}function webappLoadUserScripts(){console.log("webappLoadUserScripts");registerViewBeforeLoadListener(function(a,d){var c=d.meta;if(c&&c.extlibs){clearUserAppScript();for(var b=0;b<c.extlibs.length;b++){addUserAppScript(c.extlibs[b])}loadUserAppScripts(function(){console.log("All User App Scripts Loaded")})}});registerViewAfterLoadListener(function(a,b){});return}var gTempCanvas=null;function motkGetTempCanvas(b,a){if(!gTempCanvas){gTempCanvas=document.createElement("canvas");gTempCanvas.type="backend_canvas";gTempCanvas.width=b;gTempCanvas.height=a}if(gTempCanvas){if(gTempCanvas.width!=b){gTempCanvas.width=b}if(gTempCanvas.height!=a){gTempCanvas.height=a}}return gTempCanvas}var gApp8LocaleStrings=null;function webappGetText(b){var a=null;if(!b){return""}if(gApp8LocaleStrings){a=gApp8LocaleStrings[b]}if(!a){}return a}function webappSetLocaleStrings(a){gApp8LocaleStrings=a;return}var gDeviceConfigs=[];function dappRegisterDevice(a){gDeviceConfigs.push(dupDeviceConfig(a));return}function idrawGetDeviceConfig(a){for(var b=0;b<gDeviceConfigs.length;b++){var c=gDeviceConfigs[b];if(c.name===a){return dupDeviceConfig(c)}}return null}function idrawGetAllDeviceConfig(){return gDeviceConfigs}function idrawLoadDefaultDeviceConfigs(){var a={name:"firefox-QVGA-Emulator",bg:"/drawapp8/images/devices/device_firefoxos.png",platform:"firefox",version:"4",lcdDensity:"mdpi",width:390,height:754,screenX:34,screenY:138,screenW:320,screenH:480,hasMenuBar:false};var d={name:"android-WVGA800",bg:"/drawapp8/images/devices/device_800x480.png",platform:"android",version:"4",lcdDensity:"hdpi",width:600,height:1126,screenX:60,screenY:198,screenW:480,screenH:800,hasMenuBar:true};var b={name:"tizen-WVGA800",bg:"/drawapp8/images/devices/device_800x480.png",platform:"tizen",version:"4",lcdDensity:"hdpi",width:600,height:1126,screenX:60,screenY:198,screenW:480,screenH:800};var p={name:"tizen-WXGA720",bg:"/drawapp8/images/devices/device_1280x720.png",platform:"tizen",version:"4",lcdDensity:"xhdpi",width:860,height:1802,screenX:74,screenY:268,screenW:720,screenH:1280};var q={name:"android-WXGA720",bg:"/drawapp8/images/devices/device_1280x720.png",platform:"android",version:"4",lcdDensity:"xhdpi",width:860,height:1802,screenX:74,screenY:268,screenW:720,screenH:1280,hasMenuBar:true};var o={name:"android-WXGA800",bg:"/drawapp8/images/devices/device.png",platform:"android",version:"4",lcdDensity:"mdpi",width:1400,height:964,screenX:60,screenY:82,screenW:1280,screenH:800,hasMenuBar:true};var c={name:"android-WSVGA",bg:"/drawapp8/images/devices/device.png",platform:"android",version:"4",lcdDensity:"mdpi",width:1130,height:764,screenX:60,screenY:82,screenW:1024,screenH:600,hasMenuBar:true};var e={name:"iphone4s",bg:"/drawapp8/images/devices/device_iphone4s.png",platform:"iphone",version:"4s",lcdDensity:"xhdpi",width:760,height:1487,screenX:65,screenY:265,screenW:640,screenH:960,hasMenuBar:false};var m={name:"iphone5",bg:"/drawapp8/images/devices/device_iphone5.png",platform:"iphone",version:"5",lcdDensity:"xhdpi",width:765,height:1600,screenX:65,screenY:238,screenW:640,screenH:1136,hasMenuBar:false};var l={name:"BlackBerry Q10",bg:"/drawapp8/images/devices/device_bb_q10.jpg",platform:"blackberry",version:"10",lcdDensity:"xhdpi",width:860,height:1520,screenX:66,screenY:246,screenW:720,screenH:720,hasMenuBar:false};var h={name:"BlackBerry Z10",bg:"/drawapp8/images/devices/device_bb_z10.jpg",platform:"blackberry",version:"10",lcdDensity:"xhdpi",width:920,height:1820,screenX:72,screenY:258,screenW:768,screenH:1280,hasMenuBar:false};var g={name:"Nokia Lumia 800",bg:"/drawapp8/images/devices/device_nokia_lumia_800.jpg",platform:"winphone",version:"8",lcdDensity:"hdpi",width:620,height:1170,screenX:86,screenY:146,screenW:480,screenH:800,hasMenuBar:false};var r={name:"Nokia Lumia 920",bg:"/drawapp8/images/devices/device_nokia_lumia_920.jpg",platform:"winphone",version:"8",lcdDensity:"xhdpi",width:1050,height:1780,screenX:136,screenY:192,screenW:768,screenH:1280,hasMenuBar:false};var f={name:"iPad Mini",bg:"/drawapp8/images/devices/device_ipad_mini.jpg",platform:"iphone",version:"5",lcdDensity:"mdpi",width:876,height:1290,screenX:52,screenY:132,screenW:768,screenH:1024,hasMenuBar:false};var j={name:"iPad 4",bg:"/drawapp8/images/devices/device_ipad_4.jpg",platform:"iphone",version:"5",lcdDensity:"hdpi",width:1942,height:2542,screenX:198,screenY:238,screenW:1536,screenH:2048,hasMenuBar:false};dappRegisterDevice(e);dappRegisterDevice(m);dappRegisterDevice(d);dappRegisterDevice(q);dappRegisterDevice(o);dappRegisterDevice(c);dappRegisterDevice(b);dappRegisterDevice(p);dappRegisterDevice(a);dappRegisterDevice(l);dappRegisterDevice(h);dappRegisterDevice(g);dappRegisterDevice(r);dappRegisterDevice(f);dappRegisterDevice(j);return}idrawLoadDefaultDeviceConfigs();function MusicPlayer(){this.songs=[];this.volume=1;this.current=0;this.state=MusicPlayer.STATE_STOPPED;var b=this;function a(){if(b.isPlaying()){b.notify("time-ellapsed",b.getPercent())}setTimeout(a,1000)}setTimeout(a,1000);return}MusicPlayer.STATE_STOPPED=0;MusicPlayer.STATE_PLAYING=1;MusicPlayer.STATE_PAUSED=2;MusicPlayer.prototype.clear=function(){this.stop();this.setCurrent(0);this.songs.clear();return};MusicPlayer.prototype.setState=function(a){if(this.state!=a){this.notify("state-changed",a)}this.state=a;return};MusicPlayer.prototype.isPlaying=function(){return this.state===MusicPlayer.STATE_PLAYING};MusicPlayer.prototype.isPaused=function(){return this.state===MusicPlayer.STATE_PAUSED};MusicPlayer.prototype.isStopped=function(){return this.state===MusicPlayer.STATE_STOPPED};MusicPlayer.prototype.setEventListener=function(a){this.onNotify=a;return};MusicPlayer.prototype.notify=function(b,a){if(this.onNotify){this.notifying=true;var c=this.onNotify;try{c(b,a)}catch(d){console.log("notify error: "+d.message)}delete this.notifying}return};MusicPlayer.prototype.addSong=function(b,a){var c=this;var d=new Audio();console.log("addSong: "+this.songs.length+" "+b);d.addEventListener("ended",function(f){c.next(true);console.log("song end");return});d.addEventListener("error",function(f){c.songs.remove(d);console.log("error:"+d.src);return});d.addEventListener("playing",function(f){console.log("playing:"+d.src);return});d.addEventListener("progress",function(f){console.log("progress:"+d.src);return});if(a){d.src=b;d.load()}else{d.realSrc=b}this.songs.push(d);return};MusicPlayer.prototype.addSongs=function(c,a){for(var b=0;b<c.length;b++){this.addSong(url[b],a)}return};MusicPlayer.prototype.removeSong=function(b){var a=this.songs.indexOf(b);return this.removeSongByIndex(a)};MusicPlayer.prototype.removeSongByUrl=function(b){for(var c=0;c<this.songs.length;c++){var a=this.songs[c];if(a.src.indexOf(b)>=0){this.removeSongByIndex(c);break}}return};MusicPlayer.prototype.removeSongByIndex=function(a){if(a>=0&&a<this.songs.length){if(a===this.current){if(this.state===MusicPlayer.STATE_PLAYING){this.stop()}this.songs.remove(this.songs[a]);this.setCurrent(this.current)}else{this.songs.remove(this.songs[a])}}return};MusicPlayer.prototype.getSongsNr=function(){return this.songs.length};MusicPlayer.prototype.getSongByIndex=function(a){return(a>=0&&a<this.songs.length)?this.songs[a]:null};MusicPlayer.prototype.setCurrent=function(a){if(a>=0&&this.songs.length>0){this.current=a%this.songs.length}return};MusicPlayer.prototype.getCurrent=function(){return this.current};MusicPlayer.prototype.setVolume=function(a){this.volume=(a<=1&&a>=0)?a:1;return};MusicPlayer.prototype.getVolume=function(){return this.volume};MusicPlayer.prototype.next=function(a){var b=this.songs.length;if(b>1){this.stop();this.current=(this.current+1)%b;if(a){this.play()}}return};MusicPlayer.prototype.prev=function(a){var b=this.songs.length;if(b>1){this.stop();this.current=(this.current+b-1)%b;if(a){this.play()}}return};MusicPlayer.prototype.playOrPause=function(){if(this.isPlaying()){this.pause()}else{this.play()}return};MusicPlayer.prototype.play=function(){if(this.state===MusicPlayer.STATE_PLAYING){return}var c=this.songs.length;if(c>0&&this.current<c){var b=this.songs[this.current];b.volume=this.volume;if(!b.src&&b.realSrc){b.src=b.realSrc;b.load()}b.play();var a=this;this.setState(MusicPlayer.STATE_PLAYING)}return};MusicPlayer.prototype.stop=function(){if(this.state===MusicPlayer.STATE_STOPPED){return}var b=this.songs.length;if(b>0&&this.current<b){var a=this.songs[this.current];if(!a.paused){a.pause()}this.setState(MusicPlayer.STATE_STOPPED)}return};MusicPlayer.prototype.pause=function(){if(this.state!==MusicPlayer.STATE_PLAYING){return}var a=this.songs.length;if(a>0&&this.current<a){this.songs[this.current].pause();this.setState(MusicPlayer.STATE_PAUSED)}return};MusicPlayer.prototype.seekTo=function(a){var c=this.songs.length;if(c>0&&this.current<c){var b=this.songs[this.current];b.currentTime=b.duration*a/100}console.log("seekTo:"+a+" "+this.getPercent());return};MusicPlayer.prototype.getPercent=function(){var b=this.songs.length;if(this.state===MusicPlayer.STATE_STOPPED){return 0}if(b>0&&this.current<b){var a=this.songs[this.current];return a.currentTime*100/a.duration}return 0};MusicPlayer.prototype.getEllapsedTime=function(){var b=this.songs.length;if(this.state===MusicPlayer.STATE_STOPPED){return 0}if(b>0&&this.current<b){var a=this.songs[this.current];return a.currentTime}return 0};MusicPlayer.prototype.getDuration=function(){var b=this.songs.length;if(this.state===MusicPlayer.STATE_STOPPED){return 0}if(b>0&&this.current<b){var a=this.songs[this.current];return a.duration}return 0};var gMusicPlayer=new MusicPlayer();function getMusicPlayer(){return gMusicPlayer}function EffectsPlayer(){this.effects={}}EffectsPlayer.prototype.load=function(b,a){var c=this.effects[b];if(!c){c={};c.name=b;c.state=MusicPlayer.STATE_STOPPED}c.audio=new Audio();c.audio.addEventListener("ended",function(d){console.log("effect.audio end:"+c.name);c.state=MusicPlayer.STATE_STOPPED;return});c.audio.addEventListener("error",function(d){console.log("error:"+c.audio.src);c.state=MusicPlayer.STATE_STOPPED;return});c.audio.src=a;c.audio.load();this.effects[b]=c;return};EffectsPlayer.prototype.loadTone=function(c,f,e,d){var a={seconds:(e>100)?e/1000:e,volume:(d<1)?d*32767:d,freq:f};var b=window.makeToneDataURI(a);this.load(c,b);return};EffectsPlayer.prototype.play=function(a){var b=this.effects[a];if(b){b.state=MusicPlayer.STATE_PLAYING;b.audio.currentTime=0;b.audio.play()}return};var gEffectsPlayer=new EffectsPlayer();function getEffectsPlayer(){return gEffectsPlayer}(function(){myextend=function(){var e,r,l,m,u,s,q=arguments[0]||{},p=1,o=arguments.length,t=false;if(typeof q==="boolean"){t=q;q=arguments[1]||{};p=2}if(o===p){q=this;--p}for(;p<o;p++){if((u=arguments[p])!=null){for(m in u){e=q[m];l=u[m];if(q===l){continue}if(t&&l&&(jQuery.isPlainObject(l)||(r=jQuery.isArray(l)))){if(r){r=false;s=e&&jQuery.isArray(e)?e:[]}else{s=e&&jQuery.isPlainObject(e)?e:{}}q[m]=jQuery.extend(t,s,l)}else{if(l!==undefined){q[m]=l}}}}}return q};var f=false;if(window.webkitURL&&window.Blob){try{new Blob();f=true}catch(d){}}function a(m,l){var e=[];for(;l>0;l--){e.push(String.fromCharCode(m&255));m>>=8}return e.join("")}function j(e){return e<200?(e/200):1}var g=myextend(function(q,r,l){l=myextend({freq:440,volume:32767,sampleRate:11025,seconds:0.5,channels:1},l);var p=[];var e=l.sampleRate*l.seconds;for(var o=0;o<e;o++){for(var m=0;m<l.channels;m++){p.push(a(r(q(l.freq,l.volume,o,l.sampleRate,l.seconds,e),l.freq,l.volume,o,l.sampleRate,l.seconds,e)*j(o),2))}}return p},{style:{wave:function(o,m,l,e,p){return Math.sin((2*Math.PI)*(l/e)*o)},squareWave:function(q,o,m,l,r,e){var p=l/q;return(m%p)/p<0.5?1:-1},triangleWave:function(p,o,m,l,q,e){return Math.asin(Math.sin((2*Math.PI)*(m/l)*p))},sawtoothWave:function(q,o,m,l,r,e){var p=l/q;return -1+2*((m%p)/p)}},volume:{flat:function(l,m,e){return e*l},linearFade:function(p,q,o,m,l,r,e){return o*((e-m)/e)*p},quadraticFade:function(p,q,o,m,l,r,e){return o*((-1/Math.pow(e,2))*Math.pow(m,2)+1)*p}}});g.style.defaultVal=g.style.wave;g.volume.defaultVal=g.volume.linearFade;function c(o){o=myextend({channels:1,sampleRate:11025,bitDepth:16,seconds:0.5,volume:20000,freq:440},o);var t=["fmt ",a(16,4),a(1,2),a(o.channels,2),a(o.sampleRate,4),a(o.sampleRate*o.channels*o.bitDepth/8,4),a(o.channels*o.bitDepth/8,2),a(o.bitDepth,2)].join("");var p=g(o.styleFn||g.style.defaultVal,o.volumeFn||g.volume.defaultVal,o);var q=p.length;var s=["data",a(q*o.channels*o.bitDepth/8,4),p.join("")].join("");var l=["RIFF",a(4+(8+t.length)+(8+s.length),4),"WAVE",t,s].join("");if(f){var r=new Uint8Array(l.length);for(var m=0;m<r.length;m++){r[m]=l.charCodeAt(m)}var e=new Blob([r],{type:"audio/wav"});return window.webkitURL.createObjectURL(e)}else{return"data:audio/wav;base64,"+btoa(l)}}function b(e){return 440*Math.pow(2,(e+3)/12)}var h={sounds:{},getDataURI:function(l,e){e=e||{};e.freq=b(l);return c(e)},getCachedSound:function(s,q){var p=s,o;if(q&&typeof q=="object"){o=q;var m=[];for(var e in q){m.push(e);m.push(q[e])}m.sort();p+="-"+m.join("-")}else{if(typeof q!="undefined"){p=s+"."+p}}var r=this.sounds[p];if(!r){r=this.sounds[p]=new Audio(this.getDataURI(s,o))}return r},noteToFreq:b};window.makeToneDataURI=c;window.DataGenerator=g;window.Notes=h})();function UIDevice(){return}UIDevice.PORTRAIT=0;UIDevice.LANDSCAPE=1;UIDevice.prototype=new UIElement();UIDevice.prototype.isUIDevice=true;UIDevice.prototype.deviceToJson=function(a){a.config=this.config;return};UIDevice.prototype.deviceFromJson=function(a){if(a.config){this.config=dupDeviceConfig(a.config)}return};UIDevice.prototype.resize=function(a,b){if(this.state===C_STAT_NORMAL){this.realResize(a,b)}return};UIDevice.prototype.getDirection=function(){return(this.h>this.w)?UIDevice.PORTRAIT:UIDevice.LANDSCAPE};UIDevice.prototype.setDirection=function(g){var d=this.getDirection();if(g===d){return}var o=JSON.stringify(this.toJson());var j=this.w;var e=this.h;var l=(e-j)/2;this.x=this.x-l;this.y=this.y+l;var b=0;var a=0;var c=this.config.screenW;var m=this.config.screenH;if(d===UIDevice.PORTRAIT){this.y=100;b=this.config.screenY;a=j-(this.config.screenX+this.config.screenW)}else{this.y=0;a=this.config.screenX;b=e-(this.config.screenY+this.config.screenH)}this.w=e;this.h=j;this.config.screenX=b;this.config.screenY=a;this.config.screenW=m;this.config.screenH=c;var f=JSON.stringify(this.toJson());this.exec(new PropertyCommand(this,o,f));return};UIDevice.prototype.setName=function(a){this.name=a;this.loadConfig();return};UIDevice.prototype.beforePropertyChanged=function(){this.oldConfig=dupDeviceConfig(this.config);return};UIDevice.prototype.afterPropertyChanged=function(){if(!isDeviceConfigEqual(this.oldConfig,this.config)){this.notifyDeviceConfigChanged(this.oldConfig,this.config);this.relayout()}return};UIDevice.prototype.onDeviceConfigChanged=function(a,b){this.relayoutChildren();return};UIDevice.prototype.onModeChanged=function(){var a=this.findChildByName("button-preview",true);if(a){if(this.mode===C_MODE_EDITING){a.isPreview=false;a.setText(dappGetText("Preview"))}}return};UIDevice.prototype.loadConfig=function(){var a=idrawGetDeviceConfig(this.name);if(!a){a=idrawGetDeviceConfig("iphone5")}if(a){this.config=a}return};UIDevice.prototype.initUIDevice=function(e,a,d,b,c){this.initUIElement(e);this.setDefSize(a,d);this.setName(b);this.loadConfig();this.setTextType(C_SHAPE_TEXT_NONE);this.setImage(C_SHAPE_IMAGE_ALL,c);this.setUserResizable(false);this.rectSelectable=false;this.regSerializer(this.deviceToJson,this.deviceFromJson);return this};UIDevice.prototype.drawBgImage=function(a){var c=this.getDirection();var b=this.getHtmlImageByType(C_SHAPE_IMAGE_ALL);if(b){if(c===UIDevice.PORTRAIT){this.drawImageAt(a,b,this.images.display,0,0,this.w,this.h)}else{a.save();a.translate(this.h/2,this.h/2);a.rotate(-Math.PI/2);a.translate(-this.h/2,-this.h/2);this.drawImageAt(a,b,this.images.display,0,0,this.h,this.w);a.restore()}}return};UIDevice.prototype.getScreen=function(){for(var a=0;a<this.children.length;a++){var b=this.children[a];if(b.isUIScreen){return b}}return null};UIDevice.prototype.enterPreview=function(){var b=this.getScreen();var a=this.getWindowManager();if(!a||!b||!this.app){return}if(a.mode!=C_MODE_EDITING){return}var c=this.findChildByName("button-preview",false);if(c){c.setText(dappGetText("Edit"))}if(this.app){this.app.clearCommandHistory()}a.saveState();this.setMode(C_MODE_PREVIEW);b.setMode(C_MODE_PREVIEW,true);a.systemInit();a.showInitWindow();return};UIDevice.prototype.exitPreview=function(){var b=this.getScreen();var a=this.getWindowManager();if(!a||!b||!this.app){return}if(a.mode!=C_MODE_PREVIEW){return}var c=this.findChildByName("button-preview",false);if(c){c.setText(dappGetText("Preview"))}if(this.app){this.app.clearCommandHistory()}a.systemExit();this.setMode(C_MODE_EDITING);b.setMode(C_MODE_EDITING,true);a.restoreState();return};UIDevice.prototype.shapeCanBeChild=function(a){if(a.isUIButton){return true}return(a.isUIScreen&&this.getScreen()===null)};UIDevice.prototype.relayoutChildren=function(){if(this.disableRelayout){return}var g=0;var e=0;var l=0;var c=0;var a=this;for(var b=0;b<this.children.length;b++){var d=this.children[b];if(d.isUIScreen){g=this.config.screenX;e=this.config.screenY;l=this.config.screenW;c=this.config.screenH;d.widthAttr=C_WIDTH_FIX;d.heightAttr=C_HEIGHT_FIX;d.setPosition(g,e);d.setSize(l,c);d.relayout()}if(d.isUIButton){d.setMode(C_MODE_RUNNING);if(this.config.screenW>400){d.x=this.config.screenX;d.w=this.config.screenW/4}else{d.x=20;d.w=(this.w-40)/4}d.style.setFontSize(d.w<100?10:16);e=this.config.screenY-d.h-5;if(d.name==="button-prev"){g=d.x;d.setText(dappGetText("Prev Window"));d.onClick=function(m,o){if(o){return}var h=a.getWindowManager();if(h){h.showPrevFrame();a.updateWindowStatus()}return}}if(d.name==="button-next"){g=d.x+d.w;d.setText(dappGetText("Next Window"));d.onClick=function(m,o){if(o){return}var h=a.getWindowManager();if(h){h.showNextFrame();a.updateWindowStatus()}return}}if(d.name==="button-direction"){var f=a.getDirection();var j=(f===UIDevice.PORTRAIT)?"Landscape":"Portrait";g=d.x+d.w*2;d.setText(dappGetText(j));d.onClick=function(h,o){if(o){return}var m=a.getDirection();if(m===UIDevice.PORTRAIT){j="Portrait";a.setDirection(UIDevice.LANDSCAPE)}else{j="Landscape";a.setDirection(UIDevice.PORTRAIT)}this.setText(dappGetText(j));return}}if(d.name==="button-preview"){d.isPreview=false;g=d.x+d.w*3;d.setText(dappGetText("Preview"));d.onClick=function(h,m){if(m){return}this.isPreview=!this.isPreview;if(this.isPreview){a.enterPreview()}else{a.exitPreview()}return}}if(d.name==="button-status"){d.h=40;d.w=this.config.screenW/2;d.style.setFontSize(d.w<100?12:18);e=this.config.screenY-2*d.h-10;g=this.config.screenX+(this.config.screenW-d.w)/2;this.statusButton=d;a.updateWindowStatus()}d.setMode=function(m,h){this.mode=C_MODE_RUNNING}}d.setPosition(g,e);d.setUserMovable(false);d.setUserResizable(false)}return true};UIDevice.prototype.afterSetView=function(){this.relayoutChildren();return};UIDevice.prototype.getWindowManager=function(){var a=this.getScreen();return a?a.getWindowManager():null};UIDevice.prototype.updateWindowStatus=function(){if(this.statusButton){var b=this.getScreen();if(b){var a=b.getWindowManager();if(a){this.statusButton.setText(a.getStatusString())}}}return};UIDevice.prototype.paintSelfOnly=function(a){var b=this.getHtmlImageByType(C_SHAPE_IMAGE_ALL);if(!b){a.beginPath();drawRoundRect(a,this.w,this.h,40);a.fill();a.stroke()}return};UIDevice.prototype.onKeyDownRunning=function(a){var b=this.getWindowManager();return b.onKeyDownRunning(a)};UIDevice.prototype.onKeyUpRunning=function(a){var b=this.getWindowManager();return b.onKeyUpRunning(a)};function UIDeviceCreator(d,b,a,e){var c=["ui-device","ui-device",null,1];ShapeCreator.apply(this,c);this.createShape=function(h){var f=new UIDevice();f.initUIDevice(this.type,a,e,d+b,null);return f};return}function UIScreen(){return}UIScreen.prototype=new UIElement();UIScreen.prototype.isUIScreen=true;UIScreen.prototype.initUIScreen=function(c,a,b){this.initUIElement(c);this.setDefSize(a,b);this.setTextType(C_SHAPE_TEXT_NONE);return this};UIScreen.prototype.getWindowManager=function(){for(var a=0;a<this.children.length;a++){var b=this.children[a];if(b.isUIWindowManager){return b}}return};UIScreen.prototype.shapeCanBeChild=function(a){if(!a.isUIStatusBar&&!a.isUIWindowManager){return false}for(var b=0;b<this.children.length;b++){var c=this.children[b];if(c.type===a.type){return false}}return true};UIScreen.prototype.beforeRelayoutChild=function(a){this.relayoutChildren();return false};UIScreen.prototype.relayoutChildren=function(){if(this.disableRelayout){return}var m=0;var j=0;var e=0;var o=this.w;var g=null;var l=null;var f=null;for(var d=0;d<this.children.length;d++){var a=this.children[d];a.x=0;a.w=o;a.setUserMovable(false);a.setUserResizable(false);a.widthAttr=C_WIDTH_FILL_PARENT;if(a.type==="ui-status-bar"){l=a;if(a.h>this.h/4){a.h=this.h/4}a.move(0,0);a.relayout();continue}if(a.type==="ui-menu-bar"){var b=this.getDeviceConfig();var c=b&&b.hasMenuBar;if(c){g=a;if(a.h>this.h/4){a.h=this.h/4}a.move(0,this.h-a.h);a.relayout()}else{a.y=0;a.x=0}a.setVisible(c);a.setEnable(c);continue}if(a.isUIWindowManager){f=a;continue}}e=this.h;if(f){if(l){j=l.h;e=e-l.h}if(g){e=e-g.h}f.h=e;f.relayout()}return};function UIScreenCreator(a,c){var b=["ui-screen","ui-screen",null,1];ShapeCreator.apply(this,b);this.createShape=function(e){var d=new UIScreen();return d.initUIScreen(this.type,a,c)};return}function UIStatusBar(){return}UIStatusBar.prototype=new UIElement();UIStatusBar.prototype.isUIStatusBar=true;UIStatusBar.prototype.initUIStatusBar=function(d,a,c,b){this.initUIElement(d);this.setDefSize(a,c);this.setTextType(C_SHAPE_TEXT_NONE);this.setImage(C_SHAPE_IMAGE_ALL,b);this.images.display=C_IMAGE_DISPLAY_SCALE;this.widthAttr=C_WIDTH_FILL_PARENT;return this};UIStatusBar.prototype.shapeCanBeChild=function(a){if(a.isUILabel||a.isUIImage||a.isUIButton){return true}return false};UIStatusBar.prototype.afterChildAppended=function(a){a.yAttr=C_Y_MIDDLE_IN_PARENT;if(this.type==="ui-menu-bar"){a.hideSelectMark=true;a.textType=C_SHAPE_TEXT_NONE;this.hideSelectMark=true}return true};UIStatusBar.prototype.beforeRelayoutChild=function(a){a.yAttr=C_Y_MIDDLE_IN_PARENT;return true};function UIStatusBarCreator(e,a,d,c){var b=[e,"ui-status-bar",null,true];ShapeCreator.apply(this,b);this.createShape=function(h){var f=new UIStatusBar();return f.initUIStatusBar(this.type,a,d,c)};return}function UIWindow(){return}UIWindow.serialNo=0;UIWindow.prototype=new UIElement();UIWindow.prototype.isUIWindow=true;UIWindow.prototype.callOnGesture=function(gesture){if(!this.enable){return false}if(!this.handleOnGesture||this.mode===C_MODE_PREVIEW){var sourceCode=this.events.onGesture;if(sourceCode){sourceCode="this.handleOnGesture = function(gesture) {\n"+sourceCode+"\n}\n";try{eval(sourceCode)}catch(e){console.log("eval sourceCode failed: "+e.message+"\n"+sourceCode)}}}if(this.handleOnGesture){try{this.handleOnGesture(gesture)}catch(e){console.log("this.callOnGesture:"+e.message)}}console.log("callOnGesture: scale="+gesture.scale+" rotation="+gesture.rotation);return true};UIWindow.prototype.onGesture=function(a){if(this.mode!=C_MODE_EDITING){this.callOnGesture(a)}return};UIWindow.prototype.isMainWindow=function(){var b=this.getWindowManager();var a=b.history[0];var c=b.children[a];return c===this};UIWindow.prototype.resize=function(a,b){if(this.state===C_STAT_NORMAL){this.realResize(a,b)}return};UIWindow.prototype.initUIWindow=function(e,a,f,b,d,c){this.initUIElement(e);this.move(a,f);this.setDefSize(b,d);this.setTextType(C_SHAPE_TEXT_NONE);this.setImage(C_SHAPE_IMAGE_ALL,c);this.setName("window-"+UIWindow.serialNo++);if(!c){this.style.setFillColor("White")}this.addEventNames(["onLoad"]);this.addEventNames(["onUnload"]);this.addEventNames(["onOpen"]);this.addEventNames(["onBeforeOpen"]);this.addEventNames(["onClose"]);this.addEventNames(["onSwithToBack"]);this.addEventNames(["onSwithToFront"]);this.addEventNames(["onGesture"]);this.addEventNames(["onKeyDown"]);this.addEventNames(["onKeyUp"]);this.setAnimHint("htranslate");this.oldHitTest=this.hitTest;return this};UIWindow.prototype.setAnimHint=function(a){this.animHint=a;return true};UIWindow.prototype.shapeCanBeChild=function(a){if(a.isUIDevice||a.isUIScreen||a.isUIStatusBar||a.isUIWindow){return false}return true};UIWindow.prototype.onModeChanged=function(){if(this.mode===C_MODE_EDITING){this.popupWindow=null}return};UIWindow.prototype.removePopupWindow=function(a){if(this.popupWindow){if(this.popupWindow===a){this.popupWindow=null;this.targetShape=null;return true}return this.popupWindow.removePopupWindow(a)}return false};UIWindow.prototype.setPopupWindow=function(a){if(this.popupWindow){return this.popupWindow.setPopupWindow(a)}else{this.popupWindow=a}return true};UIWindow.prototype.getPopupWindow=function(){if(this.popupWindow){return this.popupWindow.getPopupWindow()}return this.isUIPopupWindow?this:null};UIWindow.prototype.isGrabElement=function(a){return this.grabElement===a};UIWindow.prototype.grab=function(a){this.grabElement=a;return};UIWindow.prototype.ungrab=function(a){this.grabElement=null;return};UIWindow.prototype.dispatchPointerDownToChildren=function(a){if(this.grabElement){this.grabElement.onPointerDown(a);this.setTarget(this.grabElement);return true}if(this.popupWindow){this.popupWindow.onPointerDown(a);this.setTarget(this.popupWindow);return true}return this.defaultDispatchPointerDownToChildren(a)};UIWindow.prototype.paintChildren=function(a){a.save();a.beginPath();a.rect(0,0,this.w,this.h);a.clip();a.beginPath();this.defaultPaintChildren(a);if(this.popupWindow){this.popupWindow.paintSelf(a)}a.restore();return};UIWindow.prototype.show=function(){this.setVisible(true);this.showHTML();return};UIWindow.prototype.hide=function(){this.setVisible(false);this.hideHTML();wtkHideAllInput();return};UIWindow.prototype.callOnBeforeOpen=function(initData){if(!this.handleOnBeforeOpen||this.mode===C_MODE_PREVIEW){var sourceCode=this.events.onBeforeOpen;if(sourceCode){sourceCode="this.handleOnBeforeOpen = function(initData) {\n"+sourceCode+"\n}\n";try{eval(sourceCode)}catch(e){console.log("eval sourceCode failed: "+e.message+"\n"+sourceCode)}}}this.init();if(this.handleOnBeforeOpen){this.handleOnBeforeOpen(initData)}return true};UIWindow.prototype.callOnOpen=function(initData){delete this.openPending;if(!this.handleOnOpen||this.mode===C_MODE_PREVIEW){var sourceCode=this.events.onOpen;if(sourceCode){sourceCode="this.handleOnOpen = function(initData) {\n"+sourceCode+"\n}\n";try{eval(sourceCode)}catch(e){console.log("eval sourceCode failed: "+e.message+"\n"+sourceCode)}}}if(this.handleOnOpen){this.handleOnOpen(initData)}if(this.isSplashWindow()){var win=this;var duration=win.duration?win.duration:3000;if(window.splashWinTimeID){clearTimeout(window.splashWinTimeID);delete window.splashWinTimeID}window.splashWinTimeID=setTimeout(function(){if(win.visible){win.openWindow(null,null,true)}},duration)}return true};UIWindow.prototype.callOnClose=function(){if(!this.handleOnClose||this.mode===C_MODE_PREVIEW){var sourceCode=this.events.onClose;if(sourceCode){sourceCode="this.handleOnClose = function() {\n"+sourceCode+"\n}\n";try{eval(sourceCode)}catch(e){console.log("eval sourceCode failed: "+e.message+"\n"+sourceCode)}}}if(this.handleOnClose){this.handleOnClose()}this.deinit();this.hide();return true};UIWindow.prototype.callOnSwithToBack=function(){if(!this.handleOnSwithToBack||this.mode===C_MODE_PREVIEW){var sourceCode=this.events.onSwithToBack;if(sourceCode){sourceCode="this.handleOnSwithToBack = function() {\n"+sourceCode+"\n}\n";try{eval(sourceCode)}catch(e){console.log("eval sourceCode failed: "+e.message+"\n"+sourceCode)}}}if(this.handleOnSwithToBack){this.handleOnSwithToBack()}this.hide();return true};UIWindow.prototype.callOnSwithToFront=function(){if(this.isUINormalWindow&&(this.w!=this.parentShape.w||this.h!=this.parentShape.h)){this.relayout();console.log("WindowManager Size Changed, Relayout Current Window.")}this.show();if(!this.handleOnSwithToFront||this.mode===C_MODE_PREVIEW){var sourceCode=this.events.onSwithToFront;if(sourceCode){sourceCode="this.handleOnSwithToFront = function() {\n"+sourceCode+"\n}\n";try{eval(sourceCode)}catch(e){console.log("eval sourceCode failed: "+e.message+"\n"+sourceCode)}}}if(this.handleOnSwithToFront){this.handleOnSwithToFront()}return true};UIWindow.prototype.callOnLoad=function(){if(!this.handleOnLoad||this.mode===C_MODE_PREVIEW){var sourceCode=this.events.onLoad;if(sourceCode){sourceCode="this.handleOnLoad = function() {\n"+sourceCode+"\n}\n";try{eval(sourceCode)}catch(e){console.log("eval sourceCode failed: "+e.message+"\n"+sourceCode)}}}if(this.handleOnLoad){this.handleOnLoad()}return true};UIWindow.prototype.callOnUnload=function(){if(!this.handleOnUnload||this.mode===C_MODE_PREVIEW){var sourceCode=this.events.onUnload;if(sourceCode){sourceCode="this.handleOnUnload = function() {\n"+sourceCode+"\n}\n";try{eval(sourceCode)}catch(e){console.log("eval sourceCode failed: "+e.message+"\n"+sourceCode)}}}if(this.handleOnUnload){this.handleOnUnload()}return true};UIWindow.prototype.onPointerUpRunning=function(a,b){if(b){return}if(this.isSplashWindow()){if(this.visible){this.openWindow(null,null,true)}}return};UIWindow.prototype.setCloseWhenPointerUpOutside=function(a){if(a){this.hitTest=function(b){var c=this.oldHitTest(b);if(!c){if(this.mode!=C_MODE_EDITING){c=C_HIT_TEST_MM}}return c}}else{this.hitTest=this.oldHitTest}this.closeWhenPointerUpOutside=a;return};UIWindow.prototype.isAnimationEnabled=function(){return this.animHint!=="none"};UIWindow.prototype.getAnimationName=function(a){var b="";switch(this.animHint){case"fade":b=a?"anim-fade-in":"anim-fade-out";break;case"scale":if(this.isUIDialog){b=a?"anim-scale-show-dialog":"anim-scale-hide-dialog"}else{b=a?"anim-scale-show-win":"anim-scale-hide-win"}break;case"popup":b=a?"anim-move-up":"anim-move-down";break;case"htranslate":b=a?"anim-forward":"anim-backward";break;default:if(this.isUIDialog){b=a?"anim-scale-show-dialog":"anim-scale-hide-dialog"}else{if(isAndroid()||isFirefoxMobile()){b=a?"anim-scale-show-win":"anim-scale-hide-win"}else{b=a?"anim-forward":"anim-backward"}}break}return b};UIWindow.prototype.isSplashWindow=function(){return this.isUINormalWindow&&this.windowType==="splash"};UIWindow.prototype.getSupportedAnimations=function(){var a=["none","default","scale","fade","htranslate","popup"];return a};UIWindow.prototype.paintSelfOnly=function(a){var b=this.getHtmlImageByType(C_SHAPE_IMAGE_ALL);if(!b&&this.style.fillColor!="rgba(0,0,0,0)"){a.beginPath();a.fillRect(0,0,this.w,this.h)}return};UIWindow.prototype.defaultChildrenFromJson=UIElement.prototype.childrenFromJson;UIWindow.prototype.loadChildren=function(){if(this.childrenJson){this.defaultChildrenFromJson(this.childrenJson);delete this.childrenJson;delete this.pendingLoadChildren;console.log("Now To Load Children Of "+this.name);if(this.scaleInfo){this.scaleForDensity(this.scaleInfo.sizeScale,this.scaleInfo.lcdDensity,true)}var b=this.getWindowManager();var a=b.oldConfig;var c=b.deviceConfig;if(a&&c){this.notifyDeviceConfigChanged(a,c)}}return};UIWindow.prototype.childrenFromJson=function(a){if(a.lazyLoad&&!dappIsEditorApp()){this.childrenJson=a;this.pendingLoadChildren=true;console.log("Delay To Load Children Of "+this.name)}else{delete this.pendingLoadChildren;this.defaultChildrenFromJson(a)}return};function UINormalWindow(){return}UINormalWindow.prototype=new UIWindow();UINormalWindow.prototype.isUINormalWindow=true;function UINormalWindowCreator(b){var a=["ui-window","ui-window",null,1];ShapeCreator.apply(this,a);this.createShape=function(d){var c=new UINormalWindow();c.initUIWindow(this.type,0,0,100,100,b);c.widthAttr=C_WIDTH_FILL_PARENT;c.heightAttr=C_HEIGHT_FILL_PARENT;return c};return}function UILoadingWindow(){return}UILoadingWindow.prototype=new UINormalWindow();UILoadingWindow.prototype.isUILoadingWindow=true;UILoadingWindow.prototype.getImageResources=function(){return this.imageResources?this.imageResources:""};UILoadingWindow.prototype.getAudioResources=function(){return this.audioResources?this.audioResources:""};UILoadingWindow.prototype.setImageResources=function(a){this.imageResources=a;return};UILoadingWindow.prototype.setAudioResources=function(a){this.audioResources=a;return};UILoadingWindow.prototype.loadAudioResources=function(g){var f=this;var b=this.audioResources.split("\n");for(var d=0;d<b.length;d++){var c=b[d];if(!c){continue}console.log("Loading "+c);this.resources.totalResouces++;this.resources.loadingResouces++;var e=new Audio();e.preload="auto";function a(h){f.resources.loadingResouces--;g(f.resources.totalResouces,f.resources.loadingResouces,true,this.src)}e.addEventListener("canplaythrough",a,true);e.onerror=function(h){f.resources.loadingResouces--;f.resources.failedResouces++;g(f.resources.totalResouces,f.resources.loadingResouces,false,this.src)};e.src=c;e.load();f.resources.audios.push(e)}return};UILoadingWindow.prototype.loadImageResources=function(f){var e=this;var a=this.imageResources.split("\n");for(var c=0;c<a.length;c++){var b=a[c];if(!b){continue}console.log("Loading "+b);this.resources.totalResouces++;this.resources.loadingResouces++;var d=new Image();d.onload=function(g){e.resources.loadingResouces--;f(e.resources.totalResouces,e.resources.loadingResouces,true,this.src)};d.onerror=function(g){e.resources.loadingResouces--;e.resources.failedResouces++;f(e.resources.totalResouces,e.resources.loadingResouces,false,this.src)};d.src=b;e.resources.images.push(d)}return};UILoadingWindow.prototype.loadResources=function(a){this.resources={};this.resources.audios=[];this.resources.images=[];this.resources.totalResouces=0;this.resources.failedResouces=0;this.resources.loadingResouces=0;if(this.imageResources){this.loadImageResources(a)}if(this.audioResources){this.loadAudioResources(a)}if(!this.resources.totalResouces){a(1,0,false,"")}return};function UILoadingWindowCreator(b){var a=["ui-window-loading","ui-window-loading",null,1];ShapeCreator.apply(this,a);this.createShape=function(d){var c=new UILoadingWindow();c.initUIWindow(this.type,0,0,100,100,b);c.widthAttr=C_WIDTH_FILL_PARENT;c.heightAttr=C_HEIGHT_FILL_PARENT;c.windowType="splash";c.animHint="none";c.duration=30000;return c};return}function UIPopupWindow(){return}UIPopupWindow.prototype=new UIWindow();UIPopupWindow.prototype.isUIPopupWindow=true;UIPopupWindow.prototype.onPointerUpRunning=function(a,b){if(b||!this.closeWhenPointerUpOutside){return}if(a.x<this.x||a.y<this.y||a.x>(this.x+this.w)||a.y>(this.y+this.h)){this.closeWindow(0)}return};function UIDialog(){return}UIDialog.prototype=new UIPopupWindow();UIDialog.prototype.isUIDialog=true;function UIDialogCreator(a,d,c){var b=["ui-dialog","ui-dialog",null,1];ShapeCreator.apply(this,b);this.createShape=function(f){var e=new UIDialog();e.initUIWindow(this.type,0,0,a,d,c);e.setMargin(8,8);e.xAttr=C_X_CENTER_IN_PARENT;e.yAttr=C_Y_MIDDLE_IN_PARENT;e.images.display=C_IMAGE_DISPLAY_SCALE;e.setAnimHint("scale");return e};return}function UIDialogMenu(){return}UIDialogMenu.prototype=new UIPopupWindow();UIDialogMenu.prototype.isUIDialogMenu=true;function UIDialogMenuCreator(a,d,c){var b=["ui-dialog-menu","ui-dialog-menu",null,1];ShapeCreator.apply(this,b);this.createShape=function(f){var e=new UIDialogMenu();e.initUIWindow(this.type,0,0,a,d,c);e.images.display=C_IMAGE_DISPLAY_9PATCH;return e};return}function UIPopupMenuCreator(a,d,c){var b=["ui-popup-menu","ui-popup-menu",null,1];ShapeCreator.apply(this,b);this.createShape=function(f){var e=new UIDialogMenu();e.initUIWindow(this.type,0,0,a,d,c);e.setMargin(8,8);e.xAttr=C_X_CENTER_IN_PARENT;e.yAttr=C_Y_MIDDLE_IN_PARENT;e.images.display=C_IMAGE_DISPLAY_9PATCH;e.setAnimHint("scale");return e};return}function UISystemMenuCreator(a,d,c){var b=["ui-system-menu","ui-system-menu",null,1];ShapeCreator.apply(this,b);this.createShape=function(f){var e=new UIDialogMenu();e.initUIWindow(this.type,0,0,a,d,c);e.images.display=C_IMAGE_DISPLAY_9PATCH;e.setAnimHint("popup");return e};return}function UIFrames(){return}UIFrames.prototype=new UIElement();UIFrames.prototype.isUIFrames=true;UIFrames.prototype.initUIFrames=function(a){this.initUIElement(a);this.current=0;this.setDefSize(200,200);this.setTextType(C_SHAPE_TEXT_NONE);this.widthAttr=C_WIDTH_FILL_PARENT;this.addEventNames(["onChanged"]);return this};UIFrames.prototype.getStatusString=function(){var c="";var a=this.current+1;var d=this.children.length;var b=this.getCurrentFrame();a=a<=d?a:d;if(b&&b.name){c=b.name+"("+a+"/"+d+")"}else{c=a+"/"+d}return c};UIFrames.prototype.getCurrent=function(){return this.current};UIFrames.prototype.setCurrent=function(a){if(this.current!==a){this.current=a;if(this.mode!=C_MODE_EDITING){this.callOnChanged(a)}}return};UIFrames.prototype.getCurrentFrame=function(){if(this.children.length<1){return null}if(this.current<0||!this.current){this.current=0}if(this.current>=this.children.length){this.current=this.children.length-1}return this.children[this.current]};UIFrames.prototype.fixChildSize=function(a){return};UIFrames.prototype.fixChildPosition=function(e){var a=e.x;var d=e.y;var c=e.h;var b=e.w;if(e.freePosition){return}if(e.widthAttr===C_WIDTH_FILL_PARENT){a=this.getHMargin();b=this.getWidth(true)}if(e.heightAttr===C_HEIGHT_FILL_PARENT){d=this.getVMargin();c=this.getHeight(true)}e.x=a;e.y=d;e.h=c;e.w=b;return};UIFrames.prototype.setTarget=function(a){for(var b=0;b<this.children.length;b++){var c=this.children[b];if(!a){c.setSelected(false);continue}if(c!=a&&c!=a.popupWindow){c.setSelected(false)}}this.targetShape=a;this.selected=!a;return};UIFrames.prototype.dispatchPointerDownToChildren=function(a){var b=null;if(this.children.length<1){return false}b=this.getCurrentFrame();if(b.onPointerDown(a)){this.setTarget(b);return true}return false};UIFrames.prototype.addShapeIntoChildren=function(a,b){var c=null;if(this.children.length<1){return false}c=this.getCurrentFrame();return c.addShape(a,true,b)};UIFrames.prototype.paintChildren=function(a){var b=this.getCurrentFrame();if(b){a.save();a.beginPath();b.paintSelf(a);a.restore()}return};UIFrames.prototype.showNextFrame=function(){this.showFrame(this.current+1);this.relayoutChildren();return};UIFrames.prototype.getFrame=function(a){if(a<0||a>=this.children.length){return null}return this.children[a]};UIFrames.prototype.getFrameIndex=function(b){for(var a=0;a<this.children.length;a++){if(b===this.children[a]){return a}}return -1};UIFrames.prototype.getFrames=function(){return this.children.length};UIFrames.prototype.showPrevFrame=function(){this.showFrame(this.current-1);this.relayoutChildren();return};UIFrames.prototype.showFrame=function(a){this.current=(a+this.children.length)%this.children.length;var b=this.children[this.current];if(b){b.show(true)}return};UIFrames.prototype.shapeCanBeChild=function(a){return true};UIFrames.prototype.initDefaultNameForChild=function(a){};UIFrames.prototype.relayoutChildren=function(){for(var b=0;b<this.children.length;b++){var a=this.children[b];a.x=0;a.y=0;a.w=this.w;a.h=this.h;a.widthAttr=C_WIDTH_FILL_PARENT;a.heightAttr=C_HEIGHT_FILL_PARENT;a.relayoutChildren()}return};UIFrames.prototype.afterChildAppended=function(a){this.current=this.children.length-1;if(!a.name){this.initDefaultNameForChild(a)}return};UIFrames.prototype.onChildRemoved=function(a){return};UIFrames.prototype.afterChildRemoved=function(a){if(this.children.length===0){this.current=0}else{if(this.current>=this.children.length){this.current--}}this.onChildRemoved(a);return};UIFrames.prototype.findShapeByPoint=function(a,b){var c=this.translatePoint(a);var d=this.getCurrentFrame();if(d){return d.findShapeByPoint(c,b)}return this};function UIFramesCreator(){var a=["ui-frames","ui-frames",null,0];ShapeCreator.apply(this,a);this.createShape=function(c){var b=new UIFrames();return b.initUIFrames(this.type)};return}function UIWindowManager(){}UIWindowManager.prototype=new UIFrames();UIWindowManager.prototype.isUIWindowManager=true;UIWindowManager.prototype.initUIWindowManager=function(a){this.initUIFrames(a);this.history=new Array();return this};UIWindowManager.prototype.beforeAddShapeIntoChildren=function(a){return !a.isUIWindow};UIWindowManager.prototype.initDefaultNameForChild=function(a){a.name="newwin";return};UIWindowManager.prototype.getSplashWindow=function(){for(var a=0;a<this.children.length;a++){var b=this.children[a];if(b.isUINormalWindow&&b.windowType==="splash"){return b}}return null};UIWindowManager.prototype.getMainWindow=function(){for(var a=0;a<this.children.length;a++){var b=this.children[a];if(b.isUINormalWindow&&b.windowType==="main"){return b}}for(var a=0;a<this.children.length;a++){var b=this.children[a];if(b.isUINormalWindow){return b}}return null};UIWindowManager.prototype.getWindowNames=function(){var c=[];for(var a=0;a<this.children.length;a++){var b=this.children[a];c.push(b.name)}return c};UIWindowManager.prototype.showInitWindow=function(){var a=null;if(this.children.length===0){return false}this.history.clear();var b=getQueryParameter("startwin");if(b){a=this.findBestFitWindowByName(b)}if(!a){a=this.getSplashWindow();if(!a){a=this.getMainWindow()}}if(a){this.targetShape=a;console.log("showInitWindow: set targetShape:"+this.targetShape.name);a.relayout();index=this.getFrameIndex(a);this.showFrame(index);a.callOnBeforeOpen();a.callOnOpen();this.history.push(index);this.postRedraw()}return true};UIWindowManager.prototype.callOnLoad=function(){for(var a=0;a<this.children.length;a++){var b=this.children[a];b.callOnLoad()}return true};UIWindowManager.prototype.callOnUnload=function(){for(var a=0;a<this.children.length;a++){var b=this.children[a];b.callOnUnload()}return true};UIWindowManager.prototype.systemInit=function(){this.callOnLoad();console.log("systemInit");return};UIWindowManager.prototype.systemExit=function(){var a=this.getCurrentWindow();if(a){a.hide()}this.callOnUnload();console.log("systemExit");return};function preparseBackendCanvas(b,e){var a=b.w;var d=b.h;var f=BackendCanvasGet(2*a,d);var c=f.getContext("2d");c.clearRect(0,0,2*a,d);c.save();b.paint(c);c.translate(a,0);e.paint(c);c.restore();return f}UIWindowManager.prototype.findBestFitWindowByName=function(d){var h=null;var b=null;var o=null;var l=null;var j=null;var f=this.getDeviceConfig();var e=d;var c=d+"-"+f.platform;var a=c+"-"+f.lcdDensity;var m=a+"-"+f.screenW+"x"+f.screenH;for(var g=0;g<this.children.length;g++){h=this.children[g];switch(h.name){case e:if(f.lcdDensity===h.lcddensity){l=h}else{if(!h.lcddensity||h.lcddensity==="all"){b=h}else{if(!b){b=h}}}break;case c:o=h;break;case a:l=h;break;case m:j=h;break;default:break}}if(j){console.log("Find "+j.name);return j}if(l){console.log("Find "+l.name);return l}if(o){console.log("Find "+o.name);return o}if(b){console.log("Find "+b.name);return b}return null};UIWindowManager.prototype.openWindow=function(d,c,e,a){var b=null;if(d){b=this.findBestFitWindowByName(d)}else{b=this.getMainWindow()}if(b.pendingLoadChildren){b.loadChildren()}if(this.isWindowOpen(b)){console.log(b.name+" is open already.");return false}if(!b){console.log("Not findBestFitWindowByName window "+d);return false}if(b.openPending){b.openPending=false;console.log("This window is already open:"+d);return false}if(!b.isUIWindow){console.log("It is not a window: "+d);return false}b.openPending=true;b.initData=a;b.onWindowClose=c;b.callOnBeforeOpen(a);this.targetShape=b;console.log("openWindow: set targetShape:"+this.targetShape.name);if(b.isUINormalWindow){return this.openNormalWindow(b,e)}else{return this.openPopupWindow(b,e)}};UIWindowManager.prototype.openPopupWindow=function(a,g){if(g){this.closeCurrentWindow(0,true)}var e=this;var b=this.getCurrentFrame();a.relayout();function c(){a.show();b.setPopupWindow(a);e.postRedraw();a.callOnOpen(a.initData)}if(b){b.callOnSwithToBack();if(a.isAnimationEnabled()){var f=this.getPositionInScreen();var d=animationCreate(a.getAnimationName(true));var h=preparseBackendCanvas(b,a);d.setScale(this.getRealScale());d.prepare(f.x,f.y,this.w,this.h,h,c);d.setRectOfFront(a.x,a.y,a.w,a.h);d.run()}else{c()}}return true};UIWindowManager.prototype.openNormalWindow=function(d,f){if(f){this.closeCurrentWindow(0,true)}var j=this;var e=0;d.relayout();var a=this.getCurrentFrame();function g(){e=j.getFrameIndex(d);j.showFrame(e);j.history.push(e);a=j.getCurrentFrame();j.postRedraw();d.callOnOpen(d.initData);return}if(a){a.callOnSwithToBack();if(d.isAnimationEnabled()){var b=this.getPositionInScreen();var c=animationCreate(d.getAnimationName(true));var h=preparseBackendCanvas(a,d);c.setScale(this.getRealScale());c.prepare(b.x,b.y,this.w,this.h,h,g);c.run()}else{setTimeout(g,10)}}else{g()}return true};UIWindowManager.prototype.getCurrentWindow=function(){var a=this.getCurrentFrame();var b=a.getPopupWindow();return b?b:a};UIWindowManager.prototype.closeCurrentWindow=function(a,c){var b=this.getCurrentWindow();if(!b||b.mode===C_MODE_EDITING||!b.visible){return false}if(b.isUINormalWindow){return this.closeCurrentNormalWindow(b,a,c)}else{return this.closeCurrentPopupWindow(b,a,c)}};UIWindowManager.prototype.closeCurrentPopupWindow=function(h,c,m){var l=this;var a=this.getCurrentFrame();if(a){function f(){a.removePopupWindow(h);l.postRedraw()}if(h.onWindowClose){try{h.onWindowClose(c)}catch(g){console.log("onWindowClose: "+g.message)}}h.callOnClose();a.callOnSwithToFront();if(h.isAnimationEnabled()&&!m){var b=this.getPositionInScreen();var d=animationCreate(h.getAnimationName(false));a.removePopupWindow(h);var j=preparseBackendCanvas(a,h);a.setPopupWindow(h);d.setScale(this.getRealScale());d.prepare(b.x,b.y,this.w,this.h,j,f);d.setRectOfFront(h.x,h.y,h.w,h.h);d.run()}else{f()}}return true};UIWindowManager.prototype.closeCurrentNormalWindow=function(a,d,m){var l=this;var g=null;if(this.history.length<2){return false}lastWinIndex=this.history[this.history.length-2];g=this.getFrame(lastWinIndex);function c(){l.showFrame(lastWinIndex);l.postRedraw();return}if(a.onWindowClose){try{a.onWindowClose(d)}catch(h){console.log("onWindowClose: "+h.message)}}a.callOnClose();l.history.remove(l.current);g.callOnSwithToFront();if(m){c()}else{if(a.isAnimationEnabled()){var b=this.getPositionInScreen();var f=animationCreate(a.getAnimationName(false));var j=preparseBackendCanvas(g,a);f.setScale(this.getRealScale());f.prepare(b.x,b.y,this.w,this.h,j,c);f.run()}else{setTimeout(c,10)}}return};UIWindowManager.prototype.isWindowOpen=function(d){for(var c=0;c<this.history.length;c++){var b=this.history[c];var a=this.children[b];if(a===d||a.popupWindow===d){return true}}return false};UIWindowManager.prototype.shapeCanBeChild=function(a){return a.isUIWindow};UIWindowManager.prototype.afterChildAppended=function(a){if(this.mode!==C_MODE_RUNNING&&!this.isUnpacking){var b=this.getFrameIndex(a);this.showFrame(b);var c=this.getDevice();if(c){c.updateWindowStatus()}}return};UIWindowManager.prototype.onChildRemoved=function(a){var b=this.getDevice();if(b){b.updateWindowStatus()}return};UIWindowManager.prototype.scaleForDensity=function(a,e,d){if(!a||a===1){return}for(var c=0;c<this.children.length;c++){var b=this.children[c];if(!b.lcddensity||b.lcddensity==="all"){if(b.pendingLoadChildren){b.scaleInfo={};b.scaleInfo.sizeScale=a;b.scaleInfo.lcdDensity=e}else{b.scaleForDensity(a,e,d)}}}return};UIWindowManager.prototype.setDeviceConfig=function(c){var b=this.deviceConfig;this.oldConfig=this.deviceConfig;this.deviceConfig=c;if(b&&c){if(b.lcdDensity!=c.lcdDensity){var a=this.getSizeScale(b.lcdDensity,c.lcdDensity);this.scaleForDensity(a,c.lcdDensity,true)}this.notifyDeviceConfigChanged(b,c);console.log("call this.notifyDeviceConfigChanged: "+this.type)}console.log("setDeviceConfig platform:"+c.platform);return};UIWindowManager.prototype.getDeviceConfig=function(){if(this.deviceConfig){return this.deviceConfig}else{var a=this.getDevice();if(a){return a.config}}return null};UIWindowManager.prototype.afterPaintChildren=function(b){var a=this.getCreatingShape();if(a&&a.isUIElement&&this.showHignlight){if(!a.isUIDevice){b.beginPath();b.rect(0,0,this.w,this.h);b.lineWidth=5;b.strokeStyle="Orange";b.stroke()}if(a.isUIWindow){b.textBaseline="middle";b.textAlign="center";b.fillStyle="Gray";b.font="24pt Sans";b.fillText(dappGetText("Please Drag Window To Here."),this.w/2,this.h*0.2)}}this.showHignlight=!this.showHignlight;return};UIWindowManager.prototype.paintSelfOnly=function(a){if(this.mode===C_MODE_EDITING){a.fillStyle="white";a.fillRect(0,0,this.w,this.h)}return};UIWindowManager.prototype.relayoutChildren=function(){var b=this.getCurrentFrame();if(this.mode===C_MODE_EDITING){for(var c=0;c<this.children.length;c++){var a=this.children[c];a.relayout()}}else{if(b){b.relayout();var d=b.getPopupWindow();if(d){d.relayout()}}}return};UIWindowManager.prototype.onKeyDown=function(a){var b=this.getCurrentWindow();return b.onKeyDown(a)};UIWindowManager.prototype.onKeyUp=function(a){var b=this.getCurrentWindow();return b.onKeyUp(a)};function UIWindowManagerCreator(){var a=["ui-window-manager","ui-window-manager",null,1];ShapeCreator.apply(this,a);this.createShape=function(c){var b=new UIWindowManager();return b.initUIWindowManager(this.type)};return}function UILabel(){return}UILabel.prototype=new UIElement();UILabel.prototype.isUILabel=true;UILabel.prototype.initUILabel=function(c,a,b){this.initUIElement(c);this.setText(a);this.setDefSize(200,200);this.setMargin(5,5);this.setTextType(C_SHAPE_TEXT_TEXTAREA);this.setImage(C_SHAPE_IMAGE_ALL,b);this.autoAdjustHeight=false;this.addEventNames(["onChanged"]);return this};UILabel.prototype.setAutoAdjustHeight=function(a){this.autoAdjustHeight=a;return true};UILabel.prototype.shapeCanBeChild=function(a){return false};UILabel.prototype.ANIM_OLD_OUT=1;UILabel.prototype.ANIM_NEW_IN=3;UILabel.prototype.animSetText=function(g,e){var c=this;var f=300;var a=this.getHeight(true);var d=(new Date()).getTime();this.animateYOffset=0;this.animateState=this.ANIM_OLD_OUT;function b(){var h=new Date();var j=(h.getTime()-d)/f;switch(c.animateState){case c.ANIM_OLD_OUT:if(j<1){c.animateYOffset=-j*a}else{c.setText(g);c.animateState=c.ANIM_NEW_IN;d=h.getTime()}break;case c.ANIM_NEW_IN:if(j<1){c.animateYOffset=a*(1-j)}else{delete d;delete c.animateState;delete c.animateYOffset}default:break}if(c.animateState){setTimeout(b,10)}delete h;c.postRedraw()}b();return};UILabel.prototype.beforeDrawText=function(b){if(!this.animateState){return}var a=this.getWidth(true);var c=this.getHeight(true);b.save();b.rect(this.hMargin,this.vMargin,a,c);b.clip();b.translate(0,this.animateYOffset);return};UILabel.prototype.afterDrawText=function(a){if(!this.animateState){return}a.restore();return};UILabel.prototype.setText=function(a){this.text=this.toText(a);this.textNeedRelayout=true;this.callOnChanged(a);return};UILabel.prototype.drawText=function(b){this.layoutText(b);if(this.autoAdjustHeight){var c=this.getTextHeight();this.h=c+this.vMargin*2+this.style.fontSize}this.beforeDrawText(b);var a=Math.PI*(this.textAngle?this.textAngle:0)/180;if(a){b.save();b.translate(this.w/2,this.h/2);b.rotate(a);b.translate(-this.w/2,-this.h/2);b.textBaseline="middle";b.textAlign="center";b.font=this.style.getFont();b.fillStyle=this.style.textColor;b.fillText(this.text,this.w/2,this.h/2);b.restore()}else{this.defaultDrawText(b)}this.afterDrawText(b);return};function UILabelCreator(){var a=["ui-label","ui-label",null,1];ShapeCreator.apply(this,a);this.createShape=function(c){var b=new UILabel();return b.initUILabel(this.type,dappGetText("Text"),null)};return}function UIShortcut(){return}UIShortcut.prototype=new UIElement();UIShortcut.prototype.isUIShortcut=true;UIShortcut.prototype.initUIShortcut=function(a){this.initUIElement(a);this.setText("#ABCDEFGHIJKLMNOPQRSTUVYWXYZ");this.setDefSize(200,200);this.setMargin(5,5);this.setTextType(C_SHAPE_TEXT_INPUT);this.setImage(C_SHAPE_IMAGE_ALL,null);this.addEventNames(["onChanged"]);return this};UIShortcut.prototype.shapeCanBeChild=function(a){return false};UIShortcut.prototype.drawText=function(b){var l=this.text;var d=l.length;if(!d){return}b.textBaseline="middle";b.textAlign="center";b.font=this.style.getFont();var h=this.w>>1;var g=this.vMargin;var j=this.getWidth(true);var m=this.getHeight(true)/d;var a=m>>1;if(this.pointerDown){b.fillStyle=this.style.fillColor;b.fillRect(0,0,this.w,this.h)}for(var e=0;e<l.length;e++){var f=l[e];b.fillStyle=(this.currentItem===e)?this.style.lineColor:this.style.textColor;b.fillText(f,h,g+a);g+=m}return};UIShortcut.prototype.findItemByPoint=function(a){var e=this.text;var d=this.vMargin;var c=this.getHeight(true);var b=Math.floor(e.length*(a.y-d)/c);return b};UIShortcut.prototype.changeItemByPoint=function(a){var d=this.text;var b=this.findItemByPoint(a);if(b>=0&&b<d.length){var c=d[b];if(this.currentItem!=b){this.callOnChanged(c);this.currentItem=b}}return};UIShortcut.prototype.setValue=function(b){var a=this.text.indexOf(b);if(a>=0){if(this.currentItem!=a){this.currentItem=a;this.callOnChanged(b)}}return};UIShortcut.prototype.getValue=function(){if(this.text&&this.currentItem>=0&&this.currentItem<this.text.length){return this.text[this.currentItem]}else{return""}};UIShortcut.prototype.onPointerDownRunning=function(a,b){if(b||!this.text){return}this.changeItemByPoint(a);return};UIShortcut.prototype.onPointerMoveRunning=function(a,b){if(b||!this.text){return}if(this.pointerDown){this.changeItemByPoint(a)}return};function UIShortcutCreator(){var a=["ui-shortcut","ui-shortcut",null,1];ShapeCreator.apply(this,a);this.createShape=function(c){var b=new UIShortcut();return b.initUIShortcut(this.type)};return}function UITips(){return}UITips.prototype=new UIElement();UITips.prototype.isUITips=true;UITips.prototype.initUITips=function(b,a){this.initUIElement(b);this.roundRadius=8;this.setDefSize(200,200);this.setClickable(true);this.setTextType(C_SHAPE_TEXT_TEXTAREA);this.setImage(C_SHAPE_IMAGE_ALL,a);this.pointerDirection=UITips.BOTTOM;this.pointerOffset=1;this.pointer={x:0,y:0};this.setMargin(20,20);this.setSizeLimit(80,80);this.autoAdjustHeight=true;return this};UITips.TOP=0;UITips.LEFT=1;UITips.RIGHT=2;UITips.BOTTOM=3;UITips.prototype.getPointer=function(){var b=0;var d=0;var a=this.roundRadius+this.hMargin*2;var c=this.roundRadius+this.vMargin*2;switch(this.pointerDirection){case UITips.TOP:case UITips.BOTTOM:b=this.pointerOffset*this.w;b=Math.max(b,a);b=Math.min(b,this.w-a);d=this.pointerDirection===UITips.TOP?0:this.h;break;case UITips.LEFT:case UITips.RIGHT:d=this.pointerOffset*this.h;d=Math.max(d,c);d=Math.min(d,this.h-c);b=this.pointerDirection===UITips.LEFT?0:this.w;break}return{x:b,y:d}};UITips.prototype.getMoreSelectMark=function(b,a){if(b===C_HIT_TEST_HANDLE){a.x=this.pointer.x;a.y=this.pointer.y;return true}return false};UITips.prototype.moveHandle=function(d,c){var b=0.5*this.w;var e=0.5*this.h;var h=this.roundRadius+this.hMargin;var f=this.pointer;f.x+=d;f.y+=c;var a=f.x>=0?f.x:0;a=a<this.w?a:this.w;var g=f.y>=0?f.y:0;g=g<this.h?g:this.h;if(f.y<h){this.pointerOffset=(a/this.w);this.pointerDirection=UITips.TOP}else{if(f.y<(this.h-h)){this.pointerOffset=(g/this.h);this.pointerDirection=f.x<b?UITips.LEFT:UITips.RIGHT}else{this.pointerOffset=(a/this.w);this.pointerDirection=UITips.BOTTOM}}this.pointer=f;return};UITips.prototype.setAutoAdjustHeight=function(a){this.autoAdjustHeight=a;return true};UITips.prototype.setClickable=function(a){this.clickable=a;return};UITips.prototype.drawPath=function(f){var m=this.hMargin/2;var j=this.vMargin/2;var q=this.getWidth(true)+this.hMargin;var g=this.getHeight(true)+this.vMargin;var b=this.getPointer();var p=b.x;var l=b.y;var s=this.hMargin*0.75;var a=this.roundRadius;var d=m+q-a;var c=j+g-a;var e=m+q;var o=j+g;if(l<=j&&(p>m&&p<e)){l=0;if(p<(m+a+s)){p=m+a+s}f.moveTo(p-s,j);f.lineTo(p,l);f.lineTo(p+s,j);f.lineTo(d,j);f.arc(d,j+a,a,1.5*Math.PI,2*Math.PI,false);f.lineTo(e,c);f.arc(d,c,a,0,0.5*Math.PI,false);f.lineTo(m+a,o);f.arc(m+a,c,a,0.5*Math.PI,Math.PI,false);f.lineTo(m,a+j);f.arc(m+a,j+a,a,Math.PI,1.5*Math.PI,false);f.lineTo(p-s,j)}else{if(l>j&&(p>m&&p<e)){l=this.h;if(p<(m+a+s)){p=m+a+s}f.moveTo(m+a,j);f.arc(d,j+a,a,1.5*Math.PI,2*Math.PI,false);f.lineTo(e,c);f.arc(d,c,a,0,0.5*Math.PI,false);f.lineTo(p+s,o);f.lineTo(p,l);f.lineTo(p-s,o);f.arc(m+a,c,a,0.5*Math.PI,Math.PI,false);f.lineTo(m,a+j);f.arc(m+a,j+a,a,Math.PI,1.5*Math.PI,false)}else{if(p<=m&&(l>j&&l<o)){p=0;if(l<(j+a+s)){l=j+a+s}f.moveTo(m+a,j);f.arc(d,j+a,a,1.5*Math.PI,2*Math.PI,false);f.lineTo(e,c);f.arc(d,c,a,0,0.5*Math.PI,false);f.lineTo(m+a,o);f.arc(m+a,c,a,0.5*Math.PI,Math.PI,false);f.lineTo(m,l+s);f.lineTo(p,l);f.lineTo(m,l-s);f.lineTo(m,a+j);f.arc(m+a,j+a,a,Math.PI,1.5*Math.PI,false)}else{if(p>m&&(l>j&&l<o)){p=this.w;if(l<(j+a+s)){l=j+a+s}f.moveTo(m+a,j);f.arc(d,j+a,a,1.5*Math.PI,2*Math.PI,false);f.lineTo(e,l-s);f.lineTo(p,l);f.lineTo(e,l+s);f.lineTo(e,c);f.arc(d,c,a,0,0.5*Math.PI,false);f.lineTo(m+a,o);f.arc(m+a,c,a,0.5*Math.PI,Math.PI,false);f.lineTo(m,a+j);f.arc(m+a,j+a,a,Math.PI,1.5*Math.PI,false)}}}}return};UITips.prototype.paintSelfOnlyAndroid=function(a){a.beginPath();this.drawPath(a);a.fill();a.lineWidth=(this.pointerDown&&this.clickable)?6:3;a.strokeStyle="Gray";a.stroke();a.lineWidth=1;a.strokeStyle=this.style.lineColor;a.stroke();return};UITips.prototype.paintSelfOnly=function(a){if(this.autoAdjustHeight&&(!this.children||!this.children.length)){var d=this.getTextHeight();this.h=d+this.vMargin*2+this.style.fontSize}var c=this.getHtmlImageByType(C_SHAPE_IMAGE_ALL);if(!c){if(isAndroid()){return this.paintSelfOnlyAndroid(a)}var b=this.style;a.shadowColor=b.shadow.color;a.shadowOffsetX=b.shadow.x;a.shadowOffsetY=b.shadow.y;a.shadowBlur=b.shadow.blur;a.beginPath();this.drawPath(a);a.fill();if(this.pointerDown&&this.clickable){a.lineWidth=3;a.shadowBlur=2*a.shadowBlur}else{a.lineWidth=2;a.shadowBlur=0}a.stroke();a.shadowBlur=0}return};UITips.prototype.shapeCanBeChild=function(a){return a.isUIButton||a.isUIGroup||a.isUILabel||a.isUIImage};function UITipsCreator(){var a=["ui-tips","ui-tips",null,1];ShapeCreator.apply(this,a);this.createShape=function(c){var b=new UITips();return b.initUITips(this.type,null)};return}function UICanvas(){return}UICanvas.prototype=new UIElement();UICanvas.prototype.isUICanvas=true;UICanvas.prototype.initUICanvas=function(e,a,d){this.initUIElement(e);this.setDefSize(a,d);this.refreshInterval=50;this.setTextType(C_SHAPE_TEXT_NONE);this.addEventNames(["onPaint","onTimer","onPointerDown","onPointerMove","onPointerUp","onKeyDown","onKeyUp","onLongPress","onDoubleClick"]);var b=this;function c(){if(b.needRedraw()){var f=b.view;if(f){f.postRedraw()}b.callTimerHandler()}if(b.isValid()){setTimeout(c,b.refreshInterval)}}setTimeout(c,b.refreshInterval);this.setImage("option_image_0",null);this.setImage("option_image_1",null);this.setImage("option_image_2",null);this.setImage("option_image_3",null);this.setImage("option_image_4",null);this.setImage("option_image_5",null);this.setImage("option_image_6",null);this.setImage("option_image_7",null);this.setImage("option_image_8",null);this.setImage("option_image_9",null);this.setImage("option_image_10",null);this.setImage("option_image_11",null);this.setImage("option_image_12",null);this.setImage("option_image_13",null);this.setImage("option_image_14",null);return this};UICanvas.prototype.paintChildren=function(a){a.save();a.beginPath();a.rect(0,0,this.w,this.h);a.clip();a.beginPath();this.defaultPaintChildren(a);a.restore();return};UICanvas.prototype.needRedraw=function(){if(!this.isVisible()){return false}if(!this.windowIsCurrent()){return false}if(this.mode===C_MODE_EDITING){return false}return true};UICanvas.prototype.shapeCanBeChild=function(a){return a.isUIImage||a.isUIButton||a.isUIGroup||a.isUILabel};UICanvas.prototype.paintSelfOnly=function(a){a.save();a.rect(0,0,this.w,this.h);a.clip();a.beginPath();if(this.mode===C_MODE_EDITING){a.fillRect(0,0,this.w,this.h)}this.callPaintHandler(a);a.restore();return};function UICanvasCreator(a,c){var b=["ui-canvas","ui-canvas",null,1];ShapeCreator.apply(this,b);this.createShape=function(e){var d=new UICanvas();return d.initUICanvas(this.type,a,c)};return}function UIHtml(){return}UIHtml.prototype=new UIElement();UIHtml.prototype.isUIHtml=true;UIHtml.prototype.initUIHtml=function(c,a,b){this.initUIElement(c);this.setDefSize(a,b);this.setTextType(C_SHAPE_TEXT_NONE);return this};UIHtml.prototype.shapeCanBeChild=function(a){return false};UIHtml.prototype.paintSelfOnly=function(a){if(!this.htmlVisible){a.beginPath();a.fillRect(0,0,this.w,this.h)}return};UIHtml.prototype.setVisible=function(a){if(this.visible!=a){if(a){this.onShowHTML()}else{this.onHideHTML()}this.visible=a}return};UIHtml.prototype.showHTMLElement=function(){var d=this.element;if(d){var f=this.getRealScale();var e=this.getPositionInView();var a=e.x*f+this.view.rect.x;var g=e.y*f+this.view.rect.y;var b=this.w*f;var c=this.h*f;d.style.position="absolute";d.style.left=a+"px";d.style.top=g+"px";d.style.width=b+"px";d.style.height=c+"px";d.style.visibility="visible";this.htmlVisible=true}return};UIHtml.prototype.createHTMLElement=function(a){var b=null;if(!this.element){b=document.createElement(a);b.id=this.type+this.name;document.body.appendChild(b);this.element=b}return this.element};UIHtml.prototype.onShowHTML=function(){this.createHTMLElement("div");this.element.innerHTML=this.text;this.element.style.overflow="hidden";this.element.style.zIndex=5;if(this.mode!=C_MODE_EDITING){this.showHTMLElement()}return};UIHtml.prototype.onHideHTML=function(){this.htmlVisible=false;if(this.element){this.element.style.visibility="hidden"}return};function UIHtmlCreator(a,c){var b=["ui-html","ui-html",null,1];ShapeCreator.apply(this,b);this.createShape=function(e){var d=new UIHtml();return d.initUIHtml(this.type,a,c)};return}function UISelect(){return}UISelect.prototype=new UIElement();UISelect.prototype.isUISelect=true;UISelect.prototype.initUISelect=function(c,a,b){this.initUIElement(c);this.offset=0;this.options=[];this.visibleItems=5;this.setDefSize(a,b);this.addEventNames(["onInit","onChanged"]);this.setTextType(C_SHAPE_TEXT_NONE);this.setCanRectSelectable(false,true);this.setImage(C_SHAPE_IMAGE_ALL,null);this.images.display=C_IMAGE_DISPLAY_9PATCH;return this};UISelect.prototype.getItemHeight=function(){return Math.round(this.h/this.visibleItems)};UISelect.prototype.getVisibleItems=function(){return this.visibleItems};UISelect.prototype.setVisibleItems=function(a){if(a<=3){this.visibleItems=3}else{this.visibleItems=5}};UISelect.prototype.setHighlightTextColor=function(a){this.highlightTextColor=a;return};UISelect.prototype.getHighlightTextColor=function(){return this.highlightTextColor?this.highlightTextColor:this.style.textColor};UISelect.prototype.scrollTo=function(j){var b=this.getItemHeight();j=Math.round(j/b)*b;var h=this;var c=500;var f=this.offset;var d=j-f;var a=(new Date()).getTime();var g=new DecelerateInterpolator();this.animating=true;function e(){var m=new Date();var l=(m.getTime()-a)/c;var o=g.get(l);if(l<1){h.setOffset(Math.floor(f+o*d));setTimeout(e,10)}else{h.setOffset(f+d,true);delete a;delete g;delete h.animating}delete m}setTimeout(function(){e()},10);return};UISelect.prototype.setOffset=function(c,a){this.offset=c;this.postRedraw();if(a){var b=this.getValue();this.callOnChanged(b)}return};UISelect.prototype.onPointerDownRunning=function(a,b){if(b||this.animating){return}if(!this.velocityTracker){this.velocityTracker=new VelocityTracker()}this.velocityTracker.clear();this.saveOffset=this.offset;return true};UISelect.prototype.onPointerMoveRunning=function(a,c){if(c||this.animating){return}this.addMovementForVelocityTracker();var b=this.getMoveAbsDeltaY();this.setOffset(this.saveOffset+b);return};UISelect.prototype.getMaxOffset=function(){var a=Math.floor(0.5*this.visibleItems);return a*this.getItemHeight()};UISelect.prototype.getMinOffset=function(){var b=this.getItemHeight();var a=Math.round(0.5*this.visibleItems);if(this.options.length<=a){return 0}else{return -(this.options.length-a)*b}};UISelect.prototype.handleClicked=function(b){var j=this.getItemHeight();var a=Math.floor((this.h/2-this.offset)/j);var e=Math.floor((b.y-this.offset)/j);var h=(e-a)*j;var g=this.offset-h;var f=this.getMinOffset();var c=this.getMaxOffset();if(g<f){g=f}if(g>c){g=c}this.scrollTo(g);return};UISelect.prototype.onPointerUpRunning=function(a,f){if(f||this.animating){return}var b=this.getMoveAbsDeltaY();var d=this.velocityTracker.getVelocity().y;var h=b+d/2;if(Math.abs(h)<10){this.setOffset(this.saveOffset);this.handleClicked(a);return}var e=this.getMinOffset();var c=this.getMaxOffset();var g=this.saveOffset+b+d;if(g<e){g=e}if(g>c){g=c}this.scrollTo(g);return};UISelect.prototype.shapeCanBeChild=function(a){return false};UISelect.prototype.setText=function(a){a=this.toText(a);if(a){this.options=a.split("\n");this.options.remove("")}else{this.options=[]}this.text=a;return};UISelect.prototype.drawImage=function(d){var g=0;var z=0;var l=this.w;var v=this.h;var j=l>>1;var e=0;var f=this.offset;var s=this.getItemHeight();d.beginPath();d.rect(0,0,l,v);d.clip();var q=this.options.length;var c=this.getBgImage()!=null;this.drawBgImage(d);if(!c){d.lineWidth=3;d.strokeStyle=this.style.lineColor;d.beginPath();g=(this.visibleItems>>1)*s;d.moveTo(5,g);d.lineTo(l-10,g);d.moveTo(5,g+s);d.lineTo(l-10,g+s);d.stroke()}this.style.setTextB(false);this.style.setFontSize(Math.floor(s*0.5));var a=this.style.getFont();var A=this.style.textColor;this.style.setTextB(true);this.style.setFontSize(Math.floor(s*0.6));var t=this.style.getFont();var p=this.getHighlightTextColor();d.textAlign="center";d.textBaseline="middle";d.font=this.style.getFont();d.fillStyle=this.style.textColor;d.translate(0,f);var r=Math.floor((0.5*v-f)/s);for(var u=0;u<q;u++){var o=this.options[u];g=u*s;z=g+s;e=-f;if(z<e&&g<e){continue}e=-(f-v);if(z>e&&g>e){continue}if(r==u){d.font=t;d.fillStyle=p}else{d.font=a;d.fillStyle=A}g=g+(s>>1);d.fillText(o,j,g,l)}return};UISelect.prototype.getValue=function(){var b=this.h;var d=this.offset;var e=this.getItemHeight();var a=Math.floor((0.5*b-d)/e);var c=(a<this.options.length)?this.options[a]:"";return c};UISelect.prototype.setValueByIndex=function(b,a){var c=b;var e=this.getItemHeight();if(c>=0){var d=-(c-(this.getVisibleItems()>>1))*e;if(a){this.scrollTo(d)}else{this.setOffset(d,true)}}return};UISelect.prototype.setValue=function(c,a){var b=this.options.indexOf(c);this.setValueByIndex(b,a);return};function UISelectCreator(a,c){var b=["ui-select","ui-select",null,1];ShapeCreator.apply(this,b);this.createShape=function(e){var d=new UISelect();return d.initUISelect(this.type,a,c)};return}function UIEdit(){return}UIEdit.prototype=new UIElement();UIEdit.prototype.isUIEdit=true;UIEdit.prototype.initUIEdit=function(g,a,f,e,j,c,d,b){this.initUIElement(g);this.setDefSize(a,f);this.setText(c);this.leftMargin=e;this.rightMargin=j;this.setSizeLimit(60,30,1000,80);this.setTextType(C_SHAPE_TEXT_INPUT);this.setImage(C_SHAPE_IMAGE_ALL,d);this.setImage(C_SHAPE_IMAGE_FOCUSED,b);this.setMargin(5,5);this.setInputType("text");this.addEventNames(["onChanged","onChanging","onFocusIn","onFocusOut"]);this.setTextAlignV("middle");this.setTextAlignH("left");return this};UIEdit.prototype.shapeCanBeChild=function(a){if(a.isUIButton){return true}return false};UIEdit.prototype.textEditable=function(a){return true};UIEdit.prototype.getLocaleText=function(c){if(c===" "){return c}if(this.inputType==="password"&&c&&c===this.text){var b="";var d=c.length;for(var a=0;a<d;a++){b=b+"*"}return b}else{return c}};UIEdit.prototype.drawText=function(b){var e=this.h>>1;var a=this.leftMargin;var d=this.getLocaleText(this.text);var c=this.w-a-this.rightMargin;if(!d||this.editing){return}b.save();b.font=this.style.getFont();b.fillStyle=this.style.textColor;b.beginPath();b.rect(0,0,this.w-this.rightMargin,this.h);b.clip();b.textAlign="left";b.textBaseline="middle";b.fillText(d,a,e);b.restore();return};UIEdit.prototype.onClick=function(a,b){if(b){return}if(this.mode!==C_MODE_EDITING){this.editText()}return};UIEdit.prototype.getWidth=function(b){var a=this.w;if(b){a=a-this.leftMargin-this.rightMargin}return a};UIEdit.prototype.setText=function(b,a){if(this.text!=b){this.text=this.toText(b);if(!a){this.callOnChanged(b)}this.textNeedRelayout=true}return};UIEdit.prototype.getEditorRect=function(){var a=this.getPositionInView();var d=this.getRealScale();var c=this.view.rect.x;var b=this.view.rect.y;var g=a.y*d+b;var j=(a.x+this.leftMargin)*d+c;var l=this.getWidth(true)*d;var e=this.getHeight()*d;var f={};f.x=j;f.y=g;f.w=Math.max(60,l);f.h=e;return f};UIEdit.prototype.editText=function(a){if(this.textType&&this.textEditable(a)){var b=this;var d=null;var g=this.getText();var e=this.getEditorRect();var f=this.getRealScale();var c=this.inputType?this.inputType:"text";b.editing=true;d=wtkShowInput(e.x,e.y,e.w,e.h);d.setInputType(c);d.removeBorder();d.setFontSize(this.style.fontSize*f);d.setText(g);d.shape=b;d.element.onchange=function(){if(g!==this.value){b.setText(this.value);b.callOnChanged(b.text);b.postRedraw()}else{b.text=g}d.element.onchange=null;d.hide();b.callOnFocusOut();b.editing=false;return};d.element.onkeyup=function(h){b.callOnChanging(this.value)};this.callOnFocusIn()}return};function UIEditCreator(a,f,e,g,d,b){var c=["ui-edit","ui-edit",null,1];ShapeCreator.apply(this,c);this.createShape=function(j){var h=new UIEdit();return h.initUIEdit(this.type,a,f,e,g,dappGetText("Edit"),d,b)};return}function UIMLEdit(){return}UIMLEdit.prototype=new UIElement();UIMLEdit.prototype.isUIMLEdit=true;UIMLEdit.prototype.initUIMLEdit=function(f,a,e,g,c,d,b){this.initUIElement(f);this.setDefSize(a,e);this.setText(c);this.setTextType(C_SHAPE_TEXT_TEXTAREA);this.setImage(C_SHAPE_IMAGE_ALL,d);this.setImage(C_SHAPE_IMAGE_FOCUSED,b);this.setMargin(g,g);this.addEventNames(["onChanged","onFocusIn","onFocusOut"]);this.setTextAlignV("top");this.setTextAlignH("left");return this};UIMLEdit.prototype.shapeCanBeChild=function(a){return false};UIMLEdit.prototype.textEditable=function(a){return true};UIMLEdit.prototype.onClick=function(a,b){if(b){return}if(this.mode!==C_MODE_EDITING){this.editText()}return};UIMLEdit.prototype.getEditorRect=function(){var a=this.getPositionInView();var d=this.getRealScale();var c=this.view.rect.x;var b=this.view.rect.y;var j=(a.x+this.hMargin)*d+c;var g=(a.y+this.vMargin)*d+b;var l=this.getWidth(true)*d;var e=this.getHeight(true)*d;var f={};f.x=j;f.y=g;f.w=Math.max(60,l);f.h=e;return f};UIMLEdit.prototype.editText=function(a){if(this.textType&&this.textEditable(a)){var b=this;var d=null;var e=this.getEditorRect();var g=this.getRealScale();var c=this.inputType?this.inputType:"text";var f=this.getText();b.editing=true;d=wtkShowTextArea(e.x,e.y,e.w,e.h);d.setInputType(c);d.removeBorder();d.setFontSize(this.style.fontSize*g);d.setText(f);d.shape=b;d.element.onchange=function(){if(f!==this.value){b.setText(this.value,cookie);b.callOnChanged(b.text);b.postRedraw()}else{b.setText(f)}d.element.onchange=null;d.hide();b.callOnFocusOut();b.editing=false;return};this.callOnFocusIn()}return};function UIMLEditCreator(a,e,f,d,b){var c=["ui-mledit","ui-mledit",null,1];ShapeCreator.apply(this,c);this.createShape=function(j){var h=new UIMLEdit();return h.initUIMLEdit(this.type,a,e,f,dappGetText("Edit"),d,b)};return}function UIImage(){return}UIImage.prototype=new UIElement();UIImage.prototype.isUIImage=true;UIImage.prototype.initUIImage=function(d,a,c,b){this.initUIElement(d);this.setDefSize(a,c);this.setTextType(C_SHAPE_TEXT_NONE);this.images.display=C_IMAGE_DISPLAY_CENTER;this.setImage(C_SHAPE_IMAGE_ALL,b);this.setImage("option_image_0",null);this.setImage("option_image_1",null);this.setImage("option_image_2",null);this.setImage("option_image_3",null);this.setImage("option_image_4",null);this.setImage("option_image_5",null);this.setImage("option_image_6",null);this.setImage("option_image_7",null);this.setImage("option_image_8",null);this.setImage("option_image_9",null);this.setImage("option_image_10",null);this.setImage("option_image_11",null);this.setImage("option_image_12",null);this.setImage("option_image_13",null);this.setImage("option_image_14",null);this.clickable=false;this.imageRotation=0;this.clickedStyleParam=0.8;this.clickedStyleType=UIImage.CLICKED_STYLE_OPACITY;return this};UIImage.prototype.getImageSrcRect=function(){if(this.imageSrcW&&this.imageSrcH){var a={};a.x=this.imageSrcX;a.y=this.imageSrcY;a.w=this.imageSrcW;a.h=this.imageSrcH;return a}else{return null}};UIImage.prototype.setImageSrcRect=function(a,d,b,c){this.imageSrcX=a;this.imageSrcY=d;this.imageSrcW=b;this.imageSrcH=c;return};UIImage.prototype.setValue=function(a){this.setImage(C_SHAPE_IMAGE_ALL,a);return};UIImage.prototype.setImageSrc=function(a){this.setImage(C_SHAPE_IMAGE_ALL,a);return};UIImage.prototype.getImageSrc=function(a){return this.getImageSrcByType(a?a:C_SHAPE_IMAGE_ALL)};UIImage.prototype.getHtmlImage=function(){return this.getHtmlImageByType(C_SHAPE_IMAGE_ALL)};UIImage.prototype.setBorderStyle=function(b,a){this.borderColor=b;this.borderWidth=a;return};UIImage.prototype.setClickedStyle=function(a,b){this.clickedStyleType=a;this.clickedStyleParam=b;return};UIImage.CLICKED_STYLE_SHADOW=1;UIImage.CLICKED_STYLE_OPACITY=2;UIImage.CLICKED_STYLE_RECT_BG=3;UIImage.CLICKED_STYLE_RECT_BORDER=4;UIImage.prototype.drawImage=function(a){a.save();if(this.imageRotation){a.translate(this.w/2,this.h/2);a.rotate(this.imageRotation);a.translate(-this.w/2,-this.h/2)}var b=a.globalAlpha;if(this.clickable&&this.pointerDown){switch(this.clickedStyleType){case UIImage.CLICKED_STYLE_OPACITY:a.globalAlpha=b*this.clickedStyleParam;break;case UIImage.CLICKED_STYLE_RECT_BG:a.fillStyle=this.style.fillColor;a.fillRect(0,0,this.w,this.h);break;case UIImage.CLICKED_STYLE_SHADOW:a.shadowColor=this.style.lineColor;a.shadowBlur=isNaN(this.clickedStyleParam)?25:this.clickedStyleParam;a.shadowOffsetX=0;a.shadowOffsetY=0;break}}var d=this.getBgImage();var c=this.getImageSrcRect();this.drawImageAt(a,d,this.images.display,0,0,this.w,this.h,c);if(this.clickable&&this.pointerDown){switch(this.clickedStyleType){case UIImage.CLICKED_STYLE_OPACITY:a.globalAlpha=b;break;case UIImage.CLICKED_STYLE_RECT_BORDER:a.strokeStyle=this.style.lineColor;a.lineWidth=isNaN(this.clickedStyleParam)?1:this.clickedStyleParam;a.rect(0,0,this.w,this.h);a.stroke();break;case UIImage.CLICKED_STYLE_SHADOW:a.shadowColor=null;a.shadowBlur=0;a.shadowOffsetX=0;a.shadowOffsetY=0;break}}else{if(this.borderColor&&this.borderWidth){a.strokeStyle=this.borderColor;a.lineWidth=this.borderWidth;a.rect(0,0,this.w,this.h);a.stroke()}}a.restore();return};UIImage.prototype.setClickable=function(a){this.clickable=a;return};UIImage.prototype.setImageRotation=function(a){this.imageRotation=a;return};UIImage.prototype.shapeCanBeChild=function(a){return a.isUILabel||a.isUIButton||a.isUIGroup||a.isUIEdit||a.isUILayout};function UIImageCreator(e,a,d,b){var c=[e,"ui-image",null,1];ShapeCreator.apply(this,c);this.createShape=function(h){var f=new UIImage();return f.initUIImage(this.type,a,d,b)};return}function UIStaticMap(){return}UIStaticMap.prototype=new UIImage();UIStaticMap.prototype.isUIStaticMap=true;UIStaticMap.prototype.initUIStaticMap=function(a){this.initUIImage(a,200,200,null);return this};UIStaticMap.prototype.setMapProvider=function(a){this.mapProvider=a;return};UIStaticMap.prototype.setMapType=function(a){this.mapType=a;return};UIStaticMap.prototype.setMapZoom=function(a){this.mapZoom=a;return};UIStaticMap.prototype.setMapCenter=function(a){this.mapCenter=a;return};UIStaticMap.prototype.setMapWidth=function(a){this.mapWidth=a;return};UIStaticMap.prototype.setMapHeight=function(a){this.mapHeight=a;return};UIStaticMap.prototype.setMapExtraParams=function(a){this.mapEtraParams=a;return};UIStaticMap.prototype.getMapType=function(){return this.mapType?this.mapType:""};UIStaticMap.prototype.getMapProvider=function(){return this.mapProvider?this.mapProvider:"google"};UIStaticMap.prototype.getMapZoom=function(){return this.mapZoom?this.mapZoom:10};UIStaticMap.prototype.getMapWidth=function(){return this.mapWidth?this.mapWidth:600};UIStaticMap.prototype.getMapHeight=function(){return this.mapHeight?this.mapHeight:600};UIStaticMap.prototype.getMapCenter=function(){if(!this.mapCenter&&this.currentLocation){return this.currentLocation}else{return this.mapCenter?this.mapCenter:"China"}};UIStaticMap.prototype.getMapExtraParams=function(){return this.mapEtraParams?this.mapEtraParams:""};UIStaticMap.prototype.getMapURL=function(){var a="";if(this.mapProvider==="baidu"){a="http://api.map.baidu.com/staticimage?center="+this.getMapCenter()+"&width="+this.getMapWidth()+"&height="+this.getMapHeight()+"&zoom="+this.getMapZoom()+this.getMapExtraParams()}else{if(this.mapProvider==="google"){a="http://maps.googleapis.com/maps/api/staticmap?center="+this.getMapCenter()+"&size="+this.getMapWidth()+"x"+this.getMapHeight()+"&zoom="+this.getMapZoom()+"&maptype="+this.getMapType()+"&sensor=true"+this.getMapExtraParams()}}console.log("Map URL:"+a);return a};UIStaticMap.prototype.updateMap=function(){var a=this.getMapURL();this.setImageSrc(a);return};UIStaticMap.prototype.onInit=function(){var b=this;function a(c){b.currentLocation=c.coords.latitude+","+c.coords.longitude;b.updateMap();return}if(navigator.geolocation){navigator.geolocation.getCurrentPosition(a)}this.updateMap();return};UIStaticMap.prototype.drawImage=function(a){this.drawBgImage(a);return};function UIStaticMapCreator(){var a=["ui-static-map","ui-static-map",null,1];ShapeCreator.apply(this,a);this.createShape=function(c){var b=new UIStaticMap();return b.initUIStaticMap(this.type)};return}function UIWaitBar(){return}UIWaitBar.TILES=8;UIWaitBar.prototype=new UIElement();UIWaitBar.prototype.isUIWaitBar=true;UIWaitBar.prototype.initUIWaitBar=function(d,a,c,e,b){this.initUIElement(d);this.offset=0;this.running=false;this.setDefSize(a,c);this.setTextType(C_SHAPE_TEXT_NONE);this.images.display=b;this.setImage(C_SHAPE_IMAGE_ALL,e);return this};UIWaitBar.prototype.shapeCanBeChild=function(a){return false};UIWaitBar.prototype.isRunning=function(){return this.running};UIWaitBar.prototype.start=function(){this.running=true;return};UIWaitBar.prototype.stop=function(){this.running=false;return};UIWaitBar.prototype.drawBgImage=function(b){var d=this.getHtmlImageByType(C_SHAPE_IMAGE_ALL);if(!d){return}var l=d.width;var f=d.height;var g=f/UIWaitBar.TILES;var c=this.offset*g;var o=0;var m=c;var p=l;var e=f;var a=this.w;var j=this.h;var r=(a-l)/2;var q=(j-g)/2;if(l<100&&f<100){m=0;q=(j-f)/2;b.save();b.translate(this.w/2,this.h/2);b.rotate(0.1*Math.PI*this.offset);b.translate(-this.w/2,-this.h/2);b.drawImage(d,o,m,l,f,r,q,l,f);b.restore()}else{switch(this.images.display){case C_IMAGE_DISPLAY_CENTER:b.drawImage(d,o,m,p,g,r,q,p,g);break;default:b.drawImage(d,o,m,p,g,0,q,a,g);break}}return};UIWaitBar.prototype.needRedraw=function(){if(!this.isVisible()||!this.running){return false}if(!this.windowIsCurrent()){return false}if(this.mode===C_MODE_EDITING){return false}return true};function UIWaitBarCreator(e,a,d,f,c){var b=[e,"ui-wait-bar",null,1];ShapeCreator.apply(this,b);this.createShape=function(j){var h=new UIWaitBar();if(e!==C_CREATE_FOR_ICON){setInterval(function(){if(h.needRedraw()){h.offset=(h.offset+1);if(h.type==="ui-wait-bar"){h.offset=h.offset%UIWaitBar.TILES}h.redrawSelf()}},80)}return h.initUIWaitBar(this.type,a,d,f,c)};return}function UIButton(){return}UIButton.prototype=new UIElement();UIButton.prototype.isUIButton=true;UIButton.prototype.initUIButton=function(c,a,b){this.initUIElement(c);this.setMargin(5,5);this.setDefSize(a,b);this.setSizeLimit(50,50);this.setAutoScaleFontSize(true);this.setTextType(C_SHAPE_TEXT_INPUT);this.images.display=C_IMAGE_DISPLAY_9PATCH;this.setImage(C_SHAPE_IMAGE_FOCUSED,null);this.setImage(C_SHAPE_IMAGE_ACTIVE,null);this.setImage(C_SHAPE_IMAGE_NORMAL,null);this.setImage(C_SHAPE_IMAGE_DISABLE,null);return this};UIButton.prototype.shapeCanBeChild=function(a){if(a.isUILabel||a.isUIImage){return true}return false};UIButton.prototype.paintSelfOnly=function(a){if(this.pointerDown){var b=this.getHtmlImageByType(C_SHAPE_IMAGE_ACTIVE);if(!b){a.fillRect(0,0,this.w,this.h)}}return};function UIButtonCreator(a,c){var b=["ui-button","ui-button",null,1];ShapeCreator.apply(this,b);this.createShape=function(e){var d=new UIButton();return d.initUIButton(this.type,a,c)};return}function UIImageButton(){return}UIImageButton.prototype=new UIButton();UIImageButton.prototype.isUIImageButton=true;UIImageButton.prototype.initUIImageButton=function(c,a,b){this.initUIButton(c,a,b);this.noTextAlignment=true;this.setImage(C_SHAPE_IMAGE_DISABLE_FG,null);this.setImage(C_SHAPE_IMAGE_NORMAL_FG,null);this.setImage(C_SHAPE_IMAGE_ACTIVE_FG,null);return this};UIImageButton.prototype.drawText=function(a){return};UIImageButton.prototype.shapeCanBeChild=function(a){return false};UIImageButton.prototype.getFgImage=function(){var a=null;if(!this.enable){a=this.getHtmlImageByType(C_SHAPE_IMAGE_DISABLE_FG)}else{if(this.pointerDown){a=this.getHtmlImageByType(C_SHAPE_IMAGE_ACTIVE_FG)}else{a=this.getHtmlImageByType(C_SHAPE_IMAGE_NORMAL_FG)}}return a};UIImageButton.prototype.paintSelfOnly=function(c){var s=2;var r=this.getHtmlImageByType(C_SHAPE_IMAGE_ACTIVE_FG);var f=this.getHtmlImageByType(C_SHAPE_IMAGE_NORMAL_FG);var e=this.getHtmlImageByType(C_SHAPE_IMAGE_DISABLE_FG);var u=this.getLocaleText(this.text);var b=this.style.fontSize;var l=0;var j=0;var o=this.w;var v=this.h;var q=null;if(this.enable){q=this.pointerDown?r:f;if(this.pointerDown){c.fillStyle=this.style.fillColor;c.fillRect(0,0,o,v);if(!q){q=f;c.translate(1,2)}}}else{q=e}c.font=this.style.getFont();c.fillStyle=this.style.textColor;if(q){var a=q.width;var g=q.height;var d=this.hMargin;if(u){var t=c.measureText(u).width+4;if(t>o){var b=Math.round((o/t)*this.style.fontSize);this.style.setFontSize(b);c.font=this.style.getFont()}if(this.w>2*this.h){var p=l+d;var m=Math.floor(j+(v-g)/2);c.drawImage(q,0,0,a,g,p,m,a,g);m=Math.floor(j+v/2);p=Math.floor(l+(o-a)/2+a);c.textAlign="center";c.textBaseline="middle";c.fillText(u,p,m)}else{var p=Math.floor(l+(o-a)/2);var m=Math.floor(j+(v-g-b-s)/2);c.drawImage(q,0,0,a,g,p,m,a,g);p=Math.floor(l+o/2);m=m+g+s;c.textAlign="center";c.textBaseline="top";c.fillText(u,p,m)}}else{this.drawImageAt(c,q,this.images.display,l,j,this.w,this.h)}}else{if(u){c.textAlign="center";c.textBaseline="middle";c.fillText(u,Math.floor(l+o/2),Math.floor(j+v/2))}}return};function UIImageButtonCreator(a,c){var b=["ui-image-button","ui-image-button",null,1];ShapeCreator.apply(this,b);this.createShape=function(e){var d=new UIImageButton();return d.initUIImageButton(this.type,a,c)};return}function UIToolBar(){return}UIToolBar.prototype=new UIElement();UIToolBar.prototype.isUIToolBar=true;UIToolBar.prototype.initUIToolBar=function(c,d,b,a){this.initUIElement(c);this.xAttr=C_X_LEFT_IN_PARENT;this.widthAttr=C_WIDTH_FILL_PARENT;this.yAttr=d?C_Y_TOP_IN_PARENT:C_Y_BOTTOM_IN_PARENT;this.setDefSize(200,b);this.setTextType(C_SHAPE_TEXT_NONE);this.setImage(C_SHAPE_IMAGE_ALL,a);this.setSizeLimit(100,50,2000,200);return this};UIToolBar.prototype.shapeCanBeChild=function(a){if(a.isUILabel||a.isUIImage||a.isUIButton||a.isUIGroup||a.isUIButtonGroup||a.isUIEdit||a.isUICheckBox||a.isUIRadioBox||a.isUIProgressBar||a.isUISwitch||a.isUILedDigits||a.isUIGroup||a.isUILayout||a.isUIWaitBar){return true}return false};UIToolBar.prototype.paintSelfOnly=function(a){var b=this.getHtmlImageByType(C_SHAPE_IMAGE_ALL);if(!b){a.beginPath();a.fillRect(0,0,this.w,this.h)}return};function UIToolBarCreator(d,e,c,b){var a=[d,"ui-toolbar",null,1];ShapeCreator.apply(this,a);this.createShape=function(h){var f=new UIToolBar();return f.initUIToolBar(d,e,c,b)};return}function UIScrollView(){return this}UIScrollView.prototype=new UIElement();UIScrollView.prototype.isUIScrollView=true;UIScrollView.prototype.afterChildAppended=function(a){a.setCanRectSelectable(false,true);return true};UIScrollView.prototype.initUIScrollView=function(c,a,b){this.initUIElement(c);this.offset=0;this.scrollBarOpacity=0;this.setMargin(a,a);this.setSizeLimit(100,100,2000,2000);this.setDefSize(300+2*a,300+2*a);this.velocityTracker=new VelocityTracker();this.interpolator=new DecelerateInterpolator(2);this.widthAttr=C_WIDTH_FILL_PARENT;this.heightAttr=C_HEIGHT_FILL_PARENT;this.setTextType(C_SHAPE_TEXT_NONE);this.setImage(C_SHAPE_IMAGE_ALL,b);this.setScrollable("always");if(!b){this.style.setFillColor("#f0f0f0")}this.setCanRectSelectable(false,true);return this};UIScrollView.prototype.setScrollable=function(a){this.scrollable=a;return};UIScrollView.prototype.fixChildSize=function(a){if(a.widthAttr===C_WIDTH_FILL_PARENT){a.w=this.getWidth(true)}if(a.heightAttr===C_HEIGHT_FILL_PARENT){a.h=this.getHeight(true)}if(a.widthAttr===C_WIDTH_FILL_PARENT&&a.heightAttr===C_HEIGHT_FILL_PARENT){a.setUserMovable(false);a.setUserResizable(false)}return};UIScrollView.prototype.shapeCanBeChild=function(a){if(a.isUIButton||a.isUIGroup||a.isUILabel||a.isUIImage||a.isUIList||a.isUIGrid||a.isUIProgressBar||a.isUICheckBox||a.isUIRadioBox||a.isUIWaitBar||a.isUIButtonGroup||a.isUITips||a.isUIGroup){return true}return false};UIScrollView.prototype.onModeChanged=function(){this.offset=0;return};UIScrollView.prototype.scrollTo=function(a){this.offset=a;return};UIScrollView.prototype.scrollDelta=function(b){var a=this.offset+b;this.scrollTo(a);return};UIScrollView.prototype.scrollToPageDelta=function(b){var a=Math.floor(this.offset/this.w)+b;this.scrollToPage(a);return};UIScrollView.prototype.scrollToPage=function(a){if(a<0){a=0}var b=this.w*a;var c=this.offset-b;this.animScrollTo(c,300);return};UIScrollView.prototype.onPointerDownRunning=function(a,b){if(b){return}this.velocityTracker.clear();return};UIScrollView.prototype.onDrag=function(a){return};UIScrollView.prototype.isScrollable=function(){if(this.scrollable==="always"){return true}else{if(this.scrollable==="never"){return false}else{var b=this.getScrollRange();var a=this.getPageSize();return b>a}}};UIScrollView.prototype.onPointerMoveRunning=function(a,b){if(b||!this.isScrollable()){return}this.scrollBarOpacity=0;var c=this.getScrollDelta(a);if(this.pointerDown&&this.needScroll(a)){this.scrollBarOpacity=1;this.scrollDelta(-c)}this.addMovementForVelocityTracker();this.onDrag(this.offset);return};UIScrollView.prototype.animScrollTo=function(a,e){var f=this;var d=new Date();var c=d.getTime();var h=this.offset;var l=h-a;var g=this.getScrollRange();var j=this.getPageSize();e=e<600?600:e;if(l<0){e=600;a=h}if(this.mode!=C_MODE_EDITING){if(l>(g-j)){a=h-(g-j)}}if(g<=j){l=0;a=h}function b(){var o=new Date();var q=o.getTime();var m=(q-c)/e;var p=f.interpolator.get(m);var r=h-a*Math.min(p,1);if(m<1&&!f.pointerDown){setTimeout(b,10);f.scrollTo(r);f.scrollBarOpacity=1-p}else{var r=h-a;f.scrollBarOpacity=0;f.scrollTo(r)}f.postRedraw();return}setTimeout(b,30);return};UIScrollView.prototype.onOutOfRange=function(a){return};UIScrollView.prototype.onPointerUpRunning=function(m,l){if(l||!this.isScrollable()){return}var o=this.getScrolledSize();if(!this.needScroll(m)){this.scrollBarOpacity=0;return}var c=0;var b=0;var e=this.getVelocity();var j=this.getPageSize();var p=e/j;var g=0.5*j*p*p;b=Math.abs(g);c=2*b/e;b=o<0?-b:b;c=Math.abs(c);if(c>3){c=3}var f=this.offset;var h=f-b;if(h<0){this.onOutOfRange(h)}this.animScrollTo(b,c*1000);return true};UIScrollView.prototype.paintSelfOnly=function(a){var b=this.getHtmlImageByType(C_SHAPE_IMAGE_ALL);if(!b){a.beginPath();a.fillRect(0,0,this.w,this.h)}return};function UIHScrollView(){return}UIHScrollView.prototype=new UIScrollView();UIHScrollView.prototype.isUIHScrollView=true;UIHScrollView.prototype.initUIHScrollView=function(c,a,b){this.initUIScrollView(c,a,b);this.setSizeLimit(100,40,2000,2000);return this};UIHScrollView.prototype.needScroll=function(a){var c=Math.abs(this.getMoveAbsDeltaX());var b=Math.abs(this.getMoveAbsDeltaY());return(c>20&&c>b)||(c>20&&this.mode!=C_MODE_EDITING)};UIHScrollView.prototype.getScrolledSize=function(){return Math.floor(this.getMoveAbsDeltaX())};UIHScrollView.prototype.getScrollDelta=function(a){return Math.floor(this.getMoveDeltaX())};UIHScrollView.prototype.getVelocity=function(){return this.velocityTracker.getVelocity().x};UIHScrollView.prototype.getPageSize=function(){return this.w};UIHScrollView.prototype.onPointerUpRunning=function(b,e){if(e){return}var c=0;var d=this.getVelocity();var f=this.getScrolledSize();var a=Math.abs(f);if(a>this.w/4||d>this.w){if(f<0){c=1}else{c=-1}}this.scrollToPageDelta(c);return true};UIHScrollView.prototype.translatePoint=function(a){var b={x:(a.x-this.x+this.offset),y:(a.y-this.y)};return b};UIHScrollView.prototype.getScrollRange=function(){var a=0;var b=this.calcChildrenRange();a=b.r-b.l;if(a<this.w){a=this.w}a=Math.ceil(a/this.w)*this.w;return a};UIHScrollView.prototype.fixChildPosition=function(a){if(a.widthAttr===C_WIDTH_FILL_PARENT){a.x=this.offset+this.hMargin;a.widthAttr=C_WIDTH_SCALE}if(a.heightAttr===C_HEIGHT_FILL_PARENT){a.y=this.vMargin}if(a.widthAttr===C_WIDTH_FILL_PARENT&&a.heightAttr===C_HEIGHT_FILL_PARENT){a.setUserMovable(false)}return};UIHScrollView.prototype.paintChildren=function(c){var b=null;var f=null;var e=this.offset;var a=this.offset+this.w;c.save();c.beginPath();c.rect(0,0,this.w,this.h);c.closePath();c.clip();c.beginPath();c.translate(-this.offset,0);for(var d=0;d<this.children.length;d++){b=this.children[d];if(!b.visible){continue}if((b.x+b.w)<e||b.y>a){continue}if(b.pointerDown&&b.selected&&this.mode===C_MODE_EDITING){f=b}else{this.beforePaintChild(b,c);b.paintSelf(c);this.afterPaintChild(b,c)}}if(f){b=f;this.beforePaintChild(b,c);b.paintSelf(c);this.afterPaintChild(b,c)}c.restore();return};function UIHScrollViewCreator(b,c){var a=["ui-h-scroll-view","ui-h-scroll-view",null,1];ShapeCreator.apply(this,a);this.createShape=function(e){var d=new UIHScrollView();return d.initUIHScrollView(this.type,b,c)};return}function UIVScrollView(){return}UIVScrollView.prototype=new UIScrollView();UIVScrollView.prototype.isUIVScrollView=true;UIVScrollView.prototype.initUIVScrollView=function(d,a,c,b){this.initUIScrollView(d,a,c);this.setSizeLimit(40,100,2000,2000);this.setImage("scrollBarImg",b);this.rectSelectable=false;return this};UIVScrollView.prototype.needScroll=function(a){var c=Math.abs(this.getMoveAbsDeltaX());var b=Math.abs(this.getMoveAbsDeltaY());return(b>50&&b>c)||(b>50&&this.mode!=C_MODE_EDITING)};UIVScrollView.prototype.getScrolledSize=function(){return Math.floor(this.getMoveAbsDeltaY())};UIVScrollView.prototype.getScrollDelta=function(a){return Math.floor(this.getMoveDeltaY())};UIVScrollView.prototype.getVelocity=function(){return this.velocityTracker.getVelocity().y};UIVScrollView.prototype.getPageSize=function(){return this.h};UIVScrollView.prototype.translatePoint=function(a){var b={x:(a.x-this.x),y:(a.y-this.y+this.offset)};return b};UIVScrollView.prototype.getScrollRange=function(){var a=0;var b=this.calcChildrenRange();a=b.b;if(a<this.h){a=this.h}a=Math.ceil(a/this.h)*this.h;return a};UIVScrollView.prototype.fixChildPosition=function(a){if(a.widthAttr===C_WIDTH_FILL_PARENT){a.x=this.hMargin}if(a.heightAttr===C_HEIGHT_FILL_PARENT){a.y=this.offset+this.vMargin;a.heightAttr=C_HEIGHT_SCALE}if(a.widthAttr===C_WIDTH_FILL_PARENT&&a.heightAttr===C_HEIGHT_FILL_PARENT){a.setUserMovable(false)}return};UIVScrollView.prototype.paintChildren=function(b){var a=null;var f=null;var e=this.offset;var d=this.offset+this.h;b.save();b.beginPath();b.rect(0,0,this.w,this.h);b.closePath();b.clip();b.beginPath();b.translate(0,-this.offset);var f=null;for(var c=0;c<this.children.length;c++){a=this.children[c];if(!a.visible){continue}if((a.y+a.h)<e||a.y>d){continue}if(a.pointerDown&&a.selected&&this.mode===C_MODE_EDITING){f=a}else{this.beforePaintChild(a,b);a.paintSelf(b);this.afterPaintChild(a,b)}}if(f){a=f;this.beforePaintChild(a,b);a.paintSelf(b);this.afterPaintChild(a,b)}b.restore();return};UIVScrollView.prototype.afterPaintChildren=function(a){this.drawScrollBar(a);return};UIVScrollView.prototype.drawScrollBar=function(d){var f=this.getHtmlImageByType("scrollBarImg");if(!this.scrollBarOpacity||!f){return}var c=this.getScrollRange();var a=this.w-f.width-2;var b=f.width;var e=this.h*this.h/c;var g=(this.offset/c)*this.h;if((g+e)>this.h){e=this.h-g;g=this.h-e}if(g<0){e=e+g;g=0}d.save();d.globalAlpha=this.scrollBarOpacity;drawNinePatchEx(d,f,0,0,f.width,f.height,a,g,b,e);d.restore();return};function UIVScrollViewCreator(b,d,c){var a=["ui-v-scroll-view","ui-v-scroll-view",null,1];ShapeCreator.apply(this,a);this.createShape=function(f){var e=new UIVScrollView();return e.initUIVScrollView(this.type,b,d,c)};return}function UIList(){return}UIList.prototype=new UIElement();UIList.prototype.isUIList=true;UIList.prototype.isUILayout=true;UIList.prototype.initUIList=function(c,a,d,b){this.initUIElement(c);this.setMargin(a,a);this.setSizeLimit(100,100,1000,1000);this.setDefSize(400,d*3+2*a);this.itemHeight=d;this.widthAttr=C_WIDTH_FILL_PARENT;this.setTextType(C_SHAPE_TEXT_INPUT);this.setImage(C_SHAPE_IMAGE_ALL,b);this.rectSelectable=false;this.itemHeightVariable=false;this.addEventNames(["onInit"]);if(!b){this.style.setFillColor("White")}return this};UIList.prototype.setItemHeight=function(a){this.itemHeight=a;return};UIList.prototype.shapeCanBeChild=function(a){if(!a.isUIListItem){return false}return true};UIList.prototype.paintSelfOnly=function(a){return};UIList.prototype.childIsBuiltin=function(a){return a.name==="ui-list-item-update-status"||a.name==="ui-list-item-update-tips"||a.name==="ui-last"};UIList.FIRST_ITEM=-1;UIList.LAST_ITEM=1;UIList.MIDDLE_ITEM=0;UIList.SINGLE_ITEM=2;UIList.prototype.fixListItemImage=function(d,b){var a=d.images;for(var c in a){var e=a[c];if(c!="display"){var f=e.getImageSrc();switch(b){case UIList.FIRST_ITEM:f=f.replace(/\.single\./,".first.");f=f.replace(/\.middle\./,".first.");f=f.replace(/\.last\./,".first.");break;case UIList.MIDDLE_ITEM:f=f.replace(/\.single\./,".middle.");f=f.replace(/\.first\./,".middle.");f=f.replace(/\.last\./,".middle.");break;case UIList.LAST_ITEM:f=f.replace(/\.single\./,".last.");f=f.replace(/\.first\./,".last.");f=f.replace(/\.middle\./,".last.");break;case UIList.SINGLE_ITEM:f=f.replace(/\.first\./,".single.");f=f.replace(/\.middle\./,".single.");f=f.replace(/\.last\./,".single.");break}e.setImageSrc(f)}}return};UIList.prototype.relayoutChildren=function(l){if(this.disableRelayout){return}var e=this.getHMargin();var o=e;var m=e;var p=this.w-2*e;var g=this.itemHeight;var d=this.children.length;var a=this.itemHeightVariable;for(var f=0;f<d;f++){var c={};var j=false;var b=this.children[f];if(a||b.isHeightVariable()){g=b.measureHeight(this.itemHeight)}else{g=this.itemHeight}if(d===1){this.fixListItemImage(b,UIList.SINGLE_ITEM)}else{if(f===0){this.fixListItemImage(b,UIList.FIRST_ITEM)}else{if(f===(d-1)){this.fixListItemImage(b,UIList.LAST_ITEM)}else{this.fixListItemImage(b,UIList.MIDDLE_ITEM)}}}if(this.h<=(m+e+g)){this.h=m+e+g}j=(m<this.h)&&(l||this.mode===C_MODE_EDITING);if(j){c.xStart=b.x;c.yStart=b.y;c.wStart=b.w;c.hStart=b.h;c.xEnd=o;c.yEnd=m;c.wEnd=p;c.hEnd=g;c.delay=10;c.duration=1000;c.element=b;c.onDone=function(h){h.relayoutChildren()};b.animate(c)}else{b.move(o,m);b.setSize(p,g);b.relayoutChildren()}b.setUserMovable(true);b.widthAttr=C_WIDTH_FILL_PARENT;if(b.heightAttr===C_HEIGHT_FILL_PARENT){b.heightAttr=C_HEIGHT_FIX}b.setUserResizable(a||b.isHeightVariable());if(!this.isUIScrollView){b.setDraggable(this.itemDraggable)}m+=g}return};UIList.prototype.beforePaintChildren=function(a){a.beginPath();a.rect(0,0,this.w,this.h);a.clip();a.beginPath();return};UIList.prototype.afterPaintChildren=function(a){return};UIList.prototype.afterChildAppended=function(a){if(a.view&&this.mode===C_MODE_EDITING&&a.isCreatingElement()){this.sortChildren()}this.moveMustBeLastItemToLast();a.setUserMovable(true);a.setUserResizable(false);a.setCanRectSelectable(false,true);a.autoAdjustHeight=this.itemHeightVariable;a.setDraggable(this.itemDraggable);return true};UIList.prototype.sortChildren=function(){this.children.sort(function(d,c){var f=c.y;var e=c.pointerDown?d.y+d.h:d.y;return e-f});return};function UIListCreator(b,d,c){var a=["ui-list","ui-list",null,1];ShapeCreator.apply(this,a);this.createShape=function(f){var e=new UIList();return e.initUIList(this.type,b,d,c)};return}function UIListView(){return}UIListView.prototype=new UIVScrollView();UIListView.prototype.isUIList=true;UIListView.prototype.isUILayout=true;UIListView.prototype.isUIListView=true;UIListView.prototype.setItemHeight=UIList.prototype.setItemHeight;UIListView.prototype.sortChildren=UIList.prototype.sortChildren;UIListView.prototype.initUIList=UIList.prototype.initUIList;UIListView.prototype.shapeCanBeChild=UIList.prototype.shapeCanBeChild;UIListView.prototype.paintSelfOnly=UIList.prototype.paintSelfOnly;UIListView.prototype.fixListItemImage=function(b,a){};UIListView.prototype.afterChildAppended=UIList.prototype.afterChildAppended;UIListView.prototype.childIsBuiltin=UIList.prototype.childIsBuiltin;UIListView.UPDATE_STATUS_NONE=0;UIListView.UPDATE_STATUS_TIPS=1;UIListView.UPDATE_STATUS_SYNC=2;UIListView.prototype.beginUpdate=function(){this.updateStatus=UIListView.UPDATE_STATUS_SYNC;var a=this.findChildByName("ui-list-item-update-status");if(a){var b=a.findChildByName("ui-wait-box");if(b){b.show();b.start()}var c=a.findChildByName("ui-label-loading");if(c){c.setText(dappGetText("Loading..."))}}return};UIListView.prototype.endUpdate=function(){this.updateStatus=UIListView.UPDATE_STATUS_NONE;var a=this.findChildByName("ui-list-item-update-status");if(a){var b=a.findChildByName("ui-wait-box");if(b){b.stop()}this.setLastUpdateTime(new Date())}return};UIListView.prototype.initUIListView=function(c,a,d,b){this.initUIList(c,a,d,b);this.initUIVScrollView(c,0,b,null);this.updateStatus=UIListView.UPDATE_STATUS_NONE;this.addEventNames(["onUpdateData"]);return this};UIListView.prototype.onModeChanged=function(){this.offset=0;this.updateStatus=UIListView.UPDATE_STATUS_NONE;return};UIListView.prototype.updateDone=function(){var a=this;a.endUpdate();setTimeout(function(){a.relayoutChildren();a.postRedraw()},1000);return};UIListView.prototype.callOnUpdateData=function(){if(!this.handleOnUpdateData||this.mode===C_MODE_PREVIEW){var sourceCode=this.events.onUpdateData;if(sourceCode){sourceCode="this.handleOnUpdateData = function(value) {\n"+sourceCode+"\n}\n";try{eval(sourceCode)}catch(e){console.log("eval sourceCode failed: "+e.message+"\n"+sourceCode)}}}if(this.handleOnUpdateData){try{this.handleOnUpdateData()}catch(e){console.log("this..handleOnUpdateData:"+e.message)}}this.beginUpdate();var listView=this;setTimeout(function(){listView.updateDone()},10000);return true};UIListView.prototype.setLastUpdateTime=function(f){var a=this.findChildByName("ui-list-item-update-tips");if(a&&f){var e="";var b=new Date();if(b.getFullYear()===f.getFullYear()&&b.getDate()===f.getDate()&&b.getMonth()===f.getMonth()){e=dappGetText("Today")}else{e=f.getMonth()+"-"+f.getDate()}e=e+" "+f.getHours()+":"+f.getMinutes();var c=a.findChildByName("ui-label-update-time");if(c){c.setText(e)}var c=a.findChildByName("ui-label-update-time");if(c){c.setText(e)}var d=a.findChildByName("ui-label-update-time-tips");if(d){d.setText(dappGetText("Last Update:"))}}return};UIListView.prototype.onDrag=function(e){var c=this.findChildByName("ui-list-item-update-tips");if(c){var b=c.findChildByName("ui-image");var a=c.findChildByName("ui-label-tips");if(b){if(e<-115){if(b.imageRotation===0){function d(){var f=b.imageRotation+0.2*Math.PI;if(f>Math.PI){f=Math.PI}b.setImageRotation(f);if(f<Math.PI){setTimeout(d,50)}b.postRedraw();return}d();if(a){a.setText(dappGetText("Release To Update."))}}}else{b.setImageRotation(0);if(a){a.setText(dappGetText("Pull To Update."))}}}}return};UIListView.prototype.onOutOfRange=function(a){if(a<-115){this.callOnUpdateData();this.relayoutChildren()}return};UIListView.prototype.relayoutChildren=function(o){if(this.disableRelayout){return}var e=this.getHMargin();var q=e;var p=e;var r=this.w-2*e;var l=this.itemHeight;var d=this.children.length;var a=this.itemHeightVariable;var j=this.getScrollRange();var m=this.getPageSize();var g=true;for(var f=0;f<d;f++){var c={};var s=false;var b=this.children[f];if(a||b.isHeightVariable()){l=b.measureHeight(this.itemHeight)}else{l=this.itemHeight}if(b.name==="ui-list-item-update-tips"){if(this.mode!==C_MODE_EDITING){b.move(q,-l);b.x=q;b.y=-l;b.w=r;b.h=l;b.setUserMovable(false);b.setUserResizable(false);b.setVisible(this.updateStatus!==UIListView.UPDATE_STATUS_TIPS);continue}else{b.setVisible(true)}s=true}else{if(b.name==="ui-list-item-update-status"){if(this.mode!==C_MODE_EDITING){if(this.updateStatus!==UIListView.UPDATE_STATUS_SYNC){b.setVisible(false)}else{b.setVisible(true)}}else{b.setVisible(true)}s=true}}if(!b.visible){continue}animatable=b.isVisible()&&!s&&(p<this.h)&&(o||this.mode===C_MODE_EDITING);if(animatable){c.xStart=b.x;c.yStart=b.y;c.wStart=b.w;c.hStart=b.h;c.xEnd=q;c.yEnd=p;c.wEnd=r;c.hEnd=l;c.delay=10;c.duration=1000;c.element=b;c.onDone=function(h){h.relayoutChildren()};b.animate(c)}else{b.move(q,p);b.setSize(r,l);b.relayoutChildren()}b.widthAttr=C_WIDTH_FILL_PARENT;if(b.heightAttr===C_HEIGHT_FILL_PARENT){b.heightAttr=C_HEIGHT_FIX}b.setUserMovable(g);b.setUserResizable(a||b.isHeightVariable());p+=l}return};UIListView.prototype.drawText=function(a){if(this.children.length==0&&this.text){this.defaultDrawText(a)}return};UIListView.prototype.afterPaintChildren=function(g){this.drawScrollBar(g);if(this.mode!=C_MODE_EDITING){return}var f=this.getScrollRange();var d=this.getPageSize();if(f<=d){return}var c=40;var j=20;var a=20;var e=this.w-c;var b=this.h-j;g.fillStyle=this.pointerDown?"Gray":"#E0E0E0";g.fillRect(e,0,c,j);g.fillRect(e,b,c,j);g.fillStyle="Gold";g.beginPath();g.moveTo(e,j);g.lineTo(e+a,0);g.lineTo(this.w,j);g.lineTo(e,j);g.closePath();g.fill();g.beginPath();g.moveTo(e,b);g.lineTo(e+a,this.h);g.lineTo(this.w,b);g.lineTo(e,b);g.closePath();g.fill();return};UIListView.prototype.onClick=function(a,e){if(e||this.animating){return}if(this.mode!=C_MODE_EDITING){return}var b=40;var d=20;var f=0;var c=this.w-b;var g=a.y-this.offset;if(a.x>c){if(g<d){f=this.itemHeight;this.animScrollTo(f,600);this.setSelected(true)}else{if(g>(this.h-d)){f=-this.itemHeight;this.animScrollTo(f,600);this.setSelected(true)}}}return};function UIListViewCreator(b,d,c){var a=["ui-list-view","ui-list-view",null,1];ShapeCreator.apply(this,a);this.createShape=function(f){var e=new UIListView();return e.initUIListView(this.type,b,d,c)};return}function SuggestionProvider(){this.query=function(a,b){};this.init=function(a){};return}function StaticSuggestionProvider(){this.init=function(a){if(typeof a=="string"){a=a.split("\n")}this.options=a;if(this.options){this.options.sort()}return};this.query=function(d,h){if(!d||!this.options){h([]);return}function g(l,j){if(l.indexOf(j)==0){return 0}if(l<j){return -1}else{return 1}}var a=[];var f=this.options.binarySearch(d,g);if(f>=0){var e=this.options.length;for(;f>=0;f--){var b=this.options[f];if(b.indexOf(d)!==0){f=f+1;break}}for(var c=f;c<e;c++){var b=this.options[c];if(b.indexOf(d)===0){a.push(b)}else{break}}}h(a);return};return}function createSuggestionProvider(b,a){var c=null;if(b==="static"){c=new StaticSuggestionProvider()}if(c){c.init(a)}return c}function UISuggestion(){return}UISuggestion.prototype=new UIListView();UISuggestion.prototype.isUISuggestion=true;UISuggestion.prototype.initUISuggestion=function(a){this.initUIListView(a,5,100,null);this.maxSuggestionItems=10;this.suggestionProviderParams="";this.suggestionProviderName="static";return this};UISuggestion.prototype.onInit=function(){this.suggestionProvider=createSuggestionProvider(this.suggestionProviderName,this.suggestionProviderParams);return};UISuggestion.prototype.setSuggestionProvider=function(a){this.suggestionProvider=a;return};UISuggestion.prototype.getSuggestionProvider=function(){return this.suggestionProvider};UISuggestion.prototype.onSuggestionSelected=function(a){};UISuggestion.prototype.showSuggestion=function(a){var e={children:[]};if(a.length>this.maxSuggestionItems){a.length=this.maxSuggestionItems}for(var b=0;b<a.length;b++){var c={children:[]};var d=a[b];c.children.push({text:d});e.children.push(c)}this.bindData(e,null,true);return};UISuggestion.prototype.onSuggestionShow=function(){};UISuggestion.prototype.query=function(a){var b=this;this.suggestionProvider.query(a,function(c){b.showSuggestion(c);b.onSuggestionShow()})};function UISuggestionCreator(){var a=["ui-suggestion","ui-suggestion",null,1];ShapeCreator.apply(this,a);this.createShape=function(c){var b=new UISuggestion();return b.initUISuggestion(this.type)};return}function UIListItem(){return}UIListItem.prototype=new UIElement();UIListItem.prototype.isUIListItem=true;UIListItem.prototype.initUIListItem=function(c,e,d,a,b){this.initUIElement(c);this.setDefSize(200,120);this.widthAttr=C_WIDTH_FILL_PARENT;this.setTextType(C_SHAPE_TEXT_NONE);this.images.display=C_IMAGE_DISPLAY_9PATCH;this.setImage(C_SHAPE_IMAGE_FOCUSED,e);this.setImage(C_SHAPE_IMAGE_ACTIVE,d);this.setImage(C_SHAPE_IMAGE_NORMAL,a);this.setImage(C_SHAPE_IMAGE_DISABLE,b);this.setImage(C_SHAPE_IMAGE_DELETE_ITEM,null);this.addEventNames(["onLongPress","onRemoved"]);return this};UIListItem.prototype.dragMove=function(b,a){this.y=this.y+a;this.onDragging();return};UIListItem.prototype.getDeleteItemIcon=function(){var a=this.getHtmlImageByType(C_SHAPE_IMAGE_DELETE_ITEM);if(!a){this.setImage(C_SHAPE_IMAGE_DELETE_ITEM,"drawapp8/images/common/icons/xhdpi/list_delete_item.png");a=this.getHtmlImageByType(C_SHAPE_IMAGE_DELETE_ITEM)}return a};UIListItem.prototype.shapeCanBeChild=function(a){if(a.isUILabel||a.isUIImage||a.isUIButton||a.isUIGroup||a.isUICheckBox||a.isUISwitch||a.isUIProgressBar||a.isUIWaitBar||a.isUIEdit||a.isUIColorBar||a.isUITips||a.isUIGroup||a.isUILayout||a.isUIColorTile||a.isUISelect||a.isUIButtonGroup||a.isUIMLEdit||a.isUISimpleHTML||a.isUIGrid){return true}return false};UIListItem.prototype.onUserResized=function(){var a=this.parentShape;if(a){a.relayoutChildren()}return};UIListItem.cachedBgImages=new Array();UIListItem.prototype.addCacheImage=function(c,e,b,d){var a={name:c,data:e,w:b,h:d};UIListItem.cachedBgImages.push(a);return};UIListItem.prototype.getCacheImage=function(d,c,f){var e=0;var b=null;var a=UIListItem.cachedBgImages;var g=UIListItem.cachedBgImages.length;for(e=0;e<g;e++){b=a[e];if(b.w===c&&b.h===f&&b.name===d){return b.data}}return null};UIListItem.prototype.createCacheImage=function(f){var b=this.w;var e=this.h;var d=null;var f=this.getBgImage();var c=BackendCanvasGet();var a=c.getContext("2d");if(f){a.clearRect(0,0,b,e);drawNinePatchEx(a,f,0,0,f.width,f.height,0,0,b,e);d=a.getImageData(0,0,b,e);this.addCacheImage(f.src,d,b,e)}return d};UIListItem.prototype.setSlideToRemove=function(a){this.slideToRemove=a;return};UIListItem.prototype.setHeightVariable=function(a){this.heightVariable=a;return};UIListItem.prototype.isHeightVariable=function(){return this.heightVariable};UIListItem.prototype.measureHeight=function(a){return this.h};UIListItem.prototype.ANIM_DRAW_LINE=1;UIListItem.prototype.onPointerUpRunning=function(g,f){if(f||!this.slideToRemove){return}var l=this.getMoveAbsDeltaX();var j=this.getMoveAbsDeltaY();if(Math.abs(l)<this.w/2||(Math.abs(j)>this.h)){return}var h=this;var b=300;var a=(new Date()).getTime();h.animateState=this.ANIM_DRAW_LINE;for(var c=0;c<this.children.length;c++){var e=this.children[c];e.style.setTextColor("#C0C0C0")}function d(){var m=new Date();var o=(m.getTime()-a)/b;if(o<1){h.animatePercent=o;setTimeout(d,10)}else{h.animatePercent=1;setTimeout(function(){delete a;delete h.animatePercent;delete h.animateState;var p=h.parentShape;p.removeChild(h);p.relayoutChildren("default");p.postRedraw()},300)}delete m;h.postRedraw()}d();return};UIListItem.prototype.paintSelfOnly=function(b){var d=this.getBgImage();if(!d){b.beginPath();var a=this.getWidth(true);var c=this.getHeight(true);if(!this.isFillColorTransparent()){b.fillRect(this.hMargin,this.vMargin,a,c)}}return};UIListItem.prototype.afterPaintChildren=function(c){if(!this.animateState){return}var f=this.getDeleteItemIcon();if(this.animateState===this.ANIM_DRAW_LINE&&f&&f.width>0){var e=20;var d=this.animatePercent;var b=(this.w-e)*d-f.width;if(b>e){c.lineWidth=1;c.strokeStyle="#D0D0D0";c.moveTo(e,this.h/2);c.lineTo(b,this.h/2);c.stroke();if(d>0.9){var g=(this.h-f.height)/2;var a=this.w-f.width-e;c.drawImage(f,a,g)}}}return};UIListItem.prototype.afterChildAppended=function(a){if(a.isUIButton||a.isUICheckBox){this.setImage(C_SHAPE_IMAGE_ACTIVE,this.getImageByType(C_SHAPE_IMAGE_NORMAL).getImageSrc());this.setImage(C_SHAPE_IMAGE_FOCUSED,this.getImageByType(C_SHAPE_IMAGE_NORMAL).getImageSrc())}return true};function UIListItemCreator(e,d,b,c){var a=["ui-list-item","ui-list-item",null,1];ShapeCreator.apply(this,a);this.createShape=function(h){var f=new UIListItem();f.initUIListItem(this.type,e,d,b,c);return f};return}function UIListItemGroup(){return}UIListItemGroup.prototype=new UIList();UIListItemGroup.prototype.isUIListItem=true;UIListItemGroup.prototype.isUIListItemGroup=true;UIListItemGroup.prototype.isHeightVariable=UIListItem.prototype.isHeightVariable;UIListItemGroup.prototype.setHeightVariable=UIListItem.prototype.setHeightVariable;UIListItemGroup.prototype.initUIListItemGroup=function(a){this.initUIList(a,0,30,null);this.setHeightVariable(true);this.setSizeLimit(100,30);return this};UIListItemGroup.prototype.relayoutChildren=function(a){if(this.disableRelayout){return}if(this.mode===C_MODE_EDITING){this.collapsed=false}UIList.prototype.relayoutChildren.call(this,a);this.h=this.getNewHeight();return};UIListItemGroup.prototype.collapseOrExpand=function(a){if(this.collapsed){this.expand(a)}else{this.collapse(a)}return};UIListItemGroup.prototype.collapseSelf=function(){var b=this.children.length;if(b<1){return}var a=this.h;this.collapsed=true;this.relayoutChildren();this.h=a;return};UIListItemGroup.prototype.collapse=function(a){this.collapseSelf();if(this.parentShape){this.parentShape.relayoutChildren(a)}return};UIListItemGroup.prototype.expandSelf=function(){var b=this.children.length;if(b<1){return}var a=this.h;this.collapsed=false;this.relayoutChildren();this.h=a;return};UIListItemGroup.prototype.expand=function(a){this.expandSelf();if(this.parentShape){this.parentShape.relayoutChildren(a)}return};UIListItemGroup.prototype.getNewHeight=function(){var d=this.children.length;if(d>0){if(this.collapsed){this.newHeight=this.children[0].h}else{var b=0;for(var c=0;c<d;c++){var a=this.children[c];b=b+a.h}this.newHeight=b}}else{this.newHeight=this.h}return this.newHeight};UIListItemGroup.prototype.afterChildAppended=function(a){UIList.prototype.afterChildAppended.call(this,a);if(this.disableRelayout){return}if(this.parentShape){this.parentShape.relayoutChildren("default")}return true};UIListItemGroup.prototype.afterChildRemoved=function(a){if(this.disableRelayout){return}if(this.parentShape){this.parentShape.relayoutChildren("default")}return true};UIListItemGroup.prototype.shapeCanBeChild=function(a){if(!a.isUIListItem||a.isUIListItemGroup){return false}return true};UIListItemGroup.prototype.measureHeight=function(a){if(this.mode===C_MODE_EDITING){this.collapsed=false}return this.getNewHeight()};UIListItemGroup.prototype.fixListItemImage=function(b,a){};UIListItemGroup.prototype.onModeChanged=function(){if(this.collapsedDefault&&this.mode!=C_MODE_EDITING){this.collapsed=true;this.h=this.getNewHeight()}return};function UIListItemGroupCreator(){var a=["ui-list-item-group","ui-list-item-group",null,1];ShapeCreator.apply(this,a);this.createShape=function(c){var b=new UIListItemGroup();return b.initUIListItemGroup(this.type)};return}function UIListCheckableItem(){return}UIListCheckableItem.prototype=new UIListItem();UIListCheckableItem.prototype.isUIListCheckableItem=true;UIListCheckableItem.prototype.initUIListCheckableItem=function(d,c,f,e,a,b,h,g){this.initUIListItem(c,f,e,a,b);this.isRadio=d;this.setImage(C_SHAPE_IMAGE_CHECKED_FG,h);this.setImage(C_SHAPE_IMAGE_UNCHECK_FG,g);this.addEventNames(["onChanged"]);return this};UIListCheckableItem.prototype.getValue=function(){return this.value};UIListCheckableItem.prototype.setValue=function(a){if(this.value!=a){this.value=a;this.callOnChanged(this.value)}return};UIListCheckableItem.prototype.setChecked=function(){var b=this.parentShape;if(b){for(var c=0;c<b.children.length;c++){var a=b.children[c];if(a.isUIListCheckableItem){a.setValue(false)}}}this.setValue(true);return};UIListCheckableItem.prototype.setParent=function(a){this.parentShape=a;if(this.value){this.setChecked()}return};UIListCheckableItem.prototype.onClick=function(a,b){if(b){return}if(this.isRadio){this.setChecked()}else{this.setValue(!this.value)}return};UIListCheckableItem.prototype.drawFgImage=function(b){var c=this.getHtmlImageByType(this.value?C_SHAPE_IMAGE_CHECKED_FG:C_SHAPE_IMAGE_UNCHECK_FG);if(c){var a=this.w-c.width-20;var d=(this.h-c.height)/2;b.drawImage(c,0,0,c.width,c.height,a,d,c.width,c.height)}return};function UIListCheckBoxItemCreator(e,d,b,c,g,f){var a=["ui-list-checkbox-item","ui-list-checkbox-item",null,1];ShapeCreator.apply(this,a);this.createShape=function(j){var h=new UIListCheckableItem();h.initUIListCheckableItem(false,this.type,e,d,b,c,g,f);return h};return}function UIListRadioBoxItemCreator(e,d,b,c,g,f){var a=["ui-list-radiobox-item","ui-list-radiobox-item",null,1];ShapeCreator.apply(this,a);this.createShape=function(j){var h=new UIListCheckableItem();h.initUIListCheckableItem(true,this.type,e,d,b,c,g,f);return h};return}function UIGrid(){return}UIGrid.ITEM_FIXED_HEIGHT=0;UIGrid.ITEM_FIXED_ROWS=1;UIGrid.ITEM_FIXED_WIDTH=0;UIGrid.ITEM_FIXED_COLS=1;UIGrid.prototype=new UIElement();UIGrid.prototype.isUIGrid=true;UIGrid.prototype.isUILayout=true;UIGrid.prototype.gridToJson=function(a){a.spacer=this.spacer;a.itemWidth=this.itemWidth;a.itemHeight=this.itemHeight;a.itemWidthType=this.itemWidthType;a.itemHeightType=this.itemHeightType;a.scrollDirection=this.scrollDirection;return};UIGrid.prototype.gridFromJson=function(a){if(a.itemWidth){this.itemWidth=a.itemWidth;this.itemWidthType=a.itemWidthType}if(a.itemHeight){this.itemHeight=a.itemHeight;this.itemHeightType=a.itemHeightType}if(a.spacer){this.spacer=a.spacer}if(a.scrollDirection){this.scrollDirection=a.scrollDirection}return};UIGrid.prototype.initUIGrid=function(d,a,f,c){var b=f*3+2*a;var e=f+2*a;this.initUIElement(d);this.spacer=0;this.offset=0;this.setDefSize(b,b);this.setMargin(a,a);this.setSizeLimit(e,e,2000,2000);this.itemSize=f;this.itemWidth=f;this.itemHeight=f;this.itemWidthType=UIGrid.ITEM_FIXED_WIDTH;this.itemHeightType=UIGrid.ITEM_FIXED_HEIGHT;this.widthAttr=C_WIDTH_FILL_PARENT;this.setTextType(C_SHAPE_TEXT_NONE);this.setImage(C_SHAPE_IMAGE_ALL,c);this.setImage(C_SHAPE_IMAGE_DELETE_ITEM,null);this.regSerializer(this.gridToJson,this.gridFromJson);this.rectSelectable=false;this.addEventNames(["onChildDragged","onChildDragging","onInit"]);if(!c){this.style.setFillColor("White")}return this};UIGrid.prototype.getDeleteItemIcon=function(){var a=this.getHtmlImageByType(C_SHAPE_IMAGE_DELETE_ITEM);if(!a){this.setImage(C_SHAPE_IMAGE_DELETE_ITEM,"drawapp8/images/common/icons/xhdpi/grid_delete_item.png");a=this.getHtmlImageByType(C_SHAPE_IMAGE_DELETE_ITEM)}return a};UIGrid.prototype.setRows=function(a){if(a<20){this.itemHeightType=UIGrid.ITEM_FIXED_ROWS}else{this.itemHeightType=UIGrid.ITEM_FIXED_HEIGHT}this.itemHeight=a;return};UIGrid.prototype.getRows=function(){if(this.itemHeightType===UIGrid.ITEM_FIXED_ROWS){return this.itemHeight}else{return Math.floor(this.getHeight(true)/(this.itemHeight+this.spacer))}return};UIGrid.prototype.setCols=function(a){if(a<20){this.itemWidthType=UIGrid.ITEM_FIXED_COLS}else{this.itemWidthType=UIGrid.ITEM_FIXED_WIDTH}this.itemWidth=a;return};UIGrid.prototype.getCols=function(){if(this.itemWidthType===UIGrid.ITEM_FIXED_COLS){return this.itemWidth}else{return Math.floor(this.getWidth(true)/(this.itemWidth+this.spacer))}};UIGrid.prototype.getChildAt=function(d,b){var c=this.getCols();var a=d*c+b;if(a<this.children.length){return this.children[a]}else{return null}};UIGrid.prototype.shapeCanBeChild=function(a){if(a.isUIGridItem||a.isUIGrid||a.isUIButton||a.isUIGroup||a.isUILabel||a.isUIGroup||a.isUIColorTile||a.isUIColorButton||a.isUIColorBar||a.isUICheckBox||a.isUIImage||a.isUICanvas||a.isUIEdit||a.isUIListItem){return true}return false};UIGrid.prototype.childIsBuiltin=function(a){return a.name==="ui-last"};UIGrid.prototype.afterPaintChildren=function(a){if(this.mode!==C_MODE_EDITING){return}var l=0;var f=0;var b=0;var g=this.vMargin;var e=this.hMargin;var j=this.w;var d=this.h;l=this.rows?this.rows:3;f=this.cols?this.cols:3;drawDashedRect(a,g,e,j,d);for(var c=1;c<l;c++){b=(d*c)/l;drawDashedLine(a,{x:g,y:b},{x:j,y:b},8,4)}for(var c=1;c<f;c++){b=(j*c)/f;drawDashedLine(a,{x:b,y:e},{x:b,y:d},8,4)}a.strokeStyle=this.style.lineColor;a.stroke();return};UIGrid.prototype.calcItemSize=function(){var b=0;var d=0;var a=this.getWidth(true);var c=this.getHeight(true);if(this.itemWidthType===UIGrid.ITEM_FIXED_COLS){b=a/this.itemWidth-this.spacer}else{var f=Math.floor(a/this.itemWidth);b=Math.floor(a/f)}if(this.itemHeightType===UIGrid.ITEM_FIXED_ROWS){d=c/this.itemHeight-this.spacer}else{var e=Math.floor(c/this.itemHeight);d=Math.floor(c/e)}return{w:Math.floor(b),h:Math.floor(d)}};UIGrid.prototype.sortChildren=function(){var c=this.calcItemSize();var a=c.h;var b=c.w;this.children.sort(function(e,d){var h=0;var j=0;var f=Math.floor((e.y+5)/a);var g=Math.floor((d.y+5)/a);if(f===g){j=d.x;h=d.pointerDown?e.x+e.w:e.x}else{h=f;j=g}return h-j});return};UIGrid.prototype.getChildIndexByPosition=function(o){var b=this.getHMargin();var q=this.calcItemSize();var g=this.spacer;var m=this.getWidth(true);var d=this.getHeight(true);var p=q.w+g;var e=q.h+g;var l=Math.floor(m/p);var s=Math.floor(d/e);var a=Math.floor((o.y-b)/q.h);var j=Math.floor((o.x-b)/q.w);var f=a*l+j;return f};UIGrid.prototype.onChildDragging=function(d,a){var c=this.getChildIndexByPosition(a);var b=this.getIndexOfChild(d);this.callOnChildDragging(b,c);return};UIGrid.prototype.onChildDragged=function(d,a){var c=this.getChildIndexByPosition(a);var b=this.getIndexOfChild(d);this.callOnChildDragged(b,c);this.relayoutChildren("default");return};UIGrid.prototype.relayoutChildren=function(v){if(this.disableRelayout){return}var e=this.spacer;var u=this.getHMargin();var d=this.calcItemSize();var t=0;var B=0;var q=0;var o=0;var j=u;var f=u;var s=0;var l=this.getWidth(true);var A=this.getHeight(true);var a=d.w+e;var p=d.h+e;var m=Math.floor(l/a);var g=Math.floor(A/p);q=u;o=(this.w-m*a)/2;this.cols=m;this.rows=g;for(var z=0;z<this.children.length;z++){var b=this.children[z];t=Math.floor(z/m);B=Math.floor(z%m);j=o+B*a;f=q+t*p;if(v||this.mode===C_MODE_EDITING){b.animMove(j,f,v)}else{b.move(j,f)}b.widthAttr=C_WIDTH_FIX;b.heightAttr=C_HEIGHT_FIX;b.setSize(d.w,d.h);b.setUserMovable(true);b.setUserResizable(false);b.relayoutChildren();if(!this.isUIScrollView){b.setDraggable(this.itemDraggable)}}return};UIGrid.prototype.afterChildAppended=function(a){if(a.view&&this.mode===C_MODE_EDITING&&a.isCreatingElement()){this.sortChildren()}this.moveMustBeLastItemToLast();a.setUserMovable(true);a.setUserResizable(false);a.setCanRectSelectable(false,true);a.setDraggable(this.itemDraggable);return true};UIGrid.prototype.triggerUserEditingMode=function(){if(this.mode===C_MODE_EDITING){return}this.userEditingMode=!this.userEditingMode;var a=this;function b(){a.postRedraw();if(a.userEditingMode){setTimeout(b,20)}}b();return};UIGrid.prototype.isInUserEditingMode=function(){return this.userEditingMode&&this.mode!=C_MODE_EDITING};UIGrid.prototype.beforePaintChild=function(f,b){if(this.isInUserEditingMode()){b.save();var a=f.x+f.w/2;var e=f.y+f.h/2;var c=(new Date()).getTime()/1000;var d=0.03*Math.cos(20*c);b.translate(a,e);b.rotate(d);b.translate(-a,-e)}return};UIGrid.prototype.afterPaintChild=function(e,b){if(this.isInUserEditingMode()){var c=this.getDeleteItemIcon();if(c&&c.width>0){var d=e.y;var a=e.x+e.w-c.width-10;b.drawImage(c,a,d)}b.restore()}return};function UIGridCreator(b,d,c){var a=["ui-grid","ui-grid",null,1];ShapeCreator.apply(this,a);this.createShape=function(f){var e=new UIGrid();return e.initUIGrid(this.type,b,d,c)};return}function UIGridView(){return}UIGridView.prototype=new UIVScrollView();UIGridView.prototype.isUIGrid=true;UIGridView.prototype.isUILayout=true;UIGridView.prototype.isUIGridView=true;UIGridView.prototype.gridToJson=UIGrid.prototype.gridToJson;UIGridView.prototype.gridFromJson=UIGrid.prototype.gridFromJson;UIGridView.prototype.sortChildren=UIGrid.prototype.sortChildren;UIGridView.prototype.initUIGrid=UIGrid.prototype.initUIGrid;UIGridView.prototype.shapeCanBeChild=UIGrid.prototype.shapeCanBeChild;UIGridView.prototype.childIsBuiltin=UIGrid.prototype.childIsBuiltin;UIGridView.prototype.paintSelfOnly=UIGrid.prototype.paintSelfOnly;UIGridView.prototype.calcItemSize=UIGrid.prototype.calcItemSize;UIGridView.prototype.relayoutChildren=UIGrid.prototype.relayoutChildren;UIGridView.prototype.afterChildAppended=UIGrid.prototype.afterChildAppended;UIGridView.prototype.triggerUserEditingMode=UIGrid.prototype.triggerUserEditingMode;UIGridView.prototype.isInUserEditingMode=UIGrid.prototype.isInUserEditingMode;UIGridView.prototype.beforePaintChild=UIGrid.prototype.beforePaintChild;UIGridView.prototype.afterPaintChild=UIGrid.prototype.afterPaintChild;UIGridView.prototype.afterPaintChildren=UIGrid.prototype.afterPaintChildren;UIGridView.prototype.initUIGridView=function(c,a,d,b){this.initUIGrid(c,a,d,b);this.initUIVScrollView(c,0,b,null);return this};UIGridView.prototype.onModeChanged=function(){this.offset=0;return};function UIGridViewCreator(b,d,c){var a=["ui-grid-view","ui-grid-view",null,1];ShapeCreator.apply(this,a);this.createShape=function(f){var e=new UIGridView();return e.initUIGridView(this.type,b,d,c)};return}function UIGridItem(){return}UIGridItem.prototype=new UIElement();UIGridItem.prototype.isUIGridItem=true;UIGridItem.prototype.initUIGridItem=function(c,e,d,a,b){this.initUIElement(c);this.setDefSize(100,100);this.images.display=C_IMAGE_DISPLAY_9PATCH;this.setImage(C_SHAPE_IMAGE_FOCUSED,e);this.setImage(C_SHAPE_IMAGE_ACTIVE,d);this.setImage(C_SHAPE_IMAGE_NORMAL,a);this.setImage(C_SHAPE_IMAGE_DISABLE,b);return this};UIGridItem.prototype.shapeCanBeChild=function(a){if(a.isUILabel||a.isUIImage||a.isUIButton||a.isUIGroup||a.isUICheckBox){return true}return false};UIGridItem.prototype.afterChildAppended=function(a){a.xAttr=C_X_CENTER_IN_PARENT;return true};UIGridItem.prototype.beforeRelayoutChild=function(a){a.xAttr=C_X_CENTER_IN_PARENT;return true};function UIGridItemCreator(e,d,b,c){var a=["ui-grid-item","ui-grid-item",null,1];ShapeCreator.apply(this,a);this.createShape=function(h){var f=new UIGridItem();f.initUIGridItem(this.type,e,d,b,c);return f};return}function UIButtonGroup(){return}UIButtonGroup.prototype=new UIElement();UIButtonGroup.prototype.isUIButtonGroup=true;UIButtonGroup.prototype.initUIButtonGroup=function(c,a,d,b){this.initUIElement(c);this.setMargin(a,a);this.setDefSize(300,60);this.setSizeLimit(100,40,1000,120);this.buttonMaxWidth=d;this.widthAttr=C_WIDTH_FILL_PARENT;this.setTextType(C_SHAPE_TEXT_NONE);this.setImage(C_SHAPE_IMAGE_ALL,b);this.rectSelectable=false;this.addEventNames(["onInit"]);if(!b){this.style.setFillColor("White")}return this};UIButtonGroup.prototype.shapeCanBeChild=function(a){if(a.isUILabel||a.isUIImage||a.isUIButton||a.isUIGroup||a.isUIRadioBox||a.isUICheckBox){return true}return false};UIButtonGroup.prototype.paintSelfOnly=function(a){var b=this.getHtmlImageByType(C_SHAPE_IMAGE_ALL);if(!b&&!this.isFillColorTransparent()){a.beginPath();a.fillRect(0,0,this.w,this.h)}return};UIButtonGroup.prototype.relayoutChildren=function(){var c=this.getHMargin();var b=this.children.length;if(b===0||this.disableRelayout){return}var g=c;var f=c;var e=this.h-2*c;var l=this.buttonMaxWidth;var m=Math.floor((this.w-2*c)/b);var j=Math.min(m,l);for(var d=0;d<b;d++){var a=this.children[d];g=d*m+(m-j)/2+c;a.setPosition(g,f);a.setSize(j,e);a.setUserMovable(false);a.setUserResizable(false);a.relayoutChildren()}this.w=m*b+2*c;return};UIButtonGroup.prototype.afterChildAppended=function(a){a.yAttr=C_Y_MIDDLE_IN_PARENT;return true};function UIButtonGroupCreator(b,d,c){var a=["ui-button-group","ui-button-group",null,1];ShapeCreator.apply(this,a);this.createShape=function(f){var e=new UIButtonGroup();return e.initUIButtonGroup(this.type,b,d,c)};return}function UICheckBox(){return}UICheckBox.prototype=new UIElement();UICheckBox.prototype.isUICheckBox=true;UICheckBox.prototype.initUICheckBox=function(f,g,d,l,e,b,c,j,a){this.initUIElement(f);this.setDefSize(g,d);this.setTextType(C_SHAPE_TEXT_INPUT);this.images.display=C_IMAGE_DISPLAY_SCALE;l=l?l:b;e=e?e:b;c=c?c:a;j=j?j:a;this.setImage(C_SHAPE_IMAGE_ON_FG,b);this.setImage(C_SHAPE_IMAGE_ON_ACTIVE,e);this.setImage(C_SHAPE_IMAGE_ON_FOCUSED,l);this.setImage(C_SHAPE_IMAGE_OFF_FG,a);this.setImage(C_SHAPE_IMAGE_OFF_ACTIVE,j);this.setImage(C_SHAPE_IMAGE_OFF_FOCUSED,c);this.addEventNames(["onChanged"]);this.value=true;return this};UICheckBox.prototype.shapeCanBeChild=function(a){return false};UICheckBox.prototype.getValue=function(){return this.value};UICheckBox.prototype.setValue=function(a){if(this.value!=a){this.value=a;this.callOnChanged(this.value)}return};UICheckBox.prototype.getFgImage=function(){var a=null;if(this.value){if(this.pointerDown){a=this.getImageByType(C_SHAPE_IMAGE_ON_ACTIVE).getImage()}else{if(this.selected){a=this.getImageByType(C_SHAPE_IMAGE_ON_FOCUSED).getImage()}}if(!a){a=this.getImageByType(C_SHAPE_IMAGE_ON_FG).getImage()}}else{if(this.pointerDown){a=this.getImageByType(C_SHAPE_IMAGE_OFF_ACTIVE).getImage()}else{if(this.selected){a=this.getImageByType(C_SHAPE_IMAGE_OFF_FOCUSED).getImage()}}if(!a){a=this.getImageByType(C_SHAPE_IMAGE_OFF_FG).getImage()}}return a};UICheckBox.prototype.drawFgImage=function(a){var b=this.getFgImage();if(b){this.drawImageAt(a,b,this.images.display,0,0,this.w,this.h)}return};UICheckBox.prototype.onClick=function(a,b){if(b){return}this.setValue(!this.value);this.callClickHandler(a);return};function UICheckBoxCreator(g,d,l,e,b,c,j,a){var f=["ui-checkbox","ui-checkbox",null,1];ShapeCreator.apply(this,f);this.createShape=function(m){var h=new UICheckBox();return h.initUICheckBox(this.type,g,d,l,e,b,c,j,a)};return}function UISwitch(){return}UISwitch.prototype=new UICheckBox();UISwitch.prototype.isUISwitch=true;UISwitch.prototype.initUISwitch=function(d,a,c,e,b){this.initUIElement(d);this.setDefSize(a,c);this.setTextType(C_SHAPE_TEXT_NONE);this.images.display=C_IMAGE_DISPLAY_CENTER;this.setImage(C_SHAPE_IMAGE_ALL,b);this.value=true;this.imageWidth=412;this.maskWidth=e;this.offsetImage=e;this.addEventNames(["onChanged"]);this.interpolator=new DecelerateInterpolator(2);return this};UISwitch.prototype.updateImageSize=function(a){this.imageWidth=a;this.maskWidth=Math.floor(a*0.373786);if(!this.animating){this.offsetImage=this.value?this.maskWidth:(this.imageWidth-this.maskWidth)}return};UISwitch.prototype.animateChange=function(){var f=this;var d=new Date();var e=d.getTime();var a=this.offsetImage;var c=this.value?this.maskWidth:(this.imageWidth-this.maskWidth);var b=c-a;this.animating=true;var g=500;function h(){var l=new Date();var o=l.getTime();var j=(o-e)/g;var m=f.interpolator.get(j);var p=a+b*m;if(j<1){f.offsetImage=p;setTimeout(h,10)}else{f.offsetImage=c;delete this.animating}f.postRedraw();delete l;return}setTimeout(h,30);return};UISwitch.prototype.onClick=function(a,b){if(b||this.mode!==C_MODE_EDITING){return}this.setValue(!this.value);return};UISwitch.prototype.onPointerDownRunning=function(a,b){if(b){return}this.pointerDownPosition=a;return};UISwitch.prototype.onPointerUpRunning=function(a,c){if(c){return}var b=a.x-this.pointerDownPosition.x;if(Math.abs(b)<5){this.setValue(!this.value)}else{this.setValue(b>0)}return};UISwitch.prototype.setValue=function(a){if(this.value!=a){this.value=a;this.callOnChanged(this.value);this.animateChange()}return};UISwitch.prototype.drawBgImage=function(a){return};UISwitch.prototype.drawFgImage=function(d){var f=this.getHtmlImageByType(C_SHAPE_IMAGE_ALL);if(f){this.updateImageSize(f.width);var e=f.height;var b=this.maskWidth;var c=(this.w-b)/2;var a=(this.h-e)/2;this.imageWidth=f.width;d.drawImage(f,this.offsetImage,0,b,e,c,a,b,e);d.drawImage(f,0,0,b,e,c,a,b,e)}return};function UISwitchCreator(a,d,e,b){var c=["ui-switch","ui-switch",null,1];ShapeCreator.apply(this,c);this.createShape=function(h){var f=new UISwitch();return f.initUISwitch(this.type,a,d,e,b)};return}function UIRadioBox(){return}UIRadioBox.prototype=new UICheckBox();UIRadioBox.prototype.isUIRadioBox=true;UIRadioBox.prototype.initUIRadioBox=function(f,g,d,l,e,b,c,j,a){return this.initUICheckBox(f,g,d,l,e,b,c,j,a)};UIRadioBox.prototype.setParent=function(a){this.parentShape=a;if(this.value){this.setChecked()}return};UIRadioBox.prototype.setChecked=function(){var b=this.parentShape;if(b){for(var c=0;c<b.children.length;c++){var a=b.children[c];if(a.isUIRadioBox){a.setValue(false)}}}this.setValue(true);return};UIRadioBox.prototype.onClick=function(a,b){if(b){return}this.setChecked();return this.callClickHandler(a,b)};function UIRadioBoxCreator(g,d,l,e,b,c,j,a){var f=["ui-radiobox","ui-radiobox",null,1];ShapeCreator.apply(this,f);this.createShape=function(m){var h=new UIRadioBox();h.initUIRadioBox(this.type,g,d,l,e,b,c,j,a);return h};return}function UIProgressBar(){return}UIProgressBar.prototype=new UIElement();UIProgressBar.prototype.isUIProgressBar=true;UIProgressBar.prototype.initUIProgressBar=function(g,b,f,d,c,e,a){this.initUIElement(g);this.setPercent(50);this.setDefSize(b,f);this.setInteractive(d);this.setTextType(C_SHAPE_TEXT_INPUT);this.images.display=C_IMAGE_DISPLAY_9PATCH;this.setSizeLimit(120,40,null,80);this.setImage(C_SHAPE_IMAGE_ALL,c);this.setImage(C_SHAPE_IMAGE_NORMAL_FG,e);this.drawSize=f;this.dragImg=a;if(d){this.addEventNames(["onChanged"]);this.addEventNames(["onChanging"])}return this};UIProgressBar.prototype.shapeCanBeChild=function(a){return(a.isUIImage||a.isUILabel||a.isUIColorTile)};UIProgressBar.prototype.relayoutChildren=function(){var a=this.h;var c=this.h;var b=this.drag;if(b){if(b.isUIColorTile){a=this.h>>1}b.setSize(a,c);b.y=0}return};UIProgressBar.prototype.afterChildAppended=function(b){var e=this;var c=this.drawSize?this.drawSize:this.h;this.setTextType(C_SHAPE_TEXT_NONE);b.yAttr=C_Y_MIDDLE_IN_PARENT;b.setTextType(C_SHAPE_TEXT_NONE);var a=c;var d=c;if(b.isUIColorTile){a=c>>1}b.setSize(a,d);b.setSizeLimit(a,d,a,d);b.setUserResizable(false);b.horMove=function(g){var h=g;var f=e.w-this.w;h=h<0?0:h;h=h<=f?h:f;this.move(h,this.y);return};e.onPointerMoveRunning=function(f,g){if(g){return}if(this.pointerDown){e.isChanging=true;b.horMove(f.x)}return};e.onPointerUpRunning=function(f,g){if(g){return}delete this.isChanging;b.horMove(f.x);b.onMoved();return};e.onSized=function(){this.updateLayoutParams();this.setPercent(this.getPercent());return};b.onMoved=function(){var f=100*(b.x+b.w/2)/e.w;if(b.x===0){f=0}if((b.x+b.w)===e.w){f=100}e.setPercentOnly(f);e.relayoutChildren();return};this.drag=b;return};UIProgressBar.prototype.setInteractive=function(a){this.interactive=a;return};UIProgressBar.prototype.setPercentOnly=function(b,a){var c=(b%101)/100;if(this.value!=c){this.value=c}if(this.mode===C_MODE_EDITING||!this.isVisible()){return}if(a){return}if(this.isChanging){this.callOnChanging(this.getValue())}else{this.callOnChanged(this.getValue())}return};UIProgressBar.prototype.setPercent=function(c,b){this.setPercentOnly(c,b);if(this.drag){var a=this.value*this.w-this.drag.w+5;this.drag.y=Math.floor((this.h-this.drag.h)/2);this.drag.x=Math.floor(a>0?a:0)}return};UIProgressBar.prototype.onClick=function(b,d){if(d){return}if(!this.drag&&this.interactive){var a=b.x-this.x;var c=a/this.w;this.setPercent(c*100)}return};UIProgressBar.prototype.getPercent=function(){return this.value*100};UIProgressBar.prototype.getValue=function(){return this.getPercent()};UIProgressBar.prototype.setValue=function(b,a){this.setPercent(b,a);return};UIProgressBar.prototype.paintSelfOnly=function(c){var b=this.w;var e=this.h>>1;var g=this.h>>2;var f=this.h>>3;var d=this.getHtmlImageByType(C_SHAPE_IMAGE_ALL);var a=this.getHtmlImageByType(C_SHAPE_IMAGE_NORMAL_FG);if(d&&a){return}c.save();c.translate(0,g);if(!d){c.beginPath();c.fillStyle=this.style.fillColor;drawRoundRect(c,b,e,f);c.fill()}b=this.w*this.value;if(!a){c.fillStyle=this.style.lineColor;c.beginPath();if(b>2*f){drawRoundRect(c,b,e,f)}c.fill()}c.restore();return};UIProgressBar.prototype.drawImage=function(b){var d=null;var e=0;var c=this.h;d=this.getHtmlImageByType(C_SHAPE_IMAGE_ALL);if(d){c=d.height;e=(this.h-c)>>1;drawNinePatchEx(b,d,0,0,d.width,d.height,0,e,this.w,c)}d=this.getHtmlImageByType(C_SHAPE_IMAGE_NORMAL_FG);if(d){var a=this.w*this.value;c=d.height;e=(this.h-c)>>1;if(a>=d.width){drawNinePatchEx(b,d,0,0,d.width,d.height,0,e,this.w*this.value,c)}else{b.drawImage(d,0,e)}}return};function UIProgressBarCreator(b,j,d,c,f,a){var g=d?"ui-slider":"ui-progressbar";var e=[g,"ui-progressbar",null,1];ShapeCreator.apply(this,e);this.createShape=function(l){var h=new UIProgressBar();return h.initUIProgressBar(this.type,b,j,d,c,f,a)};return}function UIPage(){return}UIPage.prototype=new UIElement();UIPage.prototype.isUIPage=true;UIPage.prototype.initUIPage=function(b,a){this.initUIElement(b);this.setDefSize(200,200);this.setTextType(C_SHAPE_TEXT_NONE);this.setImage(C_SHAPE_IMAGE_ALL,a);this.widthAttr=C_WIDTH_FILL_PARENT;this.heightAttr=C_HEIGHT_FILL_PARENT;if(!a){this.style.setFillColor("Gold")}return this};UIPage.prototype.show=function(){this.setVisible(true);this.showHTML();return};UIPage.prototype.hide=function(){this.setVisible(false);this.hideHTML();wtkHideAllInput();return};UIPage.prototype.shapeCanBeChild=function(a){if(a.isUIDevice||a.isUIScreen||a.isUIStatusBar||a.isUIWindow||a.isUIPage){return false}if(a.isUIPageIndicator){}return true};UIPage.prototype.paintSelfOnly=function(a){var b=this.getHtmlImageByType(C_SHAPE_IMAGE_ALL);if(!b){a.beginPath();a.fillRect(0,0,this.w,this.h)}return};function UIPageCreator(b){var a=["ui-page","ui-page",null,1];ShapeCreator.apply(this,a);this.createShape=function(d){var c=new UIPage();return c.initUIPage(this.type,b)};return}function UIPageManager(){}UIPageManager.prototype=new UIFrames();UIPageManager.prototype.isUIPageManager=true;UIPageManager.prototype.initUIPageManager=function(a){return this.initUIFrames(a)};UIPageManager.prototype.beforeAddShapeIntoChildren=function(a){return !a.isUIPage};UIPageManager.prototype.shapeCanBeChild=function(a){return a.isUIPage};UIPageManager.prototype.relayoutChildren=function(){for(var b=0;b<this.children.length;b++){var a=this.children[b];a.x=0;a.y=0;a.w=this.w;a.h=this.h;a.relayoutChildren();a.setUserMovable(false);a.setUserResizable(false)}return};UIPageManager.prototype.showHTML=function(){var a=this.getCurrentFrame();if(a){a.showHTML()}return};UIPageManager.prototype.hideHTML=function(){var a=this.getCurrentFrame();if(a){a.hideHTML()}return};UIPageManager.prototype.switchTo=function(d){var h=this;var f=this.getCurrentFrame();var c=this.getFrame(d);var e=this.current;if(f){f.hideHTML()}if(e<0||e===d||!f||!c){this.showFrame(d);if(c){c.showHTML()}return}function j(){h.showFrame(d);h.postRedraw();return}if(!this.isOnTopWindow()){j();return}var b=null;var g=null;var a=this.getPositionInScreen();if(d<e){b=animationCreate("anim-backward");g=preparseBackendCanvas(c,f)}else{b=animationCreate("anim-forward");g=preparseBackendCanvas(f,c)}b.setScale(this.getRealScale());b.prepare(a.x,a.y,this.w,this.h,g,j);b.run();return};function UIPageManagerCreator(){var a=["ui-page-manager","ui-page-manager",null,1];ShapeCreator.apply(this,a);this.createShape=function(c){var b=new UIPageManager();b.initUIPageManager(this.type);return b};return}function UIColorButton(){return}UIColorButton.prototype=new UIElement();UIColorButton.prototype.isUIButton=true;UIColorButton.prototype.isUIColorButton=true;UIColorButton.prototype.initUIColorTile=function(c,a,b){this.initUIColorButton(c,a,b);this.isUIButton=false;this.isUIColorButton=false;this.isUIColorTile=true;this.setAutoScaleFontSize(true);return this};UIColorButton.prototype.initUIColorButton=function(c,a,b){this.initUIElement(c);this.roundRadius=5;this.setDefSize(a,b);this.setTextType(C_SHAPE_TEXT_INPUT);this.setCanRectSelectable(false,false);this.setMargin(8,8);return this};UIColorButton.prototype.setRoundRadius=function(a){this.roundRadius=Math.max(0,a);this.roundRadius=Math.min(this.w/2,this.roundRadius);this.roundRadius=Math.min(this.h/2,this.roundRadius);return};UIColorButton.prototype.shapeCanBeChild=function(a){if(a.isUILabel||a.isUIImage){return true}return false};UIColorButton.prototype.paintSelfOnly=function(b){var a=this.isUIColorButton&&this.pointerDown;b.save();b.beginPath();b.lineWidth=a?5:0;b.strokeStyle=this.style.lineColor;b.translate(this.hMargin,this.vMargin);drawRoundRect(b,this.w-2*this.hMargin,this.h-2*this.vMargin,this.roundRadius);if(!this.isFillColorTransparent()){b.fillStyle=this.style.fillColor;b.fill()}if(a){b.stroke()}b.restore();return};function UIColorTileCreator(a,c){var b=["ui-color-tile","ui-color-tile",null,1];ShapeCreator.apply(this,b);this.createShape=function(e){var d=new UIColorButton();return d.initUIColorTile(this.type,a,c)};return}function UIColorButtonCreator(a,c){var b=["ui-color-button","ui-color-button",null,1];ShapeCreator.apply(this,b);this.createShape=function(e){var d=new UIColorButton();return d.initUIColorButton(this.type,a,c)};return}function UIColorBar(){return}UIColorBar.prototype=new UIElement();UIColorBar.prototype.isUIButton=false;UIColorBar.prototype.isUIColorBar=true;UIColorBar.prototype.initUIColorBar=function(c,a,b){this.initUIElement(c);this.setBarPosition(0);this.setDefSize(a,b);this.setTextType(C_SHAPE_TEXT_NONE);this.setCanRectSelectable(false,false);return this};UIColorBar.prototype.setColorsStr=function(a){this.strColors=a;this.colors=a.split(",");return};UIColorBar.prototype.getColorsStr=function(){return this.strColors};UIColorBar.prototype.getColors=function(){if(!this.colors||!this.colors.length){if(this.strColors){this.colors=this.strColors.split(",")}}return this.colors};UIColorBar.prototype.setBarPosition=function(a){this.barPosition=a;return};UIColorBar.prototype.getBarPosition=function(){return this.barPosition};UIColorBar.prototype.shapeCanBeChild=function(a){return false};UIColorBar.prototype.paintSelfOnly=function(e){var d=0;var b=0;var a=this.getColors();if(!a||!a.length){this.fillRect(0,0,this.w,this.h);return}var g=a.length;var c=this.h>this.w;switch(this.barPosition){case -1:break;case 1:if(c){d=this.w-g}else{b=this.h-g}break;default:if(c){d=Math.floor((this.w-g)/2)}else{b=Math.floor((this.h-g)/2)}}e.lineWidth=1;if(c){for(var f=0;f<g;f++){e.moveTo(d+f,0);e.lineTo(d+f,this.h);e.strokeStyle=a[f];e.stroke()}}else{for(var f=0;f<g;f++){e.moveTo(0,b+f);e.lineTo(this.w,b+f);e.strokeStyle=a[f];e.stroke()}}return};function UIColorBarCreator(a,c){var b=["ui-color-bar","ui-color-bar",null,1];ShapeCreator.apply(this,b);this.createShape=function(e){var d=new UIColorBar();return d.initUIColorBar(this.type,a,c)};return}function UISimpleHTML(){return}UISimpleHTML.prototype=new UIVScrollView();UISimpleHTML.prototype.isUISimpleHTML=true;UISimpleHTML.prototype.initUISimpleHTML=function(c,a,b){this.initUIVScrollView(c,10,b,null);this.setText(a);this.setDefSize(200,200);this.setTextType(C_SHAPE_TEXT_TEXTAREA);this.setImage(C_SHAPE_IMAGE_ALL,b);return this};UISimpleHTML.prototype.extractHtmlElements=function(c,l){var g=0;var e=null;var b=this;var q=c.localName;var d=c.childNodes.length;var p=c.childNodes;function m(s){var r={x:0,y:0};r.type=s;return r}if(q==="b"){this.bold=this.bold+1}else{if(q==="i"){this.italic=this.italic+1}else{if(q==="u"){this.underline=this.underline+1}else{if(q==="a"){this.anchor=this.anchor+1}else{if(q==="ol"||q==="ul"){if(l>0){e=m("newline")}}else{if(q==="li"){e=m("text");if(c.parentNode.localName==="ol"){e.value="    "+(l+1)+". "}else{e.value="    o. "}e.bold=true;e.color="gray";e.fontStyle="bold "}}}}}}if(c.style&&c.style.color){this.colors.push(c.style.color)}if(e){e.tag=q;this.elements.push(e);e=null}for(var g=0;g<d;g++){var j=p[g];this.extractHtmlElements(j,g)}if(q==="img"&&c.src){var a=c.src;var f=new Image();f.onload=function(r){e.imageLoaded=true;b.textNeedRelayout=true;return};f.onerror=function(r){e.imageLoaded=false;if(a){console.log("load "+a+" failed.")}};f.onabort=function(r){e.imageLoaded=false;if(a){console.log("load "+a+" failed(abort).")}};f.src=a;e=m("img");e.value=f}else{if(!d&&c.textContent){var o="";var h=c.textContent.replace(/\t/g," ");for(var g=0;g<h.length;g++){if(h[g]===" "){for(;g<h.length;g++){if(h[g]!=" "){o=o+" "+h[g];break}}}else{o=o+h[g]}}e=m("text");e.value=o;e.bold=this.bold;e.italic=this.italic;e.underline=this.underline;e.anchor=this.anchor;e.fontStyle="";if(this.colors.length){e.color=this.colors[this.colors.length-1]}if(e.bold){e.fontStyle=e.fontStyle+"bold "}if(e.italic){e.fontStyle=e.fontStyle+"italic "}}}if(q==="b"){this.bold=this.bold-1}if(q==="i"){this.italic=this.italic-1}if(q==="u"){this.underline=this.underline-1}if(q==="a"){e=m("a");e.href=c.href;this.anchor=this.anchor-1}if(q==="p"||(c.style!=null&&c.style.display==="block")){e=m("newblock")}else{if(q==="li"||q==="br"||q==="hr"||q==="dd"){e=m("newline")}}if(c.style&&c.style.color){this.colors.pop()}if(e){e.tag=q;this.elements.push(e)}return};UISimpleHTML.prototype.getNodeByPoint=function(o){var f=0;var l=o.x;var h=o.y;var d=null;var g=null;var j={};var b=this.elements.length;var a=this.elements;for(f=0;f<b;f++){d=a[f];g=((f+1)<b)?a[f+1]:null;if(h<d.y){continue}if(g&&(h>g.y&&d.y<g.y)){continue}if(d.type==="text"){var e=0;var c=d.lines.length;j.h=d.lineHeight;for(e=0;e<c;e++){j.x=0;j.y=d.y+e*d.lineHeight;if(e===0){j.x=d.x;j.w=d.firstLineWidth}else{if((e+1)===c){j.w=d.lastLineWidth}else{j.w=this.w}}if(isPointInRect(o,j)){return d}}}else{if(d.type==="img"){j.x=d.x;j.y=d.y;j.w=d.w;j.h=d.h;if(isPointInRect(o,j)){return d}}}}return d};UISimpleHTML.prototype.layoutHtmlElements=function(d){var m=0;var o=0;var l=0;var g=null;var p=0;var b=null;var e=this.elements.length;var a=this.elements;var c=this.getWidth(true);var t=this.style.fontSize;var j=new TextLayout(d);var f=t+"pt "+this.style.fontFamily;var r=t*2;d.font=f;for(m=0;m<e;m++){g=a[m];if(g.type==="text"){g.lines=[];g.x=o;g.y=l;g.firstLineWidth=0;d.font=g.fontStyle+f;g.lineHeight=r;j.setText(g.value);while(true){p=c-o;if(j.hasNext()){b=j.nextLine(p,t);g.lines.push(b.text);if(g.lines.length===1){g.firstLineWidth=b.width}if(j.hasNext()){o=0;l=l+r}else{o=o+b.width;g.lastLineWidth=b.width;break}}else{break}}}else{if(g.type==="newline"){g.x=o;g.y=l;o=0;l=l+r}else{if(g.type==="newblock"){g.x=o;g.y=l;o=0;l=l+r*1.5}else{if(g.type==="img"){if(g.imageLoaded){var h=g.value;var s=h.width;var q=h.height;g.y=l+r*0.5;if(s<c){g.x=(c-s)/2;l=g.y+q;g.w=s;g.h=q}else{g.x=0;g.w=c;g.h=q*(c/s);l=g.y+g.h}l=l+0.5*r}else{l=l+r}o=0}}}}this.scrollRange=l}return};UISimpleHTML.prototype.getScrollRange=function(){return this.scrollRange?this.scrollRange:this.h};UISimpleHTML.prototype.loadUrl=function(d,a){var c={};var b=this;c.method="GET";c.url=d;c.headers={"Cache-Control":"no-cache",Pragma:"no-cache"};c.onDone=function(f,m,g){var l=(m.status===200);if(m.status===200){var h=g;try{b.setText(h);console.log("loadUrl: done")}catch(j){l=false;console.log("loadUrl: failed"+j.message)}}if(a){a(l)}return};httpDoRequest(c);return};UISimpleHTML.prototype.setText=function(b){this.text=this.toText(b);this.elements=[];var a=document.createElement("div");a.innerHTML=this.text;this.bold=0;this.anchor=0;this.italic=0;this.underline=0;this.strong=0;this.colors=[];this.extractHtmlElements(a,0);delete this.colors;delete this.anchor;delete this.bold;delete this.italic;delete this.underline;delete this.strong;this.textNeedRelayout=true;return};UISimpleHTML.prototype.layoutHtml=function(a){if(!this.textNeedRelayout){return}if(!this.text){return}this.layoutHtmlElements(a);this.textNeedRelayout=false;return};UISimpleHTML.prototype.shapeCanBeChild=function(a){return false};UISimpleHTML.prototype.drawText=function(e){var s=0;var j=0;var h=0;var v=0;var r=null;var q=this.getWidth(true);var c=this.style.fontSize;var f=2*c;var u=this.hMargin;var t=-this.offset+this.vMargin;var d=c+"pt "+this.style.fontFamily;this.layoutHtml(e);e.save();e.rect(0,0,this.w,this.h);e.clip();if(!this.isFillColorTransparent()){e.fillStyle=this.style.fillColor;e.fill()}e.beginPath();e.font=d;e.textAlign="left";e.textBaseline="top";e.fillStyle=this.style.textColor;var p=this.elements.length;var l=this.elements;for(s=0;s<p;s++){r=l[s];if(r.type==="text"&&r.lines&&r.lines.length){var m=r.lines.length;e.font=r.fontStyle+d;if(r.color){e.fillStyle=r.color}else{if(r.anchor){e.fillStyle="Blue"}else{e.fillStyle=this.style.textColor}}for(k=0;k<m;k++){if(k===0){j=r.x;h=r.y}else{j=0;h=r.y+k*(f)}j=j+u;h=h+t;v=h+c;if(h<this.h&&v>=0){q=this.w-j-this.hMargin;e.fillText(r.lines[k],j,h,q)}}}else{if(r.type==="img"&&r.imageLoaded){var o=r.value;var a=o.width;var g=o.height;j=r.x+u;h=r.y+t;v=h+r.h;if(h<this.h&&v>=0){e.drawImage(o,0,0,a,g,j,h,r.w,r.h)}}}}e.restore();return};function UISimpleHTMLCreator(){var a=["ui-simple-html","ui-simple-html",null,1];ShapeCreator.apply(this,a);this.createShape=function(d){var c=new UISimpleHTML();var b="Simpe HTML";return c.initUISimpleHTML(this.type,b,null)};return}function UILayout(){return}UILayout.prototype=new UIElement();UILayout.prototype.isUILayout=true;UILayout.prototype.initUILayout=function(d,a,c,b){this.initUIElement(d);this.setDefSize(a,c);this.setTextType(C_SHAPE_TEXT_NONE);this.setImage(C_SHAPE_IMAGE_ALL,b);this.images.display=C_IMAGE_DISPLAY_9PATCH;this.setCanRectSelectable(false,false);this.vLayout=(this.type==="ui-v-layout");this.addEventNames(["onInit"]);return this};UILayout.prototype.shapeCanBeChild=function(a){if(a.isUIDevice||a.isUIScreen||a.isUIStatusBar||a.isUIWindow||a.isUIPageManager||a.isUIPage){return false}return true};UILayout.prototype.paintSelfOnly=function(a){var b=this.getHtmlImageByType(C_SHAPE_IMAGE_ALL);if(!b&&this.mode===C_MODE_EDITING){var j=this.vMargin;var g=this.hMargin;var l=this.getWidth(true);var d=this.getHeight(true);var e=this.vLayout;drawDashedRect(a,j,g,l,d);if(this.children.length===0){if(e){drawDashedLine(a,{x:j,y:0.2*d},{x:l,y:0.2*d},8,4);drawDashedLine(a,{x:j,y:0.5*d},{x:l,y:0.5*d},8,4)}else{drawDashedLine(a,{x:0.2*l,y:g},{x:0.2*l,y:d},8,4);drawDashedLine(a,{x:0.5*l,y:g},{x:0.5*l,y:d},8,4)}}else{for(var c=0;c<this.children.length;c++){var f=this.children[c];if(e){var g=f.y+f.h;drawDashedLine(a,{x:j,y:g},{x:l,y:g},8,4)}else{var j=f.x+f.w;drawDashedLine(a,{x:j,y:g},{x:j,y:d},8,4)}}}a.stroke()}return};UILayout.prototype.sortChildren=function(){var a=this.vLayout;if(a){this.children.sort(function(d,c){var f=c.y;var e=c.pointerDown?d.y+d.h/2:d.y;return e-f})}else{this.children.sort(function(d,c){var f=c.x;var e=c.pointerDown?d.x+d.w/2:d.x;return e-f})}return};UILayout.prototype.relayoutChildren=function(){if(this.disableRelayout){return}var a=this.hMargin;var e=this.vMargin;var d=this.vLayout;for(var c=0;c<this.children.length;c++){var b=this.children[c];if(d){if(b.heightAttr===C_HEIGHT_FILL_PARENT){b.heightAttr=C_HEIGHT_SCALE}b.y=e;b.relayout();b.y=e;e=e+b.h;if(e>this.h){this.h=e+this.vMargin}}else{if(b.widthAttr===C_WIDTH_FILL_PARENT){b.widthAttr=C_WIDTH_SCALE}b.x=a;b.relayout();b.x=a;a=a+b.w;if(a>this.w){this.w=a+this.hMargin}}}return};UILayout.prototype.afterChildAppended=function(a){var b=this.vLayout;if(b){if(a.heightAttr===C_HEIGHT_FILL_PARENT){a.heightAttr=C_HEIGHT_SCALE}}else{if(a.widthAttr===C_WIDTH_FILL_PARENT){a.widthAttr=C_WIDTH_SCALE}}if(this.mode===C_MODE_EDITING&&a.isCreatingElement()){this.sortChildren()}a.setUserMovable(true);a.setUserResizable(true);a.setCanRectSelectable(false,true);return true};function UIVLayoutCreator(a,d,b){var c=["ui-v-layout","ui-layout",null,1];ShapeCreator.apply(this,c);this.createShape=function(f){var e=new UILayout();return e.initUILayout(this.type,a,d,b)};return}function UIHLayoutCreator(a,d,b){var c=["ui-h-layout","ui-layout",null,1];ShapeCreator.apply(this,c);this.createShape=function(f){var e=new UILayout();return e.initUILayout(this.type,a,d,b)};return}function UIPlaceholder(){return}UIPlaceholder.prototype=new UIElement();UIPlaceholder.prototype.isUIPlaceholder=true;UIPlaceholder.prototype.initUIPlaceholder=function(c,a,b){this.initUIElement(c);this.setDefSize(a,b);this.setTextType(C_SHAPE_TEXT_NONE);this.setCanRectSelectable(false,false);return this};UIPlaceholder.prototype.shapeCanBeChild=function(a){return false};UIPlaceholder.prototype.paintSelfOnly=function(c){if(this.mode===C_MODE_EDITING){var a=this.vMargin;var e=this.hMargin;var b=this.getWidth(true);var d=this.getHeight(true);drawDashedRect(c,a,e,b,d);c.stroke()}return};function UIVPlaceholderCreator(a,c){var b=["ui-v-placeholder","ui-placeholder",null,1];ShapeCreator.apply(this,b);this.createShape=function(e){var d=new UIPlaceholder();d.initUIPlaceholder(this.type,a,c);d.widthAttr=C_WIDTH_FILL_PARENT;d.MIN_SIZE=4;d.setSizeLimit(20,4);return d};return}function UIHPlaceholderCreator(a,c){var b=["ui-h-placeholder","ui-placeholder",null,1];ShapeCreator.apply(this,b);this.createShape=function(e){var d=new UIPlaceholder();d.initUIPlaceholder(this.type,a,c);d.heightAttr=C_HEIGHT_FILL_PARENT;d.MIN_SIZE=4;d.setSizeLimit(4,20);return d};return}function UICollapsable(){return}UICollapsable.prototype=new UILayout();UICollapsable.prototype.isUICollapsable=true;UICollapsable.prototype.initUICollapsable=function(d,a,c,b){this.initUILayout(d,a,c,b);this.vLayout=(this.type==="ui-v-collapsable");return this};UICollapsable.prototype.shapeCanBeChild=function(a){if(a.isUIDevice||a.isUIScreen||a.isUIStatusBar||a.isUIWindow||a.isUIPageManager||a.isUIPage){return false}if(this.children.length>=2){return false}return true};UICollapsable.prototype.paintSelfOnly=function(a){a.fillRect(0,0,this.w,this.h);return};UICollapsable.prototype.expandChild=function(c){var b="";if(this.children.length!=2||!c||c.visible){return}var a=null;if(c===this.children[0]){if(this.vLayout){this.y=this.y-c.h;this.h=this.h+c.h;b="anim-expand-up"}else{this.x=this.x-c.w;this.w=this.w+c.w;b="anim-expand-left"}}else{if(c===this.children[1]){if(this.vLayout){this.h=this.h+c.h;b="anim-expand-down"}else{this.w=this.w+c.w;b="anim-expand-right"}}else{return}}c.setVisible(true);this.relayoutChildren();this.parentShape.relayoutChildren("default");c.setVisible(false);animateUIElement(c,b);return};UICollapsable.prototype.collapseChild=function(b){b.setVisible(true);if(this.children.length!=2||!b||!b.visible){return}var a=null;if(b===this.children[0]){if(this.vLayout){animhint="anim-collapse-down";animateUIElement(b,animhint);this.y=this.y+b.h;this.h=this.h-b.h}else{animhint="anim-collapse-right";animateUIElement(b,animhint);this.x=this.x+b.w;this.w=this.w-b.w}}else{if(b===this.children[1]){if(this.vLayout){animhint="anim-collapse-up";animateUIElement(b,animhint);this.h=this.h-b.h}else{animhint="anim-collapse-left";animateUIElement(b,animhint);this.w=this.w-b.w}}else{return}}b.setVisible(false);this.relayoutChildren();this.parentShape.relayoutChildren("default");return};UICollapsable.prototype.getChild=function(a){var b=this.findChildByName(a);if(!b){if(a==="first"||a===0){b=this.children[0]}if(a==="second"||a===1){b=this.children[1]}}return b};UICollapsable.prototype.collapse=function(a){this.collapseChild(this.getChild(a));return};UICollapsable.prototype.expand=function(a){this.collapseChild(this.getChild(a));return};UICollapsable.prototype.collapseOrExpand=function(a){var b=this.getChild(a);if(!b){return}if(b.visible){this.collapseChild(b)}else{this.expandChild(b)}return};UICollapsable.prototype.relayoutChildren=function(){if(this.disableRelayout){return}var a=this.hMargin;var e=this.vMargin;var d=this.vLayout;for(var c=0;c<this.children.length;c++){var b=this.children[c];if(!b.visible){continue}if(d){b.heightAttr=C_HEIGHT_FIX;b.widthAttr=C_WIDTH_FILL_PARENT;b.relayout();b.y=e;e=e+b.h;if(e>this.h){this.h=e+this.vMargin}}else{b.widthAttr=C_WIDTH_FIX;b.heightAttr=C_HEIGHT_FILL_PARENT;b.relayout();b.x=a;a=a+b.w;if(a>this.w){this.w=a+this.hMargin}}}return};function UIVCollapsableCreator(a,d,b){var c=["ui-v-collapsable","ui-collapsable",null,1];ShapeCreator.apply(this,c);this.createShape=function(f){var e=new UICollapsable();e.isUIVCollapsable=true;return e.initUICollapsable(this.type,a,d,b)};return}function UIHCollapsableCreator(a,d,b){var c=["ui-h-collapsable","ui-collapsable",null,1];ShapeCreator.apply(this,c);this.createShape=function(f){var e=new UICollapsable();e.isUIHCollapsable=true;return e.initUICollapsable(this.type,a,d,b)};return}function UILedDigits(){return}UILedDigits.prototype=new UIElement();UILedDigits.prototype.isUILedDigits=true;UILedDigits.prototype.initUILedDigits=function(c,a,b){this.initUIElement(c);this.setDefSize(a,b);this.setTextType(C_SHAPE_TEXT_NONE);return this};UILedDigits.prototype.shapeCanBeChild=function(a){return false};UILedDigits.prototype.setText=function(b){this.text="";b=this.toText(b);for(var a=0;a<b.length;a++){var d=b[a];switch(d){case".":case":":case"0":case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":case"E":case"F":case"F":this.text=this.text+d;default:break}}return};UILedDigits.prototype.drawBarVL=function(b,a,c){b.beginPath();b.moveTo(0,0);b.lineTo(0,c);b.lineTo(a,c-a);b.lineTo(a,a);b.lineTo(0,0);return};UILedDigits.prototype.drawBarVR=function(b,a,c){b.beginPath();b.moveTo(a,0);b.lineTo(a,c);b.lineTo(0,c-a);b.lineTo(0,a);b.lineTo(a,0);return};UILedDigits.prototype.drawBarHT=function(b,a,c){b.beginPath();b.moveTo(0,0);b.lineTo(a,0);b.lineTo(a-c,c);b.lineTo(c,c);b.lineTo(0,0);return};UILedDigits.prototype.drawBarHM=function(b,a,c){b.beginPath();var d=Math.round(c/3);a=a-2*d;b.translate(d,0);b.moveTo(0,c/2);b.lineTo(c/2,0);b.lineTo(a-c/2,0);b.lineTo(a,c/2);b.lineTo(a-c/2,c);b.lineTo(c/2,c);b.lineTo(0,c/2);b.translate(-d,0);return};UILedDigits.prototype.drawBarHB=function(b,a,c){b.beginPath();b.moveTo(0,c);b.lineTo(a,c);b.lineTo(a-c,0);b.lineTo(c,0);b.lineTo(0,c);return};UILedDigits.prototype.drawBar=function(b,a,c){if(a<c){this.drawBarV(b,a,c)}else{this.drawBarH(b,a,c)}return};UILedDigits.prototype.drawDot=function(c,a,e,b){var d=(a/4+e/8)/2;if(b==="."){c.fillRect((a-d)/2,0.75*e-d/2,d,d)}else{if(b=":"){c.fillRect((a-d)/2,0.25*e-d/2,d,d);c.fillRect((a-d)/2,0.75*e-d/2,d,d)}}return};UILedDigits.prototype.map={"0":125,"1":96,"2":55,"3":103,"4":106,"5":79,"6":95,"7":97,"8":127,"9":111,E:31,F:27,H:122};UILedDigits.prototype.fillBar=function(b,a){if(a){b.fillStyle=this.style.textColor;b.fill()}else{b.lineWidth=1;b.strokeStyle=this.style.lineColor;b.stroke()}return};UILedDigits.prototype.drawDigit=function(b,m,e,l){var j=Math.max(3,Math.round(e/10));var c=Math.max(3,Math.round(m/10));var p=Math.round((c+j)/2);var a=1;var g=m-2*a;var f=Math.floor(e/2-2*a);var o=this.map[l];b.translate(a,0);this.drawBarHT(b,g,p);b.translate(-a,0);this.fillBar(b,o&1);var d=Math.floor((e-j)/2);b.translate(a,d);this.drawBarHM(b,g,p);b.translate(-a,-d);this.fillBar(b,(o>>1)&1);var d=e-j;b.translate(a,d);this.drawBarHB(b,g,p);b.translate(-a,-d);this.fillBar(b,(o>>2)&1);b.translate(0,a);this.drawBarVL(b,p,f);b.translate(0,-a);this.fillBar(b,(o>>3)&1);var d=Math.round(2*a+(e-j)/2)+a;b.translate(0,d);this.drawBarVL(b,p,f);b.translate(0,-d);this.fillBar(b,(o>>4)&1);b.translate((m-p),a);this.drawBarVR(b,p,f);b.translate(-(m-p),-a);this.fillBar(b,(o>>5)&1);b.translate((m-p),d);this.drawBarVR(b,p,f);b.translate(-(m-p),-d);this.fillBar(b,(o>>6)&1);return};UILedDigits.prototype.drawDigits=function(b){var j=0;var m=this.text;var c=m.length;if(!c){return}for(var e=0;e<c;e++){var g=m[e];if(g==="."||g===":"){j=j+1}}var a=this.w/c*0.2;var l=this.w/c-a;var f=this.h;b.save();b.translate(l/4*j,0);for(var e=0;e<c;e++){var g=m[e];if(g==="."||g===":"){this.drawDot(b,l/2,f,m[e]);b.translate(l/2+a,0)}else{this.drawDigit(b,l,f,m[e]);b.translate(l+a,0)}}b.restore();return};UILedDigits.prototype.paintSelfOnly=function(a){if(!this.isFillColorTransparent()){a.fillStyle=this.style.fillColor;a.fillRect(0,0,this.w,this.h)}a.fillStyle=this.style.lineColor;this.drawDigits(a);return};function UILedDigitsCreator(a,c){var b=["ui-led-digits","ui-led-digits",null,1];ShapeCreator.apply(this,b);this.createShape=function(e){var d=new UILedDigits();return d.initUILedDigits(this.type,a,c)};return}function UIGauge(){return}UIGauge.prototype=new UIElement();UIGauge.prototype.isUIGauge=true;UIGauge.prototype.initUIGauge=function(c,a,b){this.initUIElement(c);this.setDefSize(a,b);this.setTextType(C_SHAPE_TEXT_NONE);this.setImage(C_SHAPE_IMAGE_ALL,null);this.addEventNames(["onInit"]);return this};UIGauge.prototype.shapeCanBeChild=function(a){return a.isUILedDigits||a.isUILabel||a.isUIGaugePointer};UIGauge.prototype.afterChildAppended=function(b){var e=20;var d=0;if(b.isUIGaugePointer){b.xAttr=C_X_CENTER_IN_PARENT;b.yAttr=C_Y_MIDDLE_IN_PARENT}for(var c=0;c<this.children.length;c++){var a=this.children[c];if(!a.isUIGaugePointer){continue}switch(d){case 0:e=100;break;case 1:e=70;break;case 2:e=40;break}d=d+1;a.setSizeLimit(e,e,e,e,1);a.setSize(e,e)}this.setSizeLimit(100,100,1000,1000,1);return};UIGauge.prototype.paintSelfOnly=function(a){return};function UIGaugeCreator(){var a=["ui-gauge","ui-gauge",null,1];ShapeCreator.apply(this,a);this.createShape=function(c){var b=new UIGauge();return b.initUIGauge(this.type,200,200)};return}function UIGaugePointer(){return}UIGaugePointer.prototype=new UIElement();UIGaugePointer.prototype.isUIGaugePointer=true;UIGaugePointer.prototype.initUIGaugePointer=function(c,a,b){this.initUIElement(c);this.setDefSize(a,b);this.setTextType(C_SHAPE_TEXT_NONE);this.setImage(C_SHAPE_IMAGE_IMAGE,null);this.value=0;this.minAngle=0;this.maxAngle=360;this.minValue=0;this.maxValue=60;return this};UIGaugePointer.prototype.shapeCanBeChild=function(a){return false};UIGaugePointer.prototype.setText=function(b){b=this.toText(b);try{this.setValue(parseInt(b))}catch(a){console.log("UIGaugePointer.prototype.setText:"+a.message)}return};UIGaugePointer.prototype.getText=function(){return this.getValue()+""};UIGaugePointer.prototype.setValue=function(a){if(a>=this.minValue&&a<=this.maxValue){this.value=a}else{console.log("UIGaugePointer.prototype.setValue: Out Of Range.")}return};UIGaugePointer.prototype.getValue=function(){return this.value};UIGaugePointer.prototype.animSetValue=function(b,a){return this.animSetValue(b,a)};UIGaugePointer.prototype.animateSetValue=function(l,h){if(l<this.minValue){l=this.minValue}if(l>this.maxValue){l=this.maxValue}var a=this;var j=l;var c=this.getValue();var g=l-c;var b=Math.abs(g*(this.maxAngle-this.minAngle)/(this.maxValue-this.minValue));if(b<5){this.setValue(l);return}var d=(new Date()).getTime();var e=(h&&h=="slow")?1000:500;function f(){var m=new Date();var o=(m.getTime()-d)/e;if(o<1){var p=c+g*o;a.setValue(p);setTimeout(f,10)}else{delete d;a.setValue(j)}delete m;a.postRedraw()}f();return};UIGaugePointer.prototype.getAngle=function(a){var c=this.maxAngle-this.minAngle;var b=this.maxValue-this.minValue;var d=(this.value/b)*c+this.minAngle;d=Math.PI*(d/180);return d};UIGaugePointer.prototype.paintSelfOnly=function(a){var g=0;var f=0;var j=this.w;var d=this.h;var b=this.getAngle();var c=this.getHtmlImageByType(C_SHAPE_IMAGE_IMAGE);if(c&&c.width){var l=c.width;var e=c.height;a.translate(j/2,d/2);a.rotate(b);a.translate(-j/2,-d/2);g=(j-l)/2;f=(d-e)/2;a.drawImage(c,g,f)}else{a.fillRect(0,0,this.w,this.h)}return};function UIGaugePointerCreator(){var a=["ui-gauge-pointer","ui-gauge-pointer",null,1];ShapeCreator.apply(this,a);this.createShape=function(c){var b=new UIGaugePointer();return b.initUIGaugePointer(this.type,20,200)};return}function UIImageView(){return}UIImageView.prototype=new UIElement();UIImageView.prototype.isUIImageView=true;UIImageView.cachedImages={};UIImageView.IMAGE_STATE_PENDING=0;UIImageView.IMAGE_STATE_ERROR=1;UIImageView.IMAGE_STATE_DONE=2;imageViewInitCustomProp=function(a){};imageThumbViewInitCustomProp=function(a){};imageAnimationInitCustomProp=function(a){};imageSlideViewInitCustomProp=function(a){};UIImageView.prototype.imageViewToJson=function(a){a.userImages=this.getValue();return a};UIImageView.prototype.imageViewFromJson=function(d){this.cacheInvalid=true;if(d.userImages){this.userImages=[];var a=d.userImages.split("\n");var f=a.length;for(var b=0;b<f;b++){var c="image_"+(b+1);var e=this.getImageSrcByType(c);if(e&&e.length>4){this.userImages.push(e)}}}return};UIImageView.prototype.initUIImageView=function(a,b){this.setDefSize(a,b);this.userImages=[];this.onSized=UIImageView.prototype.onSized;this.afterRelayout=UIImageView.prototype.afterRelayout;this.setValue=UIImageView.prototype.setValue;this.getValue=UIImageView.prototype.getValue;this.ensureImages=UIImageView.prototype.ensureImages;this.addUserImage=UIImageView.prototype.addUserImage;this.imageViewToJson=UIImageView.prototype.imageViewToJson;this.imageViewFromJson=UIImageView.prototype.imageViewFromJson;this.onScaleForDensityDone=UIImageView.prototype.onScaleForDensityDone;imageViewInitCustomProp(this);this.regSerializer(this.imageViewToJson,this.imageViewFromJson);return this};UIImageView.createImage=function(d,a){var b=UIImageView.cachedImages[d];if(!b){b=new Image();b.src=d;b.onLoadDoneListeners=[];function c(h,e){if(!h||!h.onLoadDoneListeners){return}for(var f=0;f<h.onLoadDoneListeners.length;f++){var g=h.onLoadDoneListeners[f];g(h,e)}h.onLoadDoneListeners.clear();return}b.onload=function(f){c(this,true);this.loaded=true};b.onabort=function(f){c(this,false);this.failed=true;console.log("load "+this.src+" failed.")};b.onerror=function(f){c(this,false);this.failed=true;console.log("load "+this.src+" failed.")}}else{console.log("Create Image From Cache: "+d)}if(a){if(b.loaded){a(b,true)}else{if(b.failed){a(b,false)}else{b.onLoadDoneListeners.push(a)}}}return b};UIImageView.drawImageAtCenter=function(q,c,j,g,m,d,l){q.clearRect(j,g,m,d);if(c&&c.width>0){var o=c.width;var e=c.height;if(l){var b=Math.min(1,Math.min(d/e,m/o));var a=o*b;var f=e*b;var r=(m-a)/2+j;var p=(d-f)/2+g;r=Math.max(r,j);p=Math.max(p,g)}else{r=j;p=g;a=m;f=d}q.drawImage(c,0,0,o,e,r,p,a,f)}return};UIImageView.prototype.ensureImages=function(){if(!this.cacheInvalid){return}var c=this;function a(g,f){c.postRedraw();return}this.cachedImages=[];for(var b=0;b<this.userImages.length;b++){var e=this.userImages[b];var d=UIImageView.createImage(e,a);this.cachedImages.push(d)}delete this.cacheInvalid;return};UIImageView.prototype.afterRelayout=function(){this.cacheInvalid=true;return};UIImageView.prototype.onSized=function(){this.cacheInvalid=true;return};UIImageView.prototype.onScaleForDensityDone=function(){this.cacheInvalid=true;return};UIImageView.prototype.addUserImage=function(b){this.cacheInvalid=true;this.userImages.push(b);var a="image_"+this.userImages.length;this.setImage(a,b);return};UIImageView.prototype.getCurrentImage=function(){return this.curentImage};UIImageView.prototype.setValue=function(c){var a=c.split("\n");this.userImages=[];this.images={};this.images.display=0;for(var b=0;b<a.length;b++){if(a[b]){this.addUserImage(a[b])}}return};UIImageView.prototype.getValue=function(){var b="";for(var a=0;a<this.userImages.length;a++){var c=this.userImages[a];c=c.replace(/http:\/\/www.drawapp8.net/,"");c=c.replace(/http:\/\/www.drawapp8.com/,"");b=b+c+"\n"}return b};function UIImageNormalView(){return}UIImageNormalView.prototype=new UIImageView();UIImageNormalView.prototype.isUIImageNormalView=true;UIImageNormalView.prototype.initUIImageNormalView=function(c,a,b){this.userImages=[];this.cachedImages=[];this.initUIElement(c);this.initUIImageView(a,b);this.setTextType(C_SHAPE_TEXT_NONE);this.current=0;this.offsetX=0;this.offsetY=0;this.imageScale=1;this.velocityTracker=new VelocityTracker();this.interpolator=new DecelerateInterpolator();this.errorImage=UIImageView.createImage("drawapp8/images/common/failed.png",null);this.loadingImage=UIImageView.createImage("drawapp8/images/common/loading.png",null);return this};UIImageNormalView.prototype.onPointerDownRunning=function(a,b){if(b){return}this.velocityTracker.clear();return};UIImageNormalView.prototype.onPointerMoveRunning=function(a,b){if(b){return}this.offsetX=this.offsetX+this.getMoveDeltaX();this.offsetY=this.offsetY+this.getMoveDeltaY();this.addMovementForVelocityTracker();return};UIImageNormalView.prototype.getVelocity=function(){return this.velocityTracker.getVelocity().x};UIImageNormalView.prototype.onPointerUpRunning=function(g,f){if(f){return}var c=this.velocityTracker.getVelocity();var a=this.w;var e=this.h;var b=c.x/a;var h=c.y/e;var l=Math.max(b,h);var j=0.5*a*b*b;var d=0.5*e*h*h;j=c.x>0?j:-j;d=c.y>0?d:-d;this.scrollTo(j,d,l*1000);return true};UIImageNormalView.prototype.scrollTo=function(g,f,l){var o=this;var d=Math.max(500,Math.min(l,1000));var a=(new Date()).getTime();var j=this.offsetX;var b=this.offsetY;var c=this.cachedImages[this.current];var m=Math.min(c.width/2,g);var h=Math.min(c.height/2,f);function e(){var p=new Date();var q=(p.getTime()-a)/d;if(q<1){o.offsetX=j+q*m;o.offsetY=b+q*h;setTimeout(e,10)}else{delete a;o.offsetX=j+m;o.offsetY=b+h}delete p;o.postRedraw()}e();return};UIImageNormalView.prototype.switchTo=function(b){var a=this.current;var c=this.userImages.length;if(b>0){if((this.current+b)<c){a=this.current+b}}else{if((this.current+b)>0){a=this.current+b}}};UIImageNormalView.prototype.calcImageDefaultOffset=function(){var b=this.current;if(b<0||b>=this.cachedImages.length){return}var d=this.cachedImages[b];if(!d||!d.width){return}this.imageScale=Math.min(this.w/d.width,this.h/d.height);var a=this.imageScale*d.width;var c=this.imageScale*d.height;this.offsetX=(this.w-a)/2;this.offsetY=(this.h-c)/2;return};UIImageNormalView.prototype.setCurrentImage=function(a){if(a<0||a>=this.userImages.length){return}this.current=a;this.calcImageDefaultOffset();return};UIImageNormalView.prototype.onDoubleClick=function(a,b){this.calcImageDefaultOffset();return this.callDoubleClickHandler(a)};UIImageNormalView.prototype.paintSelfOnly=function(a){if(!this.userImages||!this.userImages.length){return}this.ensureImages();var b=this.cachedImages[this.current];if(!b||!b.width){return}this.imageScale=1;a.save();a.rect(0,0,this.w,this.h);a.clip();a.translate(this.offsetX,this.offsetY);a.scale(this.imageScale,this.imageScale);a.drawImage(b,0,0);a.restore();return};function UIUIImageNormalViewCreator(){var a=["ui-image-normal-view","ui-image-normal-view",null,1];ShapeCreator.apply(this,a);this.createShape=function(c){var b=new UIImageNormalView();return b.initUIImageNormalView(this.type,300,300)};return}function UIImageThumbView(){return}UIImageThumbView.prototype=new UIImageView();UIImageThumbView.prototype.isUIImageThumbView=true;UIImageThumbView.prototype.initUIImageThumbView=function(a,b){this.userImages=[];this.imageProxies=[];this.itemSize=0;this.setDefSize(a,b);this.initUIImageView(a,b);this.setItemSize=UIImageThumbView.prototype.setItemSize;this.getCacheCanvas=UIImageThumbView.prototype.getCacheCanvas;this.getCacheCanvasContext=UIImageThumbView.prototype.getCacheCanvasContext;this.getCurrentImage=UIImageThumbView.prototype.getCurrentImage;this.getCurrentImageSrc=UIImageThumbView.prototype.getCurrentImageSrc;imageThumbViewInitCustomProp(this);this.errorImage=UIImageView.createImage("drawapp8/images/common/failed.png",null);this.loadingImage=UIImageView.createImage("drawapp8/images/common/loading.png",null);return this};UIImageThumbView.prototype.setItemSize=function(a){this.itemSize=a?a:100;if(a){this.setSizeLimit(100,a+10,2000,2000)}return};UIImageThumbView.prototype.setKeepRatio=function(a){if(this.keepRatio!=a){this.cacheInvalid=true}this.keepRatio=a;return};UIImageThumbView.prototype.getCacheCanvasContext=function(b,c){if(!this.cacheCanvas){canvas=document.createElement("canvas");canvas.width=b;canvas.height=c;this.cacheCanvas=canvas}if(canvas.width!=b){canvas.width=b}if(canvas.height!=c){canvas.height=c}var a=canvas.getContext("2d");a.clearRect(0,0,b,c);return a};UIImageThumbView.prototype.getCurrentImageSrc=function(){return this.currentImageProxy?this.currentImageProxy.src:null};UIImageThumbView.prototype.getCurrentImage=function(){return this.currentImageProxy?this.currentImageProxy.image:null};UIImageThumbView.createImageProxy=function(g,a,b,f,d,m,l,p,e){var c={};c.x=m;c.y=l;c.w=p;c.h=e;c.src=a;c.imageState=UIImageView.IMAGE_STATE_PENDING;function j(q,h){var r=g.keepRatio;if(h){c.imageState=UIImageView.IMAGE_STATE_DONE;UIImageView.drawImageAtCenter(d,q,c.x,c.y,c.w,c.h,r)}else{c.imageState=UIImageView.IMAGE_STATE_ERROR;UIImageView.drawImageAtCenter(d,f,c.x,c.y,c.w,c.h,r)}console.log("onLoadDone: "+q.src);g.postRedraw()}c.image=UIImageView.createImage(a,j);if(c.imageState===UIImageView.IMAGE_STATE_PENDING){var o=g.keepRatio;UIImageView.drawImageAtCenter(d,b,c.x,c.y,c.w,c.h,o)}return c};UIImageThumbView.prototype.createCacheCanvas=function(){};UIImageThumbView.prototype.getCacheCanvas=function(){if(this.cacheInvalid){this.createCacheCanvas()}return this.cacheCanvas};function UIImageThumbViewTape(){return}UIImageThumbViewTape.prototype=new UIHScrollView();UIImageThumbViewTape.prototype.isUIImageView=true;UIImageThumbViewTape.prototype.isUIImageThumbView=true;UIImageThumbViewTape.prototype.isUIImageThumbViewTape=true;UIImageThumbViewTape.prototype.initUIImageView=UIImageView.prototype.initUIImageView;UIImageThumbViewTape.prototype.initUIImageThumbView=UIImageThumbView.prototype.initUIImageThumbView;UIImageThumbViewTape.prototype.onPointerUpRunning=UIScrollView.prototype.onPointerUpRunning;UIImageThumbViewTape.prototype.initUIImageThumbViewTape=function(c,a,b){this.initUIHScrollView(c,10,null);this.initUIImageThumbView(a,b);this.heightAttr=C_HEIGHT_FIX;return this};UIImageThumbViewTape.prototype.getSpaceBetweenImages=function(){return this.spaceBetweenImages?this.spaceBetweenImages:2};UIImageThumbViewTape.prototype.createCacheCanvas=function(){var b=this.getSpaceBetweenImages();var p=this.w;var j=this.h;var r=(this.itemSize>0&&this.itemSize<j)?this.itemSize:j;var d=this.cacheCanvas;var f=this.userImages.length;delete this.cacheInvalid;this.imageProxies.clear();this.currentImageProxy=null;if(!f){return}p=f*(r+b);var o=0;var m=Math.floor((j-r)/2);var l=this.errorImage;var c=this.loadingImage;var q=this.getCacheCanvasContext(p,j);for(var g=0;g<this.userImages.length;g++){var a=this.userImages[g];var e=UIImageThumbView.createImageProxy(this,a,c,l,q,o,m,r,r);this.imageProxies.push(e);o=o+r+b}return};UIImageThumbViewTape.prototype.getScrollRange=function(){var b=this.h;var c=this.getSpaceBetweenImages();var a=this.userImages.length*(b+c)+c;return a};UIImageThumbViewTape.prototype.paintChildren=function(a){return};UIImageThumbViewTape.prototype.getCacheCanvasOffset=function(){var a=Math.max(0,(this.w-this.cacheCanvas.width)/2);return a};UIImageThumbViewTape.prototype.onClick=function(b,e){if(!this.imageProxies||!this.imageProxies.length||e){return}this.currentImageProxy=null;var a=b.x-this.getCacheCanvasOffset();for(var d=0;d<this.imageProxies.length;d++){var c=this.imageProxies[d];if(a>=c.x&&a<(c.x+c.w)){this.currentImageProxy=c}}this.callClickHandler(b,e);return};UIImageThumbViewTape.prototype.paintSelfOnly=function(a){if(!this.userImages||!this.userImages.length||!this.getCacheCanvas()){a.rect(0,0,this.w,this.h);a.stroke();return}var j=0;var f=0;var e=this.h;var l=this.w;var b=this.getCacheCanvas();var d=this.getCacheCanvasOffset();var g=d;a.rect(0,0,this.w,this.h);a.clip();a.beginPath();if(this.offset>=0){if(g>this.offset){g=g-this.offset;var j=b.width;a.drawImage(this.cacheCanvas,0,0,j,e,g,f,j,e);d=g}else{var c=this.offset-g;var j=Math.min(l,b.width-c);a.drawImage(this.cacheCanvas,c,0,j,e,0,f,j,e);d=-c}}else{g=g-this.offset;var j=Math.min(l+this.offset,b.width);a.drawImage(this.cacheCanvas,0,0,j,e,g,f,j,e);d=g}if(this.currentImageProxy){g=d+this.currentImageProxy.x;f=this.currentImageProxy.y;a.rect(g,f,this.currentImageProxy.w,this.currentImageProxy.h);a.stroke()}return};function UIUIImageThumbViewTapeCreator(){var a=["ui-image-thumb-view-tape","ui-image-thumb-view-tape",null,1];ShapeCreator.apply(this,a);this.createShape=function(c){var b=new UIImageThumbViewTape();return b.initUIImageThumbViewTape(this.type,300,100)};return}function UIImageThumbViewGrid(){return}UIImageThumbViewGrid.prototype=new UIHScrollView();UIImageThumbViewGrid.prototype.isUIImageView=true;UIImageThumbViewGrid.prototype.isUIImageThumbView=true;UIImageThumbViewGrid.prototype.isUIImageThumbViewGrid=true;UIImageThumbViewGrid.prototype.initUIImageView=UIImageView.prototype.initUIImageView;UIImageThumbViewGrid.prototype.initUIImageThumbView=UIImageThumbView.prototype.initUIImageThumbView;UIImageThumbViewGrid.prototype.onPointerUpRunning=UIScrollView.prototype.onPointerUpRunning;UIImageThumbViewGrid.prototype.initUIImageThumbViewGrid=function(c,a,b){this.initUIHScrollView(c,10,null);this.initUIImageThumbView(a,b);this.setSizeLimit(100,40,2000,2000);this.rows=4;this.cols=3;this.pageNr=1;this.itemSize=100;return this};UIImageThumbViewGrid.prototype.calcSize=function(){if(!this.userImages){return}if(this.isIcon){this.cols=3;this.rows=4;this.pageNr=1;return}var j=this.userImages.length;var g=this.getDeviceConfig();var b=g?g.lcdDensity:"hdpi";var f=this.getDensitySizeScale(b)/160;var a=this.w/f;var c=this.h/f;var e=Math.round(a/this.itemSize);var d=Math.round(c/this.itemSize);this.cols=e;this.rows=d;this.pageNr=Math.ceil(j/(d*e));return};UIImageThumbViewGrid.prototype.getSpaceBetweenImages=function(){return this.spaceBetweenImages?this.spaceBetweenImages:2};UIImageThumbViewGrid.prototype.createCacheCanvas=function(){var g=this.userImages.length;var d=this.getSpaceBetweenImages();delete this.cacheInvalid;this.imageProxies.clear();this.currentImageProxy=null;this.calcSize();if(!g){return}var t=0;var s=0;var j=0;var m=this.h;var u=this.pageNr*this.w;var z=this.getCacheCanvasContext(u,m);var v=Math.floor((this.w-d)/this.cols)-d;var o=Math.floor((this.h-d)/this.rows)-d;var p=this.errorImage;var e=this.loadingImage;for(var l=0;l<this.pageNr;l++){s=d;for(var b=0;b<this.rows;b++){t=l*this.w+d;for(var q=0;q<this.cols;q++,j++){if(j>=g){break}var a=this.userImages[j];var f=UIImageThumbView.createImageProxy(this,a,e,p,z,t,s,v,o);this.imageProxies.push(f);t=t+v+d}s=s+o+d}}return};UIImageThumbViewGrid.prototype.getScrollRange=function(){var a=this.pageNr*this.w;return a};UIImageThumbViewGrid.prototype.paintChildren=function(a){return};UIImageThumbViewGrid.prototype.getCacheCanvasOffset=function(){return this.getSpaceBetweenImages()};UIImageThumbViewGrid.prototype.onClick=function(h,g){if(!this.imageProxies||!this.imageProxies.length||g){return}var f=h.x;var e=h.y;var a=this.imageProxies.length;var d=Math.floor(f/this.w);var j=Math.floor(e*this.rows/this.h);var b=Math.floor((f%this.w)*this.cols/this.w);var c=d*this.rows*this.cols+j*this.cols+b;if(c<a){this.currentImageProxy=this.imageProxies[c]}return this.callClickHandler(h,g)};UIImageThumbViewGrid.prototype.paintSelfOnly=function(c){var g=this.getSpaceBetweenImages();if(!this.userImages||!this.userImages.length||!this.getCacheCanvas()){c.rect(0,0,this.w,this.h);c.stroke();return}var b=0;var e=this.w;var j=this.offset;var f=this.getCacheCanvas();var d=f.height;var a=f.width;if(j>=0){var b=Math.min(e,a-j);c.drawImage(this.cacheCanvas,j,0,b,d,0,0,b,d)}else{var b=Math.min(a+j,e);c.drawImage(this.cacheCanvas,0,0,b,d,-j,0,b,d)}if(this.currentImageProxy){y=this.currentImageProxy.y;x=this.currentImageProxy.x-j;c.rect(x,y,this.currentImageProxy.w,this.currentImageProxy.h);c.stroke()}return};function UIUIImageThumbViewGridCreator(){var a=["ui-image-thumb-view-grid","ui-image-thumb-view-grid",null,1];ShapeCreator.apply(this,a);this.createShape=function(c){var b=new UIImageThumbViewGrid();return b.initUIImageThumbViewGrid(this.type,300,100)};return}function UIImageAnimation(){return}UIImageAnimation.prototype=new UIImageView();UIImageAnimation.prototype.isUIImageAnimation=true;UIImageAnimation.prototype.initUIImageAnimation=function(c,a,b){this.initUIElement(c);this.initUIImageView(a,b);this.addEventNames(["onChanged"]);this.setTextType(C_SHAPE_TEXT_NONE);imageAnimationInitCustomProp(this);return this};UIImageAnimation.prototype.setCurrent=function(a){if(this.userImages.length){a=a%this.userImages.length}if(this.currFrame!=a){this.callOnChanged(a)}this.currFrame=a;return};UIImageAnimation.prototype.onInit=function(){var c=this;this.currFrame=0;function a(){if(c.isVisible()){var d=1000/c.getFrameRate();c.postRedraw();setTimeout(a,d);c.setCurrent(c.currFrame+1)}}var b=1000/this.getFrameRate();setTimeout(a,b);return};UIImageAnimation.prototype.getFrameRate=function(){return this.frameRate?this.frameRate:5};UIImageAnimation.prototype.setFrameRate=function(a){this.frameRate=Math.max(1,Math.min(a,30));return};UIImageAnimation.prototype.drawImage=function(c){if(!this.userImages||!this.userImages.length){return}this.ensureImages();var d=(this.currFrame?this.currFrame:0)%this.userImages.length;var f=this.cachedImages[d];if(f&&f.width>0){var e=f.width;var g=f.height;var b=(this.w-e)/2;var a=(this.h-g)/2;c.drawImage(f,0,0,e,g,b,a,e,g)}return};UIImageAnimation.prototype.shapeCanBeChild=function(a){return false};function UIImageAnimationCreator(){var a=["ui-image-animation","ui-image-animation",null,1];ShapeCreator.apply(this,a);this.createShape=function(c){var b=new UIImageAnimation();return b.initUIImageAnimation(this.type,200,200)};return}function UIImageSlideView(){return}UIImageSlideView.prototype=new UIImageView();UIImageSlideView.prototype.isUIImageSlideView=true;UIImageSlideView.prototype.initUIImageSlideView=function(c,a,b){this.initUIElement(c);this.initUIImageView(a,b);this.offset=0;this.addEventNames(["onChanged"]);this.setTextType(C_SHAPE_TEXT_NONE);imageSlideViewInitCustomProp(this);return this};UIImageSlideView.prototype.onInit=function(){var a=this;this.currFrame=0;function b(){if(a.mode!=C_MODE_EDITING&&a.isVisible()){var d=a.getFrameDuration();a.postRedraw();setTimeout(b,d);var e=a.currFrame+1;a.animScrollTo(-a.w,e)}}var c=this.getFrameDuration();setTimeout(b,c);return};UIImageSlideView.prototype.getFrameDuration=function(){return this.frameDuration?this.frameDuration:5000};UIImageSlideView.prototype.setFrameDuration=function(a){this.frameDuration=Math.max(1000,Math.min(a,300000));return};UIImageSlideView.prototype.setShowIndicator=function(a){this.showIndicator=a;return};UIImageSlideView.prototype.getFrameIndicatorParams=function(){var e=this.userImages.length;var d=Math.min((0.5*this.w)/e,40);var c=d*e;var b=(this.w-c)/2;var a=0.8*this.h;return{offsetX:b,offsetY:a,itemSize:d,n:e}};UIImageSlideView.prototype.setCurrentFrame=function(a){this.offset=0;this.currFrame=(a+this.userImages.length)%this.userImages.length;this.postRedraw();this.callOnChanged(this.currFrame);return};UIImageSlideView.prototype.animScrollTo=function(b,h){var f=1000;var d=this;var a=this.offset;var e=(new Date()).getTime();var g=new DecelerateInterpolator(2);if(d.animating){return}d.animating=true;function c(){var l=new Date();var j=(l.getTime()-e)/f;var m=g.get(j);if(j<1){d.offset=a+b*m;setTimeout(c,10)}else{d.offset=0;d.setCurrentFrame(h);delete e;delete g;delete d.animating}delete l;d.postRedraw()}c();return};UIImageSlideView.prototype.onPointerDownRunning=function(a,b){if(!this.velocityTracker){this.velocityTracker=new VelocityTracker()}this.velocityTracker.clear();return true};UIImageSlideView.prototype.onPointerMoveRunning=function(a,d){if(this.animating){this.setLastEventStatus(UIElement.EVENT_STATUS_HANDLED);return}if(this.getLastEventStatus()==UIElement.EVENT_STATUS_HANDLED){return}if(d){return}var e=this.getFrames();var c=this.currFrame;var b=this.getMoveAbsDeltaX();if((c>0&&b>0)||((c+1)<e&&b<0)){this.setLastEventStatus(UIElement.EVENT_STATUS_HANDLED)}else{return}this.offset=b;this.addMovementForVelocityTracker();return};UIImageSlideView.prototype.onPointerUpRunning=function(j,h){if(this.animating){this.setLastEventStatus(UIElement.EVENT_STATUS_HANDLED);return}if(this.getLastEventStatus()==UIElement.EVENT_STATUS_HANDLED){return}if(h){return}var f=this.getFrames();var g=this.currFrame;var l=this.getMoveAbsDeltaX();if((g>0&&l>0)||((g+1)<f&&l<0)){this.setLastEventStatus(UIElement.EVENT_STATUS_HANDLED)}else{return}var d=0;var e=this.offset;var c=this.currFrame;var b=this.velocityTracker.getVelocity().x;var a=e+b;if(Math.abs(e)<10){this.offset=0;return}if(Math.abs(a)>this.w/3){if(e>0){d=this.w-e;c=this.currFrame-1}else{d=-this.w-e;c=this.currFrame+1}}else{d=-e}this.animScrollTo(d,c);return};UIImageSlideView.prototype.onClick=function(g,f){if(f||this.animating){return}var b=this.getFrameIndicatorParams();var l=b.offsetX;var j=b.offsetY;var h=b.itemSize;var a=b.n;var e=g.x;var d=g.y;if(d<j||d>(j+h)||e<l||e>(l+a*h)){return}for(var c=0;c<a;c++){if(e>l&&e<(l+h)){this.setCurrentFrame(c);break}l+=h}return};UIImageSlideView.prototype.drawFrameIndicator=function(c,e){var g=this.getFrameIndicatorParams();var b=g.offsetX;var a=g.offsetY;var f=g.itemSize;var h=g.n;b+=f/2;a+=f/2;for(var d=0;d<h;d++){c.beginPath();c.arc(b,a,10,0,Math.PI*2);b+=f;if(d===e){c.save();c.shadowColor=this.style.lineColor;c.shadowBlur=5;c.shadowOffsetX=0;c.shadowOffsetY=0;c.fill();c.stroke();c.restore()}else{c.fill()}}return};UIImageSlideView.prototype.getPrevFrame=function(){var a=(this.currFrame-1+this.userImages.length)%this.userImages.length;return this.cachedImages[a]};UIImageSlideView.prototype.getFrames=function(){return this.userImages.length};UIImageSlideView.prototype.getNextFrame=function(){var a=(this.currFrame+1)%this.userImages.length;return this.cachedImages[a]};UIImageSlideView.prototype.drawImage=function(a){if(!this.userImages||!this.userImages.length){return}this.ensureImages();var b=(this.currFrame?this.currFrame:0)%this.userImages.length;var c=this.cachedImages[b];if(c&&c.width>0){a.save();a.rect(0,0,this.w,this.h);a.clip();a.beginPath();a.translate(this.offset,0);UIImageView.drawImageAtCenter(a,c,0,0,this.w,this.h,true);var d=Math.abs(this.offset);if(this.offset<0){c=this.getNextFrame();if(c&&c.width>0){a.translate(this.w,0);UIImageView.drawImageAtCenter(a,c,0,0,this.w,this.h,true)}}else{if(d>0){c=this.getPrevFrame();if(c&&c.width>0){a.translate(-this.w,0);UIImageView.drawImageAtCenter(a,c,0,0,this.w,this.h,true)}}}a.restore();if(this.showIndicator){this.drawFrameIndicator(a,b)}}return};UIImageSlideView.prototype.shapeCanBeChild=function(a){return a.isUIButton||a.isUIGroup||a.isUILabel||a.isUIImage};function UIImageSlideViewCreator(){var a=["ui-image-slide-view","ui-image-slide-view",null,1];ShapeCreator.apply(this,a);this.createShape=function(c){var b=new UIImageSlideView();return b.initUIImageSlideView(this.type,200,200)};return}function UIScrollText(){return}UIScrollText.prototype=new UIElement();UIScrollText.prototype.isUIScrollText=true;UIScrollText.prototype.initUIScrollText=function(c,a,b){this.initUIElement(c);this.setDefSize(a,b);this.setTextType(C_SHAPE_TEXT_TEXTAREA);this.setImage(C_SHAPE_IMAGE_ALL,null);this.addEventNames(["onScrollDone"]);return this};UIScrollText.prototype.onModeChanged=function(){this.offsetX=0;this.offsetY=0;return};UIScrollText.prototype.shapeCanBeChild=function(a){return false};UIScrollText.prototype.getAnimationDuration=function(){return this.animationDuration?this.animationDuration:1000};UIScrollText.prototype.setAnimationDuration=function(a){this.animationDuration=a;return};UIScrollText.prototype.getPauseDuration=function(){return this.pauseDuration?this.pauseDuration:0};UIScrollText.prototype.setPauseDuration=function(a){this.pauseDuration=a;return};UIScrollText.prototype.startVScroll=function(){var f=this;var j=this.getTextHeight();var l=this.getLineHeight(true);if(j<=this.h){return}this.offsetX=0;this.offsetY=0;var b=0;var g=0;var c=this.getAnimationDuration();var m=this.getPauseDuration();this.h=Math.floor(this.h/l)*l;var d=-this.h;var a=true;var h=new DecelerateInterpolator();function e(){if(a){a=false;b=(new Date()).getTime()}if(!f.isVisible()){return}var p=new Date();var o=(p.getTime()-b)/c;var q=m>0?h.get(o):o;delete p;if(o<1){f.offsetY=g+d*q;setTimeout(e,10)}else{f.offsetY=g+d;if(Math.abs(f.offsetY)<(j-f.h)){a=true;g=f.offsetY;setTimeout(e,m)}else{delete h;f.callOnScrollDone()}delete b}delete p;f.postRedraw()}setTimeout(e,m);return};UIScrollText.prototype.startHScroll=function(){var f=this;var g=this.textWidth;if(g<=this.w){return}this.offsetX=0;this.offsetY=0;var b=0;var h=0;var c=this.getAnimationDuration();var l=this.getPauseDuration();var d=-this.w;var a=true;var j=new DecelerateInterpolator();function e(){if(a){a=false;b=(new Date()).getTime()}if(!f.isVisible()){return}var o=new Date();var m=(o.getTime()-b)/c;var p=l>0?j.get(m):m;if(m<1){f.offsetX=h+d*p;setTimeout(e,10)}else{f.offsetX=h+d;if(Math.abs(f.offsetX)<(g-f.w)){a=true;h=f.offsetX;setTimeout(e,l)}else{delete b;f.callOnScrollDone()}}delete o;f.postRedraw()}setTimeout(e,l);return};UIScrollText.prototype.startScroll=function(){if(!this.isVisible()){return}if(this.type==="ui-vscroll-text"){this.startVScroll()}else{this.startHScroll()}return};UIScrollText.prototype.onInit=function(){this.offsetX=0;this.offsetY=0;var a=this;setTimeout(function(){a.startScroll()},1000);return};UIScrollText.prototype.drawText=function(b){var a=this.offsetX?this.offsetX:0;var c=this.offsetY?this.offsetY:0;b.save();b.rect(0,0,this.w,this.h);b.clip();b.translate(a,c);b.beginPath();b.font=this.style.getFont();b.fillStyle=this.style.textColor;b.strokeStyle=this.style.lineColor;b.lineWidth=1;if(this.type==="ui-vscroll-text"){this.drawMLText(b,false,true)}else{this.textWidth=this.draw1LText(b,true)}b.restore();return};function UIScrollTextCreator(d,a,c){var b=[d,d,null,1];ShapeCreator.apply(this,b);this.createShape=function(f){var e=new UIScrollText();return e.initUIScrollText(this.type,a,c)};return}function UIViewPager(){return}UIViewPager.prototype=new UIPageManager();UIViewPager.prototype.isUIViewPager=true;UIViewPager.prototype.initUIViewPager=function(a){this.initUIPageManager(a);this.current=0;this.setDefSize(200,200);this.setTextType(C_SHAPE_TEXT_NONE);this.widthAttr=C_WIDTH_FILL_PARENT;this.heightAttr=C_HEIGHT_FILL_PARENT;return this};UIViewPager.prototype.getFrameIndicatorParams=function(){var e=this.children.length;var d=Math.min((0.5*this.w)/e,40);var c=d*e;var b=(this.w-c)/2;var a=0.8*this.h;return{offsetX:b,offsetY:a,itemSize:d,n:e}};UIViewPager.prototype.onClick=function(g,f){if(f||this.animating){return}if(!this.needShowIndicator()){return}var b=this.getFrameIndicatorParams();var e=g.x;var d=g.y;var a=b.n;var l=b.offsetX;var j=b.offsetY;var h=b.itemSize;if(d<j||d>(j+h)||e<l||e>(l+a*h)){return}for(var c=0;c<a;c++){if(e>l&&e<(l+h)){this.setCurrent(c);break}l+=h}return};UIViewPager.prototype.drawFrameIndicator=function(b,f){var d=this.getFrameIndicatorParams();var c=d.n;var j=d.offsetX;var h=d.offsetY;var g=d.itemSize;j+=g/2;h+=g/2;var a=15;b.fillStyle=this.style.fillColor;for(var e=0;e<c;e++){b.beginPath();b.arc(j,h,a,0,Math.PI*2);j+=g;if(e===f){b.save();b.shadowColor=this.style.lineColor;b.shadowBlur=5;b.shadowOffsetX=0;b.shadowOffsetY=0;b.fill();b.stroke();b.restore()}else{b.fill()}}return};UIViewPager.prototype.needShowIndicator=function(){if(this.pageIndicator){return false}if(this.mode===C_MODE_EDITING||this.showIndicator){return true}return false};UIViewPager.prototype.afterPaintChildren=function(a){if(this.needShowIndicator()){this.drawFrameIndicator(a,this.current)}return};UIViewPager.prototype.getPrevFrame=function(){var b=this.children.length;var a=(this.current-1+b)%b;return this.children[a]};UIViewPager.prototype.getNextFrame=function(){var b=this.children.length;var a=(this.current+1)%b;return this.children[a]};UIViewPager.prototype.animScrollTo=function(b,h){var f=1000;var d=this;var a=this.offset;var e=(new Date()).getTime();var g=new DecelerateInterpolator(2);if(d.animating){return}d.animating=true;function c(){var l=new Date();var j=(l.getTime()-e)/f;var m=g.get(j);if(j<1){d.offset=a+b*m;setTimeout(c,10)}else{d.offset=0;d.setCurrent(h);delete e;delete g;delete d.animating}delete l;d.postRedraw()}c();return};UIViewPager.prototype.onPointerDownRunning=function(a,b){if(b||this.animating||!this.slideToChange){return}if(!this.velocityTracker){this.velocityTracker=new VelocityTracker()}this.velocityTracker.clear();return true};UIViewPager.prototype.onPointerMoveRunning=function(a,e){if(!this.slideToChange){return}if(this.animating){this.setLastEventStatus(UIElement.EVENT_STATUS_HANDLED);return}if(this.getLastEventStatus()==UIElement.EVENT_STATUS_HANDLED){return}if(e){return}var f=this.getFrames();var d=this.current;var c=this.getMoveAbsDeltaX();if((d>0&&c>0)||((d+1)<f&&c<0)){this.setLastEventStatus(UIElement.EVENT_STATUS_HANDLED)}else{return}var c=Math.abs(this.getMoveAbsDeltaX());var b=Math.abs(this.getMoveAbsDeltaY());if(c>b&&c>10){this.offset=this.getMoveAbsDeltaX()}else{this.offset=0}this.addMovementForVelocityTracker();return};UIViewPager.prototype.onPointerUpRunning=function(l,j){if(!this.slideToChange){return}if(this.animating){this.setLastEventStatus(UIElement.EVENT_STATUS_HANDLED);return}if(this.getLastEventStatus()==UIElement.EVENT_STATUS_HANDLED){return}if(j){return}var g=this.getFrames();var h=this.current;var o=this.getMoveAbsDeltaX();if((h>0&&o>0)||((h+1)<g&&o<0)){this.setLastEventStatus(UIElement.EVENT_STATUS_HANDLED)}else{return}var e=0;var f=this.offset;var d=this.current;var m=Math.abs(this.getMoveAbsDeltaY());var c=this.velocityTracker.getVelocity().x;if(Math.abs(f)<5||m>60){this.offset=0;return}var b=this.children.length;var a=f+c;if(Math.abs(a)>this.w/3){if(f>0){e=this.w-f;d=(this.current-1+b)%b}else{e=-this.w-f;d=(this.current+1)%b}}else{e=-f}this.animScrollTo(e,d);return};UIViewPager.prototype.paintChildrenAnimating=function(b){var c=this.getCurrentFrame();var e=this.getPrevFrame();var d=this.getNextFrame();b.save();b.rect(0,0,this.w,this.h);b.clip();if(this.offset>0){var a=this.w-this.offset;e.x=-a;e.paintSelf(b);a=this.offset;c.x=a;c.paintSelf(b)}else{c.x=this.offset;c.paintSelf(b);d.x=this.w+this.offset;d.paintSelf(b)}c.x=0;d.x=0;e.x=0;b.restore();return};UIViewPager.prototype.paintChildrenNormal=function(a){var b=this.getCurrentFrame();if(b){a.save();a.beginPath();b.paintSelf(a);a.restore()}return};UIViewPager.prototype.paintChildren=function(a){if(this.offset&&this.children.length>1){this.paintChildrenAnimating(a)}else{this.paintChildrenNormal(a)}return};UIViewPager.prototype.setSlideToChange=function(a){this.slideToChange=a;return};UIViewPager.prototype.setShowIndicator=function(a){this.showIndicator=a;return};UIViewPager.prototype.onModeChanged=function(){this.setCurrent(0);return};function UIViewPagerCreator(){var a=["ui-view-pager","ui-view-pager",null,1];ShapeCreator.apply(this,a);this.createShape=function(c){var b=new UIViewPager();return b.initUIViewPager(this.type)};return}function UIMenu(){return}UIMenu.prototype=new UIList();UIMenu.prototype.isUIMenu=true;UIMenu.prototype.initUIMenu=function(a){this.initUIList(a,5,114,null);this.setAlwaysOnTop(true);return this};UIMenu.prototype.onModeChanged=function(){if(this.mode===C_MODE_EDITING){this.setVisible(true)}else{this.setVisible(false)}return};UIMenu.prototype.show=function(c){this.showDown=true;this.fromLeft=true;this.callerElement=c;if(c){var g=this.y;var a=c.x;var e=this.getWindow().h;var b=this.getWindow().w;var f=c.getPositionInWindow();if((f.y+c.h+this.h)<e||f.y<e*0.3){g=f.y+c.h}else{g=f.y-this.h;this.showDown=false}if(f.x>0.6*b){this.fromLeft=false;a=(f.x+c.w-this.w)}if((a+this.w)>b){a=b-this.w;this.fromLeft=false}this.x=a;this.y=g}var d="";if(this.showDown){d=this.fromLeft?"anim-scale1-show-origin-topleft":"anim-scale1-show-origin-topright"}else{d=this.fromLeft?"anim-scale1-show-origin-bottomleft":"anim-scale1-show-origin-bottomright"}this.animShow(d);this.getWindow().grab(this);return};UIMenu.prototype.hide=function(a){if(!this.visible){return}if(a){if(this.showDown){a=this.fromLeft?"anim-scale1-hide-origin-topleft":"anim-scale1-hide-origin-topright"}else{a=this.fromLeft?"anim-scale1-hide-origin-bottomleft":"anim-scale1-hide-origin-bottomright"}this.animHide(a)}else{this.setVisible(false)}this.getWindow().ungrab(this);delete this.showDown;delete this.fromLeft;delete this.callerElement;return};UIMenu.prototype.onPointerUpRunning=function(a,b){if(!b){this.hide("default")}return};UIMenu.prototype.fixListItemImage=function(b,a){return};function UIMenuCreator(){var a=["ui-menu","ui-menu",null,1];ShapeCreator.apply(this,a);this.createShape=function(c){var b=new UIMenu();return b.initUIMenu(this.type)};return}function UIContextMenu(){return}UIContextMenu.prototype=new UIElement();UIContextMenu.prototype.isUIMenu=true;UIContextMenu.prototype.isUIContextMenu=true;UIContextMenu.prototype.initUIContextMenu=function(a){this.initUIElement(a);this.setMargin(5,5);this.setDefSize(300,80);this.setAlwaysOnTop(true);this.setTextType(C_SHAPE_TEXT_NONE);this.setHideWhenPointerUp(true);return this};UIContextMenu.prototype.onModeChanged=function(){if(this.mode===C_MODE_EDITING){this.setVisible(true)}else{this.setVisible(false)}return};UIContextMenu.prototype.show=function(a){this.showDown=true;this.fromLeft=true;this.callerElement=a;if(a){if(a==this.getParent()){var d=this.getParent();if(this.y>d.h/2){this.showDown=false}}else{var f=this.y;var c=this.getWindow().h;var e=a.getPositionInWindow();if((e.y+a.h+this.h)<c){f=e.y+a.h}else{f=e.y-this.h;this.showDown=false}this.y=f}}var b=this.showDown?"anim-expand-down":"anim-expand-up";this.animShow(b);this.getWindow().grab(this);return};UIContextMenu.prototype.hide=function(a){if(!this.visible){return}if(a){a=this.showDown?"anim-collapse-up":"anim-collapse-down";this.animHide(a)}else{this.setVisible(false)}this.getWindow().ungrab(this);delete this.showDown;delete this.fromLeft;delete this.callerElement;return};UIContextMenu.prototype.setHideWhenPointerUp=function(a){this.hideWhenPointerUp=a;return};UIContextMenu.prototype.onPointerUpRunning=function(a,c){if(c){return}var b=(!a)||(a.x>this.w||a.y>this.h);if(this.hideWhenPointerUp||b){this.hide("default")}return};UIContextMenu.prototype.paintSelfOnly=function(a){var b=this.getHtmlImageByType(C_SHAPE_IMAGE_ALL);if(!b){a.fillRect(0,0,this.w,this.h)}return};UIContextMenu.prototype.afterChildAppended=function(a){a.setUserMovable(false);a.setUserResizable(false);return};UIContextMenu.prototype.shapeCanBeChild=function(a){return a.isUIButton||a.isUIGroup||a.isUIImage||a.isUILabel||a.isUIViewPager||a.isUILayout||a.isUIImageView||a.isUIGrid};UIContextMenu.prototype.relayoutChildren=function(){var b=this.children.length;if(this.disableRelayout||!b){return}var d=this.getVMargin();var a=this.getHMargin();var l=a;var j=d;var m=this.getWidth(true);var e=this.getHeight(true);var f=this.w<this.h;if(f){e=Math.floor(e/b)}else{m=Math.floor(m/b)}for(var c=0;c<this.children.length;c++){var g=this.children[c];g.x=l;g.y=j;g.w=m;g.h=e;if(f){j=j+e}else{l=l+m}g.relayoutChildren()}return};function UIContextMenuCreator(){var a=["ui-context-menu","ui-context-menu",null,1];ShapeCreator.apply(this,a);this.createShape=function(c){var b=new UIContextMenu();return b.initUIContextMenu(this.type)};return}function UIFanMenu(){return}UIFanMenu.prototype=new UIElement();UIFanMenu.prototype.isUIMenu=true;UIFanMenu.prototype.isUIFanMenu=true;UIFanMenu.prototype.initUIFanMenu=function(c,a,b){this.initUIElement(c);this.setDefSize(a,b);this.setTextType(C_SHAPE_TEXT_NONE);return this};UIFanMenu.prototype.getOriginElement=function(){for(var b=0;b<this.children.length;b++){var a=this.children[b];if(a.name==="ui-origin"){return a}}if(this.children.length>0){return this.children[0]}return null};UIFanMenu.prototype.onModeChanged=function(){if(this.mode===C_MODE_EDITING){this.restoreState()}else{this.saveState();this.collapse()}return};UIFanMenu.prototype.restoreState=function(){if(this.save){this.x=this.save.x;this.y=this.save.y;this.w=this.save.w;this.h=this.save.h;for(var b=0;b<this.children.length;b++){var a=this.children[b];if(a.save){a.x=a.save.x;a.y=a.save.y;a.opacity=1}a.setVisible(true)}this.setVisible(true)}return};UIFanMenu.prototype.saveState=function(){var b=this.getOriginElement();if(b){this.save={};this.save.x=this.x;this.save.y=this.y;this.save.w=this.w;this.save.h=this.h;for(var c=0;c<this.children.length;c++){var a=this.children[c];a.save={};a.save.x=a.x;a.save.y=a.y;a.save.opacity=a.opacity}}return};UIFanMenu.prototype.expand=function(){this.getWindow().grab(this);if(this.save){this.x=this.save.x;this.y=this.save.y;this.w=this.save.w;this.h=this.save.h}return};UIFanMenu.prototype.collapse=function(){var b=this.getOriginElement();this.getWindow().ungrab(this);if(b){this.x=this.x+b.x;this.y=this.y+b.y;this.w=b.w;this.h=b.h;for(var c=0;c<this.children.length;c++){var a=this.children[c];a.setVisible(false)}b.x=0;b.y=0;b.setVisible(true)}this.collapsed=true;return};UIFanMenu.prototype.show=function(){};UIFanMenu.prototype.hide=function(){this.collapse();return};UIFanMenu.prototype.showOrHideMenu=function(){if(this.collapsed){this.showMenu()}else{this.hideMenu()}};UIFanMenu.prototype.showMenu=function(){var b=this.getOriginElement();if(!b||!this.collapsed){return}this.expand();b.x=b.save.x;b.y=b.save.y;var c={};for(var d=0;d<this.children.length;d++){var a=this.children[d];a.setVisible(true);if(a!=b){a.x=b.x;a.y=b.y;c.xStart=b.x;c.yStart=b.y;c.xEnd=a.save.x;c.yEnd=a.save.y;c.scaleStart=0.5;c.scaleEnd=1;c.opacityStart=0.1;c.opacityEnd=1;c.delay=0;c.duration=1000;a.animate(c)}}delete this.collapsed;return};UIFanMenu.prototype.hideMenu=function(){var b=this.getOriginElement();if(!b||this.collapsed){return}var c={};for(var d=0;d<this.children.length;d++){var a=this.children[d];if(a!=b){c.xStart=a.x;c.yStart=a.y;c.xEnd=b.x;c.yEnd=b.y;c.opacityStart=1;c.opacityEnd=0.1;c.scaleStart=1;c.scaleEnd=0.5;c.delay=0;c.duration=1000;a.animate(c)}}var e=this;setTimeout(function(){e.collapse()},200);return};UIFanMenu.prototype.onPointerUpRunning=function(a,c){if(c){return}var b=this.getOriginElement();if(b!==this.targetShape){if(this.targetShape){this.hide()}else{this.animHide()}}return};UIFanMenu.prototype.beforePaintChildren=function(c){c.save();c.rect(0,0,this.w,this.h);if(this.mode==C_MODE_EDITING){c.fillStyle=this.style.lineColor;c.stroke()}c.clip();var h=this.getOriginElement();if(h){var d=h.x+h.w/2;var b=h.y+h.w/2;c.strokeStyle="Green";c.fillStyle=this.style.fillColor;var e=0;for(var f=0;f<this.children.length;f++){var g=this.children[f];if(g!=h){var l=d-(g.x+g.w/2);var j=b-(g.y+g.h/2);var a=Math.sqrt(l*l+j*j);if(a>e){e=a}if(this.mode===C_MODE_EDITING){c.beginPath();c.arc(d,b,a,0,2*Math.PI);c.stroke()}}}if(this.mode!=C_MODE_EDITING){c.beginPath();c.globalAlpha=0.2;c.arc(d,b,e,0,2*Math.PI);c.fill()}else{c.fill()}}c.restore();return};function UIFanMenuCreator(){var a=["ui-fan-menu","ui-fan-menu",null,1];ShapeCreator.apply(this,a);this.createShape=function(c){var b=new UIFanMenu();return b.initUIFanMenu(this.type,200,200)};return}function UISlidingMenu(){return}UISlidingMenu.prototype=new UIElement();UISlidingMenu.prototype.isUISlidingMenu=true;UISlidingMenu.prototype.initUISlidingMenu=function(c,a,b){this.initUIElement(c);this.offset=0;this.setTextType(C_SHAPE_TEXT_NONE);this.setImage(C_SHAPE_IMAGE_ALL,null);this.setCanRectSelectable(false,false);this.images.display=C_IMAGE_DISPLAY_9PATCH;return this};UISlidingMenu.prototype.onAppendedInParent=function(){var a=this.getMenu();if(!a){return}if(this.offset){this.setOffset(a.w)}else{this.setOffset(0)}return};UISlidingMenu.prototype.shapeCanBeChild=function(a){return a.isUIPage&&this.children.length<2};UISlidingMenu.prototype.afterChildAppended=function(a){a.setUserMovable(false);if(this.children.length>1&&this.mode==C_MODE_EDITING){var b=this.getMenu();this.setOffset(b.w)}return};UISlidingMenu.prototype.onDoubleClick=function(a,b){if(b||this.mode!=C_MODE_EDITING){return}if(this.offset){this.hideMenu()}else{this.showMenu()}return};UISlidingMenu.prototype.getMenu=function(){if(this.children.length>0){return this.children[0]}return null};UISlidingMenu.prototype.getContent=function(){if(this.children.length>1){return this.children[1]}return null};UISlidingMenu.prototype.showMenu=function(){var a=this.getMenu();if(a){this.scrollTo(a.w)}return};UISlidingMenu.prototype.hideMenu=function(){var a=this.getMenu();if(a){this.scrollTo(0)}return};UISlidingMenu.prototype.relayoutChildren=function(){var d=null;var b=null;var e=this.children.length;if(!e){return}if(e===1){d=this.children[0];d.y=0;d.x=0;d.h=this.h;d.xAttr=C_X_FIX_LEFT;d.yAttr=C_Y_FIX_TOP;d.widthAttr=C_WIDTH_SCALE;d.heightAttr=C_HEIGHT_FILL_PARENT;d.relayout();return}else{d=this.children[0];b=this.children[1];var c=d.w;d.y=0;d.h=this.h;d.xAttr=C_X_FIX_LEFT;d.yAttr=C_Y_FIX_TOP;d.widthAttr=C_WIDTH_SCALE;d.heightAttr=C_HEIGHT_FILL_PARENT;d.relayout();if(c===this.offset){this.offset=d.w}var a=this.offset/d.w;d.x=-Math.round(0.5*((1-a)*d.w));b.y=0;b.x=this.offset;b.h=this.h;b.w=this.w;b.xAttr=C_X_FIX_LEFT;b.widthAttr=C_WIDTH_FIX;b.heightAttr=C_HEIGHT_FILL_PARENT;d.relayoutChildren();b.relayoutChildren()}return};UISlidingMenu.prototype.getMinOffset=function(){return 0};UISlidingMenu.prototype.getMaxOffset=function(){var a=this.getMenu();return a?a.w:0};UISlidingMenu.prototype.scrollTo=function(g){var d=this;var e=500;var h=this.offset;var a=g-h;var c=(new Date()).getTime();var f=new DecelerateInterpolator();this.animating=true;function b(){var l=new Date();var j=(l.getTime()-c)/e;var m=f.get(j);if(j<1){d.setOffset(Math.floor(h+m*a));setTimeout(b,10)}else{d.setOffset(h+a);delete c;delete f;delete d.animating}delete l}setTimeout(function(){b()},10);return};UISlidingMenu.prototype.setOffset=function(b){var a=this.getMenu();this.offset=b;if(a){if(this.offset<0){this.offset=0}if(this.offset>a.w){this.offset=a.w}}this.relayoutChildren();this.postRedraw();return};UISlidingMenu.prototype.onPointerDownRunning=function(a,b){if(b||this.animating){return}if(!this.velocityTracker){this.velocityTracker=new VelocityTracker()}this.velocityTracker.clear();this.saveOffset=this.offset;return true};UISlidingMenu.prototype.onPointerMoveRunning=function(a,d){if(this.animating){this.setLastEventStatus(UIElement.EVENT_STATUS_HANDLED);return}if(this.getLastEventStatus()==UIElement.EVENT_STATUS_HANDLED){return}if(d){return}this.setLastEventStatus(UIElement.EVENT_STATUS_HANDLED);this.addMovementForVelocityTracker();var c=this.getMoveAbsDeltaX();var b=this.getMoveAbsDeltaY();if(Math.abs(c)>Math.abs(b)){this.setOffset(this.saveOffset+c)}return};UISlidingMenu.prototype.onPointerUpRunning=function(h,g){if(this.animating){this.setLastEventStatus(UIElement.EVENT_STATUS_HANDLED);return}if(this.getLastEventStatus()==UIElement.EVENT_STATUS_HANDLED){return}if(g){return}this.setLastEventStatus(UIElement.EVENT_STATUS_HANDLED);var l=this.getMoveAbsDeltaX();var j=this.getMoveAbsDeltaY();if(Math.abs(l)<Math.abs(j)){return}var d=this.velocityTracker.getVelocity().x;var a=l+d/2;if(Math.abs(a)<10){var b=this.getMenu();if(this.offset>10&&b&&(h.x>(b.x+b.w))){this.hideMenu()}else{this.setOffset(this.saveOffset)}return}var f=this.getMinOffset();var c=this.getMaxOffset();var e=this.saveOffset+l+d;if(e<f){e=f}if(e>c){e=c}if(this.saveOffset>(f+c)/2){if(e<=f){e=f}else{e=c}}else{if(e>=c){e=c}else{e=f}}this.scrollTo(e);return};UISlidingMenu.prototype.onInit=function(){if(this.offset){var a=this.getMenu();if(a){this.setOffset(a.w)}}else{this.setOffset(0)}return};UISlidingMenu.prototype.dispatchPointerDownToChildren=function(b){var c=this.getMenu();var a=this.getContent();var d=this.offset?c:a;if(c&&a&&c.x==a.x&&c.x==0){this.setOffset(0)}if(d&&d.visible&&d.onPointerDown(b)){this.setTarget(d);return true}return false};UISlidingMenu.prototype.paintChildren=function(a){a.save();a.beginPath();a.rect(0,0,this.w,this.h);a.clip();a.beginPath();this.defaultPaintChildren(a);a.restore();return};function UISlidingMenuCreator(){var a=["ui-sliding-menu","ui-sliding-menu",null,1];ShapeCreator.apply(this,a);this.createShape=function(c){var b=new UISlidingMenu();return b.initUISlidingMenu(this.type,200,200)};return}function UIPageIndicator(){return}UIPageIndicator.prototype=new UIHScrollView();UIPageIndicator.prototype.isUIPageIndicator=true;UIPageIndicator.prototype.onPointerUpRunning=UIScrollView.prototype.onPointerUpRunning;UIPageIndicator.prototype.isScrollable=function(){return this.getPages()>this.getVisibleTabs()};UIPageIndicator.prototype.setVisibleTabs=function(a){this.visibleTabs=a;return};UIPageIndicator.prototype.getVisibleTabs=function(){return this.visibleTabs?this.visibleTabs:6};UIPageIndicator.prototype.getTabWidth=function(){var b=this.getPages();var a=this.getVisibleTabs();if(b<a){return this.w/b}else{return this.w/a}};UIPageIndicator.prototype.getScrollRange=function(){var a=this.getVisibleTabs();if(a<6){return this.w}else{var b=this.getPages();return this.getTabWidth()*b}};UIPageIndicator.prototype.initUIPageIndicator=function(c,a,b){this.initUIHScrollView(c,10,null);this.setDefSize(a,b);this.setTextType(C_SHAPE_TEXT_NONE);this.setImage(C_SHAPE_IMAGE_ALL,null);this.setCanRectSelectable(false,false);this.images.display=C_IMAGE_DISPLAY_9PATCH;return this};UIPageIndicator.prototype.getViewPager=function(){if(!this.getParent()){return}if(!this.viewPager){this.viewPager=this.getParent().findChildByType("ui-view-pager",true);if(!this.viewPager&&this.isUIPageIndicatorSimple){this.viewPager=this.getWindow().findChildByType("ui-view-pager",true)}}if(this.viewPager){this.viewPager.setShowIndicator(false)}return this.viewPager};UIPageIndicator.prototype.getViewPagerOffset=function(){var a=this.getViewPager();return a?a.offset/a.w:0};UIPageIndicator.prototype.getPages=function(){var a=this.getViewPager();if(a){a.pageIndicator=this}return a?a.getFrames():3};UIPageIndicator.prototype.getCurrent=function(){var a=this.getViewPager();return a?a.getCurrent():0};UIPageIndicator.prototype.paintOneIndicator=function(e,c,d,a,g,b,f){e.beginPath();e.arc(a+b/2,g+f/2,10,0,2*Math.PI);e.fill();if(c){e.stroke()}return};UIPageIndicator.prototype.shapeCanBeChild=function(a){return false};UIPageIndicator.prototype.paintOneIndicatorCircle=function(e,c,d,a,j,b,f){var g=Math.floor(Math.max(10,f/4));e.fillStyle=c?this.fillColorOfCurrent:this.style.fillColor;e.strokeStyle=c?this.lineColorOfCurrent:this.style.lineColor;e.beginPath();e.arc(a+b/2,j+f/2,g,0,2*Math.PI);e.fill();e.stroke();return};UIPageIndicator.prototype.paintOneIndicatorNumber=function(e,b,g,l,j,m,f){var a=Math.floor(Math.max(10,f/4));var d=Math.floor(l+m/2);var c=Math.floor(j+f/2);e.fillStyle=b?this.fillColorOfCurrent:this.style.fillColor;e.strokeStyle=b?this.lineColorOfCurrent:this.style.lineColor;e.beginPath();e.arc(d,c,a,0,2*Math.PI);e.fill();e.stroke();e.font=a<20?"16px sans":"22px sans";e.textAlign="center";e.textBaseline="middle";e.fillStyle=this.style.textColor;e.fillText(g+1,d,c);return};UIPageIndicator.prototype.paintOneIndicatorRect=function(b,a,d,f,e,g,c){var m=10;if(g>c){m=Math.max(20,c/4)}else{m=Math.max(20,g/4)}m=Math.floor(m);b.fillStyle=a?this.fillColorOfCurrent:this.style.fillColor;b.strokeStyle=a?this.lineColorOfCurrent:this.style.lineColor;var l=(g-m)/2;var j=(c-m)/2;b.beginPath();b.rect(f+l,e+j,m,m);b.fill();b.stroke();return};UIPageIndicator.prototype.paintOneIndicatorLine=function(b,a,d,f,e,g,c){var m=4;if(g>c){m=Math.max(4,c/4)}else{m=Math.max(4,g/4)}m=Math.floor(m);b.fillStyle=a?this.fillColorOfCurrent:this.style.fillColor;b.strokeStyle=a?this.lineColorOfCurrent:this.style.lineColor;var l=(g-m)/2;var j=(c-m)/2;b.beginPath();if(g>c){b.rect(f,e+j,g,m)}else{b.rect(f+l,e,m,c)}b.fill();b.stroke();return};UIPageIndicator.prototype.onClickItem=function(b){var a=this.getViewPager();if(a){a.setCurrent(b)}return};UIPageIndicator.prototype.findItemByPoint=function(a){var e=this.getPages();if(this.w>this.h){var d=this.getTabWidth();for(var c=0;c<e;c++){if(a.x>c*d&&a.x<(c+1)*d){return c}}}else{var b=this.h/e;for(var c=0;c<e;c++){if(a.y>c*b&&a.y<(c+1)*b){return c}}}return -1};UIPageIndicator.prototype.onClick=function(a,c){if(c){return}var b=this.findItemByPoint(a);if(b>=0){this.onClickItem(b)}this.callClickHandler(a,b);return};UIPageIndicator.prototype.paintBackground=function(a){};UIPageIndicator.prototype.paintSelfOnly=function(a){var b=this.getPages();var f=this.getCurrent();var g={};g.x=this.lastPosition.x-this.x;g.y=this.lastPosition.y-this.y;this.pointerOnItem=this.findItemByPoint(g);this.paintBackground(a);a.translate(-this.offset,0);if(this.w>this.h){var e=this.h;var h=this.getTabWidth();var c=Math.floor(this.getViewPagerOffset()*h);for(var d=0;d<b;d++){var l=d*h;this.paintOneIndicator(a,d===f,d,l,0,h,e)}}else{var h=this.w;var e=this.h/b;for(var d=0;d<b;d++){var j=d*e;this.paintOneIndicator(a,d===f,d,0,j,h,e)}}a.translate(this.offset,0);delete this.pointerOnItem;return};function UIPageIndicatorCreator(){var a=["ui-page-indicator","ui-page-indicator",null,1];ShapeCreator.apply(this,a);this.createShape=function(c){var b=new UIPageIndicator();return b.initUIPageIndicator(this.type,200,60)};return}function UIPageIndicatorSimple(){return}UIPageIndicatorSimple.prototype.isScrollable=function(){return this.getPages()>this.getVisibleTabs()};UIPageIndicatorSimple.prototype=new UIPageIndicator();UIPageIndicatorSimple.prototype.isUIPageIndicatorSimple=true;UIPageIndicatorSimple.prototype.initUIPageIndicatorSimple=function(c,a,b){this.initUIPageIndicator(c,a,b);this.fillColorOfCurrent="Gray";this.lineColorOfCurrent="Black";this.setAlwaysOnTop(true);return this};UIPageIndicatorSimple.prototype.setLineColorOfCurrent=function(a){this.lineColorOfCurrent=a;return};UIPageIndicatorSimple.prototype.setFillStyleOfCurrent=function(a){this.fillColorOfCurrent=a;return};function UIPageIndicatorCircleCreator(){var a=["ui-page-indicator-circle","ui-page-indicator-circle",null,1];ShapeCreator.apply(this,a);this.createShape=function(c){var b=new UIPageIndicatorSimple();b.paintOneIndicator=UIPageIndicator.prototype.paintOneIndicatorCircle;return b.initUIPageIndicatorSimple(this.type,200,60)};return}function UIPageIndicatorNumberCreator(){var a=["ui-page-indicator-number","ui-page-indicator-number",null,1];ShapeCreator.apply(this,a);this.createShape=function(c){var b=new UIPageIndicatorSimple();b.paintOneIndicator=UIPageIndicator.prototype.paintOneIndicatorNumber;return b.initUIPageIndicatorSimple(this.type,200,60)};return}function UIPageIndicatorRectCreator(){var a=["ui-page-indicator-rect","ui-page-indicator-rect",null,1];ShapeCreator.apply(this,a);this.createShape=function(c){var b=new UIPageIndicatorSimple();b.paintOneIndicator=UIPageIndicator.prototype.paintOneIndicatorRect;return b.initUIPageIndicatorSimple(this.type,200,60)};return}function UIPageIndicatorLineCreator(){var a=["ui-page-indicator-line","ui-page-indicator-line",null,1];ShapeCreator.apply(this,a);this.createShape=function(c){var b=new UIPageIndicatorSimple();b.paintOneIndicator=UIPageIndicator.prototype.paintOneIndicatorLine;return b.initUIPageIndicatorSimple(this.type,200,60)};return}function UIPageIndicatorNormal(){return}UIPageIndicatorNormal.prototype=new UIPageIndicator();UIPageIndicatorNormal.prototype.isUIPageIndicatorNormal=true;UIPageIndicatorNormal.prototype.initUIPageIndicatorNormal=function(c,a,b){this.initUIPageIndicator(c,a,b);this.itemTexts=[];this.itemImages=[];this.imagePosition="left";this.itemImagesOfCurrent=[];this.setMargin(5,5);this.setAlwaysOnTop(false);this.setImage(C_SHAPE_ITEM_BG_NORMAL,null);this.setImage(C_SHAPE_ITEM_BG_ACTIVE,null);this.setImage(C_SHAPE_ITEM_BG_CURRENT_NORMAL,null);this.setImage(C_SHAPE_ITEM_BG_CURRENT_ACTIVE,null);return this};UIPageIndicatorNormal.prototype.fixImagePath=function(b,c){var e=b.version;var d=b.platform;var j=b.lcdDensity;var h=c.version;var a=c.platform;var l=c.lcdDensity;UIElement.prototype.fixImagePath.call(this,b,c);function g(m){m=m.replaceAll("/"+e+"/","/"+h+"/");m=m.replaceAll("/"+d+"/","/"+a+"/");m=m.replaceAll("/"+j+"/","/"+l+"/");return m}var f=g(this.strItemImages);this.setItemImagesByStr(f);f=g(this.strItemImagesOfCurrent);this.setItemImagesOfCurrentByStr(f);return};UIPageIndicatorNormal.prototype.setEnableAnimatePage=function(a){this.enableAnimatePage=a;return};UIPageIndicatorNormal.prototype.setItemImagesByStr=function(e){this.itemImages=[];var a=e.split("\n");var c="item-images-";for(var d=0;d<a.length;d++){var b=a[d];if(b){this.itemImages.push(new WtkImage(b));this.setImage(c+d,b)}}this.strItemImages=e;return};UIPageIndicatorNormal.prototype.setItemImagesOfCurrentByStr=function(e){this.itemImagesOfCurrent=[];var a=e.split("\n");var c="current-item-images-";for(var d=0;d<a.length;d++){var b=a[d];if(b){this.itemImagesOfCurrent.push(new WtkImage(b));this.setImage(c+d,b)}}this.strItemImagesOfCurrent=e;return};UIPageIndicatorNormal.prototype.setItemTextsByStr=function(a){this.strItemTexts=a;this.itemTexts=a.split("\n");return};UIPageIndicatorNormal.prototype.setImagePosition=function(a){this.imagePosition=a;return};UIPageIndicatorNormal.prototype.getItemImagesStr=function(){return this.strItemImages?this.strItemImages:""};UIPageIndicatorNormal.prototype.getItemImagesStrOfCurrent=function(){return this.strItemImagesOfCurrent?this.strItemImagesOfCurrent:""};UIPageIndicatorNormal.prototype.getItemImages=function(){if(!this.itemImages.length&&this.strItemImages){this.setItemImagesByStr(this.strItemImages)}return this.itemImages};UIPageIndicatorNormal.prototype.getItemImagesOfCurrent=function(){if(!this.itemImagesOfCurrent.length&&this.strItemImagesOfCurrent){this.setItemImagesOfCurrentByStr(this.strItemImagesOfCurrent)}return this.itemImagesOfCurrent};UIPageIndicatorNormal.prototype.getItemTextsStr=function(){return this.strItemTexts?this.strItemTexts:""};UIPageIndicatorNormal.prototype.getItemTexts=function(){if(!this.itemTexts.length&&this.strItemTexts){this.setItemTextsByStr(this.strItemTexts)}return this.itemTexts};UIPageIndicatorNormal.prototype.getItemImage=function(c,b){var a=b?this.getItemImagesOfCurrent():this.getItemImages();if(a&&c<a.length){return a[c]}return null};UIPageIndicatorNormal.prototype.getBackgroundImage=function(b,a){var c="";var d=this.pointerDown&&this.pointerOnItem===b;if(a){c=d?C_SHAPE_ITEM_BG_CURRENT_ACTIVE:C_SHAPE_ITEM_BG_CURRENT_NORMAL}else{c=d?C_SHAPE_ITEM_BG_ACTIVE:C_SHAPE_ITEM_BG_NORMAL}return this.getImageByType(c)};UIPageIndicatorNormal.prototype.paintOneIndicatorBackground=function(b,a,f,j,g,l,d){var c=this.getBackgroundImage(f,a);if(!c||!c.getImage()){return}c=c.getImage();var m=c.width;var e=c.height;this.drawImageAt(b,c,this.images.display,j,g,l,d);return};UIPageIndicatorNormal.prototype.setItemTextColorOfCurrent=function(a){this.itemTextColorOfCurrent=a;return};UIPageIndicatorNormal.prototype.getItemTextColorOfCurrent=function(){return this.itemTextColorOfCurrent?this.itemTextColorOfCurrent:"green"};UIPageIndicatorNormal.prototype.paintBackground=function(a){var b=this.getHtmlImageByType(C_SHAPE_IMAGE_NORMAL);if(!b){a.fillStyle=this.style.fillColor;a.rect(0,0,this.w,this.h);a.fill()}return};UIPageIndicatorNormal.prototype.paintOneIndicator=function(d,t,f,l,j,o,v){var q=this.getItemImage(f,t);this.paintOneIndicatorBackground(d,t,f,l,j,o,v);if(q){q=q.getImage()}var r=4;var a=this.getItemTexts();var u=a&&f<a.length?a[f]:null;var c=this.style.fontSize;d.font=this.style.getFont();d.fillStyle=t?this.getItemTextColorOfCurrent():this.style.textColor;if(q){var b=q.width;var g=q.height;var e=this.hMargin;if(u){var s=o;if(this.imagePosition==="left"){var p=l+e;var m=Math.floor(j+(v-g)/2);d.drawImage(q,0,0,b,g,p,m,b,g);m=Math.floor(j+v/2);p=Math.floor(l+(o-b)/2+b);s=o-b-2*e;d.textAlign="center";d.textBaseline="middle";d.fillText(u,p,m,s)}else{if(this.imagePosition==="middle"){this.drawImageAt(d,q,C_IMAGE_DISPLAY_9PATCH,l,j,o,v);var m=Math.floor(j+v/2);var p=Math.floor(l+o/2);s=o-2*e;d.font=this.style.getFont();d.textAlign="center";d.textBaseline="middle";d.fillText(u,p,m,s)}else{var p=Math.floor(l+(o-b)/2);var m=Math.floor(j+(v-g-c-r)/2);d.drawImage(q,0,0,b,g,p,m,b,g);p=Math.floor(l+o/2);m=m+g+r;s=o-2*e;d.textAlign="center";d.textBaseline="top";d.fillText(u,p,m,s)}}}else{var p=Math.floor(l+(o-b)/2);var m=Math.floor(j+(v-g)/2);d.drawImage(q,0,0,b,g,p,m,b,g)}}else{if(u){d.textAlign="center";d.textBaseline="middle";d.fillText(u,Math.floor(l+o/2),Math.floor(j+v/2))}}return};UIPageIndicator.prototype.onClickItem=function(b){var a=this.getViewPager();if(a){if(this.enableAnimatePage){a.switchTo(b)}else{a.setCurrent(b)}}return};function UIPageIndicatorNormalCreator(){var a=["ui-page-indicator-normal","ui-page-indicator-normal",null,1];ShapeCreator.apply(this,a);this.createShape=function(c){var b=new UIPageIndicatorNormal();return b.initUIPageIndicatorNormal(this.type,200,60)};return}var C_UI_ELEMENTS="";function dappRegisterUIElements(){var a=ShapeFactoryGet();a.addShapeCreator(new UIShortcutCreator(),C_UI_ELEMENTS);a.addShapeCreator(new UILoadingWindowCreator(null),C_UI_ELEMENTS);a.addShapeCreator(new UISuggestionCreator(),C_UI_ELEMENTS);a.addShapeCreator(new UISelectCreator("ui-select",300,50),C_UI_ELEMENTS);a.addShapeCreator(new UIFanMenuCreator(),C_UI_ELEMENTS);a.addShapeCreator(new UISlidingMenuCreator(),C_UI_ELEMENTS);a.addShapeCreator(new UIStaticMapCreator(),C_UI_ELEMENTS);a.addShapeCreator(new UIListItemGroupCreator(),C_UI_ELEMENTS);a.addShapeCreator(new UIImageButtonCreator(120,90),C_UI_ELEMENTS);a.addShapeCreator(new UIMenuCreator(),C_UI_ELEMENTS);a.addShapeCreator(new UIContextMenuCreator(),C_UI_ELEMENTS);a.addShapeCreator(new UIPageCreator(null),C_UI_ELEMENTS);a.addShapeCreator(new UIViewPagerCreator(),C_UI_ELEMENTS);a.addShapeCreator(new UIPageIndicatorNormalCreator(),C_UI_ELEMENTS);a.addShapeCreator(new UIPageIndicatorCircleCreator(),C_UI_ELEMENTS);a.addShapeCreator(new UIPageIndicatorNumberCreator(),C_UI_ELEMENTS);a.addShapeCreator(new UIPageIndicatorRectCreator(),C_UI_ELEMENTS);a.addShapeCreator(new UIPageIndicatorLineCreator(),C_UI_ELEMENTS);a.addShapeCreator(new UIPageManagerCreator(),C_UI_ELEMENTS);a.addShapeCreator(new UIScrollTextCreator("ui-vscroll-text",200,200),C_UI_ELEMENTS);a.addShapeCreator(new UIScrollTextCreator("ui-hscroll-text",200,50),C_UI_ELEMENTS);a.addShapeCreator(new UIImageSlideViewCreator(),C_UI_ELEMENTS);a.addShapeCreator(new UIImageAnimationCreator(),C_UI_ELEMENTS);a.addShapeCreator(new UIUIImageNormalViewCreator(),C_UI_ELEMENTS);a.addShapeCreator(new UIUIImageThumbViewTapeCreator(),C_UI_ELEMENTS);a.addShapeCreator(new UIUIImageThumbViewGridCreator(),C_UI_ELEMENTS);a.addShapeCreator(new UIGaugePointerCreator(),C_UI_ELEMENTS);a.addShapeCreator(new UIGaugeCreator(),C_UI_ELEMENTS);a.addShapeCreator(new UILedDigitsCreator(100,100),C_UI_ELEMENTS);a.addShapeCreator(new UIVCollapsableCreator(100,100,null),C_UI_ELEMENTS);a.addShapeCreator(new UIHCollapsableCreator(100,100,null),C_UI_ELEMENTS);a.addShapeCreator(new UIVLayoutCreator(100,100,null),C_UI_ELEMENTS);a.addShapeCreator(new UIVPlaceholderCreator(100,20),C_UI_ELEMENTS);a.addShapeCreator(new UIHLayoutCreator(100,100,null),C_UI_ELEMENTS);a.addShapeCreator(new UIHPlaceholderCreator(20,100),C_UI_ELEMENTS);a.addShapeCreator(new UITipsCreator(),C_UI_ELEMENTS);a.addShapeCreator(new UIGridViewCreator(5,114,null),C_UI_ELEMENTS);a.addShapeCreator(new UIListViewCreator(5,114,null),C_UI_ELEMENTS);a.addShapeCreator(new UISimpleHTMLCreator(),C_UI_ELEMENTS);a.addShapeCreator(new UIColorTileCreator(80,80),C_UI_ELEMENTS);a.addShapeCreator(new UIColorButtonCreator(80,80),C_UI_ELEMENTS);a.addShapeCreator(new UIColorBarCreator(100,10),C_UI_ELEMENTS);a.addShapeCreator(new UIStatusBarCreator("ui-status-bar",640,40,null),C_UI_ELEMENTS);a.addShapeCreator(new UIStatusBarCreator("ui-menu-bar",640,96,null),C_UI_ELEMENTS);a.addShapeCreator(new UIGroupCreator(200,200,null),C_UI_ELEMENTS);a.addShapeCreator(new UIListCheckBoxItemCreator(null,null,null,null,null,null),C_UI_ELEMENTS);a.addShapeCreator(new UIListRadioBoxItemCreator(null,null,null,null,null,null),C_UI_ELEMENTS);a.addShapeCreator(new UISystemMenuCreator(600,400,null),C_UI_ELEMENTS);a.addShapeCreator(new UISwitchCreator(154,54,154,null),C_UI_ELEMENTS);a.addShapeCreator(new UIVScrollViewCreator(0,null,null),C_UI_ELEMENTS);a.addShapeCreator(new UIHScrollViewCreator(0,null),C_UI_ELEMENTS);a.addShapeCreator(new UIDeviceCreator("android","",420,700),C_UI_ELEMENTS);a.addShapeCreator(new UIScreenCreator(640,960),C_UI_ELEMENTS);a.addShapeCreator(new UIListItemCreator(null,null,null,null),C_UI_ELEMENTS);a.addShapeCreator(new UIGridItemCreator(null,null,null,null),C_UI_ELEMENTS);a.addShapeCreator(new UIToolBarCreator("ui-toolbar",true,85,null),C_UI_ELEMENTS);a.addShapeCreator(new UIPopupMenuCreator(600,400,null),C_UI_ELEMENTS);a.addShapeCreator(new UIDialogCreator(600,400,null),C_UI_ELEMENTS);a.addShapeCreator(new UINormalWindowCreator(null),C_UI_ELEMENTS);a.addShapeCreator(new UIWindowManagerCreator(),C_UI_ELEMENTS);a.addShapeCreator(new UIListCreator(5,114,null),C_UI_ELEMENTS);a.addShapeCreator(new UIGridCreator(5,150,null),C_UI_ELEMENTS);a.addShapeCreator(new UIButtonGroupCreator(5,200,null),C_UI_ELEMENTS);a.addShapeCreator(new UIProgressBarCreator(200,45,false,null,null,null),C_UI_ELEMENTS);a.addShapeCreator(new UIProgressBarCreator(200,45,true,null,null,null),C_UI_ELEMENTS);a.addShapeCreator(new UILabelCreator(),C_UI_ELEMENTS);a.addShapeCreator(new UIEditCreator(120,50,12,12,null,null),C_UI_ELEMENTS);a.addShapeCreator(new UIMLEditCreator(300,300,12,null,null),C_UI_ELEMENTS);a.addShapeCreator(new UIImageCreator("ui-icon",32,32,null),C_UI_ELEMENTS);a.addShapeCreator(new UIImageCreator("ui-image",200,200,null),C_UI_ELEMENTS);a.addShapeCreator(new UIWaitBarCreator("ui-wait-box",60,60,null,C_IMAGE_DISPLAY_CENTER),C_UI_ELEMENTS);a.addShapeCreator(new UIWaitBarCreator("ui-wait-bar",200,24,null,C_IMAGE_DISPLAY_SCALE),C_UI_ELEMENTS);a.addShapeCreator(new UIButtonCreator(120,60),C_UI_ELEMENTS);a.addShapeCreator(new UICheckBoxCreator(160,60,null,null,null,null,null,null),C_UI_ELEMENTS);a.addShapeCreator(new UIRadioBoxCreator(50,50,null,null,null,null,null,null),C_UI_ELEMENTS);a.addShapeCreator(new UICanvasCreator(200,200),C_UI_ELEMENTS);return}VelocityTracker.prototype.HISTORY_SIZE=20;VelocityTracker.prototype.HORIZON=200*1000000;VelocityTracker.prototype.MIN_DURATION=10*1000000;function Movement(){this.eventTime=0;this.point=new Point(0,0);this.getPoint=function(){return this.point};return this}function VelocityTracker(){this.clear();return this}VelocityTracker.prototype.clear=function(){this.index=0;var b=this.HISTORY_SIZE;if(!this.movements){this.movements=new Array();for(var c=0;c<b;c++){this.movements.push(new Movement())}}for(var c=0;c<b;c++){var a=this.movements[c];a.eventTime=0;a.point={x:0,y:0}}return};VelocityTracker.prototype.addMovement=function(b,a){if(++this.index==this.HISTORY_SIZE){this.index=0}this.movements[this.index].eventTime=b;this.movements[this.index].point=a;return};VelocityTracker.prototype.getVelocity=function(){var a={x:0,y:0};this.estimate();a.x=this.xVelocity;a.y=this.yVelocity;return a};VelocityTracker.prototype.estimate=function(){var w=this.HORIZON;var j=this.MIN_DURATION;var r=this.HISTORY_SIZE;var b=this.movements[this.index];var s=b.eventTime-w;var v=this.index;var t=1;do{var u=(v==0?r:v)-1;var c=this.movements[u];if(c.eventTime<s){break}v=u}while(++t<r);var f=0;var e=0;var d=v;var g=0;var l=this.movements[v];var h=l.getPoint();var p=0;while(t-->1){if(++d==r){d=0}var q=this.movements[d];var a=q.eventTime-l.eventTime;if(a>=j){var A=q.getPoint();var z=1000000000/a;var o=(A.x-h.x)*z;var m=(A.y-h.y)*z;f=(f*p+o*a)/(a+p);e=(e*p+m*a)/(a+p);p=a;g+=1}}if(g){this.xVelocity=f;this.yVelocity=e}else{this.xVelocity=0;this.yVelocity=0}return true};function testVelocityTracker(){var a=null;var d=new VelocityTracker();function c(e){return e*1000000}for(var b=0;b<20;b++){d.addMovement(c(10*b),{x:10*b,y:10*b*b/2})}a=d.getVelocity();console.log("xv: "+a.x+" yv: "+a.y);return}function Interpolator(){this.get=function(a){return 0};return this}function LinearInterpolator(){this.get=function(a){return a};return this}function BounceInterpolator(){function a(b){return 8*b*b}this.get=function(b){b*=1.1226;if(b<0.3535){return a(b)}else{if(b<0.7408){return a(b-0.54719)+0.7}else{if(b<0.9644){return a(b-0.8526)+0.9}else{return a(b-1.0435)+0.95}}}};return this}function AccelerateInterpolator(){this.get=function(a){return a*a};return this}function AccDecelerateInterpolator(){this.get=function(a){return((Math.cos((a+1)*Math.PI)/2)+0.5)};return this}function DecelerateInterpolator(a){this.factor=a?a:2;this.get=function(b){if(this.factor===1){return(1-(1-b)*(1-b))}else{return(1-Math.pow((1-b),2*this.factor))}};return this}function AnimationFactory(){this.animations=[];this.createAnimation=function(b){var c=this.animations[b];if(c){return c}var a=isIPhone()?2:3;switch(b){case"anim-forward":var d=new DecelerateInterpolator();c=isAndroid()?new AnimationHTranslateAndroid(true):new AnimationHTranslate(true);c.toLeft();c.init(200*a,d);break;case"anim-backward":var d=new DecelerateInterpolator();c=isAndroid()?new AnimationHTranslateAndroid(true):new AnimationHTranslate(false);c.toRight();c.init(200*a,d);break;case"anim-scale-show-win":var d=new DecelerateInterpolator(1);if(isMobile()){c=new AnimationBrowserScaleWin(true);c.setRange(1.2,1)}else{c=new AnimationScale(true);c.setRange(0.9,1)}c.init(600,d);break;case"anim-scale-hide-win":var d=new AccelerateInterpolator();if(isMobile()){c=new AnimationBrowserScaleWin(false);c.setRange(0.9,1)}else{c=new AnimationScale(false);c.setRange(1,0.9)}c.init(400,d);break;case"anim-scale-show-dialog":var d=new DecelerateInterpolator();c=isAndroid()?new AnimationBrowserScaleDialog(true):new AnimationScale(true);c.setRange(0.9,1);c.init(300,d);break;case"anim-scale-hide-dialog":var d=new AccelerateInterpolator();c=isAndroid()?new AnimationBrowserScaleDialog(false):new AnimationScale(false);c.setRange(1,0.9);c.init(300,d);break;case"anim-fade-in":var d=new AccelerateInterpolator();c=isAndroid()?new AnimationBrowserAlpha(true):new AnimationAlpha(true);c.setRange(0.6,1);c.init(500,d);break;case"anim-fade-out":var d=new AccelerateInterpolator();c=isAndroid()?new AnimationBrowserAlpha(false):new AnimationAlpha(false);c.setRange(1,0.8);c.init(300,d);break;case"anim-move-up":var d=new DecelerateInterpolator();c=isMobile()?new AnimationBrowserMove(true):new AnimationMove(true);c.init(600,d);break;case"anim-move-down":var d=new AccelerateInterpolator();c=isMobile()?new AnimationBrowserMove(false):new AnimationMove(false);c.init(600,d);break;case"anim-expand-up":case"anim-expand-left":case"anim-expand-right":case"anim-expand-down":var d=new DecelerateInterpolator();c=new Animation1Expand(true);c.init(400,d);break;case"anim-collapse-up":case"anim-collapse-left":case"anim-collapse-right":case"anim-collapse-down":var d=new AccelerateInterpolator();c=new Animation1Expand(true);c.init(400,d);break;case"anim-scale1-show-origin-topleft":case"anim-scale1-show-origin-center":case"anim-scale1-show-origin-bottomleft":case"anim-scale1-show-origin-topright":case"anim-scale1-show-origin-bottomright":case"anim-scale1-show":var d=new DecelerateInterpolator();c=new Animation1Scale(true);c.init(400,d);break;case"anim-scale1-hide-origin-topleft":case"anim-scale1-hide-origin-center":case"anim-scale1-hide-origin-bottomleft":case"anim-scale1-hide-origin-topright":case"anim-scale1-hide-origin-bottomright":case"anim-scale1-hide":var d=new AccelerateInterpolator();c=new Animation1Scale(false);c.init(400,d);break;case"anim-alpha1-show":var d=new DecelerateInterpolator();c=new Animation1Alpha(true);c.init(400,d);break;case"anim-alpha1-hide":var d=new AccelerateInterpolator();c=new Animation1Alpha(false);c.init(400,d);break}this.animations[b]=c;return c};return this}var gAnimationFactory=null;function AnimationFactoryGet(){if(!gAnimationFactory){gAnimationFactory=new AnimationFactory()}return gAnimationFactory}function animationCreate(a){return AnimationFactoryGet().createAnimation(a)}var gAnimationOldWinCanvas=null;function AnimationOldWinCanvasGet(){if(!gAnimationOldWinCanvas){gAnimationOldWinCanvas=document.createElement("canvas");gAnimationOldWinCanvas.type="animation_canvas"}gAnimationOldWinCanvas.style.opacity=1;gAnimationOldWinCanvas.style.zIndex=9;return gAnimationOldWinCanvas}function AnimationCanvasGet(){var a=AnimationOldWinCanvasGet();scaleElement(a,1,1);return a}var gAnimationNewWinCanvas=null;function AnimationNewWinCanvasGet(){if(!gAnimationNewWinCanvas){gAnimationNewWinCanvas=document.createElement("canvas");gAnimationNewWinCanvas.type="animation_canvas"}gAnimationNewWinCanvas.style.opacity=1;gAnimationNewWinCanvas.style.zIndex=9;return gAnimationNewWinCanvas}var gBackendCanvas=null;function BackendCanvasGet(b,a){if(!gBackendCanvas){gBackendCanvas=document.createElement("canvas");gBackendCanvas.type="backend_canvas";gBackendCanvas.width=b;gBackendCanvas.height=a}if(gBackendCanvas){if(gBackendCanvas.width!=b){gBackendCanvas.width=b}if(gBackendCanvas.height!=a){gBackendCanvas.height=a}}scaleElement(gBackendCanvas,1,1);return gBackendCanvas}function Animation(a){this.scale=1;this.visible=false;this.showWin=a;this.init=function(b,c){this.duration=b?b:500;this.interpolator=c;return};this.setRectOfFront=function(b,e,c,d){this.frontX=b;this.frontY=e;this.frontW=c;this.frontH=d;return};this.setScale=function(b){this.scale=b;return};this.prepare=function(b,g,c,e,d,f){this.x=Math.round(b);this.y=Math.round(g);this.w=Math.round(c);this.h=Math.round(e);this.onFinish=f;this.canvasImage=d;this.setRectOfFront(0,0,c,e);if(d){this.sw=d.width;this.sh=d.height}this.show();return true};this.moveResizeCanvas=function(d,b,f,c,e){d.style.position="absolute";d.width=c;d.height=e;d.style.left=b+"px";d.style.top=f+"px";d.style.width=c+"px";d.style.height=e+"px";d.style.visibility="visible";return};this.show=function(){var b=this.w*this.scale;var c=this.h*this.scale;this.visible=true;this.canvasElement=AnimationCanvasGet();this.moveResizeCanvas(this.canvasElement,this.x,this.y,b,c);document.body.appendChild(this.canvasElement);return true};this.hide=function(){this.visible=false;if(this.canvasElement){document.body.removeChild(this.canvasElement);this.canvasElement=null}return true};this.getTimePercent=function(){var c=new Date();var b=c.getTime()-this.startTime;return b/this.duration};this.getPercent=function(b){return this.interpolator.get(b)};this.step=function(b){return true};this.beforeRun=function(){return true};this.afterRun=function(){return true};this.drawBackground=function(d){if(this.isFirstStep){this.canvas.drawImage(this.canvasImage,0,0,this.w,this.h,0,0,this.w,this.h)}else{var b=this.frontX;var f=this.frontY;var c=this.frontW;var e=this.frontH;this.canvas.drawImage(this.canvasImage,b,f,c,e,b,f,c,e)}return};this.doStep=function(b){this.canvas.save();this.canvas.scale(this.scale,this.scale);this.step(b);this.canvas.restore();return};this.run=function(){var c=new Date();var d=this;this.startTime=c.getTime();d.isFirstStep=true;this.beforeRun();function b(){var f=0;var e=d.getTimePercent();if(e<1){f=d.getPercent(e);d.doStep(f);requestAnimFrame(b)}else{d.cleanup();d.afterRun();console.log("Animation done.")}d.isFirstStep=false}b();return};this.cleanup=function(){var c=this;var b=this.onFinish;setTimeout(function(){c.hide()},100);if(b){b()}};this.hide();return this}function setElementPosition(b,a,c){b.style.position="absolute";b.style.left=Math.round(a)+"px";b.style.top=Math.round(c)+"px";b.style.opacity=1;return}function moveElement(b,a,c){setElementPosition(b,a,c);return}function alphaElement(b,a){b.style.opacity=a;return}function showElement(a){a.style.opacity=1}function hideElement(a){a.style.opacity=0}function scaleElement(c,b,e,a,g){var h=(a&&g)?a+" "+g:"50% 50%";var f=["transform","-ms-transform","-webkit-transform","-o-transform","-moz-transform"];c.style["transform-style"]="preserve-3d";for(var d=0;d<f.length;d++){var j=f[d];c.style[j+"-origin"]=h;c.style[j]="scale("+b+")"}c.style.opacity=e;return}function AnimationHTranslateAndroid(){Animation.apply(this,arguments);this.leftToRight=true;this.show=function(){document.body.appendChild(gBackendCanvas);gBackendCanvas.style.zIndex=9;this.canvasElement=gBackendCanvas;setElementPosition(gBackendCanvas,this.x,this.y);return true};this.hide=function(){if(this.canvasElement){document.body.removeChild(this.canvasElement);this.canvasElement=null}return true};this.doStep=function(a){this.step(a);return};this.beforeRun=function(){var a=this.sw-this.w;this.range=a*0.7;this.start=a-this.range;return};this.toLeft=function(){this.leftToRight=true;return};this.toRight=function(){this.leftToRight=false;return};this.step=function(b){var a=0;if(this.leftToRight){a=this.start+this.range*b}else{a=this.w-this.range*b-this.start}moveElement(gBackendCanvas,-a+this.x,this.y);return true}}function AnimationHTranslate(){Animation.apply(this,arguments);this.leftToRight=true;this.beforeRun=function(){var a=this.sw-this.w;if(isMobile()){this.range=a*0.8}else{this.range=a}this.start=a-this.range;this.canvas=this.canvasElement.getContext("2d")};this.toLeft=function(){this.leftToRight=true;return};this.toRight=function(){this.leftToRight=false;return};this.step=function(b){var a=0;if(this.leftToRight){a=this.start+this.range*b}else{a=this.w-this.range*b-this.start}if(this.lastOffset===a){return true}this.canvas.drawImage(this.canvasImage,a,0,this.w,this.h,0,0,this.w,this.h);this.lastOffset=a;return true}}function AnimationScale(){Animation.apply(this,arguments);this.to=1;this.from=0;this.frontX=0;this.frontY=0;this.frontW=0;this.frontH=0;this.setRange=function(b,a){this.to=a;this.from=b;return};this.beforeRun=function(){this.canvas=this.canvasElement.getContext("2d")};this.step=function(c){var e=this.from+c*(this.to-this.from);var d=this.to>this.from?c:(1-c);if(this.canvasImage){var b=this.canvas;var a=this.frontX+0.5*this.frontW;var f=this.frontY+0.5*this.frontH;this.drawBackground(b);b.save();b.translate(a,f);b.globalAlpha=d;b.scale(e,e);b.translate(-0.5*this.frontW,-0.5*this.frontH);b.drawImage(this.canvasImage,this.frontX+this.w,this.frontY,this.frontW,this.frontH,0,0,this.frontW,this.frontH);b.restore()}return true}}function AnimationAlpha(){Animation.apply(this,arguments);this.to=1;this.from=0;this.frontX=0;this.frontY=0;this.frontW=0;this.frontH=0;this.setRange=function(b,a){this.to=a;this.from=b;return};this.beforeRun=function(){this.canvas=this.canvasElement.getContext("2d")};this.step=function(b){var c=this.from+b*(this.to-this.from);if(this.canvasImage){var a=this.canvas;a.drawImage(this.canvasImage,0,0,this.w,this.h,0,0,this.w,this.h);a.save();a.globalAlpha=c;a.drawImage(this.canvasImage,this.frontX+this.w,this.frontY,this.frontW,this.frontH,this.frontX,this.frontY,this.frontW,this.frontH);a.restore()}return true}}function AnimationMove(a){Animation.apply(this,arguments);this.beforeRun=function(){this.range=this.frontH;this.canvas=this.canvasElement.getContext("2d");return true};this.step=function(g){this.drawBackground(this.canvas);var b=this.frontX;var j=this.frontY;var e=this.frontW;var d=this.range*g;var f=this.showWin?d:(this.range-d);var c=this.showWin?(this.frontY+this.range-d):(this.frontY+d);if(f>0){this.canvas.drawImage(this.canvasImage,b+this.w,j,e,f,b,c,e,f)}return true}}function AnimationBrowser(a){Animation.apply(this,arguments);this.to=1;this.from=0;this.frontX=0;this.frontY=0;this.frontW=0;this.frontH=0;this.setRange=function(c,b){this.to=b;this.from=c;return};this.onShowCanvas=function(){setElementPosition(this.oldWinCanvas,this.x,this.y);setElementPosition(this.newWinCanvas,this.x,this.y);showElement(this.oldWinCanvas);showElement(this.newWinCanvas);return};this.showCanvas=function(j,g){var d=this.w;var f=this.h;var b=AnimationOldWinCanvasGet();var l=AnimationNewWinCanvasGet();this.moveResizeCanvas(b,this.x,this.y,d,f);this.moveResizeCanvas(l,this.x,this.y,d,f);b.style.zIndex=j;l.style.zIndex=g;var c=b.getContext("2d");var e=l.getContext("2d");if(this.showWin){c.drawImage(gBackendCanvas,0,0,d,f,0,0,d,f);e.drawImage(gBackendCanvas,this.w,0,d,f,0,0,d,f)}else{e.drawImage(gBackendCanvas,0,0,d,f,0,0,d,f);c.drawImage(gBackendCanvas,this.w,0,d,f,0,0,d,f)}this.oldWinCanvas=b;this.newWinCanvas=l;this.onShowCanvas();if(j>g){document.body.appendChild(l);document.body.appendChild(b)}else{document.body.appendChild(l);document.body.appendChild(b)}return true};this.show=function(){this.showCanvas(8,9);return true};this.hide=function(){if(this.oldWinCanvas&&this.newWinCanvas){if(this.showWin){document.body.removeChild(this.oldWinCanvas);document.body.removeChild(this.newWinCanvas)}else{document.body.removeChild(this.oldWinCanvas);document.body.removeChild(this.newWinCanvas)}this.newWinCanvas=null;this.oldWinCanvas=null}return true};this.afterRun=function(){};this.doStep=function(b){this.step(b);return};this.step=function(b){var d=this.from+b*(this.to-this.from);var c=b;scaleElement(this.newWinCanvas,d,c);return true}}function AnimationBrowserScaleWin(a){AnimationBrowser.apply(this,arguments);this.onShowCanvas=function(){setElementPosition(this.oldWinCanvas,this.x,this.y);setElementPosition(this.newWinCanvas,this.x,this.y);showElement(this.oldWinCanvas);hideElement(this.newWinCanvas);return};this.step=function(b){var c=b;var d=this.from+b*(this.to-this.from);scaleElement(this.newWinCanvas,d,c);return true}}function AnimationBrowserScaleDialog(a){AnimationBrowser.apply(this,arguments);this.show=function(){if(this.showWin){this.showCanvas(8,9)}else{this.showCanvas(9,8)}return true};this.step=function(b){var d=this.from+b*(this.to-this.from);var c=this.showWin?b:1-b;if(this.showWin){scaleElement(this.newWinCanvas,d,c)}else{scaleElement(this.oldWinCanvas,d,c)}return true}}function AnimationBrowserAlpha(a){AnimationBrowser.apply(this,arguments);this.show=function(){if(this.showWin){this.showCanvas(8,9)}else{this.showCanvas(9,8)}};this.step=function(b){var c=this.from+b*(this.to-this.from);if(this.showWin){alphaElement(this.newWinCanvas,c)}else{alphaElement(this.oldWinCanvas,c)}return true}}function AnimationBrowserMove(a){AnimationBrowser.apply(this,arguments);this.onShowCanvas=function(){if(this.showWin){setElementPosition(this.oldWinCanvas,this.x,this.y);setElementPosition(this.newWinCanvas,this.x,this.frontH)}else{setElementPosition(this.oldWinCanvas,this.x,this.y);setElementPosition(this.newWinCanvas,this.x,this.y)}showElement(this.oldWinCanvas);showElement(this.newWinCanvas);return};this.show=function(){if(this.showWin){this.showCanvas(8,9)}else{this.showCanvas(9,8)}return};this.step=function(d){var c=0;this.range=this.frontH;var b=this.range*d;if(this.showWin){c=this.range-b;moveElement(this.newWinCanvas,0,c)}else{c=b;moveElement(this.oldWinCanvas,0,c)}return true}}var C_DIR_UP=1;var C_DIR_DOWN=2;var C_DIR_LEFT=3;var C_DIR_RIGHT=4;var C_ACTION_EXPAND=1;var C_ACTION_COLLAPSE=2;function Animation1Expand(){Animation.apply(this,arguments);this.prepare=function(a,f,b,d,c,e){this.x=Math.round(a);this.y=Math.round(f);this.w=Math.round(b);this.h=Math.round(d);this.onFinish=e;this.canvasImage=c;this.xto=this.xfrom=0;this.yto=this.yfrom=0;this.wto=this.wfrom=b;this.hto=this.hfrom=d;this.show();return};this.expandV=function(a){this.direction=a?C_DIR_UP:C_DIR_DOWN;this.action=C_ACTION_EXPAND;this.yfrom=this.h;this.yto=0;this.hfrom=0;this.hto=this.h;return};this.expandH=function(a){this.direction=a?C_DIR_LEFT:C_DIR_RIGHT;this.action=C_ACTION_EXPAND;this.xfrom=this.w;this.xto=0;this.wfrom=0;this.wto=this.w;return};this.collapseV=function(a){this.direction=a?C_DIR_UP:C_DIR_DOWN;this.action=C_ACTION_COLLAPSE;this.yfrom=0;this.yto=this.h;this.hfrom=this.h;this.hto=0;return};this.collapseH=function(a){this.direction=a?C_DIR_LEFT:C_DIR_RIGHT;this.action=C_ACTION_COLLAPSE;this.xfrom=0;this.xto=this.w;this.wfrom=this.w;this.wto=0;return};this.expandUp=function(){return this.expandV(true)};this.expandDown=function(){return this.expandV(false)};this.expandLeft=function(){return this.expandH(true)};this.expandRight=function(){return this.expandH(false)};this.collapseUp=function(){return this.collapseV(true)};this.collapseDown=function(){return this.collapseV(false)};this.collapseLeft=function(){return this.collapseH(true)};this.collapseRight=function(){return this.collapseH(false)};this.show=function(){this.canvasElement=AnimationCanvasGet();this.moveResizeCanvas(this.canvasElement,this.x,this.y,this.w,this.h);this.canvas=this.canvasElement.getContext("2d");document.body.appendChild(this.canvasElement);this.canvasElement.style.zIndex=9;setElementPosition(this.canvasElement,this.x,this.y);showElement(this.canvasElement);return true};this.hide=function(){this.visible=false;if(this.canvasElement){document.body.removeChild(this.canvasElement);this.canvasElement=null}return true};this.step=function(c){var a=this.canvas;var g=this.xfrom+((this.xto-this.xfrom)*c);var e=this.yfrom+((this.yto-this.yfrom)*c);var j=this.wfrom+(this.wto-this.wfrom)*c;var b=this.hfrom+(this.hto-this.hfrom)*c;if(!j||!b){return}a.clearRect(0,0,this.w,this.h);var m=g;var l=e;var f=g;var d=e;if(this.action===C_ACTION_EXPAND){switch(this.direction){case C_DIR_UP:d=0;break;case C_DIR_DOWN:l=0;break;case C_DIR_LEFT:f=0;break;case C_DIR_RIGHT:m=0;break}}else{switch(this.direction){case C_DIR_UP:l=0;break;case C_DIR_DOWN:d=0;break;case C_DIR_LEFT:m=0;break;case C_DIR_RIGHT:f=0;break}}a.drawImage(this.canvasImage,f,d,j,b,m,l,j,b);return true}}function Animation1Alpha(){Animation.apply(this,arguments);this.prepare=function(a,f,b,d,c,e){this.x=Math.round(a);this.y=Math.round(f);this.w=Math.round(b);this.h=Math.round(d);this.onFinish=e;this.canvasImage=c;this.show();return};this.setRange=function(b,a){this.from=b;this.to=a;return};this.show=function(){this.canvasElement=AnimationCanvasGet();this.moveResizeCanvas(this.canvasElement,this.x,this.y,this.w,this.h);this.canvas=this.canvasElement.getContext("2d");document.body.appendChild(this.canvasElement);this.canvasElement.style.zIndex=9;setElementPosition(this.canvasElement,this.x,this.y);showElement(this.canvasElement);this.canvas.drawImage(this.canvasImage,0,0,this.w,this.h,0,0,this.w,this.h);return true};this.hide=function(){this.visible=false;if(this.canvasElement){try{document.body.removeChild(this.canvasElement)}catch(a){console.log("document.body.removeChild: not found.")}this.canvasElement=null}return true};this.step=function(c){var b=this.canvas;var a=this.from+(this.to-this.from)*c;alphaElement(this.canvasElement,a);console.log("opacity:"+a);return true}}function Animation1Scale(){Animation.apply(this,arguments);this.prepare=function(a,f,b,d,c,e){this.x=Math.round(a);this.y=Math.round(f);this.w=Math.round(b);this.h=Math.round(d);this.xOrigin="50%";this.yOrigin="50%";this.onFinish=e;this.canvasImage=c;this.show();return};this.setOrigin=function(b,a){this.xOrigin=b;this.yOrigin=a;return};this.setRange=function(b,a){this.from=b;this.to=a;return};this.show=function(){this.canvasElement=AnimationCanvasGet();this.moveResizeCanvas(this.canvasElement,this.x,this.y,this.w,this.h);this.canvas=this.canvasElement.getContext("2d");document.body.appendChild(this.canvasElement);this.canvasElement.style.zIndex=9;setElementPosition(this.canvasElement,this.x,this.y);showElement(this.canvasElement);this.canvas.drawImage(this.canvasImage,0,0,this.w,this.h,0,0,this.w,this.h);return true};this.hide=function(){this.visible=false;if(this.canvasElement){document.body.removeChild(this.canvasElement);this.canvasElement=null}return true};this.step=function(b){var a=this.canvas;var d=this.from+(this.to-this.from)*b;var c=this.showWin?b:1-b;scaleElement(this.canvasElement,d,c,this.xOrigin,this.yOrigin);return true}}function animateUIElement(j,g){var c=false;var d=j.getRealScale();var a=j.getPositionInView();var r=j.view.getAbsPosition();var o=Math.round(a.x*d)+r.x;var l=Math.round(a.y*d)+r.y;var q=Math.round(j.w*d);var f=Math.round(j.h*d);var m=BackendCanvasGet(q,f);var b=m.getContext("2d");b.save();c=j.visible;j.visible=true;b.scale(d,d);b.translate(-j.x,-j.y);j.paint(b);j.visible=c;b.restore();var e=animationCreate(g);e.prepare(o,l,q,f,m,function(){j.setVisible(!c);j.postRedraw()});if(c){j.setVisible(!c);j.postRedraw()}switch(g){case"anim-expand-up":e.expandUp();break;case"anim-expand-left":e.expandLeft();break;case"anim-expand-right":e.expandRight();break;case"anim-expand-down":e.expandDown();break;case"anim-collapse-up":e.collapseUp();break;case"anim-collapse-left":e.collapseLeft();break;case"anim-collapse-right":e.collapseRight();break;case"anim-collapse-down":e.collapseDown();break;case"anim-scale1-show-origin-topleft":e.setOrigin("0%","0%");e.setRange(0.5,1);break;case"anim-scale1-show-origin-center":e.setOrigin("50%","50%");e.setRange(0.5,1);break;case"anim-scale1-show-origin-bottomleft":e.setOrigin("0%","100%");e.setRange(0.5,1);break;case"anim-scale1-show-origin-topright":e.setOrigin("100%","0%");e.setRange(0.5,1);break;case"anim-scale1-show-origin-bottomright":e.setOrigin("100%","100%");e.setRange(0.5,1);break;case"anim-scale1-show":e.setRange(0.5,1);break;case"anim-scale1-hide-origin-topleft":e.setOrigin("0%","0%");e.setRange(1,0.5);break;case"anim-scale1-hide-origin-center":e.setOrigin("50%","50%");e.setRange(1,0.5);break;case"anim-scale1-hide-origin-bottomleft":e.setOrigin("0%","100%");e.setRange(1,0.5);break;case"anim-scale1-hide-origin-topright":e.setOrigin("100%","0%");e.setRange(1,0.5);break;case"anim-scale1-hide-origin-bottomright":e.setOrigin("100%","100%");e.setRange(1,0.5);break;case"anim-scale1-hide":e.setRange(1,0.5);break;case"anim-alpha1-show":e.setRange(0.2,1);break;case"anim-alpha1-hide":e.setRange(1,0.2);break}e.run();return}function testAnimation1Expand(a){var b=a.getWindow().findChildByName("ui-button-test",true);b.setVisible(false);b.postRedraw();setTimeout(function(){animateUIElement(b,"anim-alpha1-show")},100);setTimeout(function(){animateUIElement(b,"anim-alpha1-hide")},3000);return}function DeviceLocalFileSystem(){this.rootEntry=null;this.fileSystem=null;this.setContentType=function(a){this.contentType=a;return};this.setInitPath=function(a){return a};this.setVirtualRoot=function(a){return a};this.init=function(){var b=this;function c(d){console.log("gotFS");b.fileSystem=d;b.rootEntry=d.root;return}function a(d){console.log("requestFileSystem failed: "+d);return}console.log("init");window.requestFileSystem(1,2*1024*1024,c,a)};this.list=function(c,b){var a=function(g){function h(j){var m=[];for(var o=0;o<j.length;o++){var p={};var l=j[o];if(l.name.indexOf(".")===0){continue}p.size=0;p.mtime=0;p.name=l.name;p.type=l.isDirectory?"folder":"file";l.getMetadata(function(q){p.mtime=q.modificationTime},function(q){});m.push(p)}b(m);console.log("onReadEntriesOK")}function f(j){b(null)}var e=g.createReader();e.readEntries(h,f);console.log("onGetDirectoryOK");return};function d(e){console.log("error getting dir:"+c)}console.log("list");this.fileSystem.root.getDirectory(c,{create:true,exclusive:false},a,d);return};this.read=function(b,e){function a(g){var f=new FileReader();f.onloadend=function(h){e(b,h.target.result)};f.readAsText(g);return}function c(f){console.log("getFile Failed: "+b)}function d(f){f.file(a,c);return}this.fileSystem.root.getFile(b,{create:false,exclusive:false},d,c);return};this.remove=function(a,c){function b(d){c(false);console.log("Remove File Fail:"+a);return}this.fileSystem.root.getFile(a,{create:false},function(d){d.remove(function(){c(true);console.log("File removed:"+a)},b)},b);return};this.save=function(b,c,f){function e(g){g.onerror=function(h){console.log("write failed:"+b);f(false,b)};if(g.length){g.truncate(0);console.log("truncate "+b);g.onwriteend=function(h){console.log("writer.truncate done");g.onwriteend=function(j){console.log("write success:"+b);f(true,b)};g.write(c)}}else{g.onwriteend=function(h){console.log("write success:"+b);f(true,b)};g.write(c)}return}function a(g){alert(dappGetText("Write File Failed: "+b));console.log("getFile Failed: "+b+" code:"+g.code)}function d(g){g.createWriter(e,a);return}this.fileSystem.root.getFile(b,{create:true,exclusive:false},d,a);return};this.init();return}function WebStorageFileSystem(){this.setContentType=function(a){this.contentType=a;return};this.setInitPath=function(a){return"/"};this.setVirtualRoot=function(a){return"/"};this.fileNameToName=function(b){var a=b.split("/");return a.pop()};this.makeKey=function(a){return"fs-"+a};this.getMetaInfos=function(){var b=localStorage.fsMetaInfos;var a=b?JSON.parse(b):null;if(!a){a=[]}return a};this.removeMetaInfo=function(c){var b=this.getMetaInfos();for(var d=0;d<b.length;d++){var a=b[d];if(a.name==c){b.splice(d,1);break}}localStorage.fsMetaInfos=JSON.stringify(b);return};this.addMetaInfo=function(d,g,f){var c=this.getMetaInfos();for(var e=0;e<c.length;e++){var a=c[e];if(a.name==d){c.splice(e,1);break}}var b={};b.name=d;b.size=f;b.mtime=g;c.push(b);localStorage.fsMetaInfos=JSON.stringify(c);return};this.list=function(g,e){var b=[];var c=this.getMetaInfos();for(var d=0;d<c.length;d++){var a=c[d];var f={};f.type="file";f.name=a.name;f.size=a.size;f.mtime=a.mtime;b.push(f)}e(b);return};this.read=function(a,d){var b=this.fileNameToName(a);var c=localStorage[this.makeKey(b)];d(a,c);return};this.remove=function(a,c){var b=this.fileNameToName(a);delete localStorage[this.makeKey(b)];this.removeMetaInfo(b);c(true,a);return};this.save=function(b,f,a){var d=this.fileNameToName(b);var c=(new Date()).getTime();var e=f?f.length:0;this.addMetaInfo(d,c,e);localStorage[this.makeKey(d)]=f;a(true,b);return}}var gDefaultFileSystem=null;function getDefaultFileSystem(){if(!gDefaultFileSystem){appInitFilesystem()}return gDefaultFileSystem}function appInitFilesystem(){if(gDefaultFileSystem){return}if(window.tizen){tizenFsInit();gDefaultFileSystem=new TizenFileSystem()}else{if(window.requestFileSystem){gDefaultFileSystem=new DeviceLocalFileSystem()}else{gDefaultFileSystem=new WebStorageFileSystem()}}console.log("window.requestFileSystem: "+window.requestFileSystem);return}var tizenStockDirs={};var tizenStockDirNames=["documents","downloads","images","music","removable","videos"];function tizenFsInit(){function c(g){console.log("tizen.filesystem.resolve Error: "+g.message)}function a(e){console.log("resolve: "+e);tizen.filesystem.resolve(e,function(g){g.name=g.name?g.name:e;tizenStockDirs[e]=g;console.log("tizen.filesystem.resolve done:"+e+":"+g)},c,"rw")}for(var d=0;d<tizenStockDirNames.length;d++){var b=tizenStockDirNames[d];try{a(b)}catch(f){console.log(f.message)}}console.log("tizenFsInit");return}function TizenFileSystem(){this.contentType="String";this.setContentType=function(a){this.contentType=a;return};this.setInitPath=function(a){return a};this.setVirtualRoot=function(a){return a};this.getDirHandle=function(j,d){var h=1;var f=j.split("/");f.remove("");f.remove("");var g=f.length>0?f[0]:"/";var e=tizenStockDirs[g];var c=e;if(!e){d(e);return}if(f.length<2){d(e);return}function b(l){console.log(l.message)}function a(m){var q=false;var o=f[h];for(var p=0;p<m.length;p++){var l=m[p];if(l.name==f[h]){if(!l.isDirectory){c=null;d(null);return}q=true;h+=1;c=l;if(h<f.length){c.listFiles(a,b)}else{d(c)}}}if(!q){c=c.createDirectory(o);h+=1;if(h<f.length){c.listFiles(a,b)}else{d(c)}}}e.listFiles(a,b)};this.list=function(g,e){if(!g||g==="/"){var b=[];for(var d=0;d<tizenStockDirNames.length;d++){var a=tizenStockDirNames[d];var c=tizenStockDirs[a];if(c){var f={};f.type="folder";f.name=a;f.size=c.length;f.userData=c;b.push(f);console.log(d+": "+f.name+" "+f.type)}}e(b);return}function h(j){function l(o){var q=[];for(var r=0;r<o.length;r++){var s={};var p=o[r];s.type=p.isFile?"file":"folder";s.name=p.name;s.size=p.isFile?p.fileSize:p.length;s.userData=p;console.log(r+": "+s.name+" "+s.type);q.push(s)}e(q)}function m(o){e(null)}j.listFiles(l,m)}this.getDirHandle(g,h);return};this.read=function(b,f){var d=this;var a=b.split("/");var c=a.pop();var e=a.join("/");function g(j){function h(o){var q=null;if(d.contentType=="ArrayBytes"){q=o.readBytes(o.bytesAvailable)}else{if(d.contentType=="ArrayBuffer"){var r=o.readBytes(o.bytesAvailable);var s=r.length;q=new Uint8Array(s);for(var p=0;p<s;p++){q[p]=r[p]}console.log("Read As ArrayBuffer: length="+s)}else{q=o.read(o.bytesAvailable);console.log("Read As String: length="+q.length)}}f(b,q);o.close()}function m(o){f(b,null)}function l(o){for(var q=0;q<o.length;q++){var p=o[q];if(p.name==c){if(p.isFile){p.openStream("r",h,m,"UTF-8")}else{f(b,null)}return}}f(b,null)}j.listFiles(l,m)}this.getDirHandle(e,g);return};this.remove=function(d,j){var a=d.split("/");var b=a.shift();while(!b&&a.length){b=a.shift()}d=a.join("/");function h(l){j(true);console.log("deleteFile OK:"+d)}function f(l){j(false);console.log("deleteFile Failed:"+l.message)}var c=tizenStockDirs[b];if(c){try{c.deleteFile(c.fullPath+"/"+d,h,f)}catch(g){console.log("deleteFile Failed: "+g.message)}}else{j(false)}return};this.save=function(c,f,b){var e=this;var a=c.split("/");var d=a.pop();var g=a.join("/");function h(l){if(!l){alert("Save File Failed.");b(false,c);return}function j(q){try{if(e.contentType=="base64"){if(f.indexOf("data:")>=0&&f.indexOf(";base64,")>0){var u=f.indexOf(";base64,")+8;q.writeBase64(f.substr(u))}else{q.writeBase64(f)}}else{if(e.contentType=="ArrayBytes"){q.writeBytes(f)}else{if(e.contentType=="ArrayBuffer"){var s=[];var v=f.byteLength;var p=new Uint8Array(f);for(var r=0;r<v;r++){s.push(p[r])}q.writeBytes(s)}else{q.write(f)}}}q.close();b(true,c)}catch(t){b(false,c)}}function o(p){alert("Save File Failed.");b(false,c)}function m(p){for(var s=0;s<p.length;s++){var q=p[s];if(q.name==d){if(q.isFile){q.openStream("w",j,o,"UTF-8")}else{b(false,c)}return}}var r=l.createFile(d);r.openStream("w",j,o,"UTF-8")}l.listFiles(m,o)}this.getDirHandle(g,h);return}}function FileBrowser(){this.cwd="/";this.cacheEntries={};this.fs=getDefaultFileSystem();this.normalizePath=function(b){var c=b?b:"";var a=c.split("/");a.remove("");a.remove("");a.remove("");c=a.length?("/"+a.join("/")+"/"):"/";return c};this.setVirtualRoot=function(a){this.virtualRoot=this.fs.setVirtualRoot(this.normalizePath(a));return};this.initForSave=function(b,c,d,e,a){if(a){this.fs=a}this.content=d;this.cwd=this.fs.setInitPath(this.normalizePath(b));this.initFileName=c;this.onDone=e;this.cacheEntries={};return};this.initForOpen=function(b,c,a){if(a){this.fs=a}this.cwd=this.fs.setInitPath(this.normalizePath(b));this.onContent=c;this.cacheEntries={};return};this.filteItemByExtNames=function(a){function b(e){for(var c=0;c<a.length;c++){var d=a[c];if(e.name.indexOf(d)>0){return true}}return false}if(a){this.setItemFilter(b)}else{this.setItemFilter(null)}};this.setItemFilter=function(a){this.filter=a;return};this.getSizeStr=function(c){var d="";var b="";var a=c.size;if(c.type==="file"){if(a>1024*1024){a=a/(1024*1024);b=a+"";b=b.substr(0,4);b=b+"MB"}else{if(a>1024){a=a>>10;b=a+"";b=b.substr(0,4);b=b+"KB"}else{b=a+"Bytes"}}d=b}else{if(c.items){b=c.items.length+" Items"}else{b=0+" Items"}d=b}return d};this.getDateInfo=function(c){var a="";var b=c.mtime?new Date(c.mtime):new Date();a=b.getFullYear()+"-"+(b.getMonth()+1)+"-"+b.getDate()+" "+b.getHours()+":"+b.getMinutes()+":"+b.getSeconds();return a};this.getMimeIcon=function(c){var b="";var a=c.name;var d="drawapp8/images/common/mimetypes/";if(c.type==="folder"){if(a===".."){b=d+"goback.png"}else{b=d+"folder.png"}}else{if(a.indexOf(".png")>=0||a.indexOf(".jpg")>=0){b=d+"image.png"}else{b=d+"text.png"}}return b};this.createItem=function(a,d,c,b){var e={children:[]};e.userData=a;e.children.push({children:[]});e.children[0].children.push({image:d});e.children[0].children.push({children:[]});e.children[0].children[1].children.push({text:c});e.children[0].children[1].children.push({text:b});return e};this.list=function(c){var a=this;c.setValueOf("ui-label-cwd",this.cwd);console.log("list: "+this.cwd);var b=c.findChildByName("ui-list-view",true);if(this.cacheEntries[this.cwd]){b.bindData(this.cacheEntries[this.cwd],null,true);console.log("list: found cached entries.");return}b.setEnable(false);this.fs.list(this.cwd,function(f){var d={};var h=null;var l={children:[]};var j={type:"folder",name:"..",children:[]};if(a.canUp()){d.name="..";d.type="folder";h=a.getMimeIcon(d);j=a.createItem(d,h,"Up","Return To Parent");j.userData=null;l.children.push(j)}if(f){f.sort(function(o,m){if(o.name<m.name){return -1}else{if(o.name>m.name){return 1}else{return 0}}});for(var g=0;g<f.length;g++){d=f[g];if(d.type==="file"){continue}var e=a.getDateInfo(d);h=a.getMimeIcon(d);j=a.createItem(d,h,d.name,e);l.children.push(j)}for(var g=0;g<f.length;g++){d=f[g];if(d.name.indexOf(".")===0){continue}if(d.type!=="file"){continue}if(a.filter&&!a.filter(d)){continue}var e=a.getDateInfo(d);h=a.getMimeIcon(d);j=a.createItem(d,h,d.name,e);l.children.push(j)}}b.bindData(l,null,true);a.cacheEntries[a.cwd]=l;b.setEnable(true)});return};this.canUp=function(){if(this.virtualRoot&&this.virtualRoot==this.cwd){return false}if(!this.cwd||this.cwd=="/"){return false}else{return true}};this.up=function(b){var a=this.cwd.split("/");a.remove("",true);if(a.length){a.length=a.length-1}if(a.length){this.cwd="/"+a.join("/")+"/"}else{this.cwd="/"}this.list(b);return};this.enter=function(b,a){this.cwd=this.cwd+a.name+"/";this.list(b);return};this.read=function(d,b){var c=this.onContent;var a=this.cwd+b.name;if(c){this.fs.read(a,function(e,f){c(e,f);d.closeWindow(f)})}return};this.remove=function(c,b){if(b.type!="file"){alert("You Cannot Remove Directory At Here!");return}var a=this.cwd+b.name;this.fs.remove(a,function(d,e){if(!d){alert("Remove File Failed!")}});return};this.save=function(e,d){var f=this.onDone;var b=this.cwd+d.name;if(this.initFileName){var a=this.initFileName.split(".");var c=a.pop();if(c&&b.indexOf(c)<0){b=b+"."+c}}this.fs.save(b,this.content,function(g,h){if(f){f(g,h);e.closeWindow(g)}});this.content=null;return}}var gFileBrowser=null;function FileBrowserGet(){if(!gFileBrowser){webappPreloadImage("drawapp8/images/common/mimetypes/goback.png");webappPreloadImage("drawapp8/images/common/mimetypes/folder.png");webappPreloadImage("drawapp8/images/common/mimetypes/image.png");webappPreloadImage("drawapp8/images/common/mimetypes/text.png");gFileBrowser=new FileBrowser()}return gFileBrowser}
/*!
 * Chart.js
 * http://chartjs.org/
 *
 * Copyright 2013 Nick Downie
 * Released under the MIT license
 * https://github.com/nnnick/Chart.js/blob/master/LICENSE.md
 */
;window.Chart=function(d,v,t){var r=this;var a={linear:function(F){return F},easeInQuad:function(F){return F*F},easeOutQuad:function(F){return -1*F*(F-2)},easeInOutQuad:function(F){if((F/=1/2)<1){return 1/2*F*F}return -1/2*((--F)*(F-2)-1)},easeInCubic:function(F){return F*F*F},easeOutCubic:function(F){return 1*((F=F/1-1)*F*F+1)},easeInOutCubic:function(F){if((F/=1/2)<1){return 1/2*F*F*F}return 1/2*((F-=2)*F*F+2)},easeInQuart:function(F){return F*F*F*F},easeOutQuart:function(F){return -1*((F=F/1-1)*F*F*F-1)},easeInOutQuart:function(F){if((F/=1/2)<1){return 1/2*F*F*F*F}return -1/2*((F-=2)*F*F*F-2)},easeInQuint:function(F){return 1*(F/=1)*F*F*F*F},easeOutQuint:function(F){return 1*((F=F/1-1)*F*F*F*F+1)},easeInOutQuint:function(F){if((F/=1/2)<1){return 1/2*F*F*F*F*F}return 1/2*((F-=2)*F*F*F*F+2)},easeInSine:function(F){return -1*Math.cos(F/1*(Math.PI/2))+1},easeOutSine:function(F){return 1*Math.sin(F/1*(Math.PI/2))},easeInOutSine:function(F){return -1/2*(Math.cos(Math.PI*F/1)-1)},easeInExpo:function(F){return(F==0)?1:1*Math.pow(2,10*(F/1-1))},easeOutExpo:function(F){return(F==1)?1:1*(-Math.pow(2,-10*F/1)+1)},easeInOutExpo:function(F){if(F==0){return 0}if(F==1){return 1}if((F/=1/2)<1){return 1/2*Math.pow(2,10*(F-1))}return 1/2*(-Math.pow(2,-10*--F)+2)},easeInCirc:function(F){if(F>=1){return F}return -1*(Math.sqrt(1-(F/=1)*F)-1)},easeOutCirc:function(F){return 1*Math.sqrt(1-(F=F/1-1)*F)},easeInOutCirc:function(F){if((F/=1/2)<1){return -1/2*(Math.sqrt(1-F*F)-1)}return 1/2*(Math.sqrt(1-(F-=2)*F)+1)},easeInElastic:function(G){var H=1.70158;var I=0;var F=1;if(G==0){return 0}if((G/=1)==1){return 1}if(!I){I=1*0.3}if(F<Math.abs(1)){F=1;var H=I/4}else{var H=I/(2*Math.PI)*Math.asin(1/F)}return -(F*Math.pow(2,10*(G-=1))*Math.sin((G*1-H)*(2*Math.PI)/I))},easeOutElastic:function(G){var H=1.70158;var I=0;var F=1;if(G==0){return 0}if((G/=1)==1){return 1}if(!I){I=1*0.3}if(F<Math.abs(1)){F=1;var H=I/4}else{var H=I/(2*Math.PI)*Math.asin(1/F)}return F*Math.pow(2,-10*G)*Math.sin((G*1-H)*(2*Math.PI)/I)+1},easeInOutElastic:function(G){var H=1.70158;var I=0;var F=1;if(G==0){return 0}if((G/=1/2)==2){return 1}if(!I){I=1*(0.3*1.5)}if(F<Math.abs(1)){F=1;var H=I/4}else{var H=I/(2*Math.PI)*Math.asin(1/F)}if(G<1){return -0.5*(F*Math.pow(2,10*(G-=1))*Math.sin((G*1-H)*(2*Math.PI)/I))}return F*Math.pow(2,-10*(G-=1))*Math.sin((G*1-H)*(2*Math.PI)/I)*0.5+1},easeInBack:function(F){var G=1.70158;return 1*(F/=1)*F*((G+1)*F-G)},easeOutBack:function(F){var G=1.70158;return 1*((F=F/1-1)*F*((G+1)*F+G)+1)},easeInOutBack:function(F){var G=1.70158;if((F/=1/2)<1){return 1/2*(F*F*(((G*=(1.525))+1)*F-G))}return 1/2*((F-=2)*F*(((G*=(1.525))+1)*F+G)+2)},easeInBounce:function(F){return 1-a.easeOutBounce(1-F)},easeOutBounce:function(F){if((F/=1)<(1/2.75)){return 1*(7.5625*F*F)}else{if(F<(2/2.75)){return 1*(7.5625*(F-=(1.5/2.75))*F+0.75)}else{if(F<(2.5/2.75)){return 1*(7.5625*(F-=(2.25/2.75))*F+0.9375)}else{return 1*(7.5625*(F-=(2.625/2.75))*F+0.984375)}}}},easeInOutBounce:function(F){if(F<1/2){return a.easeInBounce(F*2)*0.5}return a.easeOutBounce(F*2-1)*0.5+1*0.5}};v=v?v:d.canvas.width;t=t?t:d.canvas.height;this.PolarArea=function(H,G){r.PolarArea.defaults={scaleOverlay:true,scaleOverride:false,scaleSteps:null,scaleStepWidth:null,scaleStartValue:null,scaleShowLine:true,scaleLineColor:"rgba(0,0,0,.1)",scaleLineWidth:1,scaleShowLabels:true,scaleLabel:"<%=value%>",scaleFontFamily:"'Arial'",scaleFontSize:12,scaleFontStyle:"normal",scaleFontColor:"#666",scaleShowLabelBackdrop:true,scaleBackdropColor:"rgba(255,255,255,0.75)",scaleBackdropPaddingY:2,scaleBackdropPaddingX:2,segmentShowStroke:true,segmentStrokeColor:"#fff",segmentStrokeWidth:2,animation:true,animationSteps:100,animationEasing:"easeOutBounce",animateRotate:true,animateScale:false,onAnimationComplete:null};var F=(G)?A(r.PolarArea.defaults,G):r.PolarArea.defaults;return new e(H,F,d)};this.Radar=function(H,G){r.Radar.defaults={scaleOverlay:false,scaleOverride:false,scaleSteps:null,scaleStepWidth:null,scaleStartValue:null,scaleShowLine:true,scaleLineColor:"rgba(0,0,0,.1)",scaleLineWidth:1,scaleShowLabels:false,scaleLabel:"<%=value%>",scaleFontFamily:"'Arial'",scaleFontSize:12,scaleFontStyle:"normal",scaleFontColor:"#666",scaleShowLabelBackdrop:true,scaleBackdropColor:"rgba(255,255,255,0.75)",scaleBackdropPaddingY:2,scaleBackdropPaddingX:2,angleShowLineOut:true,angleLineColor:"rgba(0,0,0,.1)",angleLineWidth:1,pointLabelFontFamily:"'Arial'",pointLabelFontStyle:"normal",pointLabelFontSize:12,pointLabelFontColor:"#666",pointDot:true,pointDotRadius:3,pointDotStrokeWidth:1,datasetStroke:true,datasetStrokeWidth:2,datasetFill:true,animation:true,animationSteps:60,animationEasing:"easeOutQuart",onAnimationComplete:null};var F=(G)?A(r.Radar.defaults,G):r.Radar.defaults;return new D(H,F,d)};this.Pie=function(H,G){r.Pie.defaults={segmentShowStroke:true,segmentStrokeColor:"#fff",segmentStrokeWidth:2,animation:true,animationSteps:100,animationEasing:"easeOutBounce",animateRotate:true,animateScale:false,onAnimationComplete:null};var F=(G)?A(r.Pie.defaults,G):r.Pie.defaults;return new z(H,F,d)};this.Doughnut=function(H,G){r.Doughnut.defaults={segmentShowStroke:true,segmentStrokeColor:"#fff",segmentStrokeWidth:2,percentageInnerCutout:50,animation:true,animationSteps:100,animationEasing:"easeOutBounce",animateRotate:true,animateScale:false,onAnimationComplete:null};var F=(G)?A(r.Doughnut.defaults,G):r.Doughnut.defaults;return new C(H,F,d)};this.Line=function(H,G){r.Line.defaults={scaleOverlay:false,scaleOverride:false,scaleSteps:null,scaleStepWidth:null,scaleStartValue:null,scaleLineColor:"rgba(0,0,0,.1)",scaleLineWidth:1,scaleShowLabels:true,scaleLabel:"<%=value%>",scaleFontFamily:"'Arial'",scaleFontSize:12,scaleFontStyle:"normal",scaleFontColor:"#666",scaleShowGridLines:true,scaleGridLineColor:"rgba(0,0,0,.05)",scaleGridLineWidth:1,bezierCurve:true,pointDot:true,pointDotRadius:4,pointDotStrokeWidth:2,datasetStroke:true,datasetStrokeWidth:2,datasetFill:true,animation:true,animationSteps:60,animationEasing:"easeOutQuart",onAnimationComplete:null};var F=(G)?A(r.Line.defaults,G):r.Line.defaults;return new w(H,F,d)};this.Bar=function(H,G){r.Bar.defaults={scaleOverlay:false,scaleOverride:false,scaleSteps:null,scaleStepWidth:null,scaleStartValue:null,scaleLineColor:"rgba(0,0,0,.1)",scaleLineWidth:1,scaleShowLabels:true,scaleLabel:"<%=value%>",scaleFontFamily:"'Arial'",scaleFontSize:12,scaleFontStyle:"normal",scaleFontColor:"#666",scaleShowGridLines:true,scaleGridLineColor:"rgba(0,0,0,.05)",scaleGridLineWidth:1,barShowStroke:true,barStrokeWidth:2,barValueSpacing:5,barDatasetSpacing:1,animation:true,animationSteps:60,animationEasing:"easeOutQuart",onAnimationComplete:null};var F=(G)?A(r.Bar.defaults,G):r.Bar.defaults;return new c(H,F,d)};var u=function(F){F.clearRect(0,0,v,t)};var e=function(L,J,R){var Q,I,H,K,S,P,F;O();P=N();F=(J.scaleShowLabels)?J.scaleLabel:null;if(!J.scaleOverride){H=j(S,P.maxSteps,P.minSteps,P.maxValue,P.minValue,F)}else{H={steps:J.scaleSteps,stepValue:J.scaleStepWidth,graphMin:J.scaleStartValue,labels:[]};s(F,H.labels,H.steps,J.scaleStartValue,J.scaleStepWidth)}I=Q/(H.steps);g(J,G,M,R);function O(){Q=(E([v,t])/2);Q-=b([J.scaleFontSize*0.5,J.scaleLineWidth*0.5]);K=J.scaleFontSize*2;if(J.scaleShowLabelBackdrop){K+=(2*J.scaleBackdropPaddingY);Q-=J.scaleBackdropPaddingY*1.5}S=Q;K=h(K,5)}function G(){for(var U=0;U<H.steps;U++){if(J.scaleShowLine){R.beginPath();R.arc(v/2,t/2,I*(U+1),0,(Math.PI*2),true);R.strokeStyle=J.scaleLineColor;R.lineWidth=J.scaleLineWidth;R.stroke()}if(J.scaleShowLabels){R.textAlign="center";R.font=J.scaleFontStyle+" "+J.scaleFontSize+"px "+J.scaleFontFamily;var T=H.labels[U];if(J.scaleShowLabelBackdrop){var V=R.measureText(T).width;R.fillStyle=J.scaleBackdropColor;R.beginPath();R.rect(Math.round(v/2-V/2-J.scaleBackdropPaddingX),Math.round(t/2-(I*(U+1))-J.scaleFontSize*0.5-J.scaleBackdropPaddingY),Math.round(V+(J.scaleBackdropPaddingX*2)),Math.round(J.scaleFontSize+(J.scaleBackdropPaddingY*2)));R.fill()}R.textBaseline="middle";R.fillStyle=J.scaleFontColor;R.fillText(T,v/2,t/2-(I*(U+1)))}}}function M(X){var V=-Math.PI/2,U=(Math.PI*2)/L.length,Y=1,W=1;if(J.animation){if(J.animateScale){Y=X}if(J.animateRotate){W=X}}for(var T=0;T<L.length;T++){R.beginPath();R.arc(v/2,t/2,Y*o(L[T].value,H,I),V,V+W*U,false);R.lineTo(v/2,t/2);R.closePath();R.fillStyle=L[T].color;R.fill();if(J.segmentShowStroke){R.strokeStyle=J.segmentStrokeColor;R.lineWidth=J.segmentStrokeWidth;R.stroke()}V+=W*U}}function N(){var X=Number.MIN_VALUE;var T=Number.MAX_VALUE;for(var W=0;W<L.length;W++){if(L[W].value>X){X=L[W].value}if(L[W].value<T){T=L[W].value}}var V=Math.floor((S/(K*0.66)));var U=Math.floor((S/K*0.5));return{maxValue:X,minValue:T,maxSteps:V,minSteps:U}}};var D=function(M,K,R){var Q,J,I,L,S,P,F;if(!M.labels){M.labels=[]}O();var P=N();F=(K.scaleShowLabels)?K.scaleLabel:null;if(!K.scaleOverride){I=j(S,P.maxSteps,P.minSteps,P.maxValue,P.minValue,F)}else{I={steps:K.scaleSteps,stepValue:K.scaleStepWidth,graphMin:K.scaleStartValue,labels:[]};s(F,I.labels,I.steps,K.scaleStartValue,K.scaleStepWidth)}J=Q/(I.steps);g(K,G,H,R);function H(W){var X=(2*Math.PI)/M.datasets[0].data.length;R.save();R.translate(v/2,t/2);for(var V=0;V<M.datasets.length;V++){R.beginPath();R.moveTo(0,W*(-1*o(M.datasets[V].data[0],I,J)));for(var U=1;U<M.datasets[V].data.length;U++){R.rotate(X);R.lineTo(0,W*(-1*o(M.datasets[V].data[U],I,J)))}R.closePath();R.fillStyle=M.datasets[V].fillColor;R.strokeStyle=M.datasets[V].strokeColor;R.lineWidth=K.datasetStrokeWidth;R.fill();R.stroke();if(K.pointDot){R.fillStyle=M.datasets[V].pointColor;R.strokeStyle=M.datasets[V].pointStrokeColor;R.lineWidth=K.pointDotStrokeWidth;for(var T=0;T<M.datasets[V].data.length;T++){R.rotate(X);R.beginPath();R.arc(0,W*(-1*o(M.datasets[V].data[T],I,J)),K.pointDotRadius,2*Math.PI,false);R.fill();R.stroke()}}R.rotate(X)}R.restore()}function G(){var aa=(2*Math.PI)/M.datasets[0].data.length;R.save();R.translate(v/2,t/2);if(K.angleShowLineOut){R.strokeStyle=K.angleLineColor;R.lineWidth=K.angleLineWidth;for(var X=0;X<M.datasets[0].data.length;X++){R.rotate(aa);R.beginPath();R.moveTo(0,0);R.lineTo(0,-Q);R.stroke()}}for(var V=0;V<I.steps;V++){R.beginPath();if(K.scaleShowLine){R.strokeStyle=K.scaleLineColor;R.lineWidth=K.scaleLineWidth;R.moveTo(0,-J*(V+1));for(var U=0;U<M.datasets[0].data.length;U++){R.rotate(aa);R.lineTo(0,-J*(V+1))}R.closePath();R.stroke()}if(K.scaleShowLabels){R.textAlign="center";R.font=K.scaleFontStyle+" "+K.scaleFontSize+"px "+K.scaleFontFamily;R.textBaseline="middle";if(K.scaleShowLabelBackdrop){var Z=R.measureText(I.labels[V]).width;R.fillStyle=K.scaleBackdropColor;R.beginPath();R.rect(Math.round(-Z/2-K.scaleBackdropPaddingX),Math.round((-J*(V+1))-K.scaleFontSize*0.5-K.scaleBackdropPaddingY),Math.round(Z+(K.scaleBackdropPaddingX*2)),Math.round(K.scaleFontSize+(K.scaleBackdropPaddingY*2)));R.fill()}R.fillStyle=K.scaleFontColor;R.fillText(I.labels[V],0,-J*(V+1))}}for(var T=0;T<M.labels.length;T++){R.font=K.pointLabelFontStyle+" "+K.pointLabelFontSize+"px "+K.pointLabelFontFamily;R.fillStyle=K.pointLabelFontColor;var Y=Math.sin(aa*T)*(Q+K.pointLabelFontSize);var W=Math.cos(aa*T)*(Q+K.pointLabelFontSize);if(aa*T==Math.PI||aa*T==0){R.textAlign="center"}else{if(aa*T>Math.PI){R.textAlign="right"}else{R.textAlign="left"}}R.textBaseline="middle";R.fillText(M.labels[T],Y,-W)}R.restore()}function O(){Q=(E([v,t])/2);L=K.scaleFontSize*2;var V=0;for(var U=0;U<M.labels.length;U++){R.font=K.pointLabelFontStyle+" "+K.pointLabelFontSize+"px "+K.pointLabelFontFamily;var T=R.measureText(M.labels[U]).width;if(T>V){V=T}}Q-=b([V,((K.pointLabelFontSize/2)*1.5)]);Q-=K.pointLabelFontSize;Q=m(Q,null,0);S=Q;L=h(L,5)}function N(){var Y=Number.MIN_VALUE;var T=Number.MAX_VALUE;for(var X=0;X<M.datasets.length;X++){for(var W=0;W<M.datasets[X].data.length;W++){if(M.datasets[X].data[W]>Y){Y=M.datasets[X].data[W]}if(M.datasets[X].data[W]<T){T=M.datasets[X].data[W]}}}var V=Math.floor((S/(L*0.66)));var U=Math.floor((S/L*0.5));return{maxValue:Y,minValue:T,maxSteps:V,minSteps:U}}};var z=function(L,I,G){var F=0;var H=E([t/2,v/2])-5;for(var J=0;J<L.length;J++){F+=L[J].value}g(I,null,K,G);function K(P){var R=-Math.PI/2,Q=1,O=1;if(I.animation){if(I.animateScale){Q=P}if(I.animateRotate){O=P}}for(var N=0;N<L.length;N++){var M=O*((L[N].value/F)*(Math.PI*2));G.beginPath();G.arc(v/2,t/2,Q*H,R,R+M);G.lineTo(v/2,t/2);G.closePath();G.fillStyle=L[N].color;G.fill();if(I.segmentShowStroke){G.lineWidth=I.segmentStrokeWidth;G.strokeStyle=I.segmentStrokeColor;G.stroke()}R+=M}}};var C=function(L,I,G){var F=0;var H=E([t/2,v/2])-5;var M=H*(I.percentageInnerCutout/100);for(var J=0;J<L.length;J++){F+=L[J].value}g(I,null,K,G);function K(Q){var S=-Math.PI/2,R=1,P=1;if(I.animation){if(I.animateScale){R=Q}if(I.animateRotate){P=Q}}for(var O=0;O<L.length;O++){var N=P*((L[O].value/F)*(Math.PI*2));G.beginPath();G.arc(v/2,t/2,R*H,S,S+N,false);G.arc(v/2,t/2,R*M,S+N,S,true);G.closePath();G.fillStyle=L[O].color;G.fill();if(I.segmentShowStroke){G.lineWidth=I.segmentStrokeWidth;G.strokeStyle=I.segmentStrokeColor;G.stroke()}S+=N}}};var w=function(Z,Y,S){var I,L,V,F,H,X,Q,O,M,P,N,W,J=0;U();X=R();Q=(Y.scaleShowLabels)?Y.scaleLabel:"";if(!Y.scaleOverride){V=j(H,X.maxSteps,X.minSteps,X.maxValue,X.minValue,Q)}else{V={steps:Y.scaleSteps,stepValue:Y.scaleStepWidth,graphMin:Y.scaleStartValue,labels:[]};s(Q,V.labels,V.steps,Y.scaleStartValue,Y.scaleStepWidth)}L=Math.floor(H/V.steps);T();g(Y,G,K,S);function K(ae){for(var ac=0;ac<Z.datasets.length;ac++){S.strokeStyle=Z.datasets[ac].strokeColor;S.lineWidth=Y.datasetStrokeWidth;S.beginPath();S.moveTo(N,W-ae*(o(Z.datasets[ac].data[0],V,L)));for(var ab=1;ab<Z.datasets[ac].data.length;ab++){if(Y.bezierCurve){S.bezierCurveTo(af(ab-0.5),ad(ac,ab-1),af(ab-0.5),ad(ac,ab),af(ab),ad(ac,ab))}else{S.lineTo(af(ab),ad(ac,ab))}}S.stroke();if(Y.datasetFill){S.lineTo(N+(O*(Z.datasets[ac].data.length-1)),W);S.lineTo(N,W);S.closePath();S.fillStyle=Z.datasets[ac].fillColor;S.fill()}else{S.closePath()}if(Y.pointDot){S.fillStyle=Z.datasets[ac].pointColor;S.strokeStyle=Z.datasets[ac].pointStrokeColor;S.lineWidth=Y.pointDotStrokeWidth;for(var aa=0;aa<Z.datasets[ac].data.length;aa++){S.beginPath();S.arc(N+(O*aa),W-ae*(o(Z.datasets[ac].data[aa],V,L)),Y.pointDotRadius,0,Math.PI*2,true);S.fill();S.stroke()}}}function ad(ag,ah){return W-ae*(o(Z.datasets[ag].data[ah],V,L))}function af(ag){return N+(O*ag)}}function G(){S.lineWidth=Y.scaleLineWidth;S.strokeStyle=Y.scaleLineColor;S.beginPath();S.moveTo(v-M/2+5,W);S.lineTo(v-(M/2)-P-5,W);S.stroke();if(J>0){S.save();S.textAlign="right"}else{S.textAlign="center"}S.fillStyle=Y.scaleFontColor;for(var ab=0;ab<Z.labels.length;ab++){S.save();if(J>0){S.translate(N+ab*O,W+Y.scaleFontSize);S.rotate(-(J*(Math.PI/180)));S.fillText(Z.labels[ab],0,0);S.restore()}else{S.fillText(Z.labels[ab],N+ab*O,W+Y.scaleFontSize+3)}S.beginPath();S.moveTo(N+ab*O,W+3);if(Y.scaleShowGridLines&&ab>0){S.lineWidth=Y.scaleGridLineWidth;S.strokeStyle=Y.scaleGridLineColor;S.lineTo(N+ab*O,5)}else{S.lineTo(N+ab*O,W+3)}S.stroke()}S.lineWidth=Y.scaleLineWidth;S.strokeStyle=Y.scaleLineColor;S.beginPath();S.moveTo(N,W+5);S.lineTo(N,5);S.stroke();S.textAlign="right";S.textBaseline="middle";for(var aa=0;aa<V.steps;aa++){S.beginPath();S.moveTo(N-3,W-((aa+1)*L));if(Y.scaleShowGridLines){S.lineWidth=Y.scaleGridLineWidth;S.strokeStyle=Y.scaleGridLineColor;S.lineTo(N+P+5,W-((aa+1)*L))}else{S.lineTo(N-0.5,W-((aa+1)*L))}S.stroke();if(Y.scaleShowLabels){S.fillText(V.labels[aa],N-8,W-((aa+1)*L))}}}function T(){var aa=1;if(Y.scaleShowLabels){S.font=Y.scaleFontStyle+" "+Y.scaleFontSize+"px "+Y.scaleFontFamily;for(var ab=0;ab<V.labels.length;ab++){var ac=S.measureText(V.labels[ab]).width;aa=(ac>aa)?ac:aa}aa+=10}P=v-aa-M;O=Math.floor(P/(Z.labels.length-1));N=v-M/2-P;W=H+Y.scaleFontSize/2}function U(){I=t;S.font=Y.scaleFontStyle+" "+Y.scaleFontSize+"px "+Y.scaleFontFamily;M=1;for(var ab=0;ab<Z.labels.length;ab++){var aa=S.measureText(Z.labels[ab]).width;M=(aa>M)?aa:M}if(v/Z.labels.length<M){J=45;if(v/Z.labels.length<Math.cos(J)*M){J=90;I-=M}else{I-=Math.sin(J)*M}}else{I-=Y.scaleFontSize}I-=5;F=Y.scaleFontSize;I-=F;H=I}function R(){var af=Number.MIN_VALUE;var aa=Number.MAX_VALUE;for(var ae=0;ae<Z.datasets.length;ae++){for(var ad=0;ad<Z.datasets[ae].data.length;ad++){if(Z.datasets[ae].data[ad]>af){af=Z.datasets[ae].data[ad]}if(Z.datasets[ae].data[ad]<aa){aa=Z.datasets[ae].data[ad]}}}var ac=Math.floor((H/(F*0.66)));var ab=Math.floor((H/F*0.5));return{maxValue:af,minValue:aa,maxSteps:ac,minSteps:ab}}};var c=function(aa,Z,T){var I,K,W,F,H,Y,P,N,L,O,M,X,R,J=0;V();Y=Q();P=(Z.scaleShowLabels)?Z.scaleLabel:"";if(!Z.scaleOverride){W=j(H,Y.maxSteps,Y.minSteps,Y.maxValue,Y.minValue,P)}else{W={steps:Z.scaleSteps,stepValue:Z.scaleStepWidth,graphMin:Z.scaleStartValue,labels:[]};s(P,W.labels,W.steps,Z.scaleStartValue,Z.scaleStepWidth)}K=Math.floor(H/W.steps);U();g(Z,G,S,T);function S(ae){T.lineWidth=Z.barStrokeWidth;for(var ac=0;ac<aa.datasets.length;ac++){T.fillStyle=aa.datasets[ac].fillColor;T.strokeStyle=aa.datasets[ac].strokeColor;for(var ab=0;ab<aa.datasets[ac].data.length;ab++){var ad=M+Z.barValueSpacing+N*ab+R*ac+Z.barDatasetSpacing*ac+Z.barStrokeWidth*ac;T.beginPath();T.moveTo(ad,X);T.lineTo(ad,X-ae*o(aa.datasets[ac].data[ab],W,K)+(Z.barStrokeWidth/2));T.lineTo(ad+R,X-ae*o(aa.datasets[ac].data[ab],W,K)+(Z.barStrokeWidth/2));T.lineTo(ad+R,X);if(Z.barShowStroke){T.stroke()}T.closePath();T.fill()}}}function G(){T.lineWidth=Z.scaleLineWidth;T.strokeStyle=Z.scaleLineColor;T.beginPath();T.moveTo(v-L/2+5,X);T.lineTo(v-(L/2)-O-5,X);T.stroke();if(J>0){T.save();T.textAlign="right"}else{T.textAlign="center"}T.fillStyle=Z.scaleFontColor;for(var ac=0;ac<aa.labels.length;ac++){T.save();if(J>0){T.translate(M+ac*N,X+Z.scaleFontSize);T.rotate(-(J*(Math.PI/180)));T.fillText(aa.labels[ac],0,0);T.restore()}else{T.fillText(aa.labels[ac],M+ac*N+N/2,X+Z.scaleFontSize+3)}T.beginPath();T.moveTo(M+(ac+1)*N,X+3);T.lineWidth=Z.scaleGridLineWidth;T.strokeStyle=Z.scaleGridLineColor;T.lineTo(M+(ac+1)*N,5);T.stroke()}T.lineWidth=Z.scaleLineWidth;T.strokeStyle=Z.scaleLineColor;T.beginPath();T.moveTo(M,X+5);T.lineTo(M,5);T.stroke();T.textAlign="right";T.textBaseline="middle";for(var ab=0;ab<W.steps;ab++){T.beginPath();T.moveTo(M-3,X-((ab+1)*K));if(Z.scaleShowGridLines){T.lineWidth=Z.scaleGridLineWidth;T.strokeStyle=Z.scaleGridLineColor;T.lineTo(M+O+5,X-((ab+1)*K))}else{T.lineTo(M-0.5,X-((ab+1)*K))}T.stroke();if(Z.scaleShowLabels){T.fillText(W.labels[ab],M-8,X-((ab+1)*K))}}}function U(){var ab=1;if(Z.scaleShowLabels){T.font=Z.scaleFontStyle+" "+Z.scaleFontSize+"px "+Z.scaleFontFamily;for(var ac=0;ac<W.labels.length;ac++){var ad=T.measureText(W.labels[ac]).width;ab=(ad>ab)?ad:ab}ab+=10}O=v-ab-L;N=Math.floor(O/(aa.labels.length));R=(N-Z.scaleGridLineWidth*2-(Z.barValueSpacing*2)-(Z.barDatasetSpacing*aa.datasets.length-1)-((Z.barStrokeWidth/2)*aa.datasets.length-1))/aa.datasets.length;M=v-L/2-O;X=H+Z.scaleFontSize/2}function V(){I=t;T.font=Z.scaleFontStyle+" "+Z.scaleFontSize+"px "+Z.scaleFontFamily;L=1;for(var ac=0;ac<aa.labels.length;ac++){var ab=T.measureText(aa.labels[ac]).width;L=(ab>L)?ab:L}if(v/aa.labels.length<L){J=45;if(v/aa.labels.length<Math.cos(J)*L){J=90;I-=L}else{I-=Math.sin(J)*L}}else{I-=Z.scaleFontSize}I-=5;F=Z.scaleFontSize;I-=F;H=I}function Q(){var ag=Number.MIN_VALUE;var ab=Number.MAX_VALUE;for(var af=0;af<aa.datasets.length;af++){for(var ae=0;ae<aa.datasets[af].data.length;ae++){if(aa.datasets[af].data[ae]>ag){ag=aa.datasets[af].data[ae]}if(aa.datasets[af].data[ae]<ab){ab=aa.datasets[af].data[ae]}}}var ad=Math.floor((H/(F*0.66)));var ac=Math.floor((H/F*0.5));return{maxValue:ag,minValue:ab,maxSteps:ad,minSteps:ac}}};function o(I,G,K){var J=G.steps*G.stepValue;var H=I-G.graphMin;var F=m(H/J,1,0);return(K*G.steps)*F}function g(I,G,F,N){var H=(I.animation)?1/m(I.animationSteps,Number.MAX_VALUE,1):1,M=a[I.animationEasing],J=(I.animation)?0:1;if(typeof G!=="function"){G=function(){}}function L(){var O=(I.animation)?m(M(J),null,0):1;u(N);if(I.scaleOverlay){F(O);G()}else{G();F(O)}}function K(){J+=H;L();if(J<=1){f(K)}else{if(typeof I.onAnimationComplete=="function"){I.onAnimationComplete()}}}I.animation=0;if(I.animation){f(K)}else{L()}}var f=(function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(F){window.setTimeout(F,1000/60)}})();function j(I,L,R,N,T,F){var S,G,H,P,U,O,Q,K;O=N-T;Q=J(O);S=Math.floor(T/(1*Math.pow(10,Q)))*Math.pow(10,Q);G=Math.ceil(N/(1*Math.pow(10,Q)))*Math.pow(10,Q);H=G-S;P=Math.pow(10,Q);U=Math.round(H/P);while(U<R||U>L){if(U<R){P/=2;U=Math.round(H/P)}else{P*=2;U=Math.round(H/P)}}var M=[];s(F,M,U,S,P);return{steps:U,stepValue:P,graphMin:S,labels:M};function J(V){return Math.floor(Math.log(V)/Math.LN10)}}function s(H,K,G,J,F){if(H){for(var I=1;I<G+1;I++){K.push(l(H,{value:(J+(F*I)).toFixed(B(F))}))}}}function b(F){return Math.max.apply(Math,F)}function E(F){return Math.min.apply(Math,F)}function h(G,F){if(!G){return F}else{return G}}function q(F){return !isNaN(parseFloat(F))&&isFinite(F)}function m(F,H,G){if(q(H)){if(F>H){return H}}if(q(G)){if(F<G){return G}}return F}function B(F){var G;if(F%1!=0){return F.toString().split(".")[1].length}else{return 0}}function A(I,G){var F={};for(var H in I){F[H]=I[H]}for(var H in G){F[H]=G[H]}return F}var p={};function l(H,G){var F=!/\W/.test(H)?p[H]=p[H]||l(document.getElementById(H).innerHTML):new Function("obj","var p=[],print=function(){p.push.apply(p,arguments);};with(obj){p.push('"+H.replace(/[\r\t\n]/g," ").split("<%").join("\t").replace(/((^|%>)[^\t]*)'/g,"$1\r").replace(/\t=(.*?)%>/g,"',$1,'").split("\t").join("');").split("%>").join("p.push('").split("\r").join("\\'")+"');}return p.join('');");return G?F(G):F}};function UIChartLegendItem(){return}UIChartLegendItem.prototype=new UIElement();UIChartLegendItem.prototype.isUIChartLegendItem=true;UIChartLegendItem.prototype.initUIChartLegendItem=function(c,a,b){this.initUIElement(c);this.setDefSize(a,b);this.setTextType(C_SHAPE_TEXT_INPUT);return this};UIChartLegendItem.prototype.shapeCanBeChild=function(a){return false};UIChartLegendItem.prototype.drawText=function(a){};UIChartLegendItem.prototype.paintSelfOnly=function(b){if(this.h>this.w){var c=Math.min(this.w,this.h);b.fillRect(0,0,c,c)}else{var c=this.h-8;b.fillStyle=this.style.fillColor;b.fillRect(4,4,c,c);b.textAlign="left";b.textBaseline="middle";b.font=this.style.getFont();b.fillStyle=this.style.textColor;var a=c+8;var d=c/2-0.2*this.style.fontSize;b.fillText(this.text,a,d)}return};function UIChartLegendItemCreator(){var a=["ui-chart-legend-item","ui-chart-legend-item",null,1];ShapeCreator.apply(this,a);this.createShape=function(c){var b=new UIChartLegendItem();return b.initUIChartLegendItem(this.type,200,40)};return}function UIChartLegendCreator(){var a=["ui-chart-legend","ui-chart-legend",null,1];ShapeCreator.apply(this,a);this.createShape=function(c){var b=new UIGrid();b.isUIChartLegend=true;b.initUIGrid(this.type,5,100,null);b.shapeCanBeChild=function(d){return d.isUIChartLegendItem};return b};return}function UIChart(){return}UIChart.prototype=new UIElement();UIChart.prototype.isUIChart=true;UIChart.prototype.initUIChart=function(c,a,b){this.initUIElement(c);this.setDefSize(a,b);this.setTextType(C_SHAPE_TEXT_NONE);this.setImage(C_SHAPE_IMAGE_ALL,null);this.images.display=C_IMAGE_DISPLAY_CENTER;this.options={};return this};UIChart.prototype.setValue=function(a){try{this.data=JSON.parse(a)}catch(b){console.log("UIChart.prototype.setValue:"+b.message)}return};UIChart.prototype.getValue=function(){var a=this.data?this.data:this.getDefaultData();return a?JSON.stringify(a,null,"\t"):""};UIChart.prototype.getDefaultData=function(){var a={labels:["1","2","3"],datasets:[{fillColor:"rgba(151,187,205,0.5)",strokeColor:"rgba(151,187,205,1)",pointColor:"rgba(151,187,205,1)",pointStrokeColor:"#fff",data:[28,48,40]}]};return a};UIChart.prototype.shapeCanBeChild=function(a){return a.isUILabel||a.isUIImage};UIChart.prototype.getOptions=function(){return null};UIChart.prototype.paintChart=function(a,c,b){return};UIChart.prototype.getData=function(){return this.data?this.data:this.getDefaultData()};UIChart.prototype.paintSelfOnly=function(c){var b=motkGetTempCanvas(this.w,this.h);var a=b.getContext("2d");this.paintChart(a,this.getData(),this.getOptions());c.drawImage(b,0,0);return};function UIBarChart(){return}UIBarChart.prototype=new UIChart();UIBarChart.prototype.isUIBarChart=true;UIBarChart.prototype.initUIBarChart=function(a){return this.initUIChart(a,200,200)};UIBarChart.prototype.getCustomProp=function(){var a='		<label class="description" for="fontsize">'+dappGetText("Font Size")+':</label>		<input id="fontsize"  class="element text small" type="number" value="0"/> 		<label class="description" for="textcolor">'+dappGetText("Text Color")+':</label>		<input id="textcolor"  class="element text small" type="text" value="0"/> 		<label class="description" for="scalelinecolor">'+dappGetText("Scale Line Color")+':</label>		<input id="scalelinecolor"  class="element text small" type="text" value="0"/> 		<label class="description" for="gridlinecolor">'+dappGetText("Grid Line Color")+':</label>		<input id="gridlinecolor"  class="element text small" type="text" value="0"/> 		<input id="showgridlines" class="checkbox_i"  type="checkbox" >'+dappGetText("Show Grid Lines")+'</input> 		<label class="description" for="data">'+dappGetText("Data")+':</label>		<textarea id="data"  rows="8" cols="60" type="text" value=""></textarea>';return a};UIBarChart.prototype.loadCustomProp=function(b){var a=this;b.fontsize.value=this.style.fontSize;b.fontsize.onchange=function(d){var c=parseInt(this.value);a.style.setFontSize(c);return};b.textcolor.value=this.style.textColor;b.textcolor.onchange=function(c){a.style.setTextColor(this.value);return};b.scalelinecolor.value=this.style.lineColor;b.scalelinecolor.onchange=function(c){a.style.setLineColor(this.value);return};b.gridlinecolor.value=this.style.fillColor;b.gridlinecolor.onchange=function(c){a.setFillColor(this.value);return};b.showgridlines.checked=this.showGridLines;b.showgridlines.onchange=function(c){a.showGridLines=this.checked;return};b.data.value=this.getValue();b.data.onchange=function(c){a.setValue(this.value);return};return};UIBarChart.prototype.getOptions=function(){this.options.scaleLineColor=this.style.lineColor;this.options.scaleFontSize=this.isIcon?12:this.style.fontSize;this.options.scaleFontColor=this.style.textColor;this.options.scaleGridLineColor=this.style.fillColor;this.options.scaleShowGridLines=this.isIcon?true:this.showGridLines;return this.options};UIBarChart.prototype.paintChart=function(a,d,b){var c=null;if(this.type==="ui-bar-chart"){c=new Chart(a).Bar(d,b)}else{c=new Chart(a).Line(d,b)}delete c;return};function UIBarChartCreator(b){var a=[b,"ui-bar-chart",null,1];ShapeCreator.apply(this,a);this.createShape=function(d){var c=new UIBarChart();return c.initUIBarChart(this.type)};return}function UIRadarChart(){return}UIRadarChart.prototype=new UIChart();UIRadarChart.prototype.isUIRadarChart=true;UIRadarChart.prototype.initUIRadarChart=function(a){return this.initUIChart(a,200,200)};UIRadarChart.prototype.getCustomProp=function(){var a='		<label class="description" for="fontsize">'+dappGetText("Font Size")+':</label>		<input id="fontsize"  class="element text small" type="number" value="0"/> 		<label class="description" for="textcolor">'+dappGetText("Text Color")+':</label>		<input id="textcolor"  class="element text small" type="text" value="0"/> 		<label class="description" for="scalelinecolor">'+dappGetText("Scale Line Color")+':</label>		<input id="scalelinecolor"  class="element text small" type="text" value="0"/> 		<label class="description" for="backdropcolor">'+dappGetText("Backdrop Color")+':</label>		<input id="backdropcolor"  class="element text small" type="text" value="0"/> 		<input id="showscalelabels" class="checkbox_i"  type="checkbox" >'+dappGetText("Show Scale Labels")+'</input> 		<label class="description" for="data">'+dappGetText("Data")+':</label>		<textarea id="data"  rows="8" cols="60" type="text" value=""></textarea>';return a};UIRadarChart.prototype.loadCustomProp=function(b){var a=this;b.fontsize.value=this.style.fontSize;b.fontsize.onchange=function(d){var c=parseInt(this.value);a.style.setFontSize(c);return};b.textcolor.value=this.style.textColor;b.textcolor.onchange=function(c){a.style.setTextColor(this.value);return};b.scalelinecolor.value=this.style.lineColor;b.scalelinecolor.onchange=function(c){a.style.setLineColor(this.value);return};b.backdropcolor.value=this.style.fillColor;b.backdropcolor.onchange=function(c){a.setFillColor(this.value);return};b.showscalelabels.checked=this.showScaleLabels;b.showscalelabels.onchange=function(c){a.showScaleLabels=this.checked;return};b.data.value=this.getValue();b.data.onchange=function(c){a.setValue(this.value);return};return};UIRadarChart.prototype.getOptions=function(){this.options.scaleLineColor=this.style.lineColor;this.options.scaleShowLabels=this.showScaleLabels;this.options.scaleFontSize=this.style.fontSize;this.options.pointLabelFontSize=this.options.scaleFontSize;this.options.scaleFontColor=this.style.textColor;this.options.scaleBackdropColor=this.style.fillColor;this.options.angleLineColor=this.options.scaleLineColor;if(this.isIcon){this.options.scaleShowLabels=false;this.options.scaleFontSize=8;this.options.pointLabelFontSize=6}return this.options};UIRadarChart.prototype.paintChart=function(a,d,b){var c=new Chart(a).Radar(d,b);delete c;return};UIRadarChart.prototype.getDefaultData=function(){var a={labels:["1","2","3","4","5","6","7"],datasets:[{fillColor:"rgba(220,220,220,0.5)",strokeColor:"rgba(220,220,220,1)",pointColor:"rgba(220,220,220,1)",pointStrokeColor:"#fff",data:[65,59,90,81,56,55,40]},{fillColor:"rgba(151,187,205,0.5)",strokeColor:"rgba(151,187,205,1)",pointColor:"rgba(151,187,205,1)",pointStrokeColor:"#fff",data:[28,48,40,19,96,27,100]}]};return a};function UIRadarChartCreator(b){var a=[b,"ui-radar-chart",null,1];ShapeCreator.apply(this,a);this.createShape=function(d){var c=new UIRadarChart();return c.initUIRadarChart(this.type)};return}function UIPolarAreaChart(){return}UIPolarAreaChart.prototype=new UIChart();UIPolarAreaChart.prototype.isUIPolarAreaChart=true;UIPolarAreaChart.prototype.initUIPolarAreaChart=function(a){return this.initUIChart(a,200,200)};UIPolarAreaChart.prototype.getCustomProp=function(){var a='		<label class="description" for="fontsize">'+dappGetText("Font Size")+':</label>		<input id="fontsize"  class="element text small" type="number" value="0"/> 		<label class="description" for="textcolor">'+dappGetText("Text Color")+':</label>		<input id="textcolor"  class="element text small" type="text" value="0"/> 		<label class="description" for="scalelinecolor">'+dappGetText("Scale Line Color")+':</label>		<input id="scalelinecolor"  class="element text small" type="text" value="0"/> 		<label class="description" for="backdropcolor">'+dappGetText("Backdrop Color")+':</label>		<input id="backdropcolor"  class="element text small" type="text" value="0"/> 		<input id="showscalelabels" class="checkbox_i"  type="checkbox" >'+dappGetText("Show Scale Labels")+'</input> 		<label class="description" for="data">'+dappGetText("Data")+':</label>		<textarea id="data"  rows="8" cols="60" type="text" value=""></textarea>';return a};UIPolarAreaChart.prototype.loadCustomProp=function(b){var a=this;b.fontsize.value=this.style.fontSize;b.fontsize.onchange=function(d){var c=parseInt(this.value);a.style.setFontSize(c);return};b.textcolor.value=this.style.textColor;b.textcolor.onchange=function(c){a.style.setTextColor(this.value);return};b.scalelinecolor.value=this.style.lineColor;b.scalelinecolor.onchange=function(c){a.style.setLineColor(this.value);return};b.backdropcolor.value=this.style.fillColor;b.backdropcolor.onchange=function(c){a.setFillColor(this.value);return};b.showscalelabels.checked=this.showScaleLabels;b.showscalelabels.onchange=function(c){a.showScaleLabels=this.checked;return};b.data.value=this.getValue();b.data.onchange=function(c){a.setValue(this.value);return};return};UIPolarAreaChart.prototype.getOptions=function(){this.options.scaleLineColor=this.style.lineColor;this.options.scaleShowLabels=this.showScaleLabels;this.options.scaleFontSize=this.style.fontSize;this.options.pointLabelFontSize=this.options.scaleFontSize;this.options.scaleFontColor=this.style.textColor;this.options.scaleBackdropColor=this.style.fillColor;this.options.angleLineColor=this.options.scaleLineColor;if(this.isIcon){this.options.scaleShowLabels=false;this.options.scaleFontSize=8;this.options.pointLabelFontSize=6}return this.options};UIPolarAreaChart.prototype.paintChart=function(a,d,b){var c=new Chart(a).PolarArea(d,b);delete c;return};UIPolarAreaChart.prototype.getDefaultData=function(){var a=[{value:30,color:"#D97041"},{value:90,color:"#C7604C"},{value:24,color:"#21323D"},{value:58,color:"#9D9B7F"},{value:82,color:"#7D4F6D"},{value:8,color:"#584A5E"}];return a};function UIPolarAreaChartCreator(b){var a=[b,"ui-polar-area-chart",null,1];ShapeCreator.apply(this,a);this.createShape=function(d){var c=new UIPolarAreaChart();return c.initUIPolarAreaChart(this.type)};return}function UIPieChart(){return}UIPieChart.prototype=new UIChart();UIPieChart.prototype.isUIPieChart=true;UIPieChart.prototype.initUIPieChart=function(a){return this.initUIChart(a,200,200)};UIPieChart.prototype.getCustomProp=function(){var a='		<label class="description" for="fontsize">'+dappGetText("Font Size")+':</label>		<input id="fontsize"  class="element text small" type="number" value="0"/> 		<label class="description" for="textcolor">'+dappGetText("Text Color")+':</label>		<input id="textcolor"  class="element text small" type="text" value="0"/> 		<label class="description" for="scalelinecolor">'+dappGetText("Scale Line Color")+':</label>		<input id="scalelinecolor"  class="element text small" type="text" value="0"/> 		<label class="description" for="backdropcolor">'+dappGetText("Backdrop Color")+':</label>		<input id="backdropcolor"  class="element text small" type="text" value="0"/> 		<input id="showscalelabels" class="checkbox_i"  type="checkbox" >'+dappGetText("Show Scale Labels")+'</input> 		<label class="description" for="data">'+dappGetText("Data")+':</label>		<textarea id="data"  rows="8" cols="60" type="text" value=""></textarea>';return a};UIPieChart.prototype.loadCustomProp=function(b){var a=this;b.fontsize.value=this.style.fontSize;b.fontsize.onchange=function(d){var c=parseInt(this.value);a.style.setFontSize(c);return};b.textcolor.value=this.style.textColor;b.textcolor.onchange=function(c){a.style.setTextColor(this.value);return};b.scalelinecolor.value=this.style.lineColor;b.scalelinecolor.onchange=function(c){a.style.setLineColor(this.value);return};b.backdropcolor.value=this.style.fillColor;b.backdropcolor.onchange=function(c){a.setFillColor(this.value);return};b.showscalelabels.checked=this.showScaleLabels;b.showscalelabels.onchange=function(c){a.showScaleLabels=this.checked;return};b.data.value=this.getValue();b.data.onchange=function(c){a.setValue(this.value);return};return};UIPieChart.prototype.getOptions=function(){this.options.scaleLineColor=this.style.lineColor;this.options.scaleShowLabels=this.showScaleLabels;this.options.scaleFontSize=this.style.fontSize;this.options.pointLabelFontSize=this.options.scaleFontSize;this.options.scaleFontColor=this.style.textColor;this.options.scaleBackdropColor=this.style.fillColor;this.options.angleLineColor=this.options.scaleLineColor;if(this.isIcon){this.options.scaleShowLabels=false;this.options.scaleFontSize=8;this.options.pointLabelFontSize=6}return this.options};UIPieChart.prototype.paintChart=function(a,d,b){var c=null;if(this.type==="ui-doughnut-chart"){c=new Chart(a).Pie(d,b)}else{c=new Chart(a).Doughnut(d,b)}delete c;return};UIPieChart.prototype.getDefaultData=function(){var a=[{value:30,color:"#F38630"},{value:50,color:"#E0E4CC"},{value:100,color:"#69D2E7"}];return a};function UIPieChartCreator(b){var a=[b,"ui-pie-chart",null,1];ShapeCreator.apply(this,a);this.createShape=function(d){var c=new UIPieChart();return c.initUIPieChart(this.type)};return}var shapeFactory=ShapeFactoryGet();shapeFactory.addShapeCreator(new UIBarChartCreator("ui-bar-chart"),C_UI_ELEMENTS);shapeFactory.addShapeCreator(new UIBarChartCreator("ui-line-chart"),C_UI_ELEMENTS);shapeFactory.addShapeCreator(new UIRadarChartCreator("ui-radar-chart"),C_UI_ELEMENTS);shapeFactory.addShapeCreator(new UIPolarAreaChartCreator("ui-polar-area-chart"),C_UI_ELEMENTS);shapeFactory.addShapeCreator(new UIPieChartCreator("ui-pie-chart"),C_UI_ELEMENTS);shapeFactory.addShapeCreator(new UIPieChartCreator("ui-doughnut-chart"),C_UI_ELEMENTS);shapeFactory.addShapeCreator(new UIChartLegendItemCreator(),C_UI_ELEMENTS);shapeFactory.addShapeCreator(new UIChartLegendCreator(),C_UI_ELEMENTS);function webappInit(a){dappRegisterUIElements();if(a===C_APP_TYPE_PREVIEW){document.body.style.overflow="scroll"}else{document.body.style.overflow="hidden"}return}function WebApp(b){var a=["idraw_canvas",b];AppBase.apply(this,a);webappInit(b);this.onSizeChanged=function(){var e=getViewPort();if(e.width===this.viewPort.width&&e.height===this.viewPort.height){console.log("onSizeChanged: size is not changed.");return}this.adjustCanvasSize();var c=this.canvas.width;var d=this.canvas.height;console.log("onSizeChanged: w="+c+" h="+d);this.manager.resize(c,d);this.win.resize(c,d);this.view.resize(c,d);this.view.resizeWindowManager(c,d);this.view.moveEditor();this.viewPort=e};this.exitApp=function(){if(isTizen()){tizen.application.getCurrentApplication().exit()}else{if(navigator.app){navigator.app.exitApp()}}console.log("exitApp");return};this.viewPort=getViewPort();return this}WebApp.prototype.runWithURL=function(c){var a={};var b=this;a.url=c;a.headers={};a.method="GET";a.noCache=true;a.onDone=function(e,g,f){var d=g.responseText;b.runWithData(d);return};httpDoRequest(a);console.log("dataURL:"+c);return};WebApp.prototype.createWindow=function(){var a=0;var e=0;var c=this.canvas.width;var d=this.canvas.height;this.win=new Window(this.manager,0,0,c,d);this.win.theme[0].bg="White";this.view=new AppView(this.win,a,e,c,d,this);this.view.forPreview=this.type===C_APP_TYPE_PREVIEW;var b=this.view;this.win.onGesture=function(f){return b.onGesture(f)};return};WebApp.prototype.showWindow=function(){this.view.showIt();this.win.showAll(1);return};WebApp.prototype.runWithData=function(a){this.createWindow();this.view.loadFromJson(a);this.showWindow();return};WebApp.prototype.previewWithDeviceData=function(a){this.createWindow();this.view.fixDeviceConfig(a);this.view.meta=a.meta;this.view.device=ShapeFactoryGet().createShape(a.type,C_CREATE_FOR_PROGRAM);this.view.device.fromJson(a);this.view.createWindowManager=function(){var c=null;var b=this.getWindowManager();this.beforeLoad(a);this.afterLoad(a);return b};this.showWindow();return};WebApp.prototype.runWithDeviceData=function(a){this.createWindow();this.view.fixDeviceConfig(a);this.view.device=a;this.view.meta=a.meta;this.view.createWindowManager=function(){var c=null;var b=this.getWindowManager();c=b;this.beforeLoad(a);b=ShapeFactoryGet().createShape(c.type,C_CREATE_FOR_PROGRAM);b.fromJson(c);this.afterLoad(a);return b};this.showWindow();return};function webappRunWithData(a){var b=new WebApp(C_APP_TYPE_WEBAPP);b.runWithData(a);return b}function webappRunWithDeviceData(a){var b=new WebApp(C_APP_TYPE_WEBAPP);b.runWithDeviceData(a);return b}function webappPreviewWithDeviceData(a){var b=new WebApp(C_APP_TYPE_PREVIEW);b.previewWithDeviceData(a);return b}function webappPreviewWithData(a){var b=new WebApp(C_APP_TYPE_PREVIEW);b.runWithData(a);return b}function webappRunWithURL(b){var a=new WebApp(C_APP_TYPE_WEBAPP);a.runWithURL(b);return a}function webappPreviewWithURL(b){var a=new WebApp(C_APP_TYPE_PREVIEW);a.runWithURL(b);return a}function shapeFixImagePath(g,c,d){var h=c.version;var f=c.platform;var o=c.lcdDensity;var j=d.version;var b=d.platform;var p=d.lcdDensity;for(var m in g.images){var l=g.images[m];if(m==="display"){continue}var a=l;if(a){a=a.replaceAll("/"+h+"/","/"+j+"/");a=a.replaceAll("/"+f+"/","/"+b+"/");a=a.replaceAll("/"+o+"/","/"+p+"/");g.images[m]=a}}if(g.children){for(var e=0;e<g.children.length;e++){shapeFixImagePath(g.children[e],c,d)}}return}function AppView(d,a,f,b,c,e){ViewBase.apply(this,arguments);this.allUserAppScriptsLoaded=false;this.forPreview=false;this.postRedraw=function(g){if(!this.allUserAppScriptsLoaded){return}var h=this.getAbsPosition();if(!g){g={x:0,y:0,w:this.rect.w,h:this.rect.h}}g.x=h.x+g.x;g.y=h.y+g.y;this.getManager().postRedraw(g)};this.init=function(){this.platform="windowphone";if(browser.versions.android){this.platform="android"}else{if(browser.versions.iPhone){this.platform="iphone"}}return};this.showPageIndicator=function(g){return};this.showLogo=function(g){return};this.drawGrid=function(g){return};this.onGesture=function(h){if(this.windowManager){var g=this.windowManager.getCurrentFrame();if(g){g.onGesture(h)}}return};this.setTarget=function(h){for(var j=this.allShapes.length-1;j>=0;j--){var l=this.allShapes[j];if(h!==l){l.setSelected(false)}}this.targetShape=h;return};this.onPointerDown=function(l){var g=this.translatePoint(l);this.pointerDownPosition.x=g.x;this.pointerDownPosition.y=g.y;this.lastPointerPosition.x=g.x;this.lastPointerPosition.y=g.y;this.updateLastPointerPoint(g);for(var j=this.allShapes.length-1;j>=0;j--){var h=this.allShapes[j];if(h.onPointerDown(g)){this.setTarget(h);break}}this.postRedraw();return};this.onPointerMove=function(h){var g=this.translatePoint(h);this.updateLastPointerPoint(g);if(this.targetShape){this.targetShape.onPointerMove(g);if(this.targetShape.pointerDown){this.postRedraw()}return}return};this.onPointerUp=function(h){var g=this.translatePoint(h);this.updateLastPointerPoint(g);if(this.targetShape){this.targetShape.onPointerUp(g);this.postRedraw()}return};this.onKeyDown=function(g){if(this.targetShape){this.targetShape.onKeyDown(g);this.postRedraw()}return};this.onKeyUp=function(g){if(this.targetShape){this.targetShape.onKeyUp(g);this.postRedraw()}return};this.extractDevices=function(o){this.devices=new Array();for(var g=0;g<o.pages.length;g++){var m=o.pages[g];for(var j=0;j<m.shapes.length;j++){var h=m.shapes[j];if(h.type==="ui-device"){if(!this.forPreview){h.images={display:0};this.fixDeviceConfig(h)}var l=ShapeFactoryGet().createShape(h.type,C_CREATE_FOR_PROGRAM);if(l){l.fromJson(h)}this.devices.push(l)}}}return this.devices.length};this.getDevice=function(){if(!this.device){for(var h=0;h<this.devices.length;h++){var j=this.devices[h];var g=j.config;if(!j.config){continue}if(g.platform!=this.platform){continue}this.device=j}if(!this.device){this.device=this.devices[0]}}return this.device};this.getScreen=function(){if(!this.screen){var h=this.getDevice();for(var g=0;g<h.children.length;g++){var j=h.children[g];if(j.isUIScreen){this.screen=j}}}return this.screen};this.getWindowManager=function(j){if(!this.windowManager){var g=this.getScreen();for(var h=0;h<g.children.length;h++){var l=g.children[h];if(l.isUIWindowManager){this.windowManager=l;if(j){g.children.remove(l);l.parentShape=null}break}}}return this.windowManager};this.detectDeviceConfig=function(){if(this.detectedDeviceConfig){return this.detectedDeviceConfig}var h={version:4};if(isAndroid()){h.platform="android"}else{if(isIPhone()||isIPad()){h.platform="iphone"}else{if(isFirefoxMobile()){h.platform="firefox"}else{if(isWinPhone()){h.platform="winphone"}else{if(isTizen()){h.platform="tizen"}else{h.platform="android"}}}}}if(window.devicePixelRatio>1.5){h.lcdDensity="xhdpi"}else{if(window.devicePixelRatio>1.1){h.lcdDensity="hdpi"}else{if(window.devicePixelRatio>0.8){h.lcdDensity="mdpi"}else{if(!window.devicePixelRatio){var g=Math.min(window.orgViewPort.width,window.orgViewPort.height);if(g>600){h.lcdDensity="xhdpi"}else{h.lcdDensity="hdpi"}}else{h.lcdDensity="ldpi"}}}}if(isFirefoxMobile()){h.lcdDensity="mdpi"}h.screenW=this.rect.w;h.screenH=this.rect.h;this.detectedDeviceConfig=h;console.log("deviceConfig.lcdDensity:"+h.lcdDensity);console.log("deviceConfig.screenW:"+h.screenW);console.log("deviceConfig.screenH:"+h.screenH);return h};this.showIt=function(){if(this.forPreview){this.showDevice()}else{this.showWindowManager()}this.targetShape=this.getWindowManager();console.log("Set targetShape: "+this.targetShape.type);var g=this;setTimeout(function(){g.postRedraw()},3000);return};this.showDevice=function(){var q=0;var p=0;var r=this.rect.w;var o=this.rect.h;var j=this.getDevice();var g=j.toJson();var u=null;for(var m=0;m<g.children.length;m++){var l=g.children[m];if(l.type==="ui-screen"){u=l}}g.children.clear();g.children.push(u);j=ShapeFactoryGet().createShape(g.type,C_CREATE_FOR_PROGRAM);j.fromJson(g);var t=getViewPort();if(j.h<t.height&&j.w<t.width){p=(t.height-j.h)/2;document.body.style.overflow="hidden"}q=(r-j.w)/2;j.move(q,p);j.setMode(C_MODE_RUNNING,true);this.addShape(j);this.device=j;var s=this.getWindowManager();this.runApp(s)};this.getDeviceConfig=function(){var g=this.getDevice();return g?g.config:null};this.resizeWindowManager=function(g,j){if(this.windowManager){this.windowManager.setSizeLimit(g,j,g,j);this.windowManager.resize(g,j);console.log("this.windowManager.x="+this.windowManager.x);console.log("this.windowManager.y="+this.windowManager.y);console.log("this.windowManager.w="+this.windowManager.w);console.log("this.windowManager.h="+this.windowManager.h);var l=this.windowManager;setTimeout(function(){l.postRedraw()},200)}return};this.moveEditor=function(){wtkMoveEditorWhenResize();return};this.createWindowManager=function(){return this.getWindowManager(true)};this.fixDeviceConfig=function(j){var g=j.config;var h=this.detectDeviceConfig();if(e.type===C_APP_TYPE_PREVIEW){h.lcdDensity=g.lcdDensity;console.log("run in preview mode.")}if(h.platform!==g.platform&&h.version!==g.version&&h.lcdDensity!==g.lcdDensity){shapeFixImagePath(j,g,h)}return};this.getUserAppScripts=function(){if(this.meta){return this.meta.extlibs}return null};this.runApp=function(l){var h=this;var g=this.getUserAppScripts();if(!g||!g.length){h.allUserAppScriptsLoaded=true;l.systemInit();l.showInitWindow();l.postRedraw();return}for(var j=0;j<g.length;j++){addUserAppScript(g[j])}loadUserAppScripts(function(){console.log("All User App Scripts Loaded");h.allUserAppScriptsLoaded=true;l.systemInit();l.showInitWindow();l.postRedraw()});return};this.showWindowManager=function(){var m=null;var g=this.rect.w;var l=this.rect.h;var j=this.detectDeviceConfig();m=this.createWindowManager();m.deviceConfig=this.getDeviceConfig();if(e.type===C_APP_TYPE_PREVIEW){j.lcdDensity=m.deviceConfig.lcdDensity}m.setDeviceConfig(j);m.setSizeLimit(g,l,g,l);m.setSize(g,l);m.move(0,0);m.setMode(C_MODE_RUNNING,true);this.addShape(m);this.runApp(m);this.windowManager=m;console.log("w:"+g+" h:"+l);return};this.loadJson=function(g){this.meta=g.meta;this.beforeLoad(g);if(!g||!g.pages||!this.extractDevices(g)){console.log("It is not a valid webapp.");return}this.afterLoad(g);return};this.init();return this}function dappGetText(a){return a}function dappIsEditorApp(){return false};console.log("motk.js build at 2014年 01月 11日 星期六 15:30:56 CST ");
